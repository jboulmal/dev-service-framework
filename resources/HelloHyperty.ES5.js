!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.activate=e()}}(function(){var e;return function t(e,n,o){function r(a,c){if(!n[a]){if(!e[a]){var s="function"==typeof require&&require;if(!c&&s)return s(a,!0);if(i)return i(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var f=n[a]={exports:{}};e[a][0].call(f.exports,function(t){var n=e[a][1][t];return r(n?n:t)},f,f.exports,t,e,n,o)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<o.length;a++)r(o[a]);return r}({1:[function(t,n,o){"use strict";function r(e){return new Promise(function(t,n){i(e,t,n)})}var i=null,a=null,c=null,s=null,u=null,f=null,l={log:function(){"undefined"!=typeof n||"function"==typeof t&&"function"==typeof e||console.log.apply(console,arguments)},extractVersion:function(e,t,n){var o=e.match(t);return o&&o.length>=n&&parseInt(o[n])}};if("object"==typeof window&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return"mozSrcObject"in this?this.mozSrcObject:this._srcObject},set:function(e){"mozSrcObject"in this?this.mozSrcObject=e:(this._srcObject=e,this.src=URL.createObjectURL(e))}}),i=window.navigator&&window.navigator.getUserMedia),a=function(e,t){e.srcObject=t},c=function(e,t){e.srcObject=t.srcObject},"undefined"!=typeof window&&window.navigator)if(navigator.mozGetUserMedia&&window.mozRTCPeerConnection){if(l.log("This appears to be Firefox"),s="firefox",u=l.extractVersion(navigator.userAgent,/Firefox\/([0-9]+)\./,1),f=31,window.RTCPeerConnection=function(e,t){if(38>u&&e&&e.iceServers){for(var n=[],o=0;o<e.iceServers.length;o++){var r=e.iceServers[o];if(r.hasOwnProperty("urls"))for(var i=0;i<r.urls.length;i++){var a={url:r.urls[i]};0===r.urls[i].indexOf("turn")&&(a.username=r.username,a.credential=r.credential),n.push(a)}else n.push(e.iceServers[o])}e.iceServers=n}return new mozRTCPeerConnection(e,t)},window.RTCSessionDescription||(window.RTCSessionDescription=mozRTCSessionDescription),window.RTCIceCandidate||(window.RTCIceCandidate=mozRTCIceCandidate),i=function(e,t,n){var o=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var o=e[n]="object"==typeof e[n]?e[n]:{ideal:e[n]};if((void 0!==o.min||void 0!==o.max||void 0!==o.exact)&&t.push(n),void 0!==o.exact&&("number"==typeof o.exact?o.min=o.max=o.exact:e[n]=o.exact,delete o.exact),void 0!==o.ideal){e.advanced=e.advanced||[];var r={};"number"==typeof o.ideal?r[n]={min:o.ideal,max:o.ideal}:r[n]=o.ideal,e.advanced.push(r),delete o.ideal,Object.keys(o).length||delete e[n]}}}),t.length&&(e.require=t),e};return 38>u&&(l.log("spec: "+JSON.stringify(e)),e.audio&&(e.audio=o(e.audio)),e.video&&(e.video=o(e.video)),l.log("ff37: "+JSON.stringify(e))),navigator.mozGetUserMedia(e,t,n)},navigator.getUserMedia=i,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:r,addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){var t=[{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}];e(t)})},41>u){var d=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return d().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}}else if(navigator.webkitGetUserMedia&&window.webkitRTCPeerConnection){l.log("This appears to be Chrome"),s="chrome",u=l.extractVersion(navigator.userAgent,/Chrom(e|ium)\/([0-9]+)\./,2),f=38,window.RTCPeerConnection=function(e,t){e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy);var n=new webkitRTCPeerConnection(e,t),o=n.getStats.bind(n);return n.getStats=function(e,t,n){var r=this,i=arguments;if(arguments.length>0&&"function"==typeof e)return o(e,t);var a=function(e){var t={},n=e.result();return n.forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t};if(arguments.length>=2){var c=function(e){i[1](a(e))};return o.apply(this,[c,arguments[0]])}return new Promise(function(t,n){1===i.length&&null===e?o.apply(r,[function(e){t.apply(null,[a(e)])},n]):o.apply(r,[t,n])})},n},["createOffer","createAnswer"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var n=1===arguments.length?arguments[0]:void 0;return new Promise(function(o,r){t.apply(e,[o,r,n])})}return t.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=webkitRTCPeerConnection.prototype[e];webkitRTCPeerConnection.prototype[e]=function(){var e=arguments,n=this;return new Promise(function(o,r){t.apply(n,[e[0],function(){o(),e.length>=2&&e[1].apply(null,[])},function(t){r(t),e.length>=3&&e[2].apply(null,[t])}])})}});var v=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var o="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==o.exact&&"number"==typeof o.exact&&(o.min=o.max=o.exact);var r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==o.ideal){t.optional=t.optional||[];var i={};"number"==typeof o.ideal?(i[r("min",n)]=o.ideal,t.optional.push(i),i={},i[r("max",n)]=o.ideal,t.optional.push(i)):(i[r("",n)]=o.ideal,t.optional.push(i))}void 0!==o.exact&&"number"!=typeof o.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=o.exact):["min","max"].forEach(function(e){void 0!==o[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=o[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t};if(i=function(e,t,n){return e.audio&&(e.audio=v(e.audio)),e.video&&(e.video=v(e.video)),l.log("chrome: "+JSON.stringify(e)),navigator.webkitGetUserMedia(e,t,n)},navigator.getUserMedia=i,navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:r,enumerateDevices:function(){return new Promise(function(e){var t={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(n){e(n.map(function(e){return{label:e.label,kind:t[e.kind],deviceId:e.id,groupId:""}}))})})}}),navigator.mediaDevices.getUserMedia){var p=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return l.log("spec:   "+JSON.stringify(e)),e.audio=v(e.audio),e.video=v(e.video),l.log("chrome: "+JSON.stringify(e)),p(e)}}else navigator.mediaDevices.getUserMedia=function(e){return r(e)};"undefined"==typeof navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){l.log("Dummy mediaDevices.addEventListener called.")}),"undefined"==typeof navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){l.log("Dummy mediaDevices.removeEventListener called.")}),a=function(e,t){u>=43?e.srcObject=t:"undefined"!=typeof e.src?e.src=URL.createObjectURL(t):l.log("Error attaching stream to element.")},c=function(e,t){u>=43?e.srcObject=t.srcObject:e.src=t.src}}else navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/)?(l.log("This appears to be Edge"),s="edge",u=l.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2),f=12):l.log("Browser does not appear to be WebRTC-capable");else l.log("This does not appear to be a browser"),s="not a browser";var y={};try{Object.defineProperty(y,"version",{set:function(e){u=e}})}catch(b){}if("undefined"!=typeof n){var h;"undefined"!=typeof window&&(h=window.RTCPeerConnection),n.exports={RTCPeerConnection:h,getUserMedia:i,attachMediaStream:a,reattachMediaStream:c,webrtcDetectedBrowser:s,webrtcDetectedVersion:u,webrtcMinimumVersion:f,webrtcTesting:y,webrtcUtils:l}}else"function"==typeof t&&"function"==typeof e&&e([],function(){return{RTCPeerConnection:window.RTCPeerConnection,getUserMedia:i,attachMediaStream:a,reattachMediaStream:c,webrtcDetectedBrowser:s,webrtcDetectedVersion:u,webrtcMinimumVersion:f,webrtcTesting:y,webrtcUtils:l}})},{}],2:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t,n){return{hypertyName:"HelloHyperty",hypertyCode:new f(e,t,n)}}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();n["default"]=i;var c=e("../src/service-framework"),s=e("../src/hyperty/HypertyConnector"),u=o(s),f=function(){function e(t,n,o){r(this,e),console.log("World Hyperty Instance");var i=this;i.bus=n,i.configuration=o,i.hypertyURL=t;var a=new c.Syncher(t,n,o);i.syncher=a,i.syncher.onNotification(function(e){console.log("hyperty hello have an notification: ",e),i.hypertyConnector._onNotification(e,t)}),i.hypertyConnector=new u["default"](a),i.hypertyConnector.name="Hello Hyperty"}return a(e,[{key:"connect",value:function(e,t){var n=this;return n.to=e,new Promise(function(o,r){console.info("Connecting to: ",e),n.hypertyConnector.connect(e,t).then(function(t){console.info("Connected to: ",e,t),o(t)})["catch"](function(e){r(e)})})}},{key:"accept",value:function(){var e=this;return new Promise(function(t,n){console.info("Subscribing object"),e.hypertyConnector.accept().then(function(e){console.info("subscribed to: ",e),t(e)})["catch"](function(e){console.error(e),n(e)})})}},{key:"disconnect",value:function(){var e=this;return new Promise(function(t,n){console.info("disconnecting object"),e.hypertyConnector.disconnect().then(function(e){console.info("disconnected"),t(e)})["catch"](function(e){console.error(e),n(e)})})}},{key:"sendMessage",value:function(){var e=this;e.bus.postMessage({from:e.hypertyURL,to:"hyperty-runtime://sp1/WorldHyperty",body:{value:"Hello from world hyperty instance"}})}}]),e}();t.exports=n["default"]},{"../src/hyperty/HypertyConnector":4,"../src/service-framework":5}],3:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=function(e,t,n){for(var o=!0;o;){var r=e,i=t,a=n;o=!1,null===r&&(r=Function.prototype);var c=Object.getOwnPropertyDescriptor(r,i);if(void 0!==c){if("value"in c)return c.value;var s=c.get;if(void 0===s)return;return s.call(a)}var u=Object.getPrototypeOf(r);if(null===u)return;e=u,t=i,n=a,o=!0,c=u=void 0}};e("webrtc-adapter-test");var s=e("../utils/EventEmitter"),u=o(s),f=function(e){function t(){r(this,t),c(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var e=this;e.mode="offer",e.mediaConstraints={optional:[],mandatory:{offerToReceiveAudio:!0,offerToReceiveVideo:!0}};var n=new RTCPeerConnection;n.addEventListener("signalingstatechange",function(t){"have-remote-offer"===t.currentTarget.signalingState&&(e.mode="answer",e.trigger("controller:state:change",e.mode)),"have-local-offer"===t.currentTarget.signalingState&&e.trigger("controller:state:change",e.mode)}),n.addEventListener("iceconnectionstatechange",function(e){console.info(e.currentTarget.iceConnectionState)}),n.addEventListener("icecandidate",function(t){if(t.candidate){var n=e._connectionDataObjectReporter.data;n.ice={type:"candidate",candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex}}}),n.addEventListener("addstream",function(t){console.log("add stream from mode: ",e.mode),e.trigger("stream:added",URL.createObjectURL(t.stream))}),e.peerConnection=n}return i(t,e),a(t,[{key:"getUserMedia",value:function(e){var t=this;return new Promise(function(n,o){navigator.mediaDevices.getUserMedia(e).then(function(e){t.peerConnection.addStream(e),n(e)})["catch"](function(e){o(e)})})}},{key:"changePeerInformation",value:function(){var e=this;e._connectionDataObjectObserver.onChange("*",function(t){console.debug("message:",t);var n=t.data;"offer"===n.type||"answer"===n.type?e.peerConnection.setRemoteDescription(new RTCSessionDescription(n),e.remoteDescriptionSuccess,e.remoteDescriptionError):"candidate"===n.type&&e.peerConnection.addIceCandidate(new RTCIceCandidate({candidate:n.candidate}))})}},{key:"remoteDescriptionSuccess",value:function(){console.log("remote success")}},{key:"remoteDescriptionError",value:function(e){console.error("error: ",e)}},{key:"createOffer",value:function(){var e=this;e.peerConnection.createOffer(function(t){e.onLocalSessionCreated(t)},e.logError,e.mediaConstraints)}},{key:"createAnswer",value:function(){var e=this;e.peerConnection.createAnswer(function(t){e.onLocalSessionCreated(t)},e.logError)}},{key:"disconnect",value:function(){var e=this;return new Promise(function(t,n){try{e.peerConnection.close(),t(!0)}catch(o){n("error disconnecting connection")}})}},{key:"onLocalSessionCreated",value:function(e){var t=this,n=t.peerConnection;n.setLocalDescription(e,function(){var n=t._connectionDataObjectReporter.data;n.sdp={sdp:e.sdp,type:e.type}},t.logError)}},{key:"logError",value:function(e){console.error(e.toString(),e)}},{key:"connectionDataObjectReporter",set:function(e){if(!e)throw new Error("The Connection Data Object is a needed parameter");var t=this;t._connectionDataObjectReporter=e,e.onSubscription(function(e){e.accept(),"offer"===t.mode?t.createOffer():t.createAnswer()}),console.log("Set connectionDataObject: ",t._connectionDataObjectReporter)},get:function(){var e=this;return e._connectionDataObjectReporter}},{key:"connectionDataObjectObserver",set:function(e){if(!e)throw new Error("The Connection Data Object is a needed parameter");var t=this;t._connectionDataObjectObserver=e,console.log("Set connectionDataObject: ",t._connectionDataObjectObserver),t.changePeerInformation()},get:function(){var e=this;return e._connectionDataObjectObserver}}]),t}(u["default"]);n["default"]=f,t.exports=n["default"]},{"../utils/EventEmitter":10,"webrtc-adapter-test":1}],4:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),c=function(e,t,n){for(var o=!0;o;){var r=e,i=t,a=n;o=!1,null===r&&(r=Function.prototype);var c=Object.getOwnPropertyDescriptor(r,i);if(void 0!==c){if("value"in c)return c.value;var s=c.get;if(void 0===s)return;return s.call(a)}var u=Object.getPrototypeOf(r);if(null===u)return;e=u,t=i,n=a,o=!0,c=u=void 0}},s=(e("../utils/utils"),e("./ConnectionController")),u=o(s),f=e("../utils/EventEmitter"),l=o(f),d=function(e){function t(e){if(r(this,t),!e)throw new Error("The Syncher is a needed parameter");c(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e);var n=this;n.mode="offer",n.connectionController=new u["default"],n.connectionController.addEventListener("controller:state:change",function(e){"answer"===e&&(n.mode=e,n._autoConnect(n.notificationEvent.from))}),e.onNotification(function(e){console.log("connector have an notification: ",e),n.notificationEvent=e;var t={type:e.type,owner:e.value.owner,from:e.from,to:e.value.to,resources:e.value.resources};"create"===e.type&&e.value.owner?n.trigger("connector:notification",t):n._autoAccept(e.url)}),n._syncher=e}return i(t,e),a(t,[{key:"connect",value:function(e,t){var n=this;return t=t||{video:!0,audio:!0},new Promise(function(o,r){n.connectionController.getUserMedia(t).then(function(o){console.log("Get webRTC common resources",o,e);var r={};return r.owner=!0,r.to=e,r.resources={video:t.video,audio:t.audio},n._syncher.create({},[e],r)}).then(function(e){console.log("Return Create Connection Data Object",e),n.connectionController.connectionDataObjectReporter=e,o(n.connectionController)})["catch"](function(e){console.error(e),r(e)})})}},{key:"accept",value:function(){var e=this;return new Promise(function(t,n){var o=e.notificationEvent.url;e._syncher.subscribe(o).then(function(t){console.log("Return Subscribe Connection Data Object",t),e.connectionController.connectionDataObjectObserver=t;var n=t.data.resources;return e.connectionController.getUserMedia(n)}).then(function(n){console.log("Get webRTC common resources",n),t(e.connectionController)})["catch"](function(e){console.error(e)})})}},{key:"disconnect",value:function(){var e=this;return new Promise(function(t,n){e.connectionController.disconnect().then(function(e){console.log("disconnected: ",e),t(e)})["catch"](function(e){n(e)})})}},{key:"_autoConnect",value:function(e){var t=this;t._syncher.create({},[e],{}).then(function(e){console.log("Return Create Connection Data Object",e),t.connectionController.connectionDataObjectReporter=e})["catch"](function(e){console.error(e)})}},{key:"_autoAccept",value:function(e){var t=this;t._syncher.subscribe(e).then(function(e){console.log("Return Subscribe Connection Data Object",e),t.connectionController.connectionDataObjectObserver=e})}}]),t}(l["default"]);n["default"]=d,t.exports=n["default"]},{"../utils/EventEmitter":10,"../utils/utils":11,"./ConnectionController":3}],5:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var r=e("./syncher/Syncher"),i=o(r),a=e("./syncher/DataObjectReporter"),c=o(a),s=e("./syncher/DataObjectObserver"),u=o(s),f=e("./hyperty/HypertyConnector"),l=o(f);n.Syncher=i["default"],n.DataObjectReporter=c["default"],n.DataObjectObserver=u["default"],n.HypertyConnector=l["default"]},{"./hyperty/HypertyConnector":4,"./syncher/DataObjectObserver":6,"./syncher/DataObjectReporter":7,"./syncher/Syncher":9}],6:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=e("./SyncObject"),c=o(a),s={ANY:"any",START:"start",EXACT:"exact"},u=function(){function e(t,n,o,i,a){r(this,e);var s=this;s._version=0,s._owner=t,s._url=n,s._schema=o,s._status=i,s._syncObj=new c["default"](a),s._syncObj.observe(function(e){s._onFilter(e)}),s._filters={}}return i(e,[{key:"pause",value:function(){throw"Not implemented"}},{key:"resume",value:function(){throw"Not implemented"}},{key:"stop",value:function(){throw"Not implemented"}},{key:"onChange",value:function(e,t){var n=e,o={type:s.EXACT,callback:t},r=e.indexOf("*");r===e.length-1&&(0===r?o.type=s.ANY:(o.type=s.START,n=e.substr(0,e.length-1))),this._filters[n]=o}},{key:"_onFilter",value:function(e){var t=this;Object.keys(t._filters).forEach(function(n){var o=t._filters[n];o.type===s.ANY?o.callback(e):o.type===s.START?0===e.field.indexOf(n)&&o.callback(e):o.type===s.EXACT&&e.field===n&&o.callback(e)})}},{key:"_changeObject",value:function(e){var t=this;if(t._version+1===e.body.version){t._version++;var n=e.body.attrib,o=e.body.value,r=t._syncObj.findBefore(n);if(e.type===a.ChangeType.UPDATE)r.obj[r.last]=o;else if(e.type===a.ChangeType.ADD)if(e.body.oType===a.ObjectType.OBJECT)r.obj[r.last]=o;else{var i=r.obj,c=r.last;Array.prototype.splice.apply(i,[c,0].concat(o))}else if(e.body.oType===a.ObjectType.OBJECT)delete r.obj[r.last];else{var i=r.obj,c=r.last;i.splice(c,o)}}else console.log("unsynchronized versions")}},{key:"version",get:function(){return this._version}},{key:"owner",get:function(){return this._owner}},{key:"url",get:function(){return this._url}},{key:"schema",get:function(){return this._schema}},{key:"status",get:function(){return this._status}},{key:"data",get:function(){return this._syncObj.data}}]),e}();n["default"]=u,t.exports=n["default"]},{"./SyncObject":8}],7:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=e("./SyncObject"),c=o(a),s=e("../utils/utils.js"),u=function(){function e(t,n,o,i,a,s){r(this,e);var u=this;u._version=0,u._owner=t,u._url=n,u._schema=o,u._bus=i,u._subscriptions={},u._status=a,u._syncObj=new c["default"](s),u._syncObj.observe(function(e){u._onChange(e)})}return i(e,[{key:"pause",value:function(){}},{key:"resume",value:function(){}},{key:"stop",value:function(){}},{key:"onSubscription",value:function(e){this._onSubscriptionHandler=e}},{key:"_onForward",value:function(e){var t=this;switch(console.log("DataObjectReporter-RCV: ",e),e.body.type){case"subscribe":t._onSubscribe(e);break;case"unsubscribe":t._onUnSubscribe(e)}}},{key:"_onSubscribe",value:function(e){var t=this,n=e.body.from,o={type:e.body.type,url:n,accept:function(){t._subscriptions[n]={status:"on"},t._bus.postMessage({id:e.id,type:"response",from:e.to,to:e.from,body:{code:200,schema:t._schema,version:t._version,value:(0,s.deepClone)(t.data)}})},reject:function(n){t._bus.postMessage({id:e.id,type:"response",from:e.to,to:e.from,body:{code:403,desc:n}})}};t._onSubscriptionHandler&&t._onSubscriptionHandler(o)}},{key:"_onUnSubscribe",value:function(e){var t=this,n=e.body.from,o=t._subscriptions[n];delete t._subscriptions[n];var r={type:e.body.type,url:n,object:o};t._onSubscriptionHandler&&t._onSubscriptionHandler(r)}},{key:"_onChange",value:function(e){var t=this;t._version++,"on"===t._status&&t._bus.postMessage({type:e.cType,from:t._owner,to:t._url,body:{version:t._version,oType:e.oType,attrib:e.field,value:e.data}})}},{key:"version",get:function(){return this._version}},{key:"url",get:function(){return this._url}},{key:"schema",get:function(){return this._schema}},{key:"status",get:function(){return this._status}},{key:"data",get:function(){return this._syncObj.data}},{key:"subscriptions",get:function(){return this._subscriptions}}]),e}();n["default"]=u,t.exports=n["default"]},{"../utils/utils.js":11,"./SyncObject":8}],8:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=e("../utils/utils.js"),a=function(){function e(t){o(this,e);var n=this;n._observers=[],n._filters={},t?n._data=t:n._data={},n._internalObserve(new c,n._data)}return r(e,[{key:"observe",value:function(e){this._observers.push(e)}},{key:"find",value:function(e){var t=e.split(".");return this._findWithSplit(t)}},{key:"findBefore",value:function(e){var t={},n=e.split(".");return t.last=n.pop(),t.obj=this._findWithSplit(n),t}},{key:"_findWithSplit",value:function(e){var t=this._data;return e.forEach(function(e){t=t[e]}),t}},{key:"_fireEvent",value:function(e){this._observers.forEach(function(t){t(e)})}},{key:"_isObservable",value:function(e){return e.constructor===Object||e.constructor===Array?!0:!1}},{key:"_internalObserve",value:function(e,t){var n=this;if(n._isObservable(t)){var o=function(t){n._onChanges(e,t)};if(t.constructor===Object){Object.observe(t,o);for(var r in t)n._isObservable(t[r])&&n._internalObserve(e["new"](r),t[r])}else if(t.constructor===Array){Array.observe(t,o);for(var r in t)if(n._isObservable(t[r])){var i=e["new"](new s(t[r],r));n._internalObserve(i,t[r])}}}}},{key:"_onChanges",value:function(e,t){var n=this;for(var o in t){var r=t[o].object,a=void 0;if(r.constructor==Object&&(a=f.OBJECT),r.constructor==Array&&(a=f.ARRAY),"splice"===t[o].type)!function(){var c=t[o].index,f=e["new"](""+c),l=f.toString(),d=t[o].removed.length;if(0!==d){var v=t[o].removed;v.forEach(function(t,o){n._isObservable(t)&&e.removeIndex(c+o)}),n._fireEvent({cType:u.REMOVE,oType:a,field:l,data:d})}var p=t[o].addedCount;if(0!==p){var y=r.slice(c,c+p);y.forEach(function(t,o){if(n._isObservable(t)){var r=e["new"](new s(t,c+o));n._internalObserve(r,t)}}),n._fireEvent({cType:u.ADD,oType:a,field:l,data:(0,i.deepClone)(y)})}c!=r.length-1&&e.reIndexFrom(r)}();else{var c=e["new"](t[o].name),l=c.toString();if(-1!==l.indexOf("Symbol"))continue;var d=r[t[o].name];"update"===t[o].type&&this._fireEvent({cType:u.UPDATE,oType:a,field:l,data:(0,i.deepClone)(d)}),"add"===t[o].type&&(this._internalObserve(c,d),this._fireEvent({cType:u.ADD,oType:a,field:l,data:(0,i.deepClone)(d)})),"delete"===t[o].type&&this._fireEvent({cType:u.REMOVE,oType:a,field:l})}}}},{key:"data",get:function(){return this._data}}]),e}(),c=function(){function e(){o(this,e),this._path=[],this._observables={}}return r(e,[{key:"removeIndex",value:function(e){delete this._observables[e]}},{key:"reIndexFrom",value:function(e){var t=this;Object.keys(this._observables).forEach(function(n){var o=t._observables[n],r=e.indexOf(o.obj);o.idx!=r&&(o.idx=r,delete t._observables[n],t._observables[r]=o)})}},{key:"new",value:function(e){e.constructor==s&&(this._observables[e.idx]=e);var t=this.clone();return t._path.push(e),t}},{key:"clone",value:function(){var t=new e;return this._path.forEach(function(e){t._path.push(e)}),t}},{key:"toString",value:function(){var e="";return this._path.forEach(function(t,n){0===n?e=t.toString():e+="."+t.toString()}),e}}]),e}(),s=function(){function e(t,n){o(this,e),this.obj=t,this.idx=n}return r(e,[{key:"toString",value:function(){return this.idx.toString()}}]),e}(),u={UPDATE:"update",ADD:"add",REMOVE:"remove"};n.ChangeType=u;var f={OBJECT:"object",ARRAY:"array"};n.ObjectType=f,n["default"]=a},{"../utils/utils.js":11}],9:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=e("./DataObjectReporter"),c=o(a),s=e("./DataObjectObserver"),u=o(s),f=function(){function e(t,n,o){r(this,e);var i=this;i._owner=t,i._bus=n,i._subURL=o.runtimeURL+"/sm",i._reporters={},i._observers={},n.addListener(t,function(e){switch(console.log("Syncher-RCV: ",e),e.type){case"response":i._onResponse(e);break;case"forward":i._onForward(e);break;case"create":i._onCreate(e);break;case"update":i._onChange(e);break;case"add":i._onChange(e);break;case"remove":i._onChange(e)}})}return i(e,[{key:"create",value:function(e,t,n){var o=this,r={type:"create",from:o._owner,to:o._subURL,body:{schema:e,value:n,authorise:t}};return new Promise(function(t,i){o._bus.postMessage(r,function(r){if(console.log("create-response: ",r),200===r.body.code){var a=r.body.resource,s=new c["default"](o._owner,a,e,o._bus,"on",n);o._reporters[a]=s,t(s)}else i(r.body.desc)})})}},{key:"subscribe",value:function(e){var t=this,n=e+"/subscription",o={type:"subscribe",from:t._owner,to:n};return new Promise(function(n,r){t._bus.postMessage(o,function(o){if(console.log("subscribe-response: ",o),200===o.body.code){var i=t._addObserver(e,o.body.schema,o.body.value);n(i)}else r(o.body.desc)})})}},{key:"onResponse",value:function(e){this._onResponseHandler=e}},{key:"onNotification",value:function(e){this._onNotificationHandler=e}},{key:"_onResponse",value:function(e){console.log("onResponse:",e)}},{key:"_onForward",value:function(e){var t=this,n=t._reporters[e.body.to];n._onForward(e)}},{key:"_onCreate",value:function(e){var t=this,n={type:e.type,from:e.from,url:e.body.resource,schema:e.body.schema,value:e.body.value,ack:function(){t._bus.postMessage({id:e.id,type:"response",from:e.to,to:e.from,body:{code:200}})}};t._onNotificationHandler&&t._onNotificationHandler(n)}},{key:"_onChange",value:function(e){var t=this,n=t._observers[e.from];n._changeObject(e)}},{key:"_addObserver",value:function(e,t,n){var o=this,r=new u["default"](o._owner,e,t,"on",n);return o._observers[e]=r,r}},{key:"owner",get:function(){return this._owner}},{key:"reporters",get:function(){return this._reporters}},{key:"observers",get:function(){return this._observers}}]),e}();n["default"]=f,t.exports=n["default"]},{"./DataObjectObserver":6,"./DataObjectReporter":7}],10:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=function(){function e(){o(this,e)}return r(e,[{key:"addEventListener",value:function(e,t){var n=this;n[e]=t}},{key:"trigger",value:function(e,t){var n=this;n[e]&&n[e](t)}}]),e}();n["default"]=i,t.exports=n["default"]},{}],11:[function(e,t,n){"use strict";function o(e){var t=/([a-zA-Z-]*):\/\/(?:\.)?([-a-zA-Z0-9@:%._\+~#=]{2,256})([-a-zA-Z0-9@:%._\+~#=\/]*)/gi,n="$1,$2,$3",o=e.replace(t,n).split(","),r={type:o[0],domain:o[1],identity:o[2]};return r}function r(e){return JSON.parse(JSON.stringify(e))}Object.defineProperty(n,"__esModule",{value:!0}),n.divideURL=o,n.deepClone=r},{}]},{},[2])(2)});