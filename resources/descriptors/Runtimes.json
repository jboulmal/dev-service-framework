{
  "MyRuntime": {
    "cguid": 1,
    "runtimeType": "browser",
    "version": "0.1",
    "objectName": "MyRuntime",
    "description": "Description of MyRuntime",
    "language": "javascript",
    "hypertyCapabilities": {
      "mic": false
    },
    "protocolCapabilities": {
      "http": true
    },
    "sourcePackageURL": "/sourcePackage",
    "sourcePackage": {
      "sourceCode": "KGZ1bmN0aW9uKGYpe2lmKHR5cGVvZiBleHBvcnRzPT09Im9iamVjdCImJnR5cGVvZiBtb2R1bGUhPT0idW5kZWZpbmVkIil7bW9kdWxlLmV4cG9ydHM9ZigpfWVsc2UgaWYodHlwZW9mIGRlZmluZT09PSJmdW5jdGlvbiImJmRlZmluZS5hbWQpe2RlZmluZShbXSxmKX1lbHNle3ZhciBnO2lmKHR5cGVvZiB3aW5kb3chPT0idW5kZWZpbmVkIil7Zz13aW5kb3d9ZWxzZSBpZih0eXBlb2YgZ2xvYmFsIT09InVuZGVmaW5lZCIpe2c9Z2xvYmFsfWVsc2UgaWYodHlwZW9mIHNlbGYhPT0idW5kZWZpbmVkIil7Zz1zZWxmfWVsc2V7Zz10aGlzfWcucnVudGltZVVBID0gZigpfX0pKGZ1bmN0aW9uKCl7dmFyIGRlZmluZSxtb2R1bGUsZXhwb3J0cztyZXR1cm4gKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT0iZnVuY3Rpb24iJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKCJDYW5ub3QgZmluZCBtb2R1bGUgJyIrbysiJyIpO3Rocm93IGYuY29kZT0iTU9EVUxFX05PVF9GT1VORCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT0iZnVuY3Rpb24iJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSh7MTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0geyAiZGVmYXVsdCI6IHJlcXVpcmUoImNvcmUtanMvbGlicmFyeS9mbi9tYXAiKSwgX19lc01vZHVsZTogdHJ1ZSB9Owp9LHsiY29yZS1qcy9saWJyYXJ5L2ZuL21hcCI6MjJ9XSwyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogcmVxdWlyZSgiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9hc3NpZ24iKSwgX19lc01vZHVsZTogdHJ1ZSB9Owp9LHsiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9hc3NpZ24iOjIzfV0sMzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0geyAiZGVmYXVsdCI6IHJlcXVpcmUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvY3JlYXRlIiksIF9fZXNNb2R1bGU6IHRydWUgfTsKfSx7ImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvY3JlYXRlIjoyNH1dLDQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cyA9IHsgImRlZmF1bHQiOiByZXF1aXJlKCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSIpLCBfX2VzTW9kdWxlOiB0cnVlIH07Cn0seyJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSI6MjV9XSw1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogcmVxdWlyZSgiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IiKSwgX19lc01vZHVsZTogdHJ1ZSB9Owp9LHsiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IiOjI2fV0sNjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0geyAiZGVmYXVsdCI6IHJlcXVpcmUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZ2V0LXByb3RvdHlwZS1vZiIpLCBfX2VzTW9kdWxlOiB0cnVlIH07Cn0seyJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2dldC1wcm90b3R5cGUtb2YiOjI3fV0sNzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0geyAiZGVmYXVsdCI6IHJlcXVpcmUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3Qva2V5cyIpLCBfX2VzTW9kdWxlOiB0cnVlIH07Cn0seyJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2tleXMiOjI4fV0sODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0geyAiZGVmYXVsdCI6IHJlcXVpcmUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZiIpLCBfX2VzTW9kdWxlOiB0cnVlIH07Cn0seyJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L3NldC1wcm90b3R5cGUtb2YiOjI5fV0sOTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0geyAiZGVmYXVsdCI6IHJlcXVpcmUoImNvcmUtanMvbGlicmFyeS9mbi9wcm9taXNlIiksIF9fZXNNb2R1bGU6IHRydWUgfTsKfSx7ImNvcmUtanMvbGlicmFyeS9mbi9wcm9taXNlIjozMH1dLDEwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogcmVxdWlyZSgiY29yZS1qcy9saWJyYXJ5L2ZuL3NldCIpLCBfX2VzTW9kdWxlOiB0cnVlIH07Cn0seyJjb3JlLWpzL2xpYnJhcnkvZm4vc2V0IjozMX1dLDExOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogcmVxdWlyZSgiY29yZS1qcy9saWJyYXJ5L2ZuL3N5bWJvbCIpLCBfX2VzTW9kdWxlOiB0cnVlIH07Cn0seyJjb3JlLWpzL2xpYnJhcnkvZm4vc3ltYm9sIjozMn1dLDEyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7ICJkZWZhdWx0IjogcmVxdWlyZSgiY29yZS1qcy9saWJyYXJ5L2ZuL3N5bWJvbC9pdGVyYXRvciIpLCBfX2VzTW9kdWxlOiB0cnVlIH07Cn0seyJjb3JlLWpzL2xpYnJhcnkvZm4vc3ltYm9sL2l0ZXJhdG9yIjozM31dLDEzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCIuL2NsYXNzQ2FsbENoZWNrLmpzIik7Cn0seyIuL2NsYXNzQ2FsbENoZWNrLmpzIjoxNH1dLDE0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKInVzZSBzdHJpY3QiOwoKZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCmV4cG9ydHMuZGVmYXVsdCA9IGZ1bmN0aW9uIChpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsKICBpZiAoIShpbnN0YW5jZSBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiQ2Fubm90IGNhbGwgYSBjbGFzcyBhcyBhIGZ1bmN0aW9uIik7CiAgfQp9Owp9LHt9XSwxNTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgiLi9jcmVhdGVDbGFzcy5qcyIpOwp9LHsiLi9jcmVhdGVDbGFzcy5qcyI6MTZ9XSwxNjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CiJ1c2Ugc3RyaWN0IjsKCmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7Cgp2YXIgX2RlZmluZVByb3BlcnR5ID0gcmVxdWlyZSgiLi4vY29yZS1qcy9vYmplY3QvZGVmaW5lLXByb3BlcnR5Iik7Cgp2YXIgX2RlZmluZVByb3BlcnR5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2RlZmluZVByb3BlcnR5KTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpleHBvcnRzLmRlZmF1bHQgPSBmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gZGVmaW5lUHJvcGVydGllcyh0YXJnZXQsIHByb3BzKSB7CiAgICBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7CiAgICAgIHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07CiAgICAgIGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsKICAgICAgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOwogICAgICBpZiAoInZhbHVlIiBpbiBkZXNjcmlwdG9yKSBkZXNjcmlwdG9yLndyaXRhYmxlID0gdHJ1ZTsKICAgICAgKDAsIF9kZWZpbmVQcm9wZXJ0eTIuZGVmYXVsdCkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7CiAgICB9CiAgfQoKICByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgewogICAgaWYgKHByb3RvUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IucHJvdG90eXBlLCBwcm90b1Byb3BzKTsKICAgIGlmIChzdGF0aWNQcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvciwgc3RhdGljUHJvcHMpOwogICAgcmV0dXJuIENvbnN0cnVjdG9yOwogIH07Cn0oKTsKfSx7Ii4uL2NvcmUtanMvb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSI6NH1dLDE3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKInVzZSBzdHJpY3QiOwoKZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCnZhciBfZ2V0UHJvdG90eXBlT2YgPSByZXF1aXJlKCIuLi9jb3JlLWpzL29iamVjdC9nZXQtcHJvdG90eXBlLW9mIik7Cgp2YXIgX2dldFByb3RvdHlwZU9mMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX2dldFByb3RvdHlwZU9mKTsKCnZhciBfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gcmVxdWlyZSgiLi4vY29yZS1qcy9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIik7Cgp2YXIgX2dldE93blByb3BlcnR5RGVzY3JpcHRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmV4cG9ydHMuZGVmYXVsdCA9IGZ1bmN0aW9uIGdldChvYmplY3QsIHByb3BlcnR5LCByZWNlaXZlcikgewogIGlmIChvYmplY3QgPT09IG51bGwpIG9iamVjdCA9IEZ1bmN0aW9uLnByb3RvdHlwZTsKICB2YXIgZGVzYyA9ICgwLCBfZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yMi5kZWZhdWx0KShvYmplY3QsIHByb3BlcnR5KTsKCiAgaWYgKGRlc2MgPT09IHVuZGVmaW5lZCkgewogICAgdmFyIHBhcmVudCA9ICgwLCBfZ2V0UHJvdG90eXBlT2YyLmRlZmF1bHQpKG9iamVjdCk7CgogICAgaWYgKHBhcmVudCA9PT0gbnVsbCkgewogICAgICByZXR1cm4gdW5kZWZpbmVkOwogICAgfSBlbHNlIHsKICAgICAgcmV0dXJuIGdldChwYXJlbnQsIHByb3BlcnR5LCByZWNlaXZlcik7CiAgICB9CiAgfSBlbHNlIGlmICgidmFsdWUiIGluIGRlc2MpIHsKICAgIHJldHVybiBkZXNjLnZhbHVlOwogIH0gZWxzZSB7CiAgICB2YXIgZ2V0dGVyID0gZGVzYy5nZXQ7CgogICAgaWYgKGdldHRlciA9PT0gdW5kZWZpbmVkKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQ7CiAgICB9CgogICAgcmV0dXJuIGdldHRlci5jYWxsKHJlY2VpdmVyKTsKICB9Cn07Cn0seyIuLi9jb3JlLWpzL29iamVjdC9nZXQtb3duLXByb3BlcnR5LWRlc2NyaXB0b3IiOjUsIi4uL2NvcmUtanMvb2JqZWN0L2dldC1wcm90b3R5cGUtb2YiOjZ9XSwxODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CiJ1c2Ugc3RyaWN0IjsKCmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7Cgp2YXIgX3NldFByb3RvdHlwZU9mID0gcmVxdWlyZSgiLi4vY29yZS1qcy9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZiIpOwoKdmFyIF9zZXRQcm90b3R5cGVPZjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9zZXRQcm90b3R5cGVPZik7Cgp2YXIgX2NyZWF0ZSA9IHJlcXVpcmUoIi4uL2NvcmUtanMvb2JqZWN0L2NyZWF0ZSIpOwoKdmFyIF9jcmVhdGUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfY3JlYXRlKTsKCnZhciBfdHlwZW9mMiA9IHJlcXVpcmUoIi4uL2hlbHBlcnMvdHlwZW9mIik7Cgp2YXIgX3R5cGVvZjMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF90eXBlb2YyKTsKCmZ1bmN0aW9uIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQob2JqKSB7IHJldHVybiBvYmogJiYgb2JqLl9fZXNNb2R1bGUgPyBvYmogOiB7IGRlZmF1bHQ6IG9iaiB9OyB9CgpleHBvcnRzLmRlZmF1bHQgPSBmdW5jdGlvbiAoc3ViQ2xhc3MsIHN1cGVyQ2xhc3MpIHsKICBpZiAodHlwZW9mIHN1cGVyQ2xhc3MgIT09ICJmdW5jdGlvbiIgJiYgc3VwZXJDbGFzcyAhPT0gbnVsbCkgewogICAgdGhyb3cgbmV3IFR5cGVFcnJvcigiU3VwZXIgZXhwcmVzc2lvbiBtdXN0IGVpdGhlciBiZSBudWxsIG9yIGEgZnVuY3Rpb24sIG5vdCAiICsgKHR5cGVvZiBzdXBlckNsYXNzID09PSAidW5kZWZpbmVkIiA/ICJ1bmRlZmluZWQiIDogKDAsIF90eXBlb2YzLmRlZmF1bHQpKHN1cGVyQ2xhc3MpKSk7CiAgfQoKICBzdWJDbGFzcy5wcm90b3R5cGUgPSAoMCwgX2NyZWF0ZTIuZGVmYXVsdCkoc3VwZXJDbGFzcyAmJiBzdXBlckNsYXNzLnByb3RvdHlwZSwgewogICAgY29uc3RydWN0b3I6IHsKICAgICAgdmFsdWU6IHN1YkNsYXNzLAogICAgICBlbnVtZXJhYmxlOiBmYWxzZSwKICAgICAgd3JpdGFibGU6IHRydWUsCiAgICAgIGNvbmZpZ3VyYWJsZTogdHJ1ZQogICAgfQogIH0pOwogIGlmIChzdXBlckNsYXNzKSBfc2V0UHJvdG90eXBlT2YyLmRlZmF1bHQgPyAoMCwgX3NldFByb3RvdHlwZU9mMi5kZWZhdWx0KShzdWJDbGFzcywgc3VwZXJDbGFzcykgOiBzdWJDbGFzcy5fX3Byb3RvX18gPSBzdXBlckNsYXNzOwp9Owp9LHsiLi4vY29yZS1qcy9vYmplY3QvY3JlYXRlIjozLCIuLi9jb3JlLWpzL29iamVjdC9zZXQtcHJvdG90eXBlLW9mIjo4LCIuLi9oZWxwZXJzL3R5cGVvZiI6MjF9XSwxOTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgiLi9pbnRlcm9wUmVxdWlyZURlZmF1bHQuanMiKTsKfSx7Ii4vaW50ZXJvcFJlcXVpcmVEZWZhdWx0LmpzIjoyMH1dLDIwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKInVzZSBzdHJpY3QiOwoKZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCmV4cG9ydHMuZGVmYXVsdCA9IGZ1bmN0aW9uIChvYmopIHsKICByZXR1cm4gb2JqICYmIG9iai5fX2VzTW9kdWxlID8gb2JqIDogewogICAgZGVmYXVsdDogb2JqCiAgfTsKfTsKfSx7fV0sMjE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewoidXNlIHN0cmljdCI7Cgp2YXIgX3R5cGVvZiA9IHR5cGVvZiBfU3ltYm9sID09PSAiZnVuY3Rpb24iICYmIHR5cGVvZiBfU3ltYm9sJGl0ZXJhdG9yID09PSAic3ltYm9sIiA/IGZ1bmN0aW9uIChvYmopIHsgcmV0dXJuIHR5cGVvZiBvYmo7IH0gOiBmdW5jdGlvbiAob2JqKSB7IHJldHVybiBvYmogJiYgdHlwZW9mIF9TeW1ib2wgPT09ICJmdW5jdGlvbiIgJiYgb2JqLmNvbnN0cnVjdG9yID09PSBfU3ltYm9sID8gInN5bWJvbCIgOiB0eXBlb2Ygb2JqOyB9OwoKZXhwb3J0cy5fX2VzTW9kdWxlID0gdHJ1ZTsKCnZhciBfaXRlcmF0b3IgPSByZXF1aXJlKCIuLi9jb3JlLWpzL3N5bWJvbC9pdGVyYXRvciIpOwoKdmFyIF9pdGVyYXRvcjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9pdGVyYXRvcik7Cgp2YXIgX3N5bWJvbCA9IHJlcXVpcmUoIi4uL2NvcmUtanMvc3ltYm9sIik7Cgp2YXIgX3N5bWJvbDIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9zeW1ib2wpOwoKZnVuY3Rpb24gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChvYmopIHsgcmV0dXJuIG9iaiAmJiBvYmouX19lc01vZHVsZSA/IG9iaiA6IHsgZGVmYXVsdDogb2JqIH07IH0KCmV4cG9ydHMuZGVmYXVsdCA9IHR5cGVvZiBfc3ltYm9sMi5kZWZhdWx0ID09PSAiZnVuY3Rpb24iICYmIF90eXBlb2YoX2l0ZXJhdG9yMi5kZWZhdWx0KSA9PT0gInN5bWJvbCIgPyBmdW5jdGlvbiAob2JqKSB7CiAgcmV0dXJuIHR5cGVvZiBvYmogPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKG9iaik7Cn0gOiBmdW5jdGlvbiAob2JqKSB7CiAgcmV0dXJuIG9iaiAmJiB0eXBlb2YgX3N5bWJvbDIuZGVmYXVsdCA9PT0gImZ1bmN0aW9uIiAmJiBvYmouY29uc3RydWN0b3IgPT09IF9zeW1ib2wyLmRlZmF1bHQgPyAic3ltYm9sIiA6IHR5cGVvZiBvYmogPT09ICJ1bmRlZmluZWQiID8gInVuZGVmaW5lZCIgOiBfdHlwZW9mKG9iaik7Cn07Cn0seyIuLi9jb3JlLWpzL3N5bWJvbCI6MTEsIi4uL2NvcmUtanMvc3ltYm9sL2l0ZXJhdG9yIjoxMn1dLDIyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKcmVxdWlyZSgnLi4vbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZycpOwpyZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3InKTsKcmVxdWlyZSgnLi4vbW9kdWxlcy93ZWIuZG9tLml0ZXJhYmxlJyk7CnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2Lm1hcCcpOwpyZXF1aXJlKCcuLi9tb2R1bGVzL2VzNy5tYXAudG8tanNvbicpOwptb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4uL21vZHVsZXMvJC5jb3JlJykuTWFwOwp9LHsiLi4vbW9kdWxlcy8kLmNvcmUiOjQyLCIuLi9tb2R1bGVzL2VzNi5tYXAiOjkzLCIuLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIjo5OSwiLi4vbW9kdWxlcy9lczYuc3RyaW5nLml0ZXJhdG9yIjoxMDIsIi4uL21vZHVsZXMvZXM3Lm1hcC50by1qc29uIjoxMDQsIi4uL21vZHVsZXMvd2ViLmRvbS5pdGVyYWJsZSI6MTA2fV0sMjM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewpyZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuYXNzaWduJyk7Cm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy8kLmNvcmUnKS5PYmplY3QuYXNzaWduOwp9LHsiLi4vLi4vbW9kdWxlcy8kLmNvcmUiOjQyLCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuYXNzaWduIjo5NH1dLDI0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyICQgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzLyQnKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBjcmVhdGUoUCwgRCl7CiAgcmV0dXJuICQuY3JlYXRlKFAsIEQpOwp9Owp9LHsiLi4vLi4vbW9kdWxlcy8kIjo2N31dLDI1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyICQgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzLyQnKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0eShpdCwga2V5LCBkZXNjKXsKICByZXR1cm4gJC5zZXREZXNjKGl0LCBrZXksIGRlc2MpOwp9Owp9LHsiLi4vLi4vbW9kdWxlcy8kIjo2N31dLDI2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyICQgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzLyQnKTsKcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvcicpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uIGdldE93blByb3BlcnR5RGVzY3JpcHRvcihpdCwga2V5KXsKICByZXR1cm4gJC5nZXREZXNjKGl0LCBrZXkpOwp9Owp9LHsiLi4vLi4vbW9kdWxlcy8kIjo2NywiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmdldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciI6OTV9XSwyNzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnJlcXVpcmUoJy4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5nZXQtcHJvdG90eXBlLW9mJyk7Cm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy8kLmNvcmUnKS5PYmplY3QuZ2V0UHJvdG90eXBlT2Y7Cn0seyIuLi8uLi9tb2R1bGVzLyQuY29yZSI6NDIsIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5nZXQtcHJvdG90eXBlLW9mIjo5Nn1dLDI4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmtleXMnKTsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzLyQuY29yZScpLk9iamVjdC5rZXlzOwp9LHsiLi4vLi4vbW9kdWxlcy8kLmNvcmUiOjQyLCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3Qua2V5cyI6OTd9XSwyOTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnJlcXVpcmUoJy4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5zZXQtcHJvdG90eXBlLW9mJyk7Cm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy8kLmNvcmUnKS5PYmplY3Quc2V0UHJvdG90eXBlT2Y7Cn0seyIuLi8uLi9tb2R1bGVzLyQuY29yZSI6NDIsIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5zZXQtcHJvdG90eXBlLW9mIjo5OH1dLDMwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKcmVxdWlyZSgnLi4vbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZycpOwpyZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3InKTsKcmVxdWlyZSgnLi4vbW9kdWxlcy93ZWIuZG9tLml0ZXJhYmxlJyk7CnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnByb21pc2UnKTsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLi9tb2R1bGVzLyQuY29yZScpLlByb21pc2U7Cn0seyIuLi9tb2R1bGVzLyQuY29yZSI6NDIsIi4uL21vZHVsZXMvZXM2Lm9iamVjdC50by1zdHJpbmciOjk5LCIuLi9tb2R1bGVzL2VzNi5wcm9taXNlIjoxMDAsIi4uL21vZHVsZXMvZXM2LnN0cmluZy5pdGVyYXRvciI6MTAyLCIuLi9tb2R1bGVzL3dlYi5kb20uaXRlcmFibGUiOjEwNn1dLDMxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKcmVxdWlyZSgnLi4vbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZycpOwpyZXF1aXJlKCcuLi9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3InKTsKcmVxdWlyZSgnLi4vbW9kdWxlcy93ZWIuZG9tLml0ZXJhYmxlJyk7CnJlcXVpcmUoJy4uL21vZHVsZXMvZXM2LnNldCcpOwpyZXF1aXJlKCcuLi9tb2R1bGVzL2VzNy5zZXQudG8tanNvbicpOwptb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4uL21vZHVsZXMvJC5jb3JlJykuU2V0Owp9LHsiLi4vbW9kdWxlcy8kLmNvcmUiOjQyLCIuLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIjo5OSwiLi4vbW9kdWxlcy9lczYuc2V0IjoxMDEsIi4uL21vZHVsZXMvZXM2LnN0cmluZy5pdGVyYXRvciI6MTAyLCIuLi9tb2R1bGVzL2VzNy5zZXQudG8tanNvbiI6MTA1LCIuLi9tb2R1bGVzL3dlYi5kb20uaXRlcmFibGUiOjEwNn1dLDMyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy9lczYuc3ltYm9sJyk7CnJlcXVpcmUoJy4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC50by1zdHJpbmcnKTsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLi8uLi9tb2R1bGVzLyQuY29yZScpLlN5bWJvbDsKfSx7Ii4uLy4uL21vZHVsZXMvJC5jb3JlIjo0MiwiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LnRvLXN0cmluZyI6OTksIi4uLy4uL21vZHVsZXMvZXM2LnN5bWJvbCI6MTAzfV0sMzM6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewpyZXF1aXJlKCcuLi8uLi9tb2R1bGVzL2VzNi5zdHJpbmcuaXRlcmF0b3InKTsKcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy93ZWIuZG9tLml0ZXJhYmxlJyk7Cm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi4vLi4vbW9kdWxlcy8kLndrcycpKCdpdGVyYXRvcicpOwp9LHsiLi4vLi4vbW9kdWxlcy8kLndrcyI6OTAsIi4uLy4uL21vZHVsZXMvZXM2LnN0cmluZy5pdGVyYXRvciI6MTAyLCIuLi8uLi9tb2R1bGVzL3dlYi5kb20uaXRlcmFibGUiOjEwNn1dLDM0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgaWYodHlwZW9mIGl0ICE9ICdmdW5jdGlvbicpdGhyb3cgVHlwZUVycm9yKGl0ICsgJyBpcyBub3QgYSBmdW5jdGlvbiEnKTsKICByZXR1cm4gaXQ7Cn07Cn0se31dLDM1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbigpeyAvKiBlbXB0eSAqLyB9Owp9LHt9XSwzNjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vJC5pcy1vYmplY3QnKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgaWYoIWlzT2JqZWN0KGl0KSl0aHJvdyBUeXBlRXJyb3IoaXQgKyAnIGlzIG5vdCBhbiBvYmplY3QhJyk7CiAgcmV0dXJuIGl0Owp9Owp9LHsiLi8kLmlzLW9iamVjdCI6NjB9XSwzNzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIGdldHRpbmcgdGFnIGZyb20gMTkuMS4zLjYgT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZygpCnZhciBjb2YgPSByZXF1aXJlKCcuLyQuY29mJykKICAsIFRBRyA9IHJlcXVpcmUoJy4vJC53a3MnKSgndG9TdHJpbmdUYWcnKQogIC8vIEVTMyB3cm9uZyBoZXJlCiAgLCBBUkcgPSBjb2YoZnVuY3Rpb24oKXsgcmV0dXJuIGFyZ3VtZW50czsgfSgpKSA9PSAnQXJndW1lbnRzJzsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpewogIHZhciBPLCBULCBCOwogIHJldHVybiBpdCA9PT0gdW5kZWZpbmVkID8gJ1VuZGVmaW5lZCcgOiBpdCA9PT0gbnVsbCA/ICdOdWxsJwogICAgLy8gQEB0b1N0cmluZ1RhZyBjYXNlCiAgICA6IHR5cGVvZiAoVCA9IChPID0gT2JqZWN0KGl0KSlbVEFHXSkgPT0gJ3N0cmluZycgPyBUCiAgICAvLyBidWlsdGluVGFnIGNhc2UKICAgIDogQVJHID8gY29mKE8pCiAgICAvLyBFUzMgYXJndW1lbnRzIGZhbGxiYWNrCiAgICA6IChCID0gY29mKE8pKSA9PSAnT2JqZWN0JyAmJiB0eXBlb2YgTy5jYWxsZWUgPT0gJ2Z1bmN0aW9uJyA/ICdBcmd1bWVudHMnIDogQjsKfTsKfSx7Ii4vJC5jb2YiOjM4LCIuLyQud2tzIjo5MH1dLDM4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIHRvU3RyaW5nID0ge30udG9TdHJpbmc7Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KXsKICByZXR1cm4gdG9TdHJpbmcuY2FsbChpdCkuc2xpY2UoOCwgLTEpOwp9Owp9LHt9XSwzOTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKdmFyICQgICAgICAgICAgICA9IHJlcXVpcmUoJy4vJCcpCiAgLCBoaWRlICAgICAgICAgPSByZXF1aXJlKCcuLyQuaGlkZScpCiAgLCByZWRlZmluZUFsbCAgPSByZXF1aXJlKCcuLyQucmVkZWZpbmUtYWxsJykKICAsIGN0eCAgICAgICAgICA9IHJlcXVpcmUoJy4vJC5jdHgnKQogICwgc3RyaWN0TmV3ICAgID0gcmVxdWlyZSgnLi8kLnN0cmljdC1uZXcnKQogICwgZGVmaW5lZCAgICAgID0gcmVxdWlyZSgnLi8kLmRlZmluZWQnKQogICwgZm9yT2YgICAgICAgID0gcmVxdWlyZSgnLi8kLmZvci1vZicpCiAgLCAkaXRlckRlZmluZSAgPSByZXF1aXJlKCcuLyQuaXRlci1kZWZpbmUnKQogICwgc3RlcCAgICAgICAgID0gcmVxdWlyZSgnLi8kLml0ZXItc3RlcCcpCiAgLCBJRCAgICAgICAgICAgPSByZXF1aXJlKCcuLyQudWlkJykoJ2lkJykKICAsICRoYXMgICAgICAgICA9IHJlcXVpcmUoJy4vJC5oYXMnKQogICwgaXNPYmplY3QgICAgID0gcmVxdWlyZSgnLi8kLmlzLW9iamVjdCcpCiAgLCBzZXRTcGVjaWVzICAgPSByZXF1aXJlKCcuLyQuc2V0LXNwZWNpZXMnKQogICwgREVTQ1JJUFRPUlMgID0gcmVxdWlyZSgnLi8kLmRlc2NyaXB0b3JzJykKICAsIGlzRXh0ZW5zaWJsZSA9IE9iamVjdC5pc0V4dGVuc2libGUgfHwgaXNPYmplY3QKICAsIFNJWkUgICAgICAgICA9IERFU0NSSVBUT1JTID8gJ19zJyA6ICdzaXplJwogICwgaWQgICAgICAgICAgID0gMDsKCnZhciBmYXN0S2V5ID0gZnVuY3Rpb24oaXQsIGNyZWF0ZSl7CiAgLy8gcmV0dXJuIHByaW1pdGl2ZSB3aXRoIHByZWZpeAogIGlmKCFpc09iamVjdChpdCkpcmV0dXJuIHR5cGVvZiBpdCA9PSAnc3ltYm9sJyA/IGl0IDogKHR5cGVvZiBpdCA9PSAnc3RyaW5nJyA/ICdTJyA6ICdQJykgKyBpdDsKICBpZighJGhhcyhpdCwgSUQpKXsKICAgIC8vIGNhbid0IHNldCBpZCB0byBmcm96ZW4gb2JqZWN0CiAgICBpZighaXNFeHRlbnNpYmxlKGl0KSlyZXR1cm4gJ0YnOwogICAgLy8gbm90IG5lY2Vzc2FyeSB0byBhZGQgaWQKICAgIGlmKCFjcmVhdGUpcmV0dXJuICdFJzsKICAgIC8vIGFkZCBtaXNzaW5nIG9iamVjdCBpZAogICAgaGlkZShpdCwgSUQsICsraWQpOwogIC8vIHJldHVybiBvYmplY3QgaWQgd2l0aCBwcmVmaXgKICB9IHJldHVybiAnTycgKyBpdFtJRF07Cn07Cgp2YXIgZ2V0RW50cnkgPSBmdW5jdGlvbih0aGF0LCBrZXkpewogIC8vIGZhc3QgY2FzZQogIHZhciBpbmRleCA9IGZhc3RLZXkoa2V5KSwgZW50cnk7CiAgaWYoaW5kZXggIT09ICdGJylyZXR1cm4gdGhhdC5faVtpbmRleF07CiAgLy8gZnJvemVuIG9iamVjdCBjYXNlCiAgZm9yKGVudHJ5ID0gdGhhdC5fZjsgZW50cnk7IGVudHJ5ID0gZW50cnkubil7CiAgICBpZihlbnRyeS5rID09IGtleSlyZXR1cm4gZW50cnk7CiAgfQp9OwoKbW9kdWxlLmV4cG9ydHMgPSB7CiAgZ2V0Q29uc3RydWN0b3I6IGZ1bmN0aW9uKHdyYXBwZXIsIE5BTUUsIElTX01BUCwgQURERVIpewogICAgdmFyIEMgPSB3cmFwcGVyKGZ1bmN0aW9uKHRoYXQsIGl0ZXJhYmxlKXsKICAgICAgc3RyaWN0TmV3KHRoYXQsIEMsIE5BTUUpOwogICAgICB0aGF0Ll9pID0gJC5jcmVhdGUobnVsbCk7IC8vIGluZGV4CiAgICAgIHRoYXQuX2YgPSB1bmRlZmluZWQ7ICAgICAgLy8gZmlyc3QgZW50cnkKICAgICAgdGhhdC5fbCA9IHVuZGVmaW5lZDsgICAgICAvLyBsYXN0IGVudHJ5CiAgICAgIHRoYXRbU0laRV0gPSAwOyAgICAgICAgICAgLy8gc2l6ZQogICAgICBpZihpdGVyYWJsZSAhPSB1bmRlZmluZWQpZm9yT2YoaXRlcmFibGUsIElTX01BUCwgdGhhdFtBRERFUl0sIHRoYXQpOwogICAgfSk7CiAgICByZWRlZmluZUFsbChDLnByb3RvdHlwZSwgewogICAgICAvLyAyMy4xLjMuMSBNYXAucHJvdG90eXBlLmNsZWFyKCkKICAgICAgLy8gMjMuMi4zLjIgU2V0LnByb3RvdHlwZS5jbGVhcigpCiAgICAgIGNsZWFyOiBmdW5jdGlvbiBjbGVhcigpewogICAgICAgIGZvcih2YXIgdGhhdCA9IHRoaXMsIGRhdGEgPSB0aGF0Ll9pLCBlbnRyeSA9IHRoYXQuX2Y7IGVudHJ5OyBlbnRyeSA9IGVudHJ5Lm4pewogICAgICAgICAgZW50cnkuciA9IHRydWU7CiAgICAgICAgICBpZihlbnRyeS5wKWVudHJ5LnAgPSBlbnRyeS5wLm4gPSB1bmRlZmluZWQ7CiAgICAgICAgICBkZWxldGUgZGF0YVtlbnRyeS5pXTsKICAgICAgICB9CiAgICAgICAgdGhhdC5fZiA9IHRoYXQuX2wgPSB1bmRlZmluZWQ7CiAgICAgICAgdGhhdFtTSVpFXSA9IDA7CiAgICAgIH0sCiAgICAgIC8vIDIzLjEuMy4zIE1hcC5wcm90b3R5cGUuZGVsZXRlKGtleSkKICAgICAgLy8gMjMuMi4zLjQgU2V0LnByb3RvdHlwZS5kZWxldGUodmFsdWUpCiAgICAgICdkZWxldGUnOiBmdW5jdGlvbihrZXkpewogICAgICAgIHZhciB0aGF0ICA9IHRoaXMKICAgICAgICAgICwgZW50cnkgPSBnZXRFbnRyeSh0aGF0LCBrZXkpOwogICAgICAgIGlmKGVudHJ5KXsKICAgICAgICAgIHZhciBuZXh0ID0gZW50cnkubgogICAgICAgICAgICAsIHByZXYgPSBlbnRyeS5wOwogICAgICAgICAgZGVsZXRlIHRoYXQuX2lbZW50cnkuaV07CiAgICAgICAgICBlbnRyeS5yID0gdHJ1ZTsKICAgICAgICAgIGlmKHByZXYpcHJldi5uID0gbmV4dDsKICAgICAgICAgIGlmKG5leHQpbmV4dC5wID0gcHJldjsKICAgICAgICAgIGlmKHRoYXQuX2YgPT0gZW50cnkpdGhhdC5fZiA9IG5leHQ7CiAgICAgICAgICBpZih0aGF0Ll9sID09IGVudHJ5KXRoYXQuX2wgPSBwcmV2OwogICAgICAgICAgdGhhdFtTSVpFXS0tOwogICAgICAgIH0gcmV0dXJuICEhZW50cnk7CiAgICAgIH0sCiAgICAgIC8vIDIzLjIuMy42IFNldC5wcm90b3R5cGUuZm9yRWFjaChjYWxsYmFja2ZuLCB0aGlzQXJnID0gdW5kZWZpbmVkKQogICAgICAvLyAyMy4xLjMuNSBNYXAucHJvdG90eXBlLmZvckVhY2goY2FsbGJhY2tmbiwgdGhpc0FyZyA9IHVuZGVmaW5lZCkKICAgICAgZm9yRWFjaDogZnVuY3Rpb24gZm9yRWFjaChjYWxsYmFja2ZuIC8qLCB0aGF0ID0gdW5kZWZpbmVkICovKXsKICAgICAgICB2YXIgZiA9IGN0eChjYWxsYmFja2ZuLCBhcmd1bWVudHMubGVuZ3RoID4gMSA/IGFyZ3VtZW50c1sxXSA6IHVuZGVmaW5lZCwgMykKICAgICAgICAgICwgZW50cnk7CiAgICAgICAgd2hpbGUoZW50cnkgPSBlbnRyeSA/IGVudHJ5Lm4gOiB0aGlzLl9mKXsKICAgICAgICAgIGYoZW50cnkudiwgZW50cnkuaywgdGhpcyk7CiAgICAgICAgICAvLyByZXZlcnQgdG8gdGhlIGxhc3QgZXhpc3RpbmcgZW50cnkKICAgICAgICAgIHdoaWxlKGVudHJ5ICYmIGVudHJ5LnIpZW50cnkgPSBlbnRyeS5wOwogICAgICAgIH0KICAgICAgfSwKICAgICAgLy8gMjMuMS4zLjcgTWFwLnByb3RvdHlwZS5oYXMoa2V5KQogICAgICAvLyAyMy4yLjMuNyBTZXQucHJvdG90eXBlLmhhcyh2YWx1ZSkKICAgICAgaGFzOiBmdW5jdGlvbiBoYXMoa2V5KXsKICAgICAgICByZXR1cm4gISFnZXRFbnRyeSh0aGlzLCBrZXkpOwogICAgICB9CiAgICB9KTsKICAgIGlmKERFU0NSSVBUT1JTKSQuc2V0RGVzYyhDLnByb3RvdHlwZSwgJ3NpemUnLCB7CiAgICAgIGdldDogZnVuY3Rpb24oKXsKICAgICAgICByZXR1cm4gZGVmaW5lZCh0aGlzW1NJWkVdKTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gQzsKICB9LAogIGRlZjogZnVuY3Rpb24odGhhdCwga2V5LCB2YWx1ZSl7CiAgICB2YXIgZW50cnkgPSBnZXRFbnRyeSh0aGF0LCBrZXkpCiAgICAgICwgcHJldiwgaW5kZXg7CiAgICAvLyBjaGFuZ2UgZXhpc3RpbmcgZW50cnkKICAgIGlmKGVudHJ5KXsKICAgICAgZW50cnkudiA9IHZhbHVlOwogICAgLy8gY3JlYXRlIG5ldyBlbnRyeQogICAgfSBlbHNlIHsKICAgICAgdGhhdC5fbCA9IGVudHJ5ID0gewogICAgICAgIGk6IGluZGV4ID0gZmFzdEtleShrZXksIHRydWUpLCAvLyA8LSBpbmRleAogICAgICAgIGs6IGtleSwgICAgICAgICAgICAgICAgICAgICAgICAvLyA8LSBrZXkKICAgICAgICB2OiB2YWx1ZSwgICAgICAgICAgICAgICAgICAgICAgLy8gPC0gdmFsdWUKICAgICAgICBwOiBwcmV2ID0gdGhhdC5fbCwgICAgICAgICAgICAgLy8gPC0gcHJldmlvdXMgZW50cnkKICAgICAgICBuOiB1bmRlZmluZWQsICAgICAgICAgICAgICAgICAgLy8gPC0gbmV4dCBlbnRyeQogICAgICAgIHI6IGZhbHNlICAgICAgICAgICAgICAgICAgICAgICAvLyA8LSByZW1vdmVkCiAgICAgIH07CiAgICAgIGlmKCF0aGF0Ll9mKXRoYXQuX2YgPSBlbnRyeTsKICAgICAgaWYocHJldilwcmV2Lm4gPSBlbnRyeTsKICAgICAgdGhhdFtTSVpFXSsrOwogICAgICAvLyBhZGQgdG8gaW5kZXgKICAgICAgaWYoaW5kZXggIT09ICdGJyl0aGF0Ll9pW2luZGV4XSA9IGVudHJ5OwogICAgfSByZXR1cm4gdGhhdDsKICB9LAogIGdldEVudHJ5OiBnZXRFbnRyeSwKICBzZXRTdHJvbmc6IGZ1bmN0aW9uKEMsIE5BTUUsIElTX01BUCl7CiAgICAvLyBhZGQgLmtleXMsIC52YWx1ZXMsIC5lbnRyaWVzLCBbQEBpdGVyYXRvcl0KICAgIC8vIDIzLjEuMy40LCAyMy4xLjMuOCwgMjMuMS4zLjExLCAyMy4xLjMuMTIsIDIzLjIuMy41LCAyMy4yLjMuOCwgMjMuMi4zLjEwLCAyMy4yLjMuMTEKICAgICRpdGVyRGVmaW5lKEMsIE5BTUUsIGZ1bmN0aW9uKGl0ZXJhdGVkLCBraW5kKXsKICAgICAgdGhpcy5fdCA9IGl0ZXJhdGVkOyAgLy8gdGFyZ2V0CiAgICAgIHRoaXMuX2sgPSBraW5kOyAgICAgIC8vIGtpbmQKICAgICAgdGhpcy5fbCA9IHVuZGVmaW5lZDsgLy8gcHJldmlvdXMKICAgIH0sIGZ1bmN0aW9uKCl7CiAgICAgIHZhciB0aGF0ICA9IHRoaXMKICAgICAgICAsIGtpbmQgID0gdGhhdC5fawogICAgICAgICwgZW50cnkgPSB0aGF0Ll9sOwogICAgICAvLyByZXZlcnQgdG8gdGhlIGxhc3QgZXhpc3RpbmcgZW50cnkKICAgICAgd2hpbGUoZW50cnkgJiYgZW50cnkucillbnRyeSA9IGVudHJ5LnA7CiAgICAgIC8vIGdldCBuZXh0IGVudHJ5CiAgICAgIGlmKCF0aGF0Ll90IHx8ICEodGhhdC5fbCA9IGVudHJ5ID0gZW50cnkgPyBlbnRyeS5uIDogdGhhdC5fdC5fZikpewogICAgICAgIC8vIG9yIGZpbmlzaCB0aGUgaXRlcmF0aW9uCiAgICAgICAgdGhhdC5fdCA9IHVuZGVmaW5lZDsKICAgICAgICByZXR1cm4gc3RlcCgxKTsKICAgICAgfQogICAgICAvLyByZXR1cm4gc3RlcCBieSBraW5kCiAgICAgIGlmKGtpbmQgPT0gJ2tleXMnICApcmV0dXJuIHN0ZXAoMCwgZW50cnkuayk7CiAgICAgIGlmKGtpbmQgPT0gJ3ZhbHVlcycpcmV0dXJuIHN0ZXAoMCwgZW50cnkudik7CiAgICAgIHJldHVybiBzdGVwKDAsIFtlbnRyeS5rLCBlbnRyeS52XSk7CiAgICB9LCBJU19NQVAgPyAnZW50cmllcycgOiAndmFsdWVzJyAsICFJU19NQVAsIHRydWUpOwoKICAgIC8vIGFkZCBbQEBzcGVjaWVzXSwgMjMuMS4yLjIsIDIzLjIuMi4yCiAgICBzZXRTcGVjaWVzKE5BTUUpOwogIH0KfTsKfSx7Ii4vJCI6NjcsIi4vJC5jdHgiOjQzLCIuLyQuZGVmaW5lZCI6NDQsIi4vJC5kZXNjcmlwdG9ycyI6NDUsIi4vJC5mb3Itb2YiOjUwLCIuLyQuaGFzIjo1MywiLi8kLmhpZGUiOjU0LCIuLyQuaXMtb2JqZWN0Ijo2MCwiLi8kLml0ZXItZGVmaW5lIjo2MywiLi8kLml0ZXItc3RlcCI6NjUsIi4vJC5yZWRlZmluZS1hbGwiOjc0LCIuLyQuc2V0LXNwZWNpZXMiOjc4LCIuLyQuc3RyaWN0LW5ldyI6ODIsIi4vJC51aWQiOjg5fV0sNDA6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBodHRwczovL2dpdGh1Yi5jb20vRGF2aWRCcnVhbnQvTWFwLVNldC5wcm90b3R5cGUudG9KU09OCnZhciBmb3JPZiAgID0gcmVxdWlyZSgnLi8kLmZvci1vZicpCiAgLCBjbGFzc29mID0gcmVxdWlyZSgnLi8kLmNsYXNzb2YnKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihOQU1FKXsKICByZXR1cm4gZnVuY3Rpb24gdG9KU09OKCl7CiAgICBpZihjbGFzc29mKHRoaXMpICE9IE5BTUUpdGhyb3cgVHlwZUVycm9yKE5BTUUgKyAiI3RvSlNPTiBpc24ndCBnZW5lcmljIik7CiAgICB2YXIgYXJyID0gW107CiAgICBmb3JPZih0aGlzLCBmYWxzZSwgYXJyLnB1c2gsIGFycik7CiAgICByZXR1cm4gYXJyOwogIH07Cn07Cn0seyIuLyQuY2xhc3NvZiI6MzcsIi4vJC5mb3Itb2YiOjUwfV0sNDE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CnZhciAkICAgICAgICAgICAgICA9IHJlcXVpcmUoJy4vJCcpCiAgLCBnbG9iYWwgICAgICAgICA9IHJlcXVpcmUoJy4vJC5nbG9iYWwnKQogICwgJGV4cG9ydCAgICAgICAgPSByZXF1aXJlKCcuLyQuZXhwb3J0JykKICAsIGZhaWxzICAgICAgICAgID0gcmVxdWlyZSgnLi8kLmZhaWxzJykKICAsIGhpZGUgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLmhpZGUnKQogICwgcmVkZWZpbmVBbGwgICAgPSByZXF1aXJlKCcuLyQucmVkZWZpbmUtYWxsJykKICAsIGZvck9mICAgICAgICAgID0gcmVxdWlyZSgnLi8kLmZvci1vZicpCiAgLCBzdHJpY3ROZXcgICAgICA9IHJlcXVpcmUoJy4vJC5zdHJpY3QtbmV3JykKICAsIGlzT2JqZWN0ICAgICAgID0gcmVxdWlyZSgnLi8kLmlzLW9iamVjdCcpCiAgLCBzZXRUb1N0cmluZ1RhZyA9IHJlcXVpcmUoJy4vJC5zZXQtdG8tc3RyaW5nLXRhZycpCiAgLCBERVNDUklQVE9SUyAgICA9IHJlcXVpcmUoJy4vJC5kZXNjcmlwdG9ycycpOwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihOQU1FLCB3cmFwcGVyLCBtZXRob2RzLCBjb21tb24sIElTX01BUCwgSVNfV0VBSyl7CiAgdmFyIEJhc2UgID0gZ2xvYmFsW05BTUVdCiAgICAsIEMgICAgID0gQmFzZQogICAgLCBBRERFUiA9IElTX01BUCA/ICdzZXQnIDogJ2FkZCcKICAgICwgcHJvdG8gPSBDICYmIEMucHJvdG90eXBlCiAgICAsIE8gICAgID0ge307CiAgaWYoIURFU0NSSVBUT1JTIHx8IHR5cGVvZiBDICE9ICdmdW5jdGlvbicgfHwgIShJU19XRUFLIHx8IHByb3RvLmZvckVhY2ggJiYgIWZhaWxzKGZ1bmN0aW9uKCl7CiAgICBuZXcgQygpLmVudHJpZXMoKS5uZXh0KCk7CiAgfSkpKXsKICAgIC8vIGNyZWF0ZSBjb2xsZWN0aW9uIGNvbnN0cnVjdG9yCiAgICBDID0gY29tbW9uLmdldENvbnN0cnVjdG9yKHdyYXBwZXIsIE5BTUUsIElTX01BUCwgQURERVIpOwogICAgcmVkZWZpbmVBbGwoQy5wcm90b3R5cGUsIG1ldGhvZHMpOwogIH0gZWxzZSB7CiAgICBDID0gd3JhcHBlcihmdW5jdGlvbih0YXJnZXQsIGl0ZXJhYmxlKXsKICAgICAgc3RyaWN0TmV3KHRhcmdldCwgQywgTkFNRSk7CiAgICAgIHRhcmdldC5fYyA9IG5ldyBCYXNlOwogICAgICBpZihpdGVyYWJsZSAhPSB1bmRlZmluZWQpZm9yT2YoaXRlcmFibGUsIElTX01BUCwgdGFyZ2V0W0FEREVSXSwgdGFyZ2V0KTsKICAgIH0pOwogICAgJC5lYWNoLmNhbGwoJ2FkZCxjbGVhcixkZWxldGUsZm9yRWFjaCxnZXQsaGFzLHNldCxrZXlzLHZhbHVlcyxlbnRyaWVzJy5zcGxpdCgnLCcpLGZ1bmN0aW9uKEtFWSl7CiAgICAgIHZhciBJU19BRERFUiA9IEtFWSA9PSAnYWRkJyB8fCBLRVkgPT0gJ3NldCc7CiAgICAgIGlmKEtFWSBpbiBwcm90byAmJiAhKElTX1dFQUsgJiYgS0VZID09ICdjbGVhcicpKWhpZGUoQy5wcm90b3R5cGUsIEtFWSwgZnVuY3Rpb24oYSwgYil7CiAgICAgICAgaWYoIUlTX0FEREVSICYmIElTX1dFQUsgJiYgIWlzT2JqZWN0KGEpKXJldHVybiBLRVkgPT0gJ2dldCcgPyB1bmRlZmluZWQgOiBmYWxzZTsKICAgICAgICB2YXIgcmVzdWx0ID0gdGhpcy5fY1tLRVldKGEgPT09IDAgPyAwIDogYSwgYik7CiAgICAgICAgcmV0dXJuIElTX0FEREVSID8gdGhpcyA6IHJlc3VsdDsKICAgICAgfSk7CiAgICB9KTsKICAgIGlmKCdzaXplJyBpbiBwcm90bykkLnNldERlc2MoQy5wcm90b3R5cGUsICdzaXplJywgewogICAgICBnZXQ6IGZ1bmN0aW9uKCl7CiAgICAgICAgcmV0dXJuIHRoaXMuX2Muc2l6ZTsKICAgICAgfQogICAgfSk7CiAgfQoKICBzZXRUb1N0cmluZ1RhZyhDLCBOQU1FKTsKCiAgT1tOQU1FXSA9IEM7CiAgJGV4cG9ydCgkZXhwb3J0LkcgKyAkZXhwb3J0LlcgKyAkZXhwb3J0LkYsIE8pOwoKICBpZighSVNfV0VBSyljb21tb24uc2V0U3Ryb25nKEMsIE5BTUUsIElTX01BUCk7CgogIHJldHVybiBDOwp9Owp9LHsiLi8kIjo2NywiLi8kLmRlc2NyaXB0b3JzIjo0NSwiLi8kLmV4cG9ydCI6NDgsIi4vJC5mYWlscyI6NDksIi4vJC5mb3Itb2YiOjUwLCIuLyQuZ2xvYmFsIjo1MiwiLi8kLmhpZGUiOjU0LCIuLyQuaXMtb2JqZWN0Ijo2MCwiLi8kLnJlZGVmaW5lLWFsbCI6NzQsIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyI6NzksIi4vJC5zdHJpY3QtbmV3Ijo4Mn1dLDQyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIGNvcmUgPSBtb2R1bGUuZXhwb3J0cyA9IHt2ZXJzaW9uOiAnMS4yLjYnfTsKaWYodHlwZW9mIF9fZSA9PSAnbnVtYmVyJylfX2UgPSBjb3JlOyAvLyBlc2xpbnQtZGlzYWJsZS1saW5lIG5vLXVuZGVmCn0se31dLDQzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gb3B0aW9uYWwgLyBzaW1wbGUgY29udGV4dCBiaW5kaW5nCnZhciBhRnVuY3Rpb24gPSByZXF1aXJlKCcuLyQuYS1mdW5jdGlvbicpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGZuLCB0aGF0LCBsZW5ndGgpewogIGFGdW5jdGlvbihmbik7CiAgaWYodGhhdCA9PT0gdW5kZWZpbmVkKXJldHVybiBmbjsKICBzd2l0Y2gobGVuZ3RoKXsKICAgIGNhc2UgMTogcmV0dXJuIGZ1bmN0aW9uKGEpewogICAgICByZXR1cm4gZm4uY2FsbCh0aGF0LCBhKTsKICAgIH07CiAgICBjYXNlIDI6IHJldHVybiBmdW5jdGlvbihhLCBiKXsKICAgICAgcmV0dXJuIGZuLmNhbGwodGhhdCwgYSwgYik7CiAgICB9OwogICAgY2FzZSAzOiByZXR1cm4gZnVuY3Rpb24oYSwgYiwgYyl7CiAgICAgIHJldHVybiBmbi5jYWxsKHRoYXQsIGEsIGIsIGMpOwogICAgfTsKICB9CiAgcmV0dXJuIGZ1bmN0aW9uKC8qIC4uLmFyZ3MgKi8pewogICAgcmV0dXJuIGZuLmFwcGx5KHRoYXQsIGFyZ3VtZW50cyk7CiAgfTsKfTsKfSx7Ii4vJC5hLWZ1bmN0aW9uIjozNH1dLDQ0OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gNy4yLjEgUmVxdWlyZU9iamVjdENvZXJjaWJsZShhcmd1bWVudCkKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgaWYoaXQgPT0gdW5kZWZpbmVkKXRocm93IFR5cGVFcnJvcigiQ2FuJ3QgY2FsbCBtZXRob2Qgb24gICIgKyBpdCk7CiAgcmV0dXJuIGl0Owp9Owp9LHt9XSw0NTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIFRoYW5rJ3MgSUU4IGZvciBoaXMgZnVubnkgZGVmaW5lUHJvcGVydHkKbW9kdWxlLmV4cG9ydHMgPSAhcmVxdWlyZSgnLi8kLmZhaWxzJykoZnVuY3Rpb24oKXsKICByZXR1cm4gT2JqZWN0LmRlZmluZVByb3BlcnR5KHt9LCAnYScsIHtnZXQ6IGZ1bmN0aW9uKCl7IHJldHVybiA3OyB9fSkuYSAhPSA3Owp9KTsKfSx7Ii4vJC5mYWlscyI6NDl9XSw0NjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBpc09iamVjdCA9IHJlcXVpcmUoJy4vJC5pcy1vYmplY3QnKQogICwgZG9jdW1lbnQgPSByZXF1aXJlKCcuLyQuZ2xvYmFsJykuZG9jdW1lbnQKICAvLyBpbiBvbGQgSUUgdHlwZW9mIGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQgaXMgJ29iamVjdCcKICAsIGlzID0gaXNPYmplY3QoZG9jdW1lbnQpICYmIGlzT2JqZWN0KGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KXsKICByZXR1cm4gaXMgPyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KGl0KSA6IHt9Owp9Owp9LHsiLi8kLmdsb2JhbCI6NTIsIi4vJC5pcy1vYmplY3QiOjYwfV0sNDc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBhbGwgZW51bWVyYWJsZSBvYmplY3Qga2V5cywgaW5jbHVkZXMgc3ltYm9scwp2YXIgJCA9IHJlcXVpcmUoJy4vJCcpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KXsKICB2YXIga2V5cyAgICAgICA9ICQuZ2V0S2V5cyhpdCkKICAgICwgZ2V0U3ltYm9scyA9ICQuZ2V0U3ltYm9sczsKICBpZihnZXRTeW1ib2xzKXsKICAgIHZhciBzeW1ib2xzID0gZ2V0U3ltYm9scyhpdCkKICAgICAgLCBpc0VudW0gID0gJC5pc0VudW0KICAgICAgLCBpICAgICAgID0gMAogICAgICAsIGtleTsKICAgIHdoaWxlKHN5bWJvbHMubGVuZ3RoID4gaSlpZihpc0VudW0uY2FsbChpdCwga2V5ID0gc3ltYm9sc1tpKytdKSlrZXlzLnB1c2goa2V5KTsKICB9CiAgcmV0dXJuIGtleXM7Cn07Cn0seyIuLyQiOjY3fV0sNDg6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgZ2xvYmFsICAgID0gcmVxdWlyZSgnLi8kLmdsb2JhbCcpCiAgLCBjb3JlICAgICAgPSByZXF1aXJlKCcuLyQuY29yZScpCiAgLCBjdHggICAgICAgPSByZXF1aXJlKCcuLyQuY3R4JykKICAsIFBST1RPVFlQRSA9ICdwcm90b3R5cGUnOwoKdmFyICRleHBvcnQgPSBmdW5jdGlvbih0eXBlLCBuYW1lLCBzb3VyY2UpewogIHZhciBJU19GT1JDRUQgPSB0eXBlICYgJGV4cG9ydC5GCiAgICAsIElTX0dMT0JBTCA9IHR5cGUgJiAkZXhwb3J0LkcKICAgICwgSVNfU1RBVElDID0gdHlwZSAmICRleHBvcnQuUwogICAgLCBJU19QUk9UTyAgPSB0eXBlICYgJGV4cG9ydC5QCiAgICAsIElTX0JJTkQgICA9IHR5cGUgJiAkZXhwb3J0LkIKICAgICwgSVNfV1JBUCAgID0gdHlwZSAmICRleHBvcnQuVwogICAgLCBleHBvcnRzICAgPSBJU19HTE9CQUwgPyBjb3JlIDogY29yZVtuYW1lXSB8fCAoY29yZVtuYW1lXSA9IHt9KQogICAgLCB0YXJnZXQgICAgPSBJU19HTE9CQUwgPyBnbG9iYWwgOiBJU19TVEFUSUMgPyBnbG9iYWxbbmFtZV0gOiAoZ2xvYmFsW25hbWVdIHx8IHt9KVtQUk9UT1RZUEVdCiAgICAsIGtleSwgb3duLCBvdXQ7CiAgaWYoSVNfR0xPQkFMKXNvdXJjZSA9IG5hbWU7CiAgZm9yKGtleSBpbiBzb3VyY2UpewogICAgLy8gY29udGFpbnMgaW4gbmF0aXZlCiAgICBvd24gPSAhSVNfRk9SQ0VEICYmIHRhcmdldCAmJiBrZXkgaW4gdGFyZ2V0OwogICAgaWYob3duICYmIGtleSBpbiBleHBvcnRzKWNvbnRpbnVlOwogICAgLy8gZXhwb3J0IG5hdGl2ZSBvciBwYXNzZWQKICAgIG91dCA9IG93biA/IHRhcmdldFtrZXldIDogc291cmNlW2tleV07CiAgICAvLyBwcmV2ZW50IGdsb2JhbCBwb2xsdXRpb24gZm9yIG5hbWVzcGFjZXMKICAgIGV4cG9ydHNba2V5XSA9IElTX0dMT0JBTCAmJiB0eXBlb2YgdGFyZ2V0W2tleV0gIT0gJ2Z1bmN0aW9uJyA/IHNvdXJjZVtrZXldCiAgICAvLyBiaW5kIHRpbWVycyB0byBnbG9iYWwgZm9yIGNhbGwgZnJvbSBleHBvcnQgY29udGV4dAogICAgOiBJU19CSU5EICYmIG93biA/IGN0eChvdXQsIGdsb2JhbCkKICAgIC8vIHdyYXAgZ2xvYmFsIGNvbnN0cnVjdG9ycyBmb3IgcHJldmVudCBjaGFuZ2UgdGhlbSBpbiBsaWJyYXJ5CiAgICA6IElTX1dSQVAgJiYgdGFyZ2V0W2tleV0gPT0gb3V0ID8gKGZ1bmN0aW9uKEMpewogICAgICB2YXIgRiA9IGZ1bmN0aW9uKHBhcmFtKXsKICAgICAgICByZXR1cm4gdGhpcyBpbnN0YW5jZW9mIEMgPyBuZXcgQyhwYXJhbSkgOiBDKHBhcmFtKTsKICAgICAgfTsKICAgICAgRltQUk9UT1RZUEVdID0gQ1tQUk9UT1RZUEVdOwogICAgICByZXR1cm4gRjsKICAgIC8vIG1ha2Ugc3RhdGljIHZlcnNpb25zIGZvciBwcm90b3R5cGUgbWV0aG9kcwogICAgfSkob3V0KSA6IElTX1BST1RPICYmIHR5cGVvZiBvdXQgPT0gJ2Z1bmN0aW9uJyA/IGN0eChGdW5jdGlvbi5jYWxsLCBvdXQpIDogb3V0OwogICAgaWYoSVNfUFJPVE8pKGV4cG9ydHNbUFJPVE9UWVBFXSB8fCAoZXhwb3J0c1tQUk9UT1RZUEVdID0ge30pKVtrZXldID0gb3V0OwogIH0KfTsKLy8gdHlwZSBiaXRtYXAKJGV4cG9ydC5GID0gMTsgIC8vIGZvcmNlZAokZXhwb3J0LkcgPSAyOyAgLy8gZ2xvYmFsCiRleHBvcnQuUyA9IDQ7ICAvLyBzdGF0aWMKJGV4cG9ydC5QID0gODsgIC8vIHByb3RvCiRleHBvcnQuQiA9IDE2OyAvLyBiaW5kCiRleHBvcnQuVyA9IDMyOyAvLyB3cmFwCm1vZHVsZS5leHBvcnRzID0gJGV4cG9ydDsKfSx7Ii4vJC5jb3JlIjo0MiwiLi8kLmN0eCI6NDMsIi4vJC5nbG9iYWwiOjUyfV0sNDk6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGV4ZWMpewogIHRyeSB7CiAgICByZXR1cm4gISFleGVjKCk7CiAgfSBjYXRjaChlKXsKICAgIHJldHVybiB0cnVlOwogIH0KfTsKfSx7fV0sNTA6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgY3R4ICAgICAgICAgPSByZXF1aXJlKCcuLyQuY3R4JykKICAsIGNhbGwgICAgICAgID0gcmVxdWlyZSgnLi8kLml0ZXItY2FsbCcpCiAgLCBpc0FycmF5SXRlciA9IHJlcXVpcmUoJy4vJC5pcy1hcnJheS1pdGVyJykKICAsIGFuT2JqZWN0ICAgID0gcmVxdWlyZSgnLi8kLmFuLW9iamVjdCcpCiAgLCB0b0xlbmd0aCAgICA9IHJlcXVpcmUoJy4vJC50by1sZW5ndGgnKQogICwgZ2V0SXRlckZuICAgPSByZXF1aXJlKCcuL2NvcmUuZ2V0LWl0ZXJhdG9yLW1ldGhvZCcpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0ZXJhYmxlLCBlbnRyaWVzLCBmbiwgdGhhdCl7CiAgdmFyIGl0ZXJGbiA9IGdldEl0ZXJGbihpdGVyYWJsZSkKICAgICwgZiAgICAgID0gY3R4KGZuLCB0aGF0LCBlbnRyaWVzID8gMiA6IDEpCiAgICAsIGluZGV4ICA9IDAKICAgICwgbGVuZ3RoLCBzdGVwLCBpdGVyYXRvcjsKICBpZih0eXBlb2YgaXRlckZuICE9ICdmdW5jdGlvbicpdGhyb3cgVHlwZUVycm9yKGl0ZXJhYmxlICsgJyBpcyBub3QgaXRlcmFibGUhJyk7CiAgLy8gZmFzdCBjYXNlIGZvciBhcnJheXMgd2l0aCBkZWZhdWx0IGl0ZXJhdG9yCiAgaWYoaXNBcnJheUl0ZXIoaXRlckZuKSlmb3IobGVuZ3RoID0gdG9MZW5ndGgoaXRlcmFibGUubGVuZ3RoKTsgbGVuZ3RoID4gaW5kZXg7IGluZGV4KyspewogICAgZW50cmllcyA/IGYoYW5PYmplY3Qoc3RlcCA9IGl0ZXJhYmxlW2luZGV4XSlbMF0sIHN0ZXBbMV0pIDogZihpdGVyYWJsZVtpbmRleF0pOwogIH0gZWxzZSBmb3IoaXRlcmF0b3IgPSBpdGVyRm4uY2FsbChpdGVyYWJsZSk7ICEoc3RlcCA9IGl0ZXJhdG9yLm5leHQoKSkuZG9uZTsgKXsKICAgIGNhbGwoaXRlcmF0b3IsIGYsIHN0ZXAudmFsdWUsIGVudHJpZXMpOwogIH0KfTsKfSx7Ii4vJC5hbi1vYmplY3QiOjM2LCIuLyQuY3R4Ijo0MywiLi8kLmlzLWFycmF5LWl0ZXIiOjU4LCIuLyQuaXRlci1jYWxsIjo2MSwiLi8kLnRvLWxlbmd0aCI6ODcsIi4vY29yZS5nZXQtaXRlcmF0b3ItbWV0aG9kIjo5MX1dLDUxOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gZmFsbGJhY2sgZm9yIElFMTEgYnVnZ3kgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMgd2l0aCBpZnJhbWUgYW5kIHdpbmRvdwp2YXIgdG9JT2JqZWN0ID0gcmVxdWlyZSgnLi8kLnRvLWlvYmplY3QnKQogICwgZ2V0TmFtZXMgID0gcmVxdWlyZSgnLi8kJykuZ2V0TmFtZXMKICAsIHRvU3RyaW5nICA9IHt9LnRvU3RyaW5nOwoKdmFyIHdpbmRvd05hbWVzID0gdHlwZW9mIHdpbmRvdyA9PSAnb2JqZWN0JyAmJiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcwogID8gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMod2luZG93KSA6IFtdOwoKdmFyIGdldFdpbmRvd05hbWVzID0gZnVuY3Rpb24oaXQpewogIHRyeSB7CiAgICByZXR1cm4gZ2V0TmFtZXMoaXQpOwogIH0gY2F0Y2goZSl7CiAgICByZXR1cm4gd2luZG93TmFtZXMuc2xpY2UoKTsKICB9Cn07Cgptb2R1bGUuZXhwb3J0cy5nZXQgPSBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eU5hbWVzKGl0KXsKICBpZih3aW5kb3dOYW1lcyAmJiB0b1N0cmluZy5jYWxsKGl0KSA9PSAnW29iamVjdCBXaW5kb3ddJylyZXR1cm4gZ2V0V2luZG93TmFtZXMoaXQpOwogIHJldHVybiBnZXROYW1lcyh0b0lPYmplY3QoaXQpKTsKfTsKfSx7Ii4vJCI6NjcsIi4vJC50by1pb2JqZWN0Ijo4Nn1dLDUyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gaHR0cHM6Ly9naXRodWIuY29tL3psb2lyb2NrL2NvcmUtanMvaXNzdWVzLzg2I2lzc3VlY29tbWVudC0xMTU3NTkwMjgKdmFyIGdsb2JhbCA9IG1vZHVsZS5leHBvcnRzID0gdHlwZW9mIHdpbmRvdyAhPSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuTWF0aCA9PSBNYXRoCiAgPyB3aW5kb3cgOiB0eXBlb2Ygc2VsZiAhPSAndW5kZWZpbmVkJyAmJiBzZWxmLk1hdGggPT0gTWF0aCA/IHNlbGYgOiBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpOwppZih0eXBlb2YgX19nID09ICdudW1iZXInKV9fZyA9IGdsb2JhbDsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bmRlZgp9LHt9XSw1MzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBoYXNPd25Qcm9wZXJ0eSA9IHt9Lmhhc093blByb3BlcnR5Owptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0LCBrZXkpewogIHJldHVybiBoYXNPd25Qcm9wZXJ0eS5jYWxsKGl0LCBrZXkpOwp9Owp9LHt9XSw1NDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciAkICAgICAgICAgID0gcmVxdWlyZSgnLi8kJykKICAsIGNyZWF0ZURlc2MgPSByZXF1aXJlKCcuLyQucHJvcGVydHktZGVzYycpOwptb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4vJC5kZXNjcmlwdG9ycycpID8gZnVuY3Rpb24ob2JqZWN0LCBrZXksIHZhbHVlKXsKICByZXR1cm4gJC5zZXREZXNjKG9iamVjdCwga2V5LCBjcmVhdGVEZXNjKDEsIHZhbHVlKSk7Cn0gOiBmdW5jdGlvbihvYmplY3QsIGtleSwgdmFsdWUpewogIG9iamVjdFtrZXldID0gdmFsdWU7CiAgcmV0dXJuIG9iamVjdDsKfTsKfSx7Ii4vJCI6NjcsIi4vJC5kZXNjcmlwdG9ycyI6NDUsIi4vJC5wcm9wZXJ0eS1kZXNjIjo3M31dLDU1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLyQuZ2xvYmFsJykuZG9jdW1lbnQgJiYgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50Owp9LHsiLi8kLmdsb2JhbCI6NTJ9XSw1NjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIGZhc3QgYXBwbHksIGh0dHA6Ly9qc3BlcmYubG5raXQuY29tL2Zhc3QtYXBwbHkvNQptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGZuLCBhcmdzLCB0aGF0KXsKICB2YXIgdW4gPSB0aGF0ID09PSB1bmRlZmluZWQ7CiAgc3dpdGNoKGFyZ3MubGVuZ3RoKXsKICAgIGNhc2UgMDogcmV0dXJuIHVuID8gZm4oKQogICAgICAgICAgICAgICAgICAgICAgOiBmbi5jYWxsKHRoYXQpOwogICAgY2FzZSAxOiByZXR1cm4gdW4gPyBmbihhcmdzWzBdKQogICAgICAgICAgICAgICAgICAgICAgOiBmbi5jYWxsKHRoYXQsIGFyZ3NbMF0pOwogICAgY2FzZSAyOiByZXR1cm4gdW4gPyBmbihhcmdzWzBdLCBhcmdzWzFdKQogICAgICAgICAgICAgICAgICAgICAgOiBmbi5jYWxsKHRoYXQsIGFyZ3NbMF0sIGFyZ3NbMV0pOwogICAgY2FzZSAzOiByZXR1cm4gdW4gPyBmbihhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdKQogICAgICAgICAgICAgICAgICAgICAgOiBmbi5jYWxsKHRoYXQsIGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0pOwogICAgY2FzZSA0OiByZXR1cm4gdW4gPyBmbihhcmdzWzBdLCBhcmdzWzFdLCBhcmdzWzJdLCBhcmdzWzNdKQogICAgICAgICAgICAgICAgICAgICAgOiBmbi5jYWxsKHRoYXQsIGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0sIGFyZ3NbM10pOwogIH0gcmV0dXJuICAgICAgICAgICAgICBmbi5hcHBseSh0aGF0LCBhcmdzKTsKfTsKfSx7fV0sNTc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBmYWxsYmFjayBmb3Igbm9uLWFycmF5LWxpa2UgRVMzIGFuZCBub24tZW51bWVyYWJsZSBvbGQgVjggc3RyaW5ncwp2YXIgY29mID0gcmVxdWlyZSgnLi8kLmNvZicpOwptb2R1bGUuZXhwb3J0cyA9IE9iamVjdCgneicpLnByb3BlcnR5SXNFbnVtZXJhYmxlKDApID8gT2JqZWN0IDogZnVuY3Rpb24oaXQpewogIHJldHVybiBjb2YoaXQpID09ICdTdHJpbmcnID8gaXQuc3BsaXQoJycpIDogT2JqZWN0KGl0KTsKfTsKfSx7Ii4vJC5jb2YiOjM4fV0sNTg6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBjaGVjayBvbiBkZWZhdWx0IEFycmF5IGl0ZXJhdG9yCnZhciBJdGVyYXRvcnMgID0gcmVxdWlyZSgnLi8kLml0ZXJhdG9ycycpCiAgLCBJVEVSQVRPUiAgID0gcmVxdWlyZSgnLi8kLndrcycpKCdpdGVyYXRvcicpCiAgLCBBcnJheVByb3RvID0gQXJyYXkucHJvdG90eXBlOwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgcmV0dXJuIGl0ICE9PSB1bmRlZmluZWQgJiYgKEl0ZXJhdG9ycy5BcnJheSA9PT0gaXQgfHwgQXJyYXlQcm90b1tJVEVSQVRPUl0gPT09IGl0KTsKfTsKfSx7Ii4vJC5pdGVyYXRvcnMiOjY2LCIuLyQud2tzIjo5MH1dLDU5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gNy4yLjIgSXNBcnJheShhcmd1bWVudCkKdmFyIGNvZiA9IHJlcXVpcmUoJy4vJC5jb2YnKTsKbW9kdWxlLmV4cG9ydHMgPSBBcnJheS5pc0FycmF5IHx8IGZ1bmN0aW9uKGFyZyl7CiAgcmV0dXJuIGNvZihhcmcpID09ICdBcnJheSc7Cn07Cn0seyIuLyQuY29mIjozOH1dLDYwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgcmV0dXJuIHR5cGVvZiBpdCA9PT0gJ29iamVjdCcgPyBpdCAhPT0gbnVsbCA6IHR5cGVvZiBpdCA9PT0gJ2Z1bmN0aW9uJzsKfTsKfSx7fV0sNjE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBjYWxsIHNvbWV0aGluZyBvbiBpdGVyYXRvciBzdGVwIHdpdGggc2FmZSBjbG9zaW5nIG9uIGVycm9yCnZhciBhbk9iamVjdCA9IHJlcXVpcmUoJy4vJC5hbi1vYmplY3QnKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdGVyYXRvciwgZm4sIHZhbHVlLCBlbnRyaWVzKXsKICB0cnkgewogICAgcmV0dXJuIGVudHJpZXMgPyBmbihhbk9iamVjdCh2YWx1ZSlbMF0sIHZhbHVlWzFdKSA6IGZuKHZhbHVlKTsKICAvLyA3LjQuNiBJdGVyYXRvckNsb3NlKGl0ZXJhdG9yLCBjb21wbGV0aW9uKQogIH0gY2F0Y2goZSl7CiAgICB2YXIgcmV0ID0gaXRlcmF0b3JbJ3JldHVybiddOwogICAgaWYocmV0ICE9PSB1bmRlZmluZWQpYW5PYmplY3QocmV0LmNhbGwoaXRlcmF0b3IpKTsKICAgIHRocm93IGU7CiAgfQp9Owp9LHsiLi8kLmFuLW9iamVjdCI6MzZ9XSw2MjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKdmFyICQgICAgICAgICAgICAgID0gcmVxdWlyZSgnLi8kJykKICAsIGRlc2NyaXB0b3IgICAgID0gcmVxdWlyZSgnLi8kLnByb3BlcnR5LWRlc2MnKQogICwgc2V0VG9TdHJpbmdUYWcgPSByZXF1aXJlKCcuLyQuc2V0LXRvLXN0cmluZy10YWcnKQogICwgSXRlcmF0b3JQcm90b3R5cGUgPSB7fTsKCi8vIDI1LjEuMi4xLjEgJUl0ZXJhdG9yUHJvdG90eXBlJVtAQGl0ZXJhdG9yXSgpCnJlcXVpcmUoJy4vJC5oaWRlJykoSXRlcmF0b3JQcm90b3R5cGUsIHJlcXVpcmUoJy4vJC53a3MnKSgnaXRlcmF0b3InKSwgZnVuY3Rpb24oKXsgcmV0dXJuIHRoaXM7IH0pOwoKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihDb25zdHJ1Y3RvciwgTkFNRSwgbmV4dCl7CiAgQ29uc3RydWN0b3IucHJvdG90eXBlID0gJC5jcmVhdGUoSXRlcmF0b3JQcm90b3R5cGUsIHtuZXh0OiBkZXNjcmlwdG9yKDEsIG5leHQpfSk7CiAgc2V0VG9TdHJpbmdUYWcoQ29uc3RydWN0b3IsIE5BTUUgKyAnIEl0ZXJhdG9yJyk7Cn07Cn0seyIuLyQiOjY3LCIuLyQuaGlkZSI6NTQsIi4vJC5wcm9wZXJ0eS1kZXNjIjo3MywiLi8kLnNldC10by1zdHJpbmctdGFnIjo3OSwiLi8kLndrcyI6OTB9XSw2MzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKdmFyIExJQlJBUlkgICAgICAgID0gcmVxdWlyZSgnLi8kLmxpYnJhcnknKQogICwgJGV4cG9ydCAgICAgICAgPSByZXF1aXJlKCcuLyQuZXhwb3J0JykKICAsIHJlZGVmaW5lICAgICAgID0gcmVxdWlyZSgnLi8kLnJlZGVmaW5lJykKICAsIGhpZGUgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLmhpZGUnKQogICwgaGFzICAgICAgICAgICAgPSByZXF1aXJlKCcuLyQuaGFzJykKICAsIEl0ZXJhdG9ycyAgICAgID0gcmVxdWlyZSgnLi8kLml0ZXJhdG9ycycpCiAgLCAkaXRlckNyZWF0ZSAgICA9IHJlcXVpcmUoJy4vJC5pdGVyLWNyZWF0ZScpCiAgLCBzZXRUb1N0cmluZ1RhZyA9IHJlcXVpcmUoJy4vJC5zZXQtdG8tc3RyaW5nLXRhZycpCiAgLCBnZXRQcm90byAgICAgICA9IHJlcXVpcmUoJy4vJCcpLmdldFByb3RvCiAgLCBJVEVSQVRPUiAgICAgICA9IHJlcXVpcmUoJy4vJC53a3MnKSgnaXRlcmF0b3InKQogICwgQlVHR1kgICAgICAgICAgPSAhKFtdLmtleXMgJiYgJ25leHQnIGluIFtdLmtleXMoKSkgLy8gU2FmYXJpIGhhcyBidWdneSBpdGVyYXRvcnMgdy9vIGBuZXh0YAogICwgRkZfSVRFUkFUT1IgICAgPSAnQEBpdGVyYXRvcicKICAsIEtFWVMgICAgICAgICAgID0gJ2tleXMnCiAgLCBWQUxVRVMgICAgICAgICA9ICd2YWx1ZXMnOwoKdmFyIHJldHVyblRoaXMgPSBmdW5jdGlvbigpeyByZXR1cm4gdGhpczsgfTsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oQmFzZSwgTkFNRSwgQ29uc3RydWN0b3IsIG5leHQsIERFRkFVTFQsIElTX1NFVCwgRk9SQ0VEKXsKICAkaXRlckNyZWF0ZShDb25zdHJ1Y3RvciwgTkFNRSwgbmV4dCk7CiAgdmFyIGdldE1ldGhvZCA9IGZ1bmN0aW9uKGtpbmQpewogICAgaWYoIUJVR0dZICYmIGtpbmQgaW4gcHJvdG8pcmV0dXJuIHByb3RvW2tpbmRdOwogICAgc3dpdGNoKGtpbmQpewogICAgICBjYXNlIEtFWVM6IHJldHVybiBmdW5jdGlvbiBrZXlzKCl7IHJldHVybiBuZXcgQ29uc3RydWN0b3IodGhpcywga2luZCk7IH07CiAgICAgIGNhc2UgVkFMVUVTOiByZXR1cm4gZnVuY3Rpb24gdmFsdWVzKCl7IHJldHVybiBuZXcgQ29uc3RydWN0b3IodGhpcywga2luZCk7IH07CiAgICB9IHJldHVybiBmdW5jdGlvbiBlbnRyaWVzKCl7IHJldHVybiBuZXcgQ29uc3RydWN0b3IodGhpcywga2luZCk7IH07CiAgfTsKICB2YXIgVEFHICAgICAgICA9IE5BTUUgKyAnIEl0ZXJhdG9yJwogICAgLCBERUZfVkFMVUVTID0gREVGQVVMVCA9PSBWQUxVRVMKICAgICwgVkFMVUVTX0JVRyA9IGZhbHNlCiAgICAsIHByb3RvICAgICAgPSBCYXNlLnByb3RvdHlwZQogICAgLCAkbmF0aXZlICAgID0gcHJvdG9bSVRFUkFUT1JdIHx8IHByb3RvW0ZGX0lURVJBVE9SXSB8fCBERUZBVUxUICYmIHByb3RvW0RFRkFVTFRdCiAgICAsICRkZWZhdWx0ICAgPSAkbmF0aXZlIHx8IGdldE1ldGhvZChERUZBVUxUKQogICAgLCBtZXRob2RzLCBrZXk7CiAgLy8gRml4IG5hdGl2ZQogIGlmKCRuYXRpdmUpewogICAgdmFyIEl0ZXJhdG9yUHJvdG90eXBlID0gZ2V0UHJvdG8oJGRlZmF1bHQuY2FsbChuZXcgQmFzZSkpOwogICAgLy8gU2V0IEBAdG9TdHJpbmdUYWcgdG8gbmF0aXZlIGl0ZXJhdG9ycwogICAgc2V0VG9TdHJpbmdUYWcoSXRlcmF0b3JQcm90b3R5cGUsIFRBRywgdHJ1ZSk7CiAgICAvLyBGRiBmaXgKICAgIGlmKCFMSUJSQVJZICYmIGhhcyhwcm90bywgRkZfSVRFUkFUT1IpKWhpZGUoSXRlcmF0b3JQcm90b3R5cGUsIElURVJBVE9SLCByZXR1cm5UaGlzKTsKICAgIC8vIGZpeCBBcnJheSN7dmFsdWVzLCBAQGl0ZXJhdG9yfS5uYW1lIGluIFY4IC8gRkYKICAgIGlmKERFRl9WQUxVRVMgJiYgJG5hdGl2ZS5uYW1lICE9PSBWQUxVRVMpewogICAgICBWQUxVRVNfQlVHID0gdHJ1ZTsKICAgICAgJGRlZmF1bHQgPSBmdW5jdGlvbiB2YWx1ZXMoKXsgcmV0dXJuICRuYXRpdmUuY2FsbCh0aGlzKTsgfTsKICAgIH0KICB9CiAgLy8gRGVmaW5lIGl0ZXJhdG9yCiAgaWYoKCFMSUJSQVJZIHx8IEZPUkNFRCkgJiYgKEJVR0dZIHx8IFZBTFVFU19CVUcgfHwgIXByb3RvW0lURVJBVE9SXSkpewogICAgaGlkZShwcm90bywgSVRFUkFUT1IsICRkZWZhdWx0KTsKICB9CiAgLy8gUGx1ZyBmb3IgbGlicmFyeQogIEl0ZXJhdG9yc1tOQU1FXSA9ICRkZWZhdWx0OwogIEl0ZXJhdG9yc1tUQUddICA9IHJldHVyblRoaXM7CiAgaWYoREVGQVVMVCl7CiAgICBtZXRob2RzID0gewogICAgICB2YWx1ZXM6ICBERUZfVkFMVUVTICA/ICRkZWZhdWx0IDogZ2V0TWV0aG9kKFZBTFVFUyksCiAgICAgIGtleXM6ICAgIElTX1NFVCAgICAgID8gJGRlZmF1bHQgOiBnZXRNZXRob2QoS0VZUyksCiAgICAgIGVudHJpZXM6ICFERUZfVkFMVUVTID8gJGRlZmF1bHQgOiBnZXRNZXRob2QoJ2VudHJpZXMnKQogICAgfTsKICAgIGlmKEZPUkNFRClmb3Ioa2V5IGluIG1ldGhvZHMpewogICAgICBpZighKGtleSBpbiBwcm90bykpcmVkZWZpbmUocHJvdG8sIGtleSwgbWV0aG9kc1trZXldKTsKICAgIH0gZWxzZSAkZXhwb3J0KCRleHBvcnQuUCArICRleHBvcnQuRiAqIChCVUdHWSB8fCBWQUxVRVNfQlVHKSwgTkFNRSwgbWV0aG9kcyk7CiAgfQogIHJldHVybiBtZXRob2RzOwp9Owp9LHsiLi8kIjo2NywiLi8kLmV4cG9ydCI6NDgsIi4vJC5oYXMiOjUzLCIuLyQuaGlkZSI6NTQsIi4vJC5pdGVyLWNyZWF0ZSI6NjIsIi4vJC5pdGVyYXRvcnMiOjY2LCIuLyQubGlicmFyeSI6NjksIi4vJC5yZWRlZmluZSI6NzUsIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyI6NzksIi4vJC53a3MiOjkwfV0sNjQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgSVRFUkFUT1IgICAgID0gcmVxdWlyZSgnLi8kLndrcycpKCdpdGVyYXRvcicpCiAgLCBTQUZFX0NMT1NJTkcgPSBmYWxzZTsKCnRyeSB7CiAgdmFyIHJpdGVyID0gWzddW0lURVJBVE9SXSgpOwogIHJpdGVyWydyZXR1cm4nXSA9IGZ1bmN0aW9uKCl7IFNBRkVfQ0xPU0lORyA9IHRydWU7IH07CiAgQXJyYXkuZnJvbShyaXRlciwgZnVuY3Rpb24oKXsgdGhyb3cgMjsgfSk7Cn0gY2F0Y2goZSl7IC8qIGVtcHR5ICovIH0KCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oZXhlYywgc2tpcENsb3NpbmcpewogIGlmKCFza2lwQ2xvc2luZyAmJiAhU0FGRV9DTE9TSU5HKXJldHVybiBmYWxzZTsKICB2YXIgc2FmZSA9IGZhbHNlOwogIHRyeSB7CiAgICB2YXIgYXJyICA9IFs3XQogICAgICAsIGl0ZXIgPSBhcnJbSVRFUkFUT1JdKCk7CiAgICBpdGVyLm5leHQgPSBmdW5jdGlvbigpeyBzYWZlID0gdHJ1ZTsgfTsKICAgIGFycltJVEVSQVRPUl0gPSBmdW5jdGlvbigpeyByZXR1cm4gaXRlcjsgfTsKICAgIGV4ZWMoYXJyKTsKICB9IGNhdGNoKGUpeyAvKiBlbXB0eSAqLyB9CiAgcmV0dXJuIHNhZmU7Cn07Cn0seyIuLyQud2tzIjo5MH1dLDY1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihkb25lLCB2YWx1ZSl7CiAgcmV0dXJuIHt2YWx1ZTogdmFsdWUsIGRvbmU6ICEhZG9uZX07Cn07Cn0se31dLDY2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSB7fTsKfSx7fV0sNjc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgJE9iamVjdCA9IE9iamVjdDsKbW9kdWxlLmV4cG9ydHMgPSB7CiAgY3JlYXRlOiAgICAgJE9iamVjdC5jcmVhdGUsCiAgZ2V0UHJvdG86ICAgJE9iamVjdC5nZXRQcm90b3R5cGVPZiwKICBpc0VudW06ICAgICB7fS5wcm9wZXJ0eUlzRW51bWVyYWJsZSwKICBnZXREZXNjOiAgICAkT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvciwKICBzZXREZXNjOiAgICAkT2JqZWN0LmRlZmluZVByb3BlcnR5LAogIHNldERlc2NzOiAgICRPYmplY3QuZGVmaW5lUHJvcGVydGllcywKICBnZXRLZXlzOiAgICAkT2JqZWN0LmtleXMsCiAgZ2V0TmFtZXM6ICAgJE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzLAogIGdldFN5bWJvbHM6ICRPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzLAogIGVhY2g6ICAgICAgIFtdLmZvckVhY2gKfTsKfSx7fV0sNjg6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgJCAgICAgICAgID0gcmVxdWlyZSgnLi8kJykKICAsIHRvSU9iamVjdCA9IHJlcXVpcmUoJy4vJC50by1pb2JqZWN0Jyk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24ob2JqZWN0LCBlbCl7CiAgdmFyIE8gICAgICA9IHRvSU9iamVjdChvYmplY3QpCiAgICAsIGtleXMgICA9ICQuZ2V0S2V5cyhPKQogICAgLCBsZW5ndGggPSBrZXlzLmxlbmd0aAogICAgLCBpbmRleCAgPSAwCiAgICAsIGtleTsKICB3aGlsZShsZW5ndGggPiBpbmRleClpZihPW2tleSA9IGtleXNbaW5kZXgrK11dID09PSBlbClyZXR1cm4ga2V5Owp9Owp9LHsiLi8kIjo2NywiLi8kLnRvLWlvYmplY3QiOjg2fV0sNjk6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cyA9IHRydWU7Cn0se31dLDcwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIGdsb2JhbCAgICA9IHJlcXVpcmUoJy4vJC5nbG9iYWwnKQogICwgbWFjcm90YXNrID0gcmVxdWlyZSgnLi8kLnRhc2snKS5zZXQKICAsIE9ic2VydmVyICA9IGdsb2JhbC5NdXRhdGlvbk9ic2VydmVyIHx8IGdsb2JhbC5XZWJLaXRNdXRhdGlvbk9ic2VydmVyCiAgLCBwcm9jZXNzICAgPSBnbG9iYWwucHJvY2VzcwogICwgUHJvbWlzZSAgID0gZ2xvYmFsLlByb21pc2UKICAsIGlzTm9kZSAgICA9IHJlcXVpcmUoJy4vJC5jb2YnKShwcm9jZXNzKSA9PSAncHJvY2VzcycKICAsIGhlYWQsIGxhc3QsIG5vdGlmeTsKCnZhciBmbHVzaCA9IGZ1bmN0aW9uKCl7CiAgdmFyIHBhcmVudCwgZG9tYWluLCBmbjsKICBpZihpc05vZGUgJiYgKHBhcmVudCA9IHByb2Nlc3MuZG9tYWluKSl7CiAgICBwcm9jZXNzLmRvbWFpbiA9IG51bGw7CiAgICBwYXJlbnQuZXhpdCgpOwogIH0KICB3aGlsZShoZWFkKXsKICAgIGRvbWFpbiA9IGhlYWQuZG9tYWluOwogICAgZm4gICAgID0gaGVhZC5mbjsKICAgIGlmKGRvbWFpbilkb21haW4uZW50ZXIoKTsKICAgIGZuKCk7IC8vIDwtIGN1cnJlbnRseSB3ZSB1c2UgaXQgb25seSBmb3IgUHJvbWlzZSAtIHRyeSAvIGNhdGNoIG5vdCByZXF1aXJlZAogICAgaWYoZG9tYWluKWRvbWFpbi5leGl0KCk7CiAgICBoZWFkID0gaGVhZC5uZXh0OwogIH0gbGFzdCA9IHVuZGVmaW5lZDsKICBpZihwYXJlbnQpcGFyZW50LmVudGVyKCk7Cn07CgovLyBOb2RlLmpzCmlmKGlzTm9kZSl7CiAgbm90aWZ5ID0gZnVuY3Rpb24oKXsKICAgIHByb2Nlc3MubmV4dFRpY2soZmx1c2gpOwogIH07Ci8vIGJyb3dzZXJzIHdpdGggTXV0YXRpb25PYnNlcnZlcgp9IGVsc2UgaWYoT2JzZXJ2ZXIpewogIHZhciB0b2dnbGUgPSAxCiAgICAsIG5vZGUgICA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKCcnKTsKICBuZXcgT2JzZXJ2ZXIoZmx1c2gpLm9ic2VydmUobm9kZSwge2NoYXJhY3RlckRhdGE6IHRydWV9KTsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby1uZXcKICBub3RpZnkgPSBmdW5jdGlvbigpewogICAgbm9kZS5kYXRhID0gdG9nZ2xlID0gLXRvZ2dsZTsKICB9OwovLyBlbnZpcm9ubWVudHMgd2l0aCBtYXliZSBub24tY29tcGxldGVseSBjb3JyZWN0LCBidXQgZXhpc3RlbnQgUHJvbWlzZQp9IGVsc2UgaWYoUHJvbWlzZSAmJiBQcm9taXNlLnJlc29sdmUpewogIG5vdGlmeSA9IGZ1bmN0aW9uKCl7CiAgICBQcm9taXNlLnJlc29sdmUoKS50aGVuKGZsdXNoKTsKICB9OwovLyBmb3Igb3RoZXIgZW52aXJvbm1lbnRzIC0gbWFjcm90YXNrIGJhc2VkIG9uOgovLyAtIHNldEltbWVkaWF0ZQovLyAtIE1lc3NhZ2VDaGFubmVsCi8vIC0gd2luZG93LnBvc3RNZXNzYWcKLy8gLSBvbnJlYWR5c3RhdGVjaGFuZ2UKLy8gLSBzZXRUaW1lb3V0Cn0gZWxzZSB7CiAgbm90aWZ5ID0gZnVuY3Rpb24oKXsKICAgIC8vIHN0cmFuZ2UgSUUgKyB3ZWJwYWNrIGRldiBzZXJ2ZXIgYnVnIC0gdXNlIC5jYWxsKGdsb2JhbCkKICAgIG1hY3JvdGFzay5jYWxsKGdsb2JhbCwgZmx1c2gpOwogIH07Cn0KCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24gYXNhcChmbil7CiAgdmFyIHRhc2sgPSB7Zm46IGZuLCBuZXh0OiB1bmRlZmluZWQsIGRvbWFpbjogaXNOb2RlICYmIHByb2Nlc3MuZG9tYWlufTsKICBpZihsYXN0KWxhc3QubmV4dCA9IHRhc2s7CiAgaWYoIWhlYWQpewogICAgaGVhZCA9IHRhc2s7CiAgICBub3RpZnkoKTsKICB9IGxhc3QgPSB0YXNrOwp9Owp9LHsiLi8kLmNvZiI6MzgsIi4vJC5nbG9iYWwiOjUyLCIuLyQudGFzayI6ODR9XSw3MTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIDE5LjEuMi4xIE9iamVjdC5hc3NpZ24odGFyZ2V0LCBzb3VyY2UsIC4uLikKdmFyICQgICAgICAgID0gcmVxdWlyZSgnLi8kJykKICAsIHRvT2JqZWN0ID0gcmVxdWlyZSgnLi8kLnRvLW9iamVjdCcpCiAgLCBJT2JqZWN0ICA9IHJlcXVpcmUoJy4vJC5pb2JqZWN0Jyk7CgovLyBzaG91bGQgd29yayB3aXRoIHN5bWJvbHMgYW5kIHNob3VsZCBoYXZlIGRldGVybWluaXN0aWMgcHJvcGVydHkgb3JkZXIgKFY4IGJ1ZykKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLyQuZmFpbHMnKShmdW5jdGlvbigpewogIHZhciBhID0gT2JqZWN0LmFzc2lnbgogICAgLCBBID0ge30KICAgICwgQiA9IHt9CiAgICAsIFMgPSBTeW1ib2woKQogICAgLCBLID0gJ2FiY2RlZmdoaWprbG1ub3BxcnN0JzsKICBBW1NdID0gNzsKICBLLnNwbGl0KCcnKS5mb3JFYWNoKGZ1bmN0aW9uKGspeyBCW2tdID0gazsgfSk7CiAgcmV0dXJuIGEoe30sIEEpW1NdICE9IDcgfHwgT2JqZWN0LmtleXMoYSh7fSwgQikpLmpvaW4oJycpICE9IEs7Cn0pID8gZnVuY3Rpb24gYXNzaWduKHRhcmdldCwgc291cmNlKXsgLy8gZXNsaW50LWRpc2FibGUtbGluZSBuby11bnVzZWQtdmFycwogIHZhciBUICAgICA9IHRvT2JqZWN0KHRhcmdldCkKICAgICwgJCQgICAgPSBhcmd1bWVudHMKICAgICwgJCRsZW4gPSAkJC5sZW5ndGgKICAgICwgaW5kZXggPSAxCiAgICAsIGdldEtleXMgICAgPSAkLmdldEtleXMKICAgICwgZ2V0U3ltYm9scyA9ICQuZ2V0U3ltYm9scwogICAgLCBpc0VudW0gICAgID0gJC5pc0VudW07CiAgd2hpbGUoJCRsZW4gPiBpbmRleCl7CiAgICB2YXIgUyAgICAgID0gSU9iamVjdCgkJFtpbmRleCsrXSkKICAgICAgLCBrZXlzICAgPSBnZXRTeW1ib2xzID8gZ2V0S2V5cyhTKS5jb25jYXQoZ2V0U3ltYm9scyhTKSkgOiBnZXRLZXlzKFMpCiAgICAgICwgbGVuZ3RoID0ga2V5cy5sZW5ndGgKICAgICAgLCBqICAgICAgPSAwCiAgICAgICwga2V5OwogICAgd2hpbGUobGVuZ3RoID4gailpZihpc0VudW0uY2FsbChTLCBrZXkgPSBrZXlzW2orK10pKVRba2V5XSA9IFNba2V5XTsKICB9CiAgcmV0dXJuIFQ7Cn0gOiBPYmplY3QuYXNzaWduOwp9LHsiLi8kIjo2NywiLi8kLmZhaWxzIjo0OSwiLi8kLmlvYmplY3QiOjU3LCIuLyQudG8tb2JqZWN0Ijo4OH1dLDcyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gbW9zdCBPYmplY3QgbWV0aG9kcyBieSBFUzYgc2hvdWxkIGFjY2VwdCBwcmltaXRpdmVzCnZhciAkZXhwb3J0ID0gcmVxdWlyZSgnLi8kLmV4cG9ydCcpCiAgLCBjb3JlICAgID0gcmVxdWlyZSgnLi8kLmNvcmUnKQogICwgZmFpbHMgICA9IHJlcXVpcmUoJy4vJC5mYWlscycpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKEtFWSwgZXhlYyl7CiAgdmFyIGZuICA9IChjb3JlLk9iamVjdCB8fCB7fSlbS0VZXSB8fCBPYmplY3RbS0VZXQogICAgLCBleHAgPSB7fTsKICBleHBbS0VZXSA9IGV4ZWMoZm4pOwogICRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogZmFpbHMoZnVuY3Rpb24oKXsgZm4oMSk7IH0pLCAnT2JqZWN0JywgZXhwKTsKfTsKfSx7Ii4vJC5jb3JlIjo0MiwiLi8kLmV4cG9ydCI6NDgsIi4vJC5mYWlscyI6NDl9XSw3MzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oYml0bWFwLCB2YWx1ZSl7CiAgcmV0dXJuIHsKICAgIGVudW1lcmFibGUgIDogIShiaXRtYXAgJiAxKSwKICAgIGNvbmZpZ3VyYWJsZTogIShiaXRtYXAgJiAyKSwKICAgIHdyaXRhYmxlICAgIDogIShiaXRtYXAgJiA0KSwKICAgIHZhbHVlICAgICAgIDogdmFsdWUKICB9Owp9Owp9LHt9XSw3NDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciByZWRlZmluZSA9IHJlcXVpcmUoJy4vJC5yZWRlZmluZScpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKHRhcmdldCwgc3JjKXsKICBmb3IodmFyIGtleSBpbiBzcmMpcmVkZWZpbmUodGFyZ2V0LCBrZXksIHNyY1trZXldKTsKICByZXR1cm4gdGFyZ2V0Owp9Owp9LHsiLi8kLnJlZGVmaW5lIjo3NX1dLDc1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKbW9kdWxlLmV4cG9ydHMgPSByZXF1aXJlKCcuLyQuaGlkZScpOwp9LHsiLi8kLmhpZGUiOjU0fV0sNzY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyA3LjIuOSBTYW1lVmFsdWUoeCwgeSkKbW9kdWxlLmV4cG9ydHMgPSBPYmplY3QuaXMgfHwgZnVuY3Rpb24gaXMoeCwgeSl7CiAgcmV0dXJuIHggPT09IHkgPyB4ICE9PSAwIHx8IDEgLyB4ID09PSAxIC8geSA6IHggIT0geCAmJiB5ICE9IHk7Cn07Cn0se31dLDc3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gV29ya3Mgd2l0aCBfX3Byb3RvX18gb25seS4gT2xkIHY4IGNhbid0IHdvcmsgd2l0aCBudWxsIHByb3RvIG9iamVjdHMuCi8qIGVzbGludC1kaXNhYmxlIG5vLXByb3RvICovCnZhciBnZXREZXNjICA9IHJlcXVpcmUoJy4vJCcpLmdldERlc2MKICAsIGlzT2JqZWN0ID0gcmVxdWlyZSgnLi8kLmlzLW9iamVjdCcpCiAgLCBhbk9iamVjdCA9IHJlcXVpcmUoJy4vJC5hbi1vYmplY3QnKTsKdmFyIGNoZWNrID0gZnVuY3Rpb24oTywgcHJvdG8pewogIGFuT2JqZWN0KE8pOwogIGlmKCFpc09iamVjdChwcm90bykgJiYgcHJvdG8gIT09IG51bGwpdGhyb3cgVHlwZUVycm9yKHByb3RvICsgIjogY2FuJ3Qgc2V0IGFzIHByb3RvdHlwZSEiKTsKfTsKbW9kdWxlLmV4cG9ydHMgPSB7CiAgc2V0OiBPYmplY3Quc2V0UHJvdG90eXBlT2YgfHwgKCdfX3Byb3RvX18nIGluIHt9ID8gLy8gZXNsaW50LWRpc2FibGUtbGluZQogICAgZnVuY3Rpb24odGVzdCwgYnVnZ3ksIHNldCl7CiAgICAgIHRyeSB7CiAgICAgICAgc2V0ID0gcmVxdWlyZSgnLi8kLmN0eCcpKEZ1bmN0aW9uLmNhbGwsIGdldERlc2MoT2JqZWN0LnByb3RvdHlwZSwgJ19fcHJvdG9fXycpLnNldCwgMik7CiAgICAgICAgc2V0KHRlc3QsIFtdKTsKICAgICAgICBidWdneSA9ICEodGVzdCBpbnN0YW5jZW9mIEFycmF5KTsKICAgICAgfSBjYXRjaChlKXsgYnVnZ3kgPSB0cnVlOyB9CiAgICAgIHJldHVybiBmdW5jdGlvbiBzZXRQcm90b3R5cGVPZihPLCBwcm90byl7CiAgICAgICAgY2hlY2soTywgcHJvdG8pOwogICAgICAgIGlmKGJ1Z2d5KU8uX19wcm90b19fID0gcHJvdG87CiAgICAgICAgZWxzZSBzZXQoTywgcHJvdG8pOwogICAgICAgIHJldHVybiBPOwogICAgICB9OwogICAgfSh7fSwgZmFsc2UpIDogdW5kZWZpbmVkKSwKICBjaGVjazogY2hlY2sKfTsKfSx7Ii4vJCI6NjcsIi4vJC5hbi1vYmplY3QiOjM2LCIuLyQuY3R4Ijo0MywiLi8kLmlzLW9iamVjdCI6NjB9XSw3ODpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKdmFyIGNvcmUgICAgICAgID0gcmVxdWlyZSgnLi8kLmNvcmUnKQogICwgJCAgICAgICAgICAgPSByZXF1aXJlKCcuLyQnKQogICwgREVTQ1JJUFRPUlMgPSByZXF1aXJlKCcuLyQuZGVzY3JpcHRvcnMnKQogICwgU1BFQ0lFUyAgICAgPSByZXF1aXJlKCcuLyQud2tzJykoJ3NwZWNpZXMnKTsKCm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oS0VZKXsKICB2YXIgQyA9IGNvcmVbS0VZXTsKICBpZihERVNDUklQVE9SUyAmJiBDICYmICFDW1NQRUNJRVNdKSQuc2V0RGVzYyhDLCBTUEVDSUVTLCB7CiAgICBjb25maWd1cmFibGU6IHRydWUsCiAgICBnZXQ6IGZ1bmN0aW9uKCl7IHJldHVybiB0aGlzOyB9CiAgfSk7Cn07Cn0seyIuLyQiOjY3LCIuLyQuY29yZSI6NDIsIi4vJC5kZXNjcmlwdG9ycyI6NDUsIi4vJC53a3MiOjkwfV0sNzk6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgZGVmID0gcmVxdWlyZSgnLi8kJykuc2V0RGVzYwogICwgaGFzID0gcmVxdWlyZSgnLi8kLmhhcycpCiAgLCBUQUcgPSByZXF1aXJlKCcuLyQud2tzJykoJ3RvU3RyaW5nVGFnJyk7Cgptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0LCB0YWcsIHN0YXQpewogIGlmKGl0ICYmICFoYXMoaXQgPSBzdGF0ID8gaXQgOiBpdC5wcm90b3R5cGUsIFRBRykpZGVmKGl0LCBUQUcsIHtjb25maWd1cmFibGU6IHRydWUsIHZhbHVlOiB0YWd9KTsKfTsKfSx7Ii4vJCI6NjcsIi4vJC5oYXMiOjUzLCIuLyQud2tzIjo5MH1dLDgwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKdmFyIGdsb2JhbCA9IHJlcXVpcmUoJy4vJC5nbG9iYWwnKQogICwgU0hBUkVEID0gJ19fY29yZS1qc19zaGFyZWRfXycKICAsIHN0b3JlICA9IGdsb2JhbFtTSEFSRURdIHx8IChnbG9iYWxbU0hBUkVEXSA9IHt9KTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihrZXkpewogIHJldHVybiBzdG9yZVtrZXldIHx8IChzdG9yZVtrZXldID0ge30pOwp9Owp9LHsiLi8kLmdsb2JhbCI6NTJ9XSw4MTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIDcuMy4yMCBTcGVjaWVzQ29uc3RydWN0b3IoTywgZGVmYXVsdENvbnN0cnVjdG9yKQp2YXIgYW5PYmplY3QgID0gcmVxdWlyZSgnLi8kLmFuLW9iamVjdCcpCiAgLCBhRnVuY3Rpb24gPSByZXF1aXJlKCcuLyQuYS1mdW5jdGlvbicpCiAgLCBTUEVDSUVTICAgPSByZXF1aXJlKCcuLyQud2tzJykoJ3NwZWNpZXMnKTsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihPLCBEKXsKICB2YXIgQyA9IGFuT2JqZWN0KE8pLmNvbnN0cnVjdG9yLCBTOwogIHJldHVybiBDID09PSB1bmRlZmluZWQgfHwgKFMgPSBhbk9iamVjdChDKVtTUEVDSUVTXSkgPT0gdW5kZWZpbmVkID8gRCA6IGFGdW5jdGlvbihTKTsKfTsKfSx7Ii4vJC5hLWZ1bmN0aW9uIjozNCwiLi8kLmFuLW9iamVjdCI6MzYsIi4vJC53a3MiOjkwfV0sODI6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0LCBDb25zdHJ1Y3RvciwgbmFtZSl7CiAgaWYoIShpdCBpbnN0YW5jZW9mIENvbnN0cnVjdG9yKSl0aHJvdyBUeXBlRXJyb3IobmFtZSArICI6IHVzZSB0aGUgJ25ldycgb3BlcmF0b3IhIik7CiAgcmV0dXJuIGl0Owp9Owp9LHt9XSw4MzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciB0b0ludGVnZXIgPSByZXF1aXJlKCcuLyQudG8taW50ZWdlcicpCiAgLCBkZWZpbmVkICAgPSByZXF1aXJlKCcuLyQuZGVmaW5lZCcpOwovLyB0cnVlICAtPiBTdHJpbmcjYXQKLy8gZmFsc2UgLT4gU3RyaW5nI2NvZGVQb2ludEF0Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oVE9fU1RSSU5HKXsKICByZXR1cm4gZnVuY3Rpb24odGhhdCwgcG9zKXsKICAgIHZhciBzID0gU3RyaW5nKGRlZmluZWQodGhhdCkpCiAgICAgICwgaSA9IHRvSW50ZWdlcihwb3MpCiAgICAgICwgbCA9IHMubGVuZ3RoCiAgICAgICwgYSwgYjsKICAgIGlmKGkgPCAwIHx8IGkgPj0gbClyZXR1cm4gVE9fU1RSSU5HID8gJycgOiB1bmRlZmluZWQ7CiAgICBhID0gcy5jaGFyQ29kZUF0KGkpOwogICAgcmV0dXJuIGEgPCAweGQ4MDAgfHwgYSA+IDB4ZGJmZiB8fCBpICsgMSA9PT0gbCB8fCAoYiA9IHMuY2hhckNvZGVBdChpICsgMSkpIDwgMHhkYzAwIHx8IGIgPiAweGRmZmYKICAgICAgPyBUT19TVFJJTkcgPyBzLmNoYXJBdChpKSA6IGEKICAgICAgOiBUT19TVFJJTkcgPyBzLnNsaWNlKGksIGkgKyAyKSA6IChhIC0gMHhkODAwIDw8IDEwKSArIChiIC0gMHhkYzAwKSArIDB4MTAwMDA7CiAgfTsKfTsKfSx7Ii4vJC5kZWZpbmVkIjo0NCwiLi8kLnRvLWludGVnZXIiOjg1fV0sODQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgY3R4ICAgICAgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLmN0eCcpCiAgLCBpbnZva2UgICAgICAgICAgICAgPSByZXF1aXJlKCcuLyQuaW52b2tlJykKICAsIGh0bWwgICAgICAgICAgICAgICA9IHJlcXVpcmUoJy4vJC5odG1sJykKICAsIGNlbCAgICAgICAgICAgICAgICA9IHJlcXVpcmUoJy4vJC5kb20tY3JlYXRlJykKICAsIGdsb2JhbCAgICAgICAgICAgICA9IHJlcXVpcmUoJy4vJC5nbG9iYWwnKQogICwgcHJvY2VzcyAgICAgICAgICAgID0gZ2xvYmFsLnByb2Nlc3MKICAsIHNldFRhc2sgICAgICAgICAgICA9IGdsb2JhbC5zZXRJbW1lZGlhdGUKICAsIGNsZWFyVGFzayAgICAgICAgICA9IGdsb2JhbC5jbGVhckltbWVkaWF0ZQogICwgTWVzc2FnZUNoYW5uZWwgICAgID0gZ2xvYmFsLk1lc3NhZ2VDaGFubmVsCiAgLCBjb3VudGVyICAgICAgICAgICAgPSAwCiAgLCBxdWV1ZSAgICAgICAgICAgICAgPSB7fQogICwgT05SRUFEWVNUQVRFQ0hBTkdFID0gJ29ucmVhZHlzdGF0ZWNoYW5nZScKICAsIGRlZmVyLCBjaGFubmVsLCBwb3J0Owp2YXIgcnVuID0gZnVuY3Rpb24oKXsKICB2YXIgaWQgPSArdGhpczsKICBpZihxdWV1ZS5oYXNPd25Qcm9wZXJ0eShpZCkpewogICAgdmFyIGZuID0gcXVldWVbaWRdOwogICAgZGVsZXRlIHF1ZXVlW2lkXTsKICAgIGZuKCk7CiAgfQp9Owp2YXIgbGlzdG5lciA9IGZ1bmN0aW9uKGV2ZW50KXsKICBydW4uY2FsbChldmVudC5kYXRhKTsKfTsKLy8gTm9kZS5qcyAwLjkrICYgSUUxMCsgaGFzIHNldEltbWVkaWF0ZSwgb3RoZXJ3aXNlOgppZighc2V0VGFzayB8fCAhY2xlYXJUYXNrKXsKICBzZXRUYXNrID0gZnVuY3Rpb24gc2V0SW1tZWRpYXRlKGZuKXsKICAgIHZhciBhcmdzID0gW10sIGkgPSAxOwogICAgd2hpbGUoYXJndW1lbnRzLmxlbmd0aCA+IGkpYXJncy5wdXNoKGFyZ3VtZW50c1tpKytdKTsKICAgIHF1ZXVlWysrY291bnRlcl0gPSBmdW5jdGlvbigpewogICAgICBpbnZva2UodHlwZW9mIGZuID09ICdmdW5jdGlvbicgPyBmbiA6IEZ1bmN0aW9uKGZuKSwgYXJncyk7CiAgICB9OwogICAgZGVmZXIoY291bnRlcik7CiAgICByZXR1cm4gY291bnRlcjsKICB9OwogIGNsZWFyVGFzayA9IGZ1bmN0aW9uIGNsZWFySW1tZWRpYXRlKGlkKXsKICAgIGRlbGV0ZSBxdWV1ZVtpZF07CiAgfTsKICAvLyBOb2RlLmpzIDAuOC0KICBpZihyZXF1aXJlKCcuLyQuY29mJykocHJvY2VzcykgPT0gJ3Byb2Nlc3MnKXsKICAgIGRlZmVyID0gZnVuY3Rpb24oaWQpewogICAgICBwcm9jZXNzLm5leHRUaWNrKGN0eChydW4sIGlkLCAxKSk7CiAgICB9OwogIC8vIEJyb3dzZXJzIHdpdGggTWVzc2FnZUNoYW5uZWwsIGluY2x1ZGVzIFdlYldvcmtlcnMKICB9IGVsc2UgaWYoTWVzc2FnZUNoYW5uZWwpewogICAgY2hhbm5lbCA9IG5ldyBNZXNzYWdlQ2hhbm5lbDsKICAgIHBvcnQgICAgPSBjaGFubmVsLnBvcnQyOwogICAgY2hhbm5lbC5wb3J0MS5vbm1lc3NhZ2UgPSBsaXN0bmVyOwogICAgZGVmZXIgPSBjdHgocG9ydC5wb3N0TWVzc2FnZSwgcG9ydCwgMSk7CiAgLy8gQnJvd3NlcnMgd2l0aCBwb3N0TWVzc2FnZSwgc2tpcCBXZWJXb3JrZXJzCiAgLy8gSUU4IGhhcyBwb3N0TWVzc2FnZSwgYnV0IGl0J3Mgc3luYyAmIHR5cGVvZiBpdHMgcG9zdE1lc3NhZ2UgaXMgJ29iamVjdCcKICB9IGVsc2UgaWYoZ2xvYmFsLmFkZEV2ZW50TGlzdGVuZXIgJiYgdHlwZW9mIHBvc3RNZXNzYWdlID09ICdmdW5jdGlvbicgJiYgIWdsb2JhbC5pbXBvcnRTY3JpcHRzKXsKICAgIGRlZmVyID0gZnVuY3Rpb24oaWQpewogICAgICBnbG9iYWwucG9zdE1lc3NhZ2UoaWQgKyAnJywgJyonKTsKICAgIH07CiAgICBnbG9iYWwuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIGxpc3RuZXIsIGZhbHNlKTsKICAvLyBJRTgtCiAgfSBlbHNlIGlmKE9OUkVBRFlTVEFURUNIQU5HRSBpbiBjZWwoJ3NjcmlwdCcpKXsKICAgIGRlZmVyID0gZnVuY3Rpb24oaWQpewogICAgICBodG1sLmFwcGVuZENoaWxkKGNlbCgnc2NyaXB0JykpW09OUkVBRFlTVEFURUNIQU5HRV0gPSBmdW5jdGlvbigpewogICAgICAgIGh0bWwucmVtb3ZlQ2hpbGQodGhpcyk7CiAgICAgICAgcnVuLmNhbGwoaWQpOwogICAgICB9OwogICAgfTsKICAvLyBSZXN0IG9sZCBicm93c2VycwogIH0gZWxzZSB7CiAgICBkZWZlciA9IGZ1bmN0aW9uKGlkKXsKICAgICAgc2V0VGltZW91dChjdHgocnVuLCBpZCwgMSksIDApOwogICAgfTsKICB9Cn0KbW9kdWxlLmV4cG9ydHMgPSB7CiAgc2V0OiAgIHNldFRhc2ssCiAgY2xlYXI6IGNsZWFyVGFzawp9Owp9LHsiLi8kLmNvZiI6MzgsIi4vJC5jdHgiOjQzLCIuLyQuZG9tLWNyZWF0ZSI6NDYsIi4vJC5nbG9iYWwiOjUyLCIuLyQuaHRtbCI6NTUsIi4vJC5pbnZva2UiOjU2fV0sODU6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyA3LjEuNCBUb0ludGVnZXIKdmFyIGNlaWwgID0gTWF0aC5jZWlsCiAgLCBmbG9vciA9IE1hdGguZmxvb3I7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpewogIHJldHVybiBpc05hTihpdCA9ICtpdCkgPyAwIDogKGl0ID4gMCA/IGZsb29yIDogY2VpbCkoaXQpOwp9Owp9LHt9XSw4NjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIHRvIGluZGV4ZWQgb2JqZWN0LCB0b09iamVjdCB3aXRoIGZhbGxiYWNrIGZvciBub24tYXJyYXktbGlrZSBFUzMgc3RyaW5ncwp2YXIgSU9iamVjdCA9IHJlcXVpcmUoJy4vJC5pb2JqZWN0JykKICAsIGRlZmluZWQgPSByZXF1aXJlKCcuLyQuZGVmaW5lZCcpOwptb2R1bGUuZXhwb3J0cyA9IGZ1bmN0aW9uKGl0KXsKICByZXR1cm4gSU9iamVjdChkZWZpbmVkKGl0KSk7Cn07Cn0seyIuLyQuZGVmaW5lZCI6NDQsIi4vJC5pb2JqZWN0Ijo1N31dLDg3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gNy4xLjE1IFRvTGVuZ3RoCnZhciB0b0ludGVnZXIgPSByZXF1aXJlKCcuLyQudG8taW50ZWdlcicpCiAgLCBtaW4gICAgICAgPSBNYXRoLm1pbjsKbW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbihpdCl7CiAgcmV0dXJuIGl0ID4gMCA/IG1pbih0b0ludGVnZXIoaXQpLCAweDFmZmZmZmZmZmZmZmZmKSA6IDA7IC8vIHBvdygyLCA1MykgLSAxID09IDkwMDcxOTkyNTQ3NDA5OTEKfTsKfSx7Ii4vJC50by1pbnRlZ2VyIjo4NX1dLDg4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gNy4xLjEzIFRvT2JqZWN0KGFyZ3VtZW50KQp2YXIgZGVmaW5lZCA9IHJlcXVpcmUoJy4vJC5kZWZpbmVkJyk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oaXQpewogIHJldHVybiBPYmplY3QoZGVmaW5lZChpdCkpOwp9Owp9LHsiLi8kLmRlZmluZWQiOjQ0fV0sODk6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgaWQgPSAwCiAgLCBweCA9IE1hdGgucmFuZG9tKCk7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24oa2V5KXsKICByZXR1cm4gJ1N5bWJvbCgnLmNvbmNhdChrZXkgPT09IHVuZGVmaW5lZCA/ICcnIDoga2V5LCAnKV8nLCAoKytpZCArIHB4KS50b1N0cmluZygzNikpOwp9Owp9LHt9XSw5MDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnZhciBzdG9yZSAgPSByZXF1aXJlKCcuLyQuc2hhcmVkJykoJ3drcycpCiAgLCB1aWQgICAgPSByZXF1aXJlKCcuLyQudWlkJykKICAsIFN5bWJvbCA9IHJlcXVpcmUoJy4vJC5nbG9iYWwnKS5TeW1ib2w7Cm1vZHVsZS5leHBvcnRzID0gZnVuY3Rpb24obmFtZSl7CiAgcmV0dXJuIHN0b3JlW25hbWVdIHx8IChzdG9yZVtuYW1lXSA9CiAgICBTeW1ib2wgJiYgU3ltYm9sW25hbWVdIHx8IChTeW1ib2wgfHwgdWlkKSgnU3ltYm9sLicgKyBuYW1lKSk7Cn07Cn0seyIuLyQuZ2xvYmFsIjo1MiwiLi8kLnNoYXJlZCI6ODAsIi4vJC51aWQiOjg5fV0sOTE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewp2YXIgY2xhc3NvZiAgID0gcmVxdWlyZSgnLi8kLmNsYXNzb2YnKQogICwgSVRFUkFUT1IgID0gcmVxdWlyZSgnLi8kLndrcycpKCdpdGVyYXRvcicpCiAgLCBJdGVyYXRvcnMgPSByZXF1aXJlKCcuLyQuaXRlcmF0b3JzJyk7Cm1vZHVsZS5leHBvcnRzID0gcmVxdWlyZSgnLi8kLmNvcmUnKS5nZXRJdGVyYXRvck1ldGhvZCA9IGZ1bmN0aW9uKGl0KXsKICBpZihpdCAhPSB1bmRlZmluZWQpcmV0dXJuIGl0W0lURVJBVE9SXQogICAgfHwgaXRbJ0BAaXRlcmF0b3InXQogICAgfHwgSXRlcmF0b3JzW2NsYXNzb2YoaXQpXTsKfTsKfSx7Ii4vJC5jbGFzc29mIjozNywiLi8kLmNvcmUiOjQyLCIuLyQuaXRlcmF0b3JzIjo2NiwiLi8kLndrcyI6OTB9XSw5MjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKdmFyIGFkZFRvVW5zY29wYWJsZXMgPSByZXF1aXJlKCcuLyQuYWRkLXRvLXVuc2NvcGFibGVzJykKICAsIHN0ZXAgICAgICAgICAgICAgPSByZXF1aXJlKCcuLyQuaXRlci1zdGVwJykKICAsIEl0ZXJhdG9ycyAgICAgICAgPSByZXF1aXJlKCcuLyQuaXRlcmF0b3JzJykKICAsIHRvSU9iamVjdCAgICAgICAgPSByZXF1aXJlKCcuLyQudG8taW9iamVjdCcpOwoKLy8gMjIuMS4zLjQgQXJyYXkucHJvdG90eXBlLmVudHJpZXMoKQovLyAyMi4xLjMuMTMgQXJyYXkucHJvdG90eXBlLmtleXMoKQovLyAyMi4xLjMuMjkgQXJyYXkucHJvdG90eXBlLnZhbHVlcygpCi8vIDIyLjEuMy4zMCBBcnJheS5wcm90b3R5cGVbQEBpdGVyYXRvcl0oKQptb2R1bGUuZXhwb3J0cyA9IHJlcXVpcmUoJy4vJC5pdGVyLWRlZmluZScpKEFycmF5LCAnQXJyYXknLCBmdW5jdGlvbihpdGVyYXRlZCwga2luZCl7CiAgdGhpcy5fdCA9IHRvSU9iamVjdChpdGVyYXRlZCk7IC8vIHRhcmdldAogIHRoaXMuX2kgPSAwOyAgICAgICAgICAgICAgICAgICAvLyBuZXh0IGluZGV4CiAgdGhpcy5fayA9IGtpbmQ7ICAgICAgICAgICAgICAgIC8vIGtpbmQKLy8gMjIuMS41LjIuMSAlQXJyYXlJdGVyYXRvclByb3RvdHlwZSUubmV4dCgpCn0sIGZ1bmN0aW9uKCl7CiAgdmFyIE8gICAgID0gdGhpcy5fdAogICAgLCBraW5kICA9IHRoaXMuX2sKICAgICwgaW5kZXggPSB0aGlzLl9pKys7CiAgaWYoIU8gfHwgaW5kZXggPj0gTy5sZW5ndGgpewogICAgdGhpcy5fdCA9IHVuZGVmaW5lZDsKICAgIHJldHVybiBzdGVwKDEpOwogIH0KICBpZihraW5kID09ICdrZXlzJyAgKXJldHVybiBzdGVwKDAsIGluZGV4KTsKICBpZihraW5kID09ICd2YWx1ZXMnKXJldHVybiBzdGVwKDAsIE9baW5kZXhdKTsKICByZXR1cm4gc3RlcCgwLCBbaW5kZXgsIE9baW5kZXhdXSk7Cn0sICd2YWx1ZXMnKTsKCi8vIGFyZ3VtZW50c0xpc3RbQEBpdGVyYXRvcl0gaXMgJUFycmF5UHJvdG9fdmFsdWVzJSAoOS40LjQuNiwgOS40LjQuNykKSXRlcmF0b3JzLkFyZ3VtZW50cyA9IEl0ZXJhdG9ycy5BcnJheTsKCmFkZFRvVW5zY29wYWJsZXMoJ2tleXMnKTsKYWRkVG9VbnNjb3BhYmxlcygndmFsdWVzJyk7CmFkZFRvVW5zY29wYWJsZXMoJ2VudHJpZXMnKTsKfSx7Ii4vJC5hZGQtdG8tdW5zY29wYWJsZXMiOjM1LCIuLyQuaXRlci1kZWZpbmUiOjYzLCIuLyQuaXRlci1zdGVwIjo2NSwiLi8kLml0ZXJhdG9ycyI6NjYsIi4vJC50by1pb2JqZWN0Ijo4Nn1dLDkzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwp2YXIgc3Ryb25nID0gcmVxdWlyZSgnLi8kLmNvbGxlY3Rpb24tc3Ryb25nJyk7CgovLyAyMy4xIE1hcCBPYmplY3RzCnJlcXVpcmUoJy4vJC5jb2xsZWN0aW9uJykoJ01hcCcsIGZ1bmN0aW9uKGdldCl7CiAgcmV0dXJuIGZ1bmN0aW9uIE1hcCgpeyByZXR1cm4gZ2V0KHRoaXMsIGFyZ3VtZW50cy5sZW5ndGggPiAwID8gYXJndW1lbnRzWzBdIDogdW5kZWZpbmVkKTsgfTsKfSwgewogIC8vIDIzLjEuMy42IE1hcC5wcm90b3R5cGUuZ2V0KGtleSkKICBnZXQ6IGZ1bmN0aW9uIGdldChrZXkpewogICAgdmFyIGVudHJ5ID0gc3Ryb25nLmdldEVudHJ5KHRoaXMsIGtleSk7CiAgICByZXR1cm4gZW50cnkgJiYgZW50cnkudjsKICB9LAogIC8vIDIzLjEuMy45IE1hcC5wcm90b3R5cGUuc2V0KGtleSwgdmFsdWUpCiAgc2V0OiBmdW5jdGlvbiBzZXQoa2V5LCB2YWx1ZSl7CiAgICByZXR1cm4gc3Ryb25nLmRlZih0aGlzLCBrZXkgPT09IDAgPyAwIDoga2V5LCB2YWx1ZSk7CiAgfQp9LCBzdHJvbmcsIHRydWUpOwp9LHsiLi8kLmNvbGxlY3Rpb24iOjQxLCIuLyQuY29sbGVjdGlvbi1zdHJvbmciOjM5fV0sOTQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyAxOS4xLjMuMSBPYmplY3QuYXNzaWduKHRhcmdldCwgc291cmNlKQp2YXIgJGV4cG9ydCA9IHJlcXVpcmUoJy4vJC5leHBvcnQnKTsKCiRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GLCAnT2JqZWN0Jywge2Fzc2lnbjogcmVxdWlyZSgnLi8kLm9iamVjdC1hc3NpZ24nKX0pOwp9LHsiLi8kLmV4cG9ydCI6NDgsIi4vJC5vYmplY3QtYXNzaWduIjo3MX1dLDk1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gMTkuMS4yLjYgT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcihPLCBQKQp2YXIgdG9JT2JqZWN0ID0gcmVxdWlyZSgnLi8kLnRvLWlvYmplY3QnKTsKCnJlcXVpcmUoJy4vJC5vYmplY3Qtc2FwJykoJ2dldE93blByb3BlcnR5RGVzY3JpcHRvcicsIGZ1bmN0aW9uKCRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IpewogIHJldHVybiBmdW5jdGlvbiBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoaXQsIGtleSl7CiAgICByZXR1cm4gJGdldE93blByb3BlcnR5RGVzY3JpcHRvcih0b0lPYmplY3QoaXQpLCBrZXkpOwogIH07Cn0pOwp9LHsiLi8kLm9iamVjdC1zYXAiOjcyLCIuLyQudG8taW9iamVjdCI6ODZ9XSw5NjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIDE5LjEuMi45IE9iamVjdC5nZXRQcm90b3R5cGVPZihPKQp2YXIgdG9PYmplY3QgPSByZXF1aXJlKCcuLyQudG8tb2JqZWN0Jyk7CgpyZXF1aXJlKCcuLyQub2JqZWN0LXNhcCcpKCdnZXRQcm90b3R5cGVPZicsIGZ1bmN0aW9uKCRnZXRQcm90b3R5cGVPZil7CiAgcmV0dXJuIGZ1bmN0aW9uIGdldFByb3RvdHlwZU9mKGl0KXsKICAgIHJldHVybiAkZ2V0UHJvdG90eXBlT2YodG9PYmplY3QoaXQpKTsKICB9Owp9KTsKfSx7Ii4vJC5vYmplY3Qtc2FwIjo3MiwiLi8kLnRvLW9iamVjdCI6ODh9XSw5NzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8vIDE5LjEuMi4xNCBPYmplY3Qua2V5cyhPKQp2YXIgdG9PYmplY3QgPSByZXF1aXJlKCcuLyQudG8tb2JqZWN0Jyk7CgpyZXF1aXJlKCcuLyQub2JqZWN0LXNhcCcpKCdrZXlzJywgZnVuY3Rpb24oJGtleXMpewogIHJldHVybiBmdW5jdGlvbiBrZXlzKGl0KXsKICAgIHJldHVybiAka2V5cyh0b09iamVjdChpdCkpOwogIH07Cn0pOwp9LHsiLi8kLm9iamVjdC1zYXAiOjcyLCIuLyQudG8tb2JqZWN0Ijo4OH1dLDk4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gMTkuMS4zLjE5IE9iamVjdC5zZXRQcm90b3R5cGVPZihPLCBwcm90bykKdmFyICRleHBvcnQgPSByZXF1aXJlKCcuLyQuZXhwb3J0Jyk7CiRleHBvcnQoJGV4cG9ydC5TLCAnT2JqZWN0Jywge3NldFByb3RvdHlwZU9mOiByZXF1aXJlKCcuLyQuc2V0LXByb3RvJykuc2V0fSk7Cn0seyIuLyQuZXhwb3J0Ijo0OCwiLi8kLnNldC1wcm90byI6Nzd9XSw5OTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cgp9LHt9XSwxMDA6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7CnZhciAkICAgICAgICAgID0gcmVxdWlyZSgnLi8kJykKICAsIExJQlJBUlkgICAgPSByZXF1aXJlKCcuLyQubGlicmFyeScpCiAgLCBnbG9iYWwgICAgID0gcmVxdWlyZSgnLi8kLmdsb2JhbCcpCiAgLCBjdHggICAgICAgID0gcmVxdWlyZSgnLi8kLmN0eCcpCiAgLCBjbGFzc29mICAgID0gcmVxdWlyZSgnLi8kLmNsYXNzb2YnKQogICwgJGV4cG9ydCAgICA9IHJlcXVpcmUoJy4vJC5leHBvcnQnKQogICwgaXNPYmplY3QgICA9IHJlcXVpcmUoJy4vJC5pcy1vYmplY3QnKQogICwgYW5PYmplY3QgICA9IHJlcXVpcmUoJy4vJC5hbi1vYmplY3QnKQogICwgYUZ1bmN0aW9uICA9IHJlcXVpcmUoJy4vJC5hLWZ1bmN0aW9uJykKICAsIHN0cmljdE5ldyAgPSByZXF1aXJlKCcuLyQuc3RyaWN0LW5ldycpCiAgLCBmb3JPZiAgICAgID0gcmVxdWlyZSgnLi8kLmZvci1vZicpCiAgLCBzZXRQcm90byAgID0gcmVxdWlyZSgnLi8kLnNldC1wcm90bycpLnNldAogICwgc2FtZSAgICAgICA9IHJlcXVpcmUoJy4vJC5zYW1lLXZhbHVlJykKICAsIFNQRUNJRVMgICAgPSByZXF1aXJlKCcuLyQud2tzJykoJ3NwZWNpZXMnKQogICwgc3BlY2llc0NvbnN0cnVjdG9yID0gcmVxdWlyZSgnLi8kLnNwZWNpZXMtY29uc3RydWN0b3InKQogICwgYXNhcCAgICAgICA9IHJlcXVpcmUoJy4vJC5taWNyb3Rhc2snKQogICwgUFJPTUlTRSAgICA9ICdQcm9taXNlJwogICwgcHJvY2VzcyAgICA9IGdsb2JhbC5wcm9jZXNzCiAgLCBpc05vZGUgICAgID0gY2xhc3NvZihwcm9jZXNzKSA9PSAncHJvY2VzcycKICAsIFAgICAgICAgICAgPSBnbG9iYWxbUFJPTUlTRV0KICAsIFdyYXBwZXI7Cgp2YXIgdGVzdFJlc29sdmUgPSBmdW5jdGlvbihzdWIpewogIHZhciB0ZXN0ID0gbmV3IFAoZnVuY3Rpb24oKXt9KTsKICBpZihzdWIpdGVzdC5jb25zdHJ1Y3RvciA9IE9iamVjdDsKICByZXR1cm4gUC5yZXNvbHZlKHRlc3QpID09PSB0ZXN0Owp9OwoKdmFyIFVTRV9OQVRJVkUgPSBmdW5jdGlvbigpewogIHZhciB3b3JrcyA9IGZhbHNlOwogIGZ1bmN0aW9uIFAyKHgpewogICAgdmFyIHNlbGYgPSBuZXcgUCh4KTsKICAgIHNldFByb3RvKHNlbGYsIFAyLnByb3RvdHlwZSk7CiAgICByZXR1cm4gc2VsZjsKICB9CiAgdHJ5IHsKICAgIHdvcmtzID0gUCAmJiBQLnJlc29sdmUgJiYgdGVzdFJlc29sdmUoKTsKICAgIHNldFByb3RvKFAyLCBQKTsKICAgIFAyLnByb3RvdHlwZSA9ICQuY3JlYXRlKFAucHJvdG90eXBlLCB7Y29uc3RydWN0b3I6IHt2YWx1ZTogUDJ9fSk7CiAgICAvLyBhY3R1YWwgRmlyZWZveCBoYXMgYnJva2VuIHN1YmNsYXNzIHN1cHBvcnQsIHRlc3QgdGhhdAogICAgaWYoIShQMi5yZXNvbHZlKDUpLnRoZW4oZnVuY3Rpb24oKXt9KSBpbnN0YW5jZW9mIFAyKSl7CiAgICAgIHdvcmtzID0gZmFsc2U7CiAgICB9CiAgICAvLyBhY3R1YWwgVjggYnVnLCBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9NDE2MgogICAgaWYod29ya3MgJiYgcmVxdWlyZSgnLi8kLmRlc2NyaXB0b3JzJykpewogICAgICB2YXIgdGhlbmFibGVUaGVuR290dGVuID0gZmFsc2U7CiAgICAgIFAucmVzb2x2ZSgkLnNldERlc2Moe30sICd0aGVuJywgewogICAgICAgIGdldDogZnVuY3Rpb24oKXsgdGhlbmFibGVUaGVuR290dGVuID0gdHJ1ZTsgfQogICAgICB9KSk7CiAgICAgIHdvcmtzID0gdGhlbmFibGVUaGVuR290dGVuOwogICAgfQogIH0gY2F0Y2goZSl7IHdvcmtzID0gZmFsc2U7IH0KICByZXR1cm4gd29ya3M7Cn0oKTsKCi8vIGhlbHBlcnMKdmFyIHNhbWVDb25zdHJ1Y3RvciA9IGZ1bmN0aW9uKGEsIGIpewogIC8vIGxpYnJhcnkgd3JhcHBlciBzcGVjaWFsIGNhc2UKICBpZihMSUJSQVJZICYmIGEgPT09IFAgJiYgYiA9PT0gV3JhcHBlcilyZXR1cm4gdHJ1ZTsKICByZXR1cm4gc2FtZShhLCBiKTsKfTsKdmFyIGdldENvbnN0cnVjdG9yID0gZnVuY3Rpb24oQyl7CiAgdmFyIFMgPSBhbk9iamVjdChDKVtTUEVDSUVTXTsKICByZXR1cm4gUyAhPSB1bmRlZmluZWQgPyBTIDogQzsKfTsKdmFyIGlzVGhlbmFibGUgPSBmdW5jdGlvbihpdCl7CiAgdmFyIHRoZW47CiAgcmV0dXJuIGlzT2JqZWN0KGl0KSAmJiB0eXBlb2YgKHRoZW4gPSBpdC50aGVuKSA9PSAnZnVuY3Rpb24nID8gdGhlbiA6IGZhbHNlOwp9Owp2YXIgUHJvbWlzZUNhcGFiaWxpdHkgPSBmdW5jdGlvbihDKXsKICB2YXIgcmVzb2x2ZSwgcmVqZWN0OwogIHRoaXMucHJvbWlzZSA9IG5ldyBDKGZ1bmN0aW9uKCQkcmVzb2x2ZSwgJCRyZWplY3QpewogICAgaWYocmVzb2x2ZSAhPT0gdW5kZWZpbmVkIHx8IHJlamVjdCAhPT0gdW5kZWZpbmVkKXRocm93IFR5cGVFcnJvcignQmFkIFByb21pc2UgY29uc3RydWN0b3InKTsKICAgIHJlc29sdmUgPSAkJHJlc29sdmU7CiAgICByZWplY3QgID0gJCRyZWplY3Q7CiAgfSk7CiAgdGhpcy5yZXNvbHZlID0gYUZ1bmN0aW9uKHJlc29sdmUpLAogIHRoaXMucmVqZWN0ICA9IGFGdW5jdGlvbihyZWplY3QpCn07CnZhciBwZXJmb3JtID0gZnVuY3Rpb24oZXhlYyl7CiAgdHJ5IHsKICAgIGV4ZWMoKTsKICB9IGNhdGNoKGUpewogICAgcmV0dXJuIHtlcnJvcjogZX07CiAgfQp9Owp2YXIgbm90aWZ5ID0gZnVuY3Rpb24ocmVjb3JkLCBpc1JlamVjdCl7CiAgaWYocmVjb3JkLm4pcmV0dXJuOwogIHJlY29yZC5uID0gdHJ1ZTsKICB2YXIgY2hhaW4gPSByZWNvcmQuYzsKICBhc2FwKGZ1bmN0aW9uKCl7CiAgICB2YXIgdmFsdWUgPSByZWNvcmQudgogICAgICAsIG9rICAgID0gcmVjb3JkLnMgPT0gMQogICAgICAsIGkgICAgID0gMDsKICAgIHZhciBydW4gPSBmdW5jdGlvbihyZWFjdGlvbil7CiAgICAgIHZhciBoYW5kbGVyID0gb2sgPyByZWFjdGlvbi5vayA6IHJlYWN0aW9uLmZhaWwKICAgICAgICAsIHJlc29sdmUgPSByZWFjdGlvbi5yZXNvbHZlCiAgICAgICAgLCByZWplY3QgID0gcmVhY3Rpb24ucmVqZWN0CiAgICAgICAgLCByZXN1bHQsIHRoZW47CiAgICAgIHRyeSB7CiAgICAgICAgaWYoaGFuZGxlcil7CiAgICAgICAgICBpZighb2spcmVjb3JkLmggPSB0cnVlOwogICAgICAgICAgcmVzdWx0ID0gaGFuZGxlciA9PT0gdHJ1ZSA/IHZhbHVlIDogaGFuZGxlcih2YWx1ZSk7CiAgICAgICAgICBpZihyZXN1bHQgPT09IHJlYWN0aW9uLnByb21pc2UpewogICAgICAgICAgICByZWplY3QoVHlwZUVycm9yKCdQcm9taXNlLWNoYWluIGN5Y2xlJykpOwogICAgICAgICAgfSBlbHNlIGlmKHRoZW4gPSBpc1RoZW5hYmxlKHJlc3VsdCkpewogICAgICAgICAgICB0aGVuLmNhbGwocmVzdWx0LCByZXNvbHZlLCByZWplY3QpOwogICAgICAgICAgfSBlbHNlIHJlc29sdmUocmVzdWx0KTsKICAgICAgICB9IGVsc2UgcmVqZWN0KHZhbHVlKTsKICAgICAgfSBjYXRjaChlKXsKICAgICAgICByZWplY3QoZSk7CiAgICAgIH0KICAgIH07CiAgICB3aGlsZShjaGFpbi5sZW5ndGggPiBpKXJ1bihjaGFpbltpKytdKTsgLy8gdmFyaWFibGUgbGVuZ3RoIC0gY2FuJ3QgdXNlIGZvckVhY2gKICAgIGNoYWluLmxlbmd0aCA9IDA7CiAgICByZWNvcmQubiA9IGZhbHNlOwogICAgaWYoaXNSZWplY3Qpc2V0VGltZW91dChmdW5jdGlvbigpewogICAgICB2YXIgcHJvbWlzZSA9IHJlY29yZC5wCiAgICAgICAgLCBoYW5kbGVyLCBjb25zb2xlOwogICAgICBpZihpc1VuaGFuZGxlZChwcm9taXNlKSl7CiAgICAgICAgaWYoaXNOb2RlKXsKICAgICAgICAgIHByb2Nlc3MuZW1pdCgndW5oYW5kbGVkUmVqZWN0aW9uJywgdmFsdWUsIHByb21pc2UpOwogICAgICAgIH0gZWxzZSBpZihoYW5kbGVyID0gZ2xvYmFsLm9udW5oYW5kbGVkcmVqZWN0aW9uKXsKICAgICAgICAgIGhhbmRsZXIoe3Byb21pc2U6IHByb21pc2UsIHJlYXNvbjogdmFsdWV9KTsKICAgICAgICB9IGVsc2UgaWYoKGNvbnNvbGUgPSBnbG9iYWwuY29uc29sZSkgJiYgY29uc29sZS5lcnJvcil7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCdVbmhhbmRsZWQgcHJvbWlzZSByZWplY3Rpb24nLCB2YWx1ZSk7CiAgICAgICAgfQogICAgICB9IHJlY29yZC5hID0gdW5kZWZpbmVkOwogICAgfSwgMSk7CiAgfSk7Cn07CnZhciBpc1VuaGFuZGxlZCA9IGZ1bmN0aW9uKHByb21pc2UpewogIHZhciByZWNvcmQgPSBwcm9taXNlLl9kCiAgICAsIGNoYWluICA9IHJlY29yZC5hIHx8IHJlY29yZC5jCiAgICAsIGkgICAgICA9IDAKICAgICwgcmVhY3Rpb247CiAgaWYocmVjb3JkLmgpcmV0dXJuIGZhbHNlOwogIHdoaWxlKGNoYWluLmxlbmd0aCA+IGkpewogICAgcmVhY3Rpb24gPSBjaGFpbltpKytdOwogICAgaWYocmVhY3Rpb24uZmFpbCB8fCAhaXNVbmhhbmRsZWQocmVhY3Rpb24ucHJvbWlzZSkpcmV0dXJuIGZhbHNlOwogIH0gcmV0dXJuIHRydWU7Cn07CnZhciAkcmVqZWN0ID0gZnVuY3Rpb24odmFsdWUpewogIHZhciByZWNvcmQgPSB0aGlzOwogIGlmKHJlY29yZC5kKXJldHVybjsKICByZWNvcmQuZCA9IHRydWU7CiAgcmVjb3JkID0gcmVjb3JkLnIgfHwgcmVjb3JkOyAvLyB1bndyYXAKICByZWNvcmQudiA9IHZhbHVlOwogIHJlY29yZC5zID0gMjsKICByZWNvcmQuYSA9IHJlY29yZC5jLnNsaWNlKCk7CiAgbm90aWZ5KHJlY29yZCwgdHJ1ZSk7Cn07CnZhciAkcmVzb2x2ZSA9IGZ1bmN0aW9uKHZhbHVlKXsKICB2YXIgcmVjb3JkID0gdGhpcwogICAgLCB0aGVuOwogIGlmKHJlY29yZC5kKXJldHVybjsKICByZWNvcmQuZCA9IHRydWU7CiAgcmVjb3JkID0gcmVjb3JkLnIgfHwgcmVjb3JkOyAvLyB1bndyYXAKICB0cnkgewogICAgaWYocmVjb3JkLnAgPT09IHZhbHVlKXRocm93IFR5cGVFcnJvcigiUHJvbWlzZSBjYW4ndCBiZSByZXNvbHZlZCBpdHNlbGYiKTsKICAgIGlmKHRoZW4gPSBpc1RoZW5hYmxlKHZhbHVlKSl7CiAgICAgIGFzYXAoZnVuY3Rpb24oKXsKICAgICAgICB2YXIgd3JhcHBlciA9IHtyOiByZWNvcmQsIGQ6IGZhbHNlfTsgLy8gd3JhcAogICAgICAgIHRyeSB7CiAgICAgICAgICB0aGVuLmNhbGwodmFsdWUsIGN0eCgkcmVzb2x2ZSwgd3JhcHBlciwgMSksIGN0eCgkcmVqZWN0LCB3cmFwcGVyLCAxKSk7CiAgICAgICAgfSBjYXRjaChlKXsKICAgICAgICAgICRyZWplY3QuY2FsbCh3cmFwcGVyLCBlKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgcmVjb3JkLnYgPSB2YWx1ZTsKICAgICAgcmVjb3JkLnMgPSAxOwogICAgICBub3RpZnkocmVjb3JkLCBmYWxzZSk7CiAgICB9CiAgfSBjYXRjaChlKXsKICAgICRyZWplY3QuY2FsbCh7cjogcmVjb3JkLCBkOiBmYWxzZX0sIGUpOyAvLyB3cmFwCiAgfQp9OwoKLy8gY29uc3RydWN0b3IgcG9seWZpbGwKaWYoIVVTRV9OQVRJVkUpewogIC8vIDI1LjQuMy4xIFByb21pc2UoZXhlY3V0b3IpCiAgUCA9IGZ1bmN0aW9uIFByb21pc2UoZXhlY3V0b3IpewogICAgYUZ1bmN0aW9uKGV4ZWN1dG9yKTsKICAgIHZhciByZWNvcmQgPSB0aGlzLl9kID0gewogICAgICBwOiBzdHJpY3ROZXcodGhpcywgUCwgUFJPTUlTRSksICAgICAgICAgLy8gPC0gcHJvbWlzZQogICAgICBjOiBbXSwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gPC0gYXdhaXRpbmcgcmVhY3Rpb25zCiAgICAgIGE6IHVuZGVmaW5lZCwgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyA8LSBjaGVja2VkIGluIGlzVW5oYW5kbGVkIHJlYWN0aW9ucwogICAgICBzOiAwLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gPC0gc3RhdGUKICAgICAgZDogZmFsc2UsICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDwtIGRvbmUKICAgICAgdjogdW5kZWZpbmVkLCAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIDwtIHZhbHVlCiAgICAgIGg6IGZhbHNlLCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyA8LSBoYW5kbGVkIHJlamVjdGlvbgogICAgICBuOiBmYWxzZSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gPC0gbm90aWZ5CiAgICB9OwogICAgdHJ5IHsKICAgICAgZXhlY3V0b3IoY3R4KCRyZXNvbHZlLCByZWNvcmQsIDEpLCBjdHgoJHJlamVjdCwgcmVjb3JkLCAxKSk7CiAgICB9IGNhdGNoKGVycil7CiAgICAgICRyZWplY3QuY2FsbChyZWNvcmQsIGVycik7CiAgICB9CiAgfTsKICByZXF1aXJlKCcuLyQucmVkZWZpbmUtYWxsJykoUC5wcm90b3R5cGUsIHsKICAgIC8vIDI1LjQuNS4zIFByb21pc2UucHJvdG90eXBlLnRoZW4ob25GdWxmaWxsZWQsIG9uUmVqZWN0ZWQpCiAgICB0aGVuOiBmdW5jdGlvbiB0aGVuKG9uRnVsZmlsbGVkLCBvblJlamVjdGVkKXsKICAgICAgdmFyIHJlYWN0aW9uID0gbmV3IFByb21pc2VDYXBhYmlsaXR5KHNwZWNpZXNDb25zdHJ1Y3Rvcih0aGlzLCBQKSkKICAgICAgICAsIHByb21pc2UgID0gcmVhY3Rpb24ucHJvbWlzZQogICAgICAgICwgcmVjb3JkICAgPSB0aGlzLl9kOwogICAgICByZWFjdGlvbi5vayAgID0gdHlwZW9mIG9uRnVsZmlsbGVkID09ICdmdW5jdGlvbicgPyBvbkZ1bGZpbGxlZCA6IHRydWU7CiAgICAgIHJlYWN0aW9uLmZhaWwgPSB0eXBlb2Ygb25SZWplY3RlZCA9PSAnZnVuY3Rpb24nICYmIG9uUmVqZWN0ZWQ7CiAgICAgIHJlY29yZC5jLnB1c2gocmVhY3Rpb24pOwogICAgICBpZihyZWNvcmQuYSlyZWNvcmQuYS5wdXNoKHJlYWN0aW9uKTsKICAgICAgaWYocmVjb3JkLnMpbm90aWZ5KHJlY29yZCwgZmFsc2UpOwogICAgICByZXR1cm4gcHJvbWlzZTsKICAgIH0sCiAgICAvLyAyNS40LjUuMSBQcm9taXNlLnByb3RvdHlwZS5jYXRjaChvblJlamVjdGVkKQogICAgJ2NhdGNoJzogZnVuY3Rpb24ob25SZWplY3RlZCl7CiAgICAgIHJldHVybiB0aGlzLnRoZW4odW5kZWZpbmVkLCBvblJlamVjdGVkKTsKICAgIH0KICB9KTsKfQoKJGV4cG9ydCgkZXhwb3J0LkcgKyAkZXhwb3J0LlcgKyAkZXhwb3J0LkYgKiAhVVNFX05BVElWRSwge1Byb21pc2U6IFB9KTsKcmVxdWlyZSgnLi8kLnNldC10by1zdHJpbmctdGFnJykoUCwgUFJPTUlTRSk7CnJlcXVpcmUoJy4vJC5zZXQtc3BlY2llcycpKFBST01JU0UpOwpXcmFwcGVyID0gcmVxdWlyZSgnLi8kLmNvcmUnKVtQUk9NSVNFXTsKCi8vIHN0YXRpY3MKJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhVVNFX05BVElWRSwgUFJPTUlTRSwgewogIC8vIDI1LjQuNC41IFByb21pc2UucmVqZWN0KHIpCiAgcmVqZWN0OiBmdW5jdGlvbiByZWplY3Qocil7CiAgICB2YXIgY2FwYWJpbGl0eSA9IG5ldyBQcm9taXNlQ2FwYWJpbGl0eSh0aGlzKQogICAgICAsICQkcmVqZWN0ICAgPSBjYXBhYmlsaXR5LnJlamVjdDsKICAgICQkcmVqZWN0KHIpOwogICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICB9Cn0pOwokZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICghVVNFX05BVElWRSB8fCB0ZXN0UmVzb2x2ZSh0cnVlKSksIFBST01JU0UsIHsKICAvLyAyNS40LjQuNiBQcm9taXNlLnJlc29sdmUoeCkKICByZXNvbHZlOiBmdW5jdGlvbiByZXNvbHZlKHgpewogICAgLy8gaW5zdGFuY2VvZiBpbnN0ZWFkIG9mIGludGVybmFsIHNsb3QgY2hlY2sgYmVjYXVzZSB3ZSBzaG91bGQgZml4IGl0IHdpdGhvdXQgcmVwbGFjZW1lbnQgbmF0aXZlIFByb21pc2UgY29yZQogICAgaWYoeCBpbnN0YW5jZW9mIFAgJiYgc2FtZUNvbnN0cnVjdG9yKHguY29uc3RydWN0b3IsIHRoaXMpKXJldHVybiB4OwogICAgdmFyIGNhcGFiaWxpdHkgPSBuZXcgUHJvbWlzZUNhcGFiaWxpdHkodGhpcykKICAgICAgLCAkJHJlc29sdmUgID0gY2FwYWJpbGl0eS5yZXNvbHZlOwogICAgJCRyZXNvbHZlKHgpOwogICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICB9Cn0pOwokZXhwb3J0KCRleHBvcnQuUyArICRleHBvcnQuRiAqICEoVVNFX05BVElWRSAmJiByZXF1aXJlKCcuLyQuaXRlci1kZXRlY3QnKShmdW5jdGlvbihpdGVyKXsKICBQLmFsbChpdGVyKVsnY2F0Y2gnXShmdW5jdGlvbigpe30pOwp9KSksIFBST01JU0UsIHsKICAvLyAyNS40LjQuMSBQcm9taXNlLmFsbChpdGVyYWJsZSkKICBhbGw6IGZ1bmN0aW9uIGFsbChpdGVyYWJsZSl7CiAgICB2YXIgQyAgICAgICAgICA9IGdldENvbnN0cnVjdG9yKHRoaXMpCiAgICAgICwgY2FwYWJpbGl0eSA9IG5ldyBQcm9taXNlQ2FwYWJpbGl0eShDKQogICAgICAsIHJlc29sdmUgICAgPSBjYXBhYmlsaXR5LnJlc29sdmUKICAgICAgLCByZWplY3QgICAgID0gY2FwYWJpbGl0eS5yZWplY3QKICAgICAgLCB2YWx1ZXMgICAgID0gW107CiAgICB2YXIgYWJydXB0ID0gcGVyZm9ybShmdW5jdGlvbigpewogICAgICBmb3JPZihpdGVyYWJsZSwgZmFsc2UsIHZhbHVlcy5wdXNoLCB2YWx1ZXMpOwogICAgICB2YXIgcmVtYWluaW5nID0gdmFsdWVzLmxlbmd0aAogICAgICAgICwgcmVzdWx0cyAgID0gQXJyYXkocmVtYWluaW5nKTsKICAgICAgaWYocmVtYWluaW5nKSQuZWFjaC5jYWxsKHZhbHVlcywgZnVuY3Rpb24ocHJvbWlzZSwgaW5kZXgpewogICAgICAgIHZhciBhbHJlYWR5Q2FsbGVkID0gZmFsc2U7CiAgICAgICAgQy5yZXNvbHZlKHByb21pc2UpLnRoZW4oZnVuY3Rpb24odmFsdWUpewogICAgICAgICAgaWYoYWxyZWFkeUNhbGxlZClyZXR1cm47CiAgICAgICAgICBhbHJlYWR5Q2FsbGVkID0gdHJ1ZTsKICAgICAgICAgIHJlc3VsdHNbaW5kZXhdID0gdmFsdWU7CiAgICAgICAgICAtLXJlbWFpbmluZyB8fCByZXNvbHZlKHJlc3VsdHMpOwogICAgICAgIH0sIHJlamVjdCk7CiAgICAgIH0pOwogICAgICBlbHNlIHJlc29sdmUocmVzdWx0cyk7CiAgICB9KTsKICAgIGlmKGFicnVwdClyZWplY3QoYWJydXB0LmVycm9yKTsKICAgIHJldHVybiBjYXBhYmlsaXR5LnByb21pc2U7CiAgfSwKICAvLyAyNS40LjQuNCBQcm9taXNlLnJhY2UoaXRlcmFibGUpCiAgcmFjZTogZnVuY3Rpb24gcmFjZShpdGVyYWJsZSl7CiAgICB2YXIgQyAgICAgICAgICA9IGdldENvbnN0cnVjdG9yKHRoaXMpCiAgICAgICwgY2FwYWJpbGl0eSA9IG5ldyBQcm9taXNlQ2FwYWJpbGl0eShDKQogICAgICAsIHJlamVjdCAgICAgPSBjYXBhYmlsaXR5LnJlamVjdDsKICAgIHZhciBhYnJ1cHQgPSBwZXJmb3JtKGZ1bmN0aW9uKCl7CiAgICAgIGZvck9mKGl0ZXJhYmxlLCBmYWxzZSwgZnVuY3Rpb24ocHJvbWlzZSl7CiAgICAgICAgQy5yZXNvbHZlKHByb21pc2UpLnRoZW4oY2FwYWJpbGl0eS5yZXNvbHZlLCByZWplY3QpOwogICAgICB9KTsKICAgIH0pOwogICAgaWYoYWJydXB0KXJlamVjdChhYnJ1cHQuZXJyb3IpOwogICAgcmV0dXJuIGNhcGFiaWxpdHkucHJvbWlzZTsKICB9Cn0pOwp9LHsiLi8kIjo2NywiLi8kLmEtZnVuY3Rpb24iOjM0LCIuLyQuYW4tb2JqZWN0IjozNiwiLi8kLmNsYXNzb2YiOjM3LCIuLyQuY29yZSI6NDIsIi4vJC5jdHgiOjQzLCIuLyQuZGVzY3JpcHRvcnMiOjQ1LCIuLyQuZXhwb3J0Ijo0OCwiLi8kLmZvci1vZiI6NTAsIi4vJC5nbG9iYWwiOjUyLCIuLyQuaXMtb2JqZWN0Ijo2MCwiLi8kLml0ZXItZGV0ZWN0Ijo2NCwiLi8kLmxpYnJhcnkiOjY5LCIuLyQubWljcm90YXNrIjo3MCwiLi8kLnJlZGVmaW5lLWFsbCI6NzQsIi4vJC5zYW1lLXZhbHVlIjo3NiwiLi8kLnNldC1wcm90byI6NzcsIi4vJC5zZXQtc3BlY2llcyI6NzgsIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyI6NzksIi4vJC5zcGVjaWVzLWNvbnN0cnVjdG9yIjo4MSwiLi8kLnN0cmljdC1uZXciOjgyLCIuLyQud2tzIjo5MH1dLDEwMTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKdmFyIHN0cm9uZyA9IHJlcXVpcmUoJy4vJC5jb2xsZWN0aW9uLXN0cm9uZycpOwoKLy8gMjMuMiBTZXQgT2JqZWN0cwpyZXF1aXJlKCcuLyQuY29sbGVjdGlvbicpKCdTZXQnLCBmdW5jdGlvbihnZXQpewogIHJldHVybiBmdW5jdGlvbiBTZXQoKXsgcmV0dXJuIGdldCh0aGlzLCBhcmd1bWVudHMubGVuZ3RoID4gMCA/IGFyZ3VtZW50c1swXSA6IHVuZGVmaW5lZCk7IH07Cn0sIHsKICAvLyAyMy4yLjMuMSBTZXQucHJvdG90eXBlLmFkZCh2YWx1ZSkKICBhZGQ6IGZ1bmN0aW9uIGFkZCh2YWx1ZSl7CiAgICByZXR1cm4gc3Ryb25nLmRlZih0aGlzLCB2YWx1ZSA9IHZhbHVlID09PSAwID8gMCA6IHZhbHVlLCB2YWx1ZSk7CiAgfQp9LCBzdHJvbmcpOwp9LHsiLi8kLmNvbGxlY3Rpb24iOjQxLCIuLyQuY29sbGVjdGlvbi1zdHJvbmciOjM5fV0sMTAyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwp2YXIgJGF0ICA9IHJlcXVpcmUoJy4vJC5zdHJpbmctYXQnKSh0cnVlKTsKCi8vIDIxLjEuMy4yNyBTdHJpbmcucHJvdG90eXBlW0BAaXRlcmF0b3JdKCkKcmVxdWlyZSgnLi8kLml0ZXItZGVmaW5lJykoU3RyaW5nLCAnU3RyaW5nJywgZnVuY3Rpb24oaXRlcmF0ZWQpewogIHRoaXMuX3QgPSBTdHJpbmcoaXRlcmF0ZWQpOyAvLyB0YXJnZXQKICB0aGlzLl9pID0gMDsgICAgICAgICAgICAgICAgLy8gbmV4dCBpbmRleAovLyAyMS4xLjUuMi4xICVTdHJpbmdJdGVyYXRvclByb3RvdHlwZSUubmV4dCgpCn0sIGZ1bmN0aW9uKCl7CiAgdmFyIE8gICAgID0gdGhpcy5fdAogICAgLCBpbmRleCA9IHRoaXMuX2kKICAgICwgcG9pbnQ7CiAgaWYoaW5kZXggPj0gTy5sZW5ndGgpcmV0dXJuIHt2YWx1ZTogdW5kZWZpbmVkLCBkb25lOiB0cnVlfTsKICBwb2ludCA9ICRhdChPLCBpbmRleCk7CiAgdGhpcy5faSArPSBwb2ludC5sZW5ndGg7CiAgcmV0dXJuIHt2YWx1ZTogcG9pbnQsIGRvbmU6IGZhbHNlfTsKfSk7Cn0seyIuLyQuaXRlci1kZWZpbmUiOjYzLCIuLyQuc3RyaW5nLWF0Ijo4M31dLDEwMzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKLy8gRUNNQVNjcmlwdCA2IHN5bWJvbHMgc2hpbQp2YXIgJCAgICAgICAgICAgICAgPSByZXF1aXJlKCcuLyQnKQogICwgZ2xvYmFsICAgICAgICAgPSByZXF1aXJlKCcuLyQuZ2xvYmFsJykKICAsIGhhcyAgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLmhhcycpCiAgLCBERVNDUklQVE9SUyAgICA9IHJlcXVpcmUoJy4vJC5kZXNjcmlwdG9ycycpCiAgLCAkZXhwb3J0ICAgICAgICA9IHJlcXVpcmUoJy4vJC5leHBvcnQnKQogICwgcmVkZWZpbmUgICAgICAgPSByZXF1aXJlKCcuLyQucmVkZWZpbmUnKQogICwgJGZhaWxzICAgICAgICAgPSByZXF1aXJlKCcuLyQuZmFpbHMnKQogICwgc2hhcmVkICAgICAgICAgPSByZXF1aXJlKCcuLyQuc2hhcmVkJykKICAsIHNldFRvU3RyaW5nVGFnID0gcmVxdWlyZSgnLi8kLnNldC10by1zdHJpbmctdGFnJykKICAsIHVpZCAgICAgICAgICAgID0gcmVxdWlyZSgnLi8kLnVpZCcpCiAgLCB3a3MgICAgICAgICAgICA9IHJlcXVpcmUoJy4vJC53a3MnKQogICwga2V5T2YgICAgICAgICAgPSByZXF1aXJlKCcuLyQua2V5b2YnKQogICwgJG5hbWVzICAgICAgICAgPSByZXF1aXJlKCcuLyQuZ2V0LW5hbWVzJykKICAsIGVudW1LZXlzICAgICAgID0gcmVxdWlyZSgnLi8kLmVudW0ta2V5cycpCiAgLCBpc0FycmF5ICAgICAgICA9IHJlcXVpcmUoJy4vJC5pcy1hcnJheScpCiAgLCBhbk9iamVjdCAgICAgICA9IHJlcXVpcmUoJy4vJC5hbi1vYmplY3QnKQogICwgdG9JT2JqZWN0ICAgICAgPSByZXF1aXJlKCcuLyQudG8taW9iamVjdCcpCiAgLCBjcmVhdGVEZXNjICAgICA9IHJlcXVpcmUoJy4vJC5wcm9wZXJ0eS1kZXNjJykKICAsIGdldERlc2MgICAgICAgID0gJC5nZXREZXNjCiAgLCBzZXREZXNjICAgICAgICA9ICQuc2V0RGVzYwogICwgX2NyZWF0ZSAgICAgICAgPSAkLmNyZWF0ZQogICwgZ2V0TmFtZXMgICAgICAgPSAkbmFtZXMuZ2V0CiAgLCAkU3ltYm9sICAgICAgICA9IGdsb2JhbC5TeW1ib2wKICAsICRKU09OICAgICAgICAgID0gZ2xvYmFsLkpTT04KICAsIF9zdHJpbmdpZnkgICAgID0gJEpTT04gJiYgJEpTT04uc3RyaW5naWZ5CiAgLCBzZXR0ZXIgICAgICAgICA9IGZhbHNlCiAgLCBISURERU4gICAgICAgICA9IHdrcygnX2hpZGRlbicpCiAgLCBpc0VudW0gICAgICAgICA9ICQuaXNFbnVtCiAgLCBTeW1ib2xSZWdpc3RyeSA9IHNoYXJlZCgnc3ltYm9sLXJlZ2lzdHJ5JykKICAsIEFsbFN5bWJvbHMgICAgID0gc2hhcmVkKCdzeW1ib2xzJykKICAsIHVzZU5hdGl2ZSAgICAgID0gdHlwZW9mICRTeW1ib2wgPT0gJ2Z1bmN0aW9uJwogICwgT2JqZWN0UHJvdG8gICAgPSBPYmplY3QucHJvdG90eXBlOwoKLy8gZmFsbGJhY2sgZm9yIG9sZCBBbmRyb2lkLCBodHRwczovL2NvZGUuZ29vZ2xlLmNvbS9wL3Y4L2lzc3Vlcy9kZXRhaWw/aWQ9Njg3CnZhciBzZXRTeW1ib2xEZXNjID0gREVTQ1JJUFRPUlMgJiYgJGZhaWxzKGZ1bmN0aW9uKCl7CiAgcmV0dXJuIF9jcmVhdGUoc2V0RGVzYyh7fSwgJ2EnLCB7CiAgICBnZXQ6IGZ1bmN0aW9uKCl7IHJldHVybiBzZXREZXNjKHRoaXMsICdhJywge3ZhbHVlOiA3fSkuYTsgfQogIH0pKS5hICE9IDc7Cn0pID8gZnVuY3Rpb24oaXQsIGtleSwgRCl7CiAgdmFyIHByb3RvRGVzYyA9IGdldERlc2MoT2JqZWN0UHJvdG8sIGtleSk7CiAgaWYocHJvdG9EZXNjKWRlbGV0ZSBPYmplY3RQcm90b1trZXldOwogIHNldERlc2MoaXQsIGtleSwgRCk7CiAgaWYocHJvdG9EZXNjICYmIGl0ICE9PSBPYmplY3RQcm90bylzZXREZXNjKE9iamVjdFByb3RvLCBrZXksIHByb3RvRGVzYyk7Cn0gOiBzZXREZXNjOwoKdmFyIHdyYXAgPSBmdW5jdGlvbih0YWcpewogIHZhciBzeW0gPSBBbGxTeW1ib2xzW3RhZ10gPSBfY3JlYXRlKCRTeW1ib2wucHJvdG90eXBlKTsKICBzeW0uX2sgPSB0YWc7CiAgREVTQ1JJUFRPUlMgJiYgc2V0dGVyICYmIHNldFN5bWJvbERlc2MoT2JqZWN0UHJvdG8sIHRhZywgewogICAgY29uZmlndXJhYmxlOiB0cnVlLAogICAgc2V0OiBmdW5jdGlvbih2YWx1ZSl7CiAgICAgIGlmKGhhcyh0aGlzLCBISURERU4pICYmIGhhcyh0aGlzW0hJRERFTl0sIHRhZykpdGhpc1tISURERU5dW3RhZ10gPSBmYWxzZTsKICAgICAgc2V0U3ltYm9sRGVzYyh0aGlzLCB0YWcsIGNyZWF0ZURlc2MoMSwgdmFsdWUpKTsKICAgIH0KICB9KTsKICByZXR1cm4gc3ltOwp9OwoKdmFyIGlzU3ltYm9sID0gZnVuY3Rpb24oaXQpewogIHJldHVybiB0eXBlb2YgaXQgPT0gJ3N5bWJvbCc7Cn07Cgp2YXIgJGRlZmluZVByb3BlcnR5ID0gZnVuY3Rpb24gZGVmaW5lUHJvcGVydHkoaXQsIGtleSwgRCl7CiAgaWYoRCAmJiBoYXMoQWxsU3ltYm9scywga2V5KSl7CiAgICBpZighRC5lbnVtZXJhYmxlKXsKICAgICAgaWYoIWhhcyhpdCwgSElEREVOKSlzZXREZXNjKGl0LCBISURERU4sIGNyZWF0ZURlc2MoMSwge30pKTsKICAgICAgaXRbSElEREVOXVtrZXldID0gdHJ1ZTsKICAgIH0gZWxzZSB7CiAgICAgIGlmKGhhcyhpdCwgSElEREVOKSAmJiBpdFtISURERU5dW2tleV0paXRbSElEREVOXVtrZXldID0gZmFsc2U7CiAgICAgIEQgPSBfY3JlYXRlKEQsIHtlbnVtZXJhYmxlOiBjcmVhdGVEZXNjKDAsIGZhbHNlKX0pOwogICAgfSByZXR1cm4gc2V0U3ltYm9sRGVzYyhpdCwga2V5LCBEKTsKICB9IHJldHVybiBzZXREZXNjKGl0LCBrZXksIEQpOwp9Owp2YXIgJGRlZmluZVByb3BlcnRpZXMgPSBmdW5jdGlvbiBkZWZpbmVQcm9wZXJ0aWVzKGl0LCBQKXsKICBhbk9iamVjdChpdCk7CiAgdmFyIGtleXMgPSBlbnVtS2V5cyhQID0gdG9JT2JqZWN0KFApKQogICAgLCBpICAgID0gMAogICAgLCBsID0ga2V5cy5sZW5ndGgKICAgICwga2V5OwogIHdoaWxlKGwgPiBpKSRkZWZpbmVQcm9wZXJ0eShpdCwga2V5ID0ga2V5c1tpKytdLCBQW2tleV0pOwogIHJldHVybiBpdDsKfTsKdmFyICRjcmVhdGUgPSBmdW5jdGlvbiBjcmVhdGUoaXQsIFApewogIHJldHVybiBQID09PSB1bmRlZmluZWQgPyBfY3JlYXRlKGl0KSA6ICRkZWZpbmVQcm9wZXJ0aWVzKF9jcmVhdGUoaXQpLCBQKTsKfTsKdmFyICRwcm9wZXJ0eUlzRW51bWVyYWJsZSA9IGZ1bmN0aW9uIHByb3BlcnR5SXNFbnVtZXJhYmxlKGtleSl7CiAgdmFyIEUgPSBpc0VudW0uY2FsbCh0aGlzLCBrZXkpOwogIHJldHVybiBFIHx8ICFoYXModGhpcywga2V5KSB8fCAhaGFzKEFsbFN5bWJvbHMsIGtleSkgfHwgaGFzKHRoaXMsIEhJRERFTikgJiYgdGhpc1tISURERU5dW2tleV0KICAgID8gRSA6IHRydWU7Cn07CnZhciAkZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKGl0LCBrZXkpewogIHZhciBEID0gZ2V0RGVzYyhpdCA9IHRvSU9iamVjdChpdCksIGtleSk7CiAgaWYoRCAmJiBoYXMoQWxsU3ltYm9scywga2V5KSAmJiAhKGhhcyhpdCwgSElEREVOKSAmJiBpdFtISURERU5dW2tleV0pKUQuZW51bWVyYWJsZSA9IHRydWU7CiAgcmV0dXJuIEQ7Cn07CnZhciAkZ2V0T3duUHJvcGVydHlOYW1lcyA9IGZ1bmN0aW9uIGdldE93blByb3BlcnR5TmFtZXMoaXQpewogIHZhciBuYW1lcyAgPSBnZXROYW1lcyh0b0lPYmplY3QoaXQpKQogICAgLCByZXN1bHQgPSBbXQogICAgLCBpICAgICAgPSAwCiAgICAsIGtleTsKICB3aGlsZShuYW1lcy5sZW5ndGggPiBpKWlmKCFoYXMoQWxsU3ltYm9scywga2V5ID0gbmFtZXNbaSsrXSkgJiYga2V5ICE9IEhJRERFTilyZXN1bHQucHVzaChrZXkpOwogIHJldHVybiByZXN1bHQ7Cn07CnZhciAkZ2V0T3duUHJvcGVydHlTeW1ib2xzID0gZnVuY3Rpb24gZ2V0T3duUHJvcGVydHlTeW1ib2xzKGl0KXsKICB2YXIgbmFtZXMgID0gZ2V0TmFtZXModG9JT2JqZWN0KGl0KSkKICAgICwgcmVzdWx0ID0gW10KICAgICwgaSAgICAgID0gMAogICAgLCBrZXk7CiAgd2hpbGUobmFtZXMubGVuZ3RoID4gaSlpZihoYXMoQWxsU3ltYm9scywga2V5ID0gbmFtZXNbaSsrXSkpcmVzdWx0LnB1c2goQWxsU3ltYm9sc1trZXldKTsKICByZXR1cm4gcmVzdWx0Owp9Owp2YXIgJHN0cmluZ2lmeSA9IGZ1bmN0aW9uIHN0cmluZ2lmeShpdCl7CiAgaWYoaXQgPT09IHVuZGVmaW5lZCB8fCBpc1N5bWJvbChpdCkpcmV0dXJuOyAvLyBJRTggcmV0dXJucyBzdHJpbmcgb24gdW5kZWZpbmVkCiAgdmFyIGFyZ3MgPSBbaXRdCiAgICAsIGkgICAgPSAxCiAgICAsICQkICAgPSBhcmd1bWVudHMKICAgICwgcmVwbGFjZXIsICRyZXBsYWNlcjsKICB3aGlsZSgkJC5sZW5ndGggPiBpKWFyZ3MucHVzaCgkJFtpKytdKTsKICByZXBsYWNlciA9IGFyZ3NbMV07CiAgaWYodHlwZW9mIHJlcGxhY2VyID09ICdmdW5jdGlvbicpJHJlcGxhY2VyID0gcmVwbGFjZXI7CiAgaWYoJHJlcGxhY2VyIHx8ICFpc0FycmF5KHJlcGxhY2VyKSlyZXBsYWNlciA9IGZ1bmN0aW9uKGtleSwgdmFsdWUpewogICAgaWYoJHJlcGxhY2VyKXZhbHVlID0gJHJlcGxhY2VyLmNhbGwodGhpcywga2V5LCB2YWx1ZSk7CiAgICBpZighaXNTeW1ib2wodmFsdWUpKXJldHVybiB2YWx1ZTsKICB9OwogIGFyZ3NbMV0gPSByZXBsYWNlcjsKICByZXR1cm4gX3N0cmluZ2lmeS5hcHBseSgkSlNPTiwgYXJncyk7Cn07CnZhciBidWdneUpTT04gPSAkZmFpbHMoZnVuY3Rpb24oKXsKICB2YXIgUyA9ICRTeW1ib2woKTsKICAvLyBNUyBFZGdlIGNvbnZlcnRzIHN5bWJvbCB2YWx1ZXMgdG8gSlNPTiBhcyB7fQogIC8vIFdlYktpdCBjb252ZXJ0cyBzeW1ib2wgdmFsdWVzIHRvIEpTT04gYXMgbnVsbAogIC8vIFY4IHRocm93cyBvbiBib3hlZCBzeW1ib2xzCiAgcmV0dXJuIF9zdHJpbmdpZnkoW1NdKSAhPSAnW251bGxdJyB8fCBfc3RyaW5naWZ5KHthOiBTfSkgIT0gJ3t9JyB8fCBfc3RyaW5naWZ5KE9iamVjdChTKSkgIT0gJ3t9JzsKfSk7CgovLyAxOS40LjEuMSBTeW1ib2woW2Rlc2NyaXB0aW9uXSkKaWYoIXVzZU5hdGl2ZSl7CiAgJFN5bWJvbCA9IGZ1bmN0aW9uIFN5bWJvbCgpewogICAgaWYoaXNTeW1ib2wodGhpcykpdGhyb3cgVHlwZUVycm9yKCdTeW1ib2wgaXMgbm90IGEgY29uc3RydWN0b3InKTsKICAgIHJldHVybiB3cmFwKHVpZChhcmd1bWVudHMubGVuZ3RoID4gMCA/IGFyZ3VtZW50c1swXSA6IHVuZGVmaW5lZCkpOwogIH07CiAgcmVkZWZpbmUoJFN5bWJvbC5wcm90b3R5cGUsICd0b1N0cmluZycsIGZ1bmN0aW9uIHRvU3RyaW5nKCl7CiAgICByZXR1cm4gdGhpcy5fazsKICB9KTsKCiAgaXNTeW1ib2wgPSBmdW5jdGlvbihpdCl7CiAgICByZXR1cm4gaXQgaW5zdGFuY2VvZiAkU3ltYm9sOwogIH07CgogICQuY3JlYXRlICAgICA9ICRjcmVhdGU7CiAgJC5pc0VudW0gICAgID0gJHByb3BlcnR5SXNFbnVtZXJhYmxlOwogICQuZ2V0RGVzYyAgICA9ICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I7CiAgJC5zZXREZXNjICAgID0gJGRlZmluZVByb3BlcnR5OwogICQuc2V0RGVzY3MgICA9ICRkZWZpbmVQcm9wZXJ0aWVzOwogICQuZ2V0TmFtZXMgICA9ICRuYW1lcy5nZXQgPSAkZ2V0T3duUHJvcGVydHlOYW1lczsKICAkLmdldFN5bWJvbHMgPSAkZ2V0T3duUHJvcGVydHlTeW1ib2xzOwoKICBpZihERVNDUklQVE9SUyAmJiAhcmVxdWlyZSgnLi8kLmxpYnJhcnknKSl7CiAgICByZWRlZmluZShPYmplY3RQcm90bywgJ3Byb3BlcnR5SXNFbnVtZXJhYmxlJywgJHByb3BlcnR5SXNFbnVtZXJhYmxlLCB0cnVlKTsKICB9Cn0KCnZhciBzeW1ib2xTdGF0aWNzID0gewogIC8vIDE5LjQuMi4xIFN5bWJvbC5mb3Ioa2V5KQogICdmb3InOiBmdW5jdGlvbihrZXkpewogICAgcmV0dXJuIGhhcyhTeW1ib2xSZWdpc3RyeSwga2V5ICs9ICcnKQogICAgICA/IFN5bWJvbFJlZ2lzdHJ5W2tleV0KICAgICAgOiBTeW1ib2xSZWdpc3RyeVtrZXldID0gJFN5bWJvbChrZXkpOwogIH0sCiAgLy8gMTkuNC4yLjUgU3ltYm9sLmtleUZvcihzeW0pCiAga2V5Rm9yOiBmdW5jdGlvbiBrZXlGb3Ioa2V5KXsKICAgIHJldHVybiBrZXlPZihTeW1ib2xSZWdpc3RyeSwga2V5KTsKICB9LAogIHVzZVNldHRlcjogZnVuY3Rpb24oKXsgc2V0dGVyID0gdHJ1ZTsgfSwKICB1c2VTaW1wbGU6IGZ1bmN0aW9uKCl7IHNldHRlciA9IGZhbHNlOyB9Cn07Ci8vIDE5LjQuMi4yIFN5bWJvbC5oYXNJbnN0YW5jZQovLyAxOS40LjIuMyBTeW1ib2wuaXNDb25jYXRTcHJlYWRhYmxlCi8vIDE5LjQuMi40IFN5bWJvbC5pdGVyYXRvcgovLyAxOS40LjIuNiBTeW1ib2wubWF0Y2gKLy8gMTkuNC4yLjggU3ltYm9sLnJlcGxhY2UKLy8gMTkuNC4yLjkgU3ltYm9sLnNlYXJjaAovLyAxOS40LjIuMTAgU3ltYm9sLnNwZWNpZXMKLy8gMTkuNC4yLjExIFN5bWJvbC5zcGxpdAovLyAxOS40LjIuMTIgU3ltYm9sLnRvUHJpbWl0aXZlCi8vIDE5LjQuMi4xMyBTeW1ib2wudG9TdHJpbmdUYWcKLy8gMTkuNC4yLjE0IFN5bWJvbC51bnNjb3BhYmxlcwokLmVhY2guY2FsbCgoCiAgJ2hhc0luc3RhbmNlLGlzQ29uY2F0U3ByZWFkYWJsZSxpdGVyYXRvcixtYXRjaCxyZXBsYWNlLHNlYXJjaCwnICsKICAnc3BlY2llcyxzcGxpdCx0b1ByaW1pdGl2ZSx0b1N0cmluZ1RhZyx1bnNjb3BhYmxlcycKKS5zcGxpdCgnLCcpLCBmdW5jdGlvbihpdCl7CiAgdmFyIHN5bSA9IHdrcyhpdCk7CiAgc3ltYm9sU3RhdGljc1tpdF0gPSB1c2VOYXRpdmUgPyBzeW0gOiB3cmFwKHN5bSk7Cn0pOwoKc2V0dGVyID0gdHJ1ZTsKCiRleHBvcnQoJGV4cG9ydC5HICsgJGV4cG9ydC5XLCB7U3ltYm9sOiAkU3ltYm9sfSk7CgokZXhwb3J0KCRleHBvcnQuUywgJ1N5bWJvbCcsIHN5bWJvbFN0YXRpY3MpOwoKJGV4cG9ydCgkZXhwb3J0LlMgKyAkZXhwb3J0LkYgKiAhdXNlTmF0aXZlLCAnT2JqZWN0JywgewogIC8vIDE5LjEuMi4yIE9iamVjdC5jcmVhdGUoTyBbLCBQcm9wZXJ0aWVzXSkKICBjcmVhdGU6ICRjcmVhdGUsCiAgLy8gMTkuMS4yLjQgT2JqZWN0LmRlZmluZVByb3BlcnR5KE8sIFAsIEF0dHJpYnV0ZXMpCiAgZGVmaW5lUHJvcGVydHk6ICRkZWZpbmVQcm9wZXJ0eSwKICAvLyAxOS4xLjIuMyBPYmplY3QuZGVmaW5lUHJvcGVydGllcyhPLCBQcm9wZXJ0aWVzKQogIGRlZmluZVByb3BlcnRpZXM6ICRkZWZpbmVQcm9wZXJ0aWVzLAogIC8vIDE5LjEuMi42IE9iamVjdC5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IoTywgUCkKICBnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3I6ICRnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3IsCiAgLy8gMTkuMS4yLjcgT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoTykKICBnZXRPd25Qcm9wZXJ0eU5hbWVzOiAkZ2V0T3duUHJvcGVydHlOYW1lcywKICAvLyAxOS4xLjIuOCBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKE8pCiAgZ2V0T3duUHJvcGVydHlTeW1ib2xzOiAkZ2V0T3duUHJvcGVydHlTeW1ib2xzCn0pOwoKLy8gMjQuMy4yIEpTT04uc3RyaW5naWZ5KHZhbHVlIFssIHJlcGxhY2VyIFssIHNwYWNlXV0pCiRKU09OICYmICRleHBvcnQoJGV4cG9ydC5TICsgJGV4cG9ydC5GICogKCF1c2VOYXRpdmUgfHwgYnVnZ3lKU09OKSwgJ0pTT04nLCB7c3RyaW5naWZ5OiAkc3RyaW5naWZ5fSk7CgovLyAxOS40LjMuNSBTeW1ib2wucHJvdG90eXBlW0BAdG9TdHJpbmdUYWddCnNldFRvU3RyaW5nVGFnKCRTeW1ib2wsICdTeW1ib2wnKTsKLy8gMjAuMi4xLjkgTWF0aFtAQHRvU3RyaW5nVGFnXQpzZXRUb1N0cmluZ1RhZyhNYXRoLCAnTWF0aCcsIHRydWUpOwovLyAyNC4zLjMgSlNPTltAQHRvU3RyaW5nVGFnXQpzZXRUb1N0cmluZ1RhZyhnbG9iYWwuSlNPTiwgJ0pTT04nLCB0cnVlKTsKfSx7Ii4vJCI6NjcsIi4vJC5hbi1vYmplY3QiOjM2LCIuLyQuZGVzY3JpcHRvcnMiOjQ1LCIuLyQuZW51bS1rZXlzIjo0NywiLi8kLmV4cG9ydCI6NDgsIi4vJC5mYWlscyI6NDksIi4vJC5nZXQtbmFtZXMiOjUxLCIuLyQuZ2xvYmFsIjo1MiwiLi8kLmhhcyI6NTMsIi4vJC5pcy1hcnJheSI6NTksIi4vJC5rZXlvZiI6NjgsIi4vJC5saWJyYXJ5Ijo2OSwiLi8kLnByb3BlcnR5LWRlc2MiOjczLCIuLyQucmVkZWZpbmUiOjc1LCIuLyQuc2V0LXRvLXN0cmluZy10YWciOjc5LCIuLyQuc2hhcmVkIjo4MCwiLi8kLnRvLWlvYmplY3QiOjg2LCIuLyQudWlkIjo4OSwiLi8kLndrcyI6OTB9XSwxMDQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBodHRwczovL2dpdGh1Yi5jb20vRGF2aWRCcnVhbnQvTWFwLVNldC5wcm90b3R5cGUudG9KU09OCnZhciAkZXhwb3J0ICA9IHJlcXVpcmUoJy4vJC5leHBvcnQnKTsKCiRleHBvcnQoJGV4cG9ydC5QLCAnTWFwJywge3RvSlNPTjogcmVxdWlyZSgnLi8kLmNvbGxlY3Rpb24tdG8tanNvbicpKCdNYXAnKX0pOwp9LHsiLi8kLmNvbGxlY3Rpb24tdG8tanNvbiI6NDAsIi4vJC5leHBvcnQiOjQ4fV0sMTA1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gaHR0cHM6Ly9naXRodWIuY29tL0RhdmlkQnJ1YW50L01hcC1TZXQucHJvdG90eXBlLnRvSlNPTgp2YXIgJGV4cG9ydCAgPSByZXF1aXJlKCcuLyQuZXhwb3J0Jyk7CgokZXhwb3J0KCRleHBvcnQuUCwgJ1NldCcsIHt0b0pTT046IHJlcXVpcmUoJy4vJC5jb2xsZWN0aW9uLXRvLWpzb24nKSgnU2V0Jyl9KTsKfSx7Ii4vJC5jb2xsZWN0aW9uLXRvLWpzb24iOjQwLCIuLyQuZXhwb3J0Ijo0OH1dLDEwNjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7CnJlcXVpcmUoJy4vZXM2LmFycmF5Lml0ZXJhdG9yJyk7CnZhciBJdGVyYXRvcnMgPSByZXF1aXJlKCcuLyQuaXRlcmF0b3JzJyk7Ckl0ZXJhdG9ycy5Ob2RlTGlzdCA9IEl0ZXJhdG9ycy5IVE1MQ29sbGVjdGlvbiA9IEl0ZXJhdG9ycy5BcnJheTsKfSx7Ii4vJC5pdGVyYXRvcnMiOjY2LCIuL2VzNi5hcnJheS5pdGVyYXRvciI6OTJ9XSwxMDc6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24gKHByb2Nlc3MpewovKiEgaGVsbG9qcyB2MS4xMS4wIHwgKGMpIDIwMTItMjAxNiBBbmRyZXcgRG9kc29uIHwgTUlUIGh0dHBzOi8vYWRvZHNvbi5jb20vaGVsbG8uanMvTElDRU5TRSAqLw0KLy8gRVM1IE9iamVjdC5jcmVhdGUKaWYgKCFPYmplY3QuY3JlYXRlKSB7CgoJLy8gU2hpbSwgT2JqZWN0IGNyZWF0ZQoJLy8gQSBzaGltIGZvciBPYmplY3QuY3JlYXRlKCksIGl0IGFkZHMgYSBwcm90b3R5cGUgdG8gYSBuZXcgb2JqZWN0CglPYmplY3QuY3JlYXRlID0gKGZ1bmN0aW9uKCkgewoKCQlmdW5jdGlvbiBGKCkge30KCgkJcmV0dXJuIGZ1bmN0aW9uKG8pIHsKCgkJCWlmIChhcmd1bWVudHMubGVuZ3RoICE9IDEpIHsKCQkJCXRocm93IG5ldyBFcnJvcignT2JqZWN0LmNyZWF0ZSBpbXBsZW1lbnRhdGlvbiBvbmx5IGFjY2VwdHMgb25lIHBhcmFtZXRlci4nKTsKCQkJfQoKCQkJRi5wcm90b3R5cGUgPSBvOwoJCQlyZXR1cm4gbmV3IEYoKTsKCQl9OwoKCX0pKCk7Cgp9CgovLyBFUzUgT2JqZWN0LmtleXMKaWYgKCFPYmplY3Qua2V5cykgewoJT2JqZWN0LmtleXMgPSBmdW5jdGlvbihvLCBrLCByKSB7CgkJciA9IFtdOwoJCWZvciAoayBpbiBvKSB7CgkJCWlmIChyLmhhc093blByb3BlcnR5LmNhbGwobywgaykpCgkJCQlyLnB1c2goayk7CgkJfQoKCQlyZXR1cm4gcjsKCX07Cn0KCi8vIEVTNSBbXS5pbmRleE9mCmlmICghQXJyYXkucHJvdG90eXBlLmluZGV4T2YpIHsKCUFycmF5LnByb3RvdHlwZS5pbmRleE9mID0gZnVuY3Rpb24ocykgewoKCQlmb3IgKHZhciBqID0gMDsgaiA8IHRoaXMubGVuZ3RoOyBqKyspIHsKCQkJaWYgKHRoaXNbal0gPT09IHMpIHsKCQkJCXJldHVybiBqOwoJCQl9CgkJfQoKCQlyZXR1cm4gLTE7Cgl9Owp9CgovLyBFUzUgW10uZm9yRWFjaAppZiAoIUFycmF5LnByb3RvdHlwZS5mb3JFYWNoKSB7CglBcnJheS5wcm90b3R5cGUuZm9yRWFjaCA9IGZ1bmN0aW9uKGZ1bi8qLCB0aGlzQXJnKi8pIHsKCgkJaWYgKHRoaXMgPT09IHZvaWQgMCB8fCB0aGlzID09PSBudWxsKSB7CgkJCXRocm93IG5ldyBUeXBlRXJyb3IoKTsKCQl9CgoJCXZhciB0ID0gT2JqZWN0KHRoaXMpOwoJCXZhciBsZW4gPSB0Lmxlbmd0aCA+Pj4gMDsKCQlpZiAodHlwZW9mIGZ1biAhPT0gJ2Z1bmN0aW9uJykgewoJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCk7CgkJfQoKCQl2YXIgdGhpc0FyZyA9IGFyZ3VtZW50cy5sZW5ndGggPj0gMiA/IGFyZ3VtZW50c1sxXSA6IHZvaWQgMDsKCQlmb3IgKHZhciBpID0gMDsgaSA8IGxlbjsgaSsrKSB7CgkJCWlmIChpIGluIHQpIHsKCQkJCWZ1bi5jYWxsKHRoaXNBcmcsIHRbaV0sIGksIHQpOwoJCQl9CgkJfQoKCQlyZXR1cm4gdGhpczsKCX07Cn0KCi8vIEVTNSBbXS5maWx0ZXIKaWYgKCFBcnJheS5wcm90b3R5cGUuZmlsdGVyKSB7CglBcnJheS5wcm90b3R5cGUuZmlsdGVyID0gZnVuY3Rpb24oZnVuLCB0aGlzQXJnKSB7CgoJCXZhciBhID0gW107CgkJdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHZhbCwgaSwgdCkgewoJCQlpZiAoZnVuLmNhbGwodGhpc0FyZyB8fCB2b2lkIDAsIHZhbCwgaSwgdCkpIHsKCQkJCWEucHVzaCh2YWwpOwoJCQl9CgkJfSk7CgoJCXJldHVybiBhOwoJfTsKfQoKLy8gUHJvZHVjdGlvbiBzdGVwcyBvZiBFQ01BLTI2MiwgRWRpdGlvbiA1LCAxNS40LjQuMTkKLy8gUmVmZXJlbmNlOiBodHRwOi8vZXM1LmdpdGh1Yi5pby8jeDE1LjQuNC4xOQppZiAoIUFycmF5LnByb3RvdHlwZS5tYXApIHsKCglBcnJheS5wcm90b3R5cGUubWFwID0gZnVuY3Rpb24oZnVuLCB0aGlzQXJnKSB7CgoJCXZhciBhID0gW107CgkJdGhpcy5mb3JFYWNoKGZ1bmN0aW9uKHZhbCwgaSwgdCkgewoJCQlhLnB1c2goZnVuLmNhbGwodGhpc0FyZyB8fCB2b2lkIDAsIHZhbCwgaSwgdCkpOwoJCX0pOwoKCQlyZXR1cm4gYTsKCX07Cn0KCi8vIEVTNSBpc0FycmF5CmlmICghQXJyYXkuaXNBcnJheSkgewoKCS8vIEZ1bmN0aW9uIEFycmF5LmlzQXJyYXkKCUFycmF5LmlzQXJyYXkgPSBmdW5jdGlvbihvKSB7CgkJcmV0dXJuIE9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChvKSA9PT0gJ1tvYmplY3QgQXJyYXldJzsKCX07Cgp9CgovLyBUZXN0IGZvciBsb2NhdGlvbi5hc3NpZ24KaWYgKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnICYmIHR5cGVvZiB3aW5kb3cubG9jYXRpb24gPT09ICdvYmplY3QnICYmICF3aW5kb3cubG9jYXRpb24uYXNzaWduKSB7CgoJd2luZG93LmxvY2F0aW9uLmFzc2lnbiA9IGZ1bmN0aW9uKHVybCkgewoJCXdpbmRvdy5sb2NhdGlvbiA9IHVybDsKCX07Cgp9CgovLyBUZXN0IGZvciBGdW5jdGlvbi5iaW5kCmlmICghRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQpIHsKCgkvLyBNRE4KCS8vIFBvbHlmaWxsIElFOCwgZG9lcyBub3Qgc3VwcG9ydCBuYXRpdmUgRnVuY3Rpb24uYmluZAoJRnVuY3Rpb24ucHJvdG90eXBlLmJpbmQgPSBmdW5jdGlvbihiKSB7CgoJCWlmICh0eXBlb2YgdGhpcyAhPT0gJ2Z1bmN0aW9uJykgewoJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCdGdW5jdGlvbi5wcm90b3R5cGUuYmluZCAtIHdoYXQgaXMgdHJ5aW5nIHRvIGJlIGJvdW5kIGlzIG5vdCBjYWxsYWJsZScpOwoJCX0KCgkJZnVuY3Rpb24gQygpIHt9CgoJCXZhciBhID0gW10uc2xpY2U7CgkJdmFyIGYgPSBhLmNhbGwoYXJndW1lbnRzLCAxKTsKCQl2YXIgX3RoaXMgPSB0aGlzOwoJCXZhciBEID0gZnVuY3Rpb24oKSB7CgkJCXJldHVybiBfdGhpcy5hcHBseSh0aGlzIGluc3RhbmNlb2YgQyA/IHRoaXMgOiBiIHx8IHdpbmRvdywgZi5jb25jYXQoYS5jYWxsKGFyZ3VtZW50cykpKTsKCQl9OwoKCQlDLnByb3RvdHlwZSA9IHRoaXMucHJvdG90eXBlOwoJCUQucHJvdG90eXBlID0gbmV3IEMoKTsKCgkJcmV0dXJuIEQ7Cgl9OwoKfQoKLyoqCiAqIEBoZWxsby5qcwogKgogKiBIZWxsb0pTIGlzIGEgY2xpZW50IHNpZGUgSmF2YXNjcmlwdCBTREsgZm9yIG1ha2luZyBPQXV0aDIgbG9naW5zIGFuZCBzdWJzZXF1ZW50IFJFU1QgY2FsbHMuCiAqCiAqIEBhdXRob3IgQW5kcmV3IERvZHNvbgogKiBAd2Vic2l0ZSBodHRwczovL2Fkb2Rzb24uY29tL2hlbGxvLmpzLwogKgogKiBAY29weXJpZ2h0IEFuZHJldyBEb2Rzb24sIDIwMTIgLSAyMDE1CiAqIEBsaWNlbnNlIE1JVDogWW91IGFyZSBmcmVlIHRvIHVzZSBhbmQgbW9kaWZ5IHRoaXMgY29kZSBmb3IgYW55IHVzZSwgb24gdGhlIGNvbmRpdGlvbiB0aGF0IHRoaXMgY29weXJpZ2h0IG5vdGljZSByZW1haW5zLgogKi8KCnZhciBoZWxsbyA9IGZ1bmN0aW9uKG5hbWUpIHsKCXJldHVybiBoZWxsby51c2UobmFtZSk7Cn07CgpoZWxsby51dGlscyA9IHsKCgkvLyBFeHRlbmQgdGhlIGZpcnN0IG9iamVjdCB3aXRoIHRoZSBwcm9wZXJ0aWVzIGFuZCBtZXRob2RzIG9mIHRoZSBzZWNvbmQKCWV4dGVuZDogZnVuY3Rpb24ociAvKiwgYVssIGJbLCAuLi5dXSAqLykgewoKCQkvLyBHZXQgdGhlIGFyZ3VtZW50cyBhcyBhbiBhcnJheSBidXQgb21taXQgdGhlIGluaXRpYWwgaXRlbQoJCUFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkuZm9yRWFjaChmdW5jdGlvbihhKSB7CgkJCWlmIChyIGluc3RhbmNlb2YgT2JqZWN0ICYmIGEgaW5zdGFuY2VvZiBPYmplY3QgJiYgciAhPT0gYSkgewoJCQkJZm9yICh2YXIgeCBpbiBhKSB7CgkJCQkJclt4XSA9IGhlbGxvLnV0aWxzLmV4dGVuZChyW3hdLCBhW3hdKTsKCQkJCX0KCQkJfQoJCQllbHNlIHsKCQkJCXIgPSBhOwoJCQl9CgkJfSk7CgoJCXJldHVybiByOwoJfQp9OwoKLy8gQ29yZSBsaWJyYXJ5CmhlbGxvLnV0aWxzLmV4dGVuZChoZWxsbywgewoKCXNldHRpbmdzOiB7CgoJCS8vIE9BdXRoMiBhdXRoZW50aWNhdGlvbiBkZWZhdWx0cwoJCXJlZGlyZWN0X3VyaTogd2luZG93LmxvY2F0aW9uLmhyZWYuc3BsaXQoJyMnKVswXSwKCQlyZXNwb25zZV90eXBlOiAndG9rZW4nLAoJCWRpc3BsYXk6ICdwb3B1cCcsCgkJc3RhdGU6ICcnLAoKCQkvLyBPQXV0aDEgc2hpbQoJCS8vIFRoZSBwYXRoIHRvIHRoZSBPQXV0aDEgc2VydmVyIGZvciBzaWduaW5nIHVzZXIgcmVxdWVzdHMKCQkvLyBXYW50IHRvIHJlY3JlYXRlIHlvdXIgb3duPyBDaGVja291dCBodHRwczovL2dpdGh1Yi5jb20vTXJTd2l0Y2gvbm9kZS1vYXV0aC1zaGltCgkJb2F1dGhfcHJveHk6ICdodHRwczovL2F1dGgtc2VydmVyLmhlcm9rdWFwcC5jb20vcHJveHknLAoKCQkvLyBBUEkgdGltZW91dCBpbiBtaWxsaXNlY29uZHMKCQl0aW1lb3V0OiAyMDAwMCwKCgkJLy8gUG9wdXAgT3B0aW9ucwoJCXBvcHVwOiB7CgkJCXJlc2l6YWJsZTogMSwKCQkJc2Nyb2xsYmFyczogMSwKCQkJd2lkdGg6IDUwMCwKCQkJaGVpZ2h0OiA1NTAKCQl9LAoKCQkvLyBEZWZhdWx0IHNjb3BlCgkJLy8gTWFueSBzZXJ2aWNlcyByZXF1aXJlIGF0bGVhc3QgYSBwcm9maWxlIHNjb3BlLAoJCS8vIEhlbGxvSlMgYXV0b21hdGlhbGx5IGluY2x1ZGVzIHRoZSB2YWx1ZSBvZiBwcm92aWRlci5zY29wZV9tYXAuYmFzaWMKCQkvLyBJZiB0aGF0J3Mgbm90IHJlcXVpcmVkIGl0IGNhbiBiZSByZW1vdmVkIHZpYSBoZWxsby5zZXR0aW5ncy5zY29wZS5sZW5ndGggPSAwOwoJCXNjb3BlOiBbJ2Jhc2ljJ10sCgoJCS8vIFNjb3BlIE1hcHMKCQkvLyBUaGlzIGlzIHRoZSBkZWZhdWx0IG1vZHVsZSBzY29wZSwgdGhlc2UgYXJlIHRoZSBkZWZhdWx0cyB3aGljaCBlYWNoIHNlcnZpY2UgaXMgbWFwcGVkIHRvby4KCQkvLyBUaGlzIGxpc3QgaXMgb25seSB0aGUgcG9wdWxhciBvbmVzIGJlaW5nIHN0YW5kYXJkaXplZC4KCQkvLyBCeSBpbmNsdWRpbmcgdGhlbSBoZXJlIGl0IHByZXZlbnRzIHRoZSBzY29wZXMgZnJvbSBiZWluZyBhcHBsaWVkIGFjY2lkZW50YWxseQoJCS8vIEZvciBsZXNzIGNvbW1vbiBzY29wZXMgaXRzIGFzc3VtZWQgdGhlIERldmVsb3BlciBrbm93cyB3aGVuIHRvIHVzZSB0aGUgc2NvcGUuCgkJc2NvcGVfbWFwOiB7CgkJCWJhc2ljOiAnJywKCQkJZW1haWw6ICcnLAoJCQlmaWxlczogJycsCgkJCWZyaWVuZHM6ICcnLAoJCQlwaG90b3M6ICcnLAoJCQlwdWJsaXNoOiAnJywKCQkJcHVibGlzaF9maWxlczogJycsCgkJCXNoYXJlOiAnJywKCQkJdmlkZW9zOiAnJwoJCX0sCgoJCS8vIERlZmF1bHQgc2VydmljZSAvIG5ldHdvcmsKCQlkZWZhdWx0X3NlcnZpY2U6IG51bGwsCgoJCS8vIEZvcmNlIGF1dGhlbnRpY2F0aW9uCgkJLy8gV2hlbiBoZWxsby5sb2dpbiBpcyBmaXJlZC4KCQkvLyAobnVsbCk6IGlnbm9yZSBjdXJyZW50IHNlc3Npb24gZXhwaXJ5IGFuZCBjb250aW51ZSB3aXRoIGxvZ2luCgkJLy8gKHRydWUpOiBpZ25vcmUgY3VycmVudCBzZXNzaW9uIGV4cGlyeSBhbmQgY29udGludWUgd2l0aCBsb2dpbiwgYXNrIGZvciB1c2VyIHRvIHJlYXV0aGVudGljYXRlCgkJLy8gKGZhbHNlKTogaWYgdGhlIGN1cnJlbnQgc2Vzc2lvbiBsb29rcyBnb29kIGZvciB0aGUgcmVxdWVzdCBzY29wZXMgcmV0dXJuIHRoZSBjdXJyZW50IHNlc3Npb24uCgkJZm9yY2U6IG51bGwsCgoJCS8vIFBhZ2UgVVJMCgkJLy8gV2hlbiAnZGlzcGxheT1wYWdlJyB0aGlzIHByb3BlcnR5IGRlZmluZXMgd2hlcmUgdGhlIHVzZXJzIHBhZ2Ugc2hvdWxkIGVuZCB1cCBhZnRlciByZWRpcmVjdF91cmkKCQkvLyBUaHMgY291bGQgYmUgcHJvYmxlbWF0aWMgaWYgdGhlIHJlZGlyZWN0X3VyaSBpcyBpbmRlZWQgdGhlIGZpbmFsIHBsYWNlLAoJCS8vIFR5cGljYWxseSB0aGlzIGNpcmN1bXZlbnRzIHRoZSBwcm9ibGVtIG9mIHRoZSByZWRpcmVjdF91cmwgYmVpbmcgYSBkdW1iIHJlbGF5IHBhZ2UuCgkJcGFnZV91cmk6IHdpbmRvdy5sb2NhdGlvbi5ocmVmCgl9LAoKCS8vIFNlcnZpY2UgY29uZmlndXJhdGlvbiBvYmplY3RzCglzZXJ2aWNlczoge30sCgoJLy8gVXNlCgkvLyBEZWZpbmUgYSBuZXcgaW5zdGFuY2Ugb2YgdGhlIEhlbGxvSlMgbGlicmFyeSB3aXRoIGEgZGVmYXVsdCBzZXJ2aWNlCgl1c2U6IGZ1bmN0aW9uKHNlcnZpY2UpIHsKCgkJLy8gQ3JlYXRlIHNlbGYsIHdoaWNoIGluaGVyaXRzIGZyb20gaXRzIHBhcmVudAoJCXZhciBzZWxmID0gT2JqZWN0LmNyZWF0ZSh0aGlzKTsKCgkJLy8gSW5oZXJpdCB0aGUgcHJvdG90eXBlIGZyb20gaXRzIHBhcmVudAoJCXNlbGYuc2V0dGluZ3MgPSBPYmplY3QuY3JlYXRlKHRoaXMuc2V0dGluZ3MpOwoKCQkvLyBEZWZpbmUgdGhlIGRlZmF1bHQgc2VydmljZQoJCWlmIChzZXJ2aWNlKSB7CgkJCXNlbGYuc2V0dGluZ3MuZGVmYXVsdF9zZXJ2aWNlID0gc2VydmljZTsKCQl9CgoJCS8vIENyZWF0ZSBhbiBpbnN0YW5jZSBvZiBFdmVudHMKCQlzZWxmLnV0aWxzLkV2ZW50LmNhbGwoc2VsZik7CgoJCXJldHVybiBzZWxmOwoJfSwKCgkvLyBJbml0aWFsaXplCgkvLyBEZWZpbmUgdGhlIGNsaWVudF9pZHMgZm9yIHRoZSBlbmRwb2ludCBzZXJ2aWNlcwoJLy8gQHBhcmFtIG9iamVjdCBvLCBjb250YWlucyBhIGtleSB2YWx1ZSBwYWlyLCBzZXJ2aWNlID0+IGNsaWVudElkCgkvLyBAcGFyYW0gb2JqZWN0IG9wdHMsIGNvbnRhaW5zIGEga2V5IHZhbHVlIHBhaXIgb2Ygb3B0aW9ucyB1c2VkIGZvciBkZWZpbmluZyB0aGUgYXV0aGVudGljYXRpb24gZGVmYXVsdHMKCS8vIEBwYXJhbSBudW1iZXIgdGltZW91dCwgdGltZW91dCBpbiBzZWNvbmRzCglpbml0OiBmdW5jdGlvbihzZXJ2aWNlcywgb3B0aW9ucykgewoKCQl2YXIgdXRpbHMgPSB0aGlzLnV0aWxzOwoKCQlpZiAoIXNlcnZpY2VzKSB7CgkJCXJldHVybiB0aGlzLnNlcnZpY2VzOwoJCX0KCgkJLy8gRGVmaW5lIHByb3ZpZGVyIGNyZWRlbnRpYWxzCgkJLy8gUmVmb3JtYXQgdGhlIElEIGZpZWxkCgkJZm9yICh2YXIgeCBpbiBzZXJ2aWNlcykge2lmIChzZXJ2aWNlcy5oYXNPd25Qcm9wZXJ0eSh4KSkgewoJCQlpZiAodHlwZW9mIChzZXJ2aWNlc1t4XSkgIT09ICdvYmplY3QnKSB7CgkJCQlzZXJ2aWNlc1t4XSA9IHtpZDogc2VydmljZXNbeF19OwoJCQl9CgkJfX0KCgkJLy8gTWVyZ2Ugc2VydmljZXMgaWYgdGhlcmUgYWxyZWFkeSBleGlzdHMgc29tZQoJCXV0aWxzLmV4dGVuZCh0aGlzLnNlcnZpY2VzLCBzZXJ2aWNlcyk7CgoJCS8vIFVwZGF0ZSB0aGUgZGVmYXVsdCBzZXR0aW5ncyB3aXRoIHRoaXMgb25lLgoJCWlmIChvcHRpb25zKSB7CgkJCXV0aWxzLmV4dGVuZCh0aGlzLnNldHRpbmdzLCBvcHRpb25zKTsKCgkJCS8vIERvIHRoaXMgaW1tZWRpYXRseSBpbmNhc2UgdGhlIGJyb3dzZXIgY2hhbmdlcyB0aGUgY3VycmVudCBwYXRoLgoJCQlpZiAoJ3JlZGlyZWN0X3VyaScgaW4gb3B0aW9ucykgewoJCQkJdGhpcy5zZXR0aW5ncy5yZWRpcmVjdF91cmkgPSB1dGlscy51cmwob3B0aW9ucy5yZWRpcmVjdF91cmkpLmhyZWY7CgkJCX0KCQl9CgoJCXJldHVybiB0aGlzOwoJfSwKCgkvLyBMb2dpbgoJLy8gVXNpbmcgdGhlIGVuZHBvaW50CgkvLyBAcGFyYW0gbmV0d29yayBzdHJpbmdpZnkgICAgICAgbmFtZSB0byBjb25uZWN0IHRvCgkvLyBAcGFyYW0gb3B0aW9ucyBvYmplY3QgICAgKG9wdGlvbmFsKSAge2Rpc3BsYXkgbW9kZSwgaXMgZWl0aGVyIG5vbmV8cG9wdXAoZGVmYXVsdCl8cGFnZSwgc2NvcGU6IGVtYWlsLGJpcnRoZGF5LHB1Ymxpc2gsIC4uIH0KCS8vIEBwYXJhbSBjYWxsYmFjayAgZnVuY3Rpb24gIChvcHRpb25hbCkgIGZpcmVkIG9uIHNpZ25pbgoJbG9naW46IGZ1bmN0aW9uKCkgewoKCQkvLyBDcmVhdGUgYW4gb2JqZWN0IHdoaWNoIGluaGVyaXRzIGl0cyBwYXJlbnQgYXMgdGhlIHByb3RvdHlwZSBhbmQgY29uc3RydWN0cyBhIG5ldyBldmVudCBjaGFpbi4KCQl2YXIgX3RoaXMgPSB0aGlzOwoJCXZhciB1dGlscyA9IF90aGlzLnV0aWxzOwoJCXZhciBlcnJvciA9IHV0aWxzLmVycm9yOwoJCXZhciBwcm9taXNlID0gdXRpbHMuUHJvbWlzZSgpOwoKCQkvLyBHZXQgcGFyYW1ldGVycwoJCXZhciBwID0gdXRpbHMuYXJncyh7bmV0d29yazogJ3MnLCBvcHRpb25zOiAnbycsIGNhbGxiYWNrOiAnZid9LCBhcmd1bWVudHMpOwoKCQkvLyBMb2NhbCB2YXJzCgkJdmFyIHVybDsKCgkJLy8gR2V0IGFsbCB0aGUgY3VzdG9tIG9wdGlvbnMgYW5kIHN0b3JlIHRvIGJlIGFwcGVuZGVkIHRvIHRoZSBxdWVyeXN0cmluZwoJCXZhciBxcyA9IHV0aWxzLmRpZmZLZXkocC5vcHRpb25zLCBfdGhpcy5zZXR0aW5ncyk7CgoJCS8vIE1lcmdlL292ZXJyaWRlIG9wdGlvbnMgd2l0aCBhcHAgZGVmYXVsdHMKCQl2YXIgb3B0cyA9IHAub3B0aW9ucyA9IHV0aWxzLm1lcmdlKF90aGlzLnNldHRpbmdzLCBwLm9wdGlvbnMgfHwge30pOwoKCQkvLyBNZXJnZS9vdmVycmlkZSBvcHRpb25zIHdpdGggYXBwIGRlZmF1bHRzCgkJb3B0cy5wb3B1cCA9IHV0aWxzLm1lcmdlKF90aGlzLnNldHRpbmdzLnBvcHVwLCBwLm9wdGlvbnMucG9wdXAgfHwge30pOwoKCQkvLyBOZXR3b3JrCgkJcC5uZXR3b3JrID0gcC5uZXR3b3JrIHx8IF90aGlzLnNldHRpbmdzLmRlZmF1bHRfc2VydmljZTsKCgkJLy8gQmluZCBjYWxsYmFjayB0byBib3RoIHJlamVjdCBhbmQgZnVsZmlsbCBzdGF0ZXMKCQlwcm9taXNlLnByb3h5LnRoZW4ocC5jYWxsYmFjaywgcC5jYWxsYmFjayk7CgoJCS8vIFRyaWdnZXIgYW4gZXZlbnQgb24gdGhlIGdsb2JhbCBsaXN0ZW5lcgoJCWZ1bmN0aW9uIGVtaXQocywgdmFsdWUpIHsKCQkJaGVsbG8uZW1pdChzLCB2YWx1ZSk7CgkJfQoKCQlwcm9taXNlLnByb3h5LnRoZW4oZW1pdC5iaW5kKHRoaXMsICdhdXRoLmxvZ2luIGF1dGgnKSwgZW1pdC5iaW5kKHRoaXMsICdhdXRoLmZhaWxlZCBhdXRoJykpOwoKCQkvLyBJcyBvdXIgc2VydmljZSB2YWxpZD8KCQlpZiAodHlwZW9mIChwLm5ldHdvcmspICE9PSAnc3RyaW5nJyB8fCAhKHAubmV0d29yayBpbiBfdGhpcy5zZXJ2aWNlcykpIHsKCQkJLy8gVHJpZ2dlciB0aGUgZGVmYXVsdCBsb2dpbi4KCQkJLy8gQWhoIHdlIGRvbnQgaGF2ZSBvbmUuCgkJCXJldHVybiBwcm9taXNlLnJlamVjdChlcnJvcignaW52YWxpZF9uZXR3b3JrJywgJ1RoZSBwcm92aWRlZCBuZXR3b3JrIHdhcyBub3QgcmVjb2duaXplZCcpKTsKCQl9CgoJCXZhciBwcm92aWRlciA9IF90aGlzLnNlcnZpY2VzW3AubmV0d29ya107CgoJCS8vIENyZWF0ZSBhIGdsb2JhbCBsaXN0ZW5lciB0byBjYXB0dXJlIGV2ZW50cyB0cmlnZ2VyZWQgb3V0IG9mIHNjb3BlCgkJdmFyIGNhbGxiYWNrSWQgPSB1dGlscy5nbG9iYWxFdmVudChmdW5jdGlvbihzdHIpIHsKCgkJCS8vIFRoZSByZXNwb25zZUhhbmRsZXIgcmV0dXJucyBhIHN0cmluZywgbGV0cyBzYXZlIHRoaXMgbG9jYWxseQoJCQl2YXIgb2JqOwoKCQkJaWYgKHN0cikgewoJCQkJb2JqID0gSlNPTi5wYXJzZShzdHIpOwoJCQl9CgkJCWVsc2UgewoJCQkJb2JqID0gZXJyb3IoJ2NhbmNlbGxlZCcsICdUaGUgYXV0aGVudGljYXRpb24gd2FzIG5vdCBjb21wbGV0ZWQnKTsKCQkJfQoKCQkJLy8gSGFuZGxlIHRoZXNlIHJlc3BvbnNlIHVzaW5nIHRoZSBsb2NhbAoJCQkvLyBUcmlnZ2VyIG9uIHRoZSBwYXJlbnQKCQkJaWYgKCFvYmouZXJyb3IpIHsKCgkJCQkvLyBTYXZlIG9uIHRoZSBwYXJlbnQgd2luZG93IHRoZSBuZXcgY3JlZGVudGlhbHMKCQkJCS8vIFRoaXMgZml4ZXMgYW4gSUUxMCBidWcgaSB0aGluay4uLiBhdGxlYXN0IGl0IGRvZXMgZm9yIG1lLgoJCQkJdXRpbHMuc3RvcmUob2JqLm5ldHdvcmssIG9iaik7CgoJCQkJLy8gRnVsZmlsbCBhIHN1Y2Nlc3NmdWwgbG9naW4KCQkJCXByb21pc2UuZnVsZmlsbCh7CgkJCQkJbmV0d29yazogb2JqLm5ldHdvcmssCgkJCQkJYXV0aFJlc3BvbnNlOiBvYmoKCQkJCX0pOwoJCQl9CgkJCWVsc2UgewoJCQkJLy8gUmVqZWN0IGEgc3VjY2Vzc2Z1bCBsb2dpbgoJCQkJcHJvbWlzZS5yZWplY3Qob2JqKTsKCQkJfQoJCX0pOwoKCQl2YXIgcmVkaXJlY3RVcmkgPSB1dGlscy51cmwob3B0cy5yZWRpcmVjdF91cmkpLmhyZWY7CgoJCS8vIE1heSBiZSBhIHNwYWNlLWRlbGltaXRlZCBsaXN0IG9mIG11bHRpcGxlLCBjb21wbGVtZW50YXJ5IHR5cGVzCgkJdmFyIHJlc3BvbnNlVHlwZSA9IHByb3ZpZGVyLm9hdXRoLnJlc3BvbnNlX3R5cGUgfHwgb3B0cy5yZXNwb25zZV90eXBlOwoKCQkvLyBGYWxsYmFjayB0byB0b2tlbiBpZiB0aGUgbW9kdWxlIGhhc24ndCBkZWZpbmVkIGEgZ3JhbnQgdXJsCgkJaWYgKC9cYmNvZGVcYi8udGVzdChyZXNwb25zZVR5cGUpICYmICFwcm92aWRlci5vYXV0aC5ncmFudCkgewoJCQlyZXNwb25zZVR5cGUgPSByZXNwb25zZVR5cGUucmVwbGFjZSgvXGJjb2RlXGIvLCAndG9rZW4nKTsKCQl9CgoJCS8vIFF1ZXJ5IHN0cmluZyBwYXJhbWV0ZXJzLCB3ZSBtYXkgcGFzcyBvdXIgb3duIGFyZ3VtZW50cyB0byBmb3JtIHRoZSBxdWVyeXN0cmluZwoJCXAucXMgPSB1dGlscy5tZXJnZShxcywgewoJCQljbGllbnRfaWQ6IGVuY29kZVVSSUNvbXBvbmVudChwcm92aWRlci5pZCksCgkJCXJlc3BvbnNlX3R5cGU6IGVuY29kZVVSSUNvbXBvbmVudChyZXNwb25zZVR5cGUpLAoJCQlyZWRpcmVjdF91cmk6IGVuY29kZVVSSUNvbXBvbmVudChyZWRpcmVjdFVyaSksCgkJCWRpc3BsYXk6IG9wdHMuZGlzcGxheSwKCQkJc3RhdGU6IHsKCQkJCWNsaWVudF9pZDogcHJvdmlkZXIuaWQsCgkJCQluZXR3b3JrOiBwLm5ldHdvcmssCgkJCQlkaXNwbGF5OiBvcHRzLmRpc3BsYXksCgkJCQljYWxsYmFjazogY2FsbGJhY2tJZCwKCQkJCXN0YXRlOiBvcHRzLnN0YXRlLAoJCQkJcmVkaXJlY3RfdXJpOiByZWRpcmVjdFVyaQoJCQl9CgkJfSk7CgoJCS8vIEdldCBjdXJyZW50IHNlc3Npb24gZm9yIG1lcmdpbmcgc2NvcGVzLCBhbmQgZm9yIHF1aWNrIGF1dGggcmVzcG9uc2UKCQl2YXIgc2Vzc2lvbiA9IHV0aWxzLnN0b3JlKHAubmV0d29yayk7CgoJCS8vIFNjb3BlcyAoYXV0aGVudGljYXRpb24gcGVybWlzaW9ucykKCQkvLyBFbnN1cmUgdGhpcyBpcyBhIHN0cmluZyAtIElFIGhhcyBhIHByb2JsZW0gbW92aW5nIEFycmF5cyBiZXR3ZWVuIHdpbmRvd3MKCQkvLyBBcHBlbmQgdGhlIHNldHVwIHNjb3BlCgkJdmFyIFNDT1BFX1NQTElUID0gL1ssXHNdKy87CgoJCS8vIEluY2x1ZGUgZGVmYXVsdCBzY29wZSBzZXR0aW5ncyAoY2xvbmVkKS4KCQl2YXIgc2NvcGUgPSBfdGhpcy5zZXR0aW5ncy5zY29wZSA/IFtfdGhpcy5zZXR0aW5ncy5zY29wZS50b1N0cmluZygpXSA6IFtdOwoKCQkvLyBFeHRlbmQgdGhlIHByb3ZpZGVycyBzY29wZSBsaXN0IHdpdGggdGhlIGRlZmF1bHQKCQl2YXIgc2NvcGVNYXAgPSB1dGlscy5tZXJnZShfdGhpcy5zZXR0aW5ncy5zY29wZV9tYXAsIHByb3ZpZGVyLnNjb3BlIHx8IHt9KTsKCgkJLy8gQWRkIHVzZXIgZGVmaW5lZCBzY29wZXMuLi4KCQlpZiAob3B0cy5zY29wZSkgewoJCQlzY29wZS5wdXNoKG9wdHMuc2NvcGUudG9TdHJpbmcoKSk7CgkJfQoKCQkvLyBBcHBlbmQgc2NvcGVzIGZyb20gYSBwcmV2aW91cyBzZXNzaW9uLgoJCS8vIFRoaXMgaGVscHMga2VlcCBhcHAgY3JlZGVudGlhbHMgY29uc3RhbnQsCgkJLy8gQXZvaWRpbmcgaGF2aW5nIHRvIGtlZXAgdGFicyBvbiB3aGF0IHNjb3BlcyBhcmUgYXV0aG9yaXplZAoJCWlmIChzZXNzaW9uICYmICdzY29wZScgaW4gc2Vzc2lvbiAmJiBzZXNzaW9uLnNjb3BlIGluc3RhbmNlb2YgU3RyaW5nKSB7CgkJCXNjb3BlLnB1c2goc2Vzc2lvbi5zY29wZSk7CgkJfQoKCQkvLyBKb2luIGFuZCBTcGxpdCBhZ2FpbgoJCXNjb3BlID0gc2NvcGUuam9pbignLCcpLnNwbGl0KFNDT1BFX1NQTElUKTsKCgkJLy8gRm9ybWF0IHJlbW92ZSBkdXBsaWNhdGVzIGFuZCBlbXB0eSB2YWx1ZXMKCQlzY29wZSA9IHV0aWxzLnVuaXF1ZShzY29wZSkuZmlsdGVyKGZpbHRlckVtcHR5KTsKCgkJLy8gU2F2ZSB0aGUgdGhlIHNjb3BlcyB0byB0aGUgc3RhdGUgd2l0aCB0aGUgbmFtZXMgdGhhdCB0aGV5IHdlcmUgcmVxdWVzdGVkIHdpdGguCgkJcC5xcy5zdGF0ZS5zY29wZSA9IHNjb3BlLmpvaW4oJywnKTsKCgkJLy8gTWFwIHNjb3BlcyB0byB0aGUgcHJvdmlkZXJzIG5hbWluZyBjb252ZW50aW9uCgkJc2NvcGUgPSBzY29wZS5tYXAoZnVuY3Rpb24oaXRlbSkgewoJCQkvLyBEb2VzIHRoaXMgaGF2ZSBhIG1hcHBpbmc/CgkJCXJldHVybiAoaXRlbSBpbiBzY29wZU1hcCkgPyBzY29wZU1hcFtpdGVtXSA6IGl0ZW07CgkJfSk7CgoJCS8vIFN0cmluZ2lmeSBhbmQgQXJyYXlpZnkgc28gdGhhdCBkb3VibGUgbWFwcGVkIHNjb3BlcyBhcmUgZ2l2ZW4gdGhlIGNoYW5jZSB0byBiZSBmb3JtYXR0ZWQKCQlzY29wZSA9IHNjb3BlLmpvaW4oJywnKS5zcGxpdChTQ09QRV9TUExJVCk7CgoJCS8vIEFnYWluLi4uCgkJLy8gRm9ybWF0IHJlbW92ZSBkdXBsaWNhdGVzIGFuZCBlbXB0eSB2YWx1ZXMKCQlzY29wZSA9IHV0aWxzLnVuaXF1ZShzY29wZSkuZmlsdGVyKGZpbHRlckVtcHR5KTsKCgkJLy8gSm9pbiB3aXRoIHRoZSBleHBlY3RlZCBzY29wZSBkZWxpbWl0ZXIgaW50byBhIHN0cmluZwoJCXAucXMuc2NvcGUgPSBzY29wZS5qb2luKHByb3ZpZGVyLnNjb3BlX2RlbGltIHx8ICcsJyk7CgoJCS8vIElzIHRoZSB1c2VyIGFscmVhZHkgc2lnbmVkIGluIHdpdGggdGhlIGFwcHJvcHJpYXRlIHNjb3BlcywgdmFsaWQgYWNjZXNzX3Rva2VuPwoJCWlmIChvcHRzLmZvcmNlID09PSBmYWxzZSkgewoKCQkJaWYgKHNlc3Npb24gJiYgJ2FjY2Vzc190b2tlbicgaW4gc2Vzc2lvbiAmJiBzZXNzaW9uLmFjY2Vzc190b2tlbiAmJiAnZXhwaXJlcycgaW4gc2Vzc2lvbiAmJiBzZXNzaW9uLmV4cGlyZXMgPiAoKG5ldyBEYXRlKCkpLmdldFRpbWUoKSAvIDFlMykpIHsKCQkJCS8vIFdoYXQgaXMgZGlmZmVyZW50IGFib3V0IHRoZSBzY29wZXMgaW4gdGhlIHNlc3Npb24gdnMgdGhlIHNjb3BlcyBpbiB0aGUgbmV3IGxvZ2luPwoJCQkJdmFyIGRpZmYgPSB1dGlscy5kaWZmKChzZXNzaW9uLnNjb3BlIHx8ICcnKS5zcGxpdChTQ09QRV9TUExJVCksIChwLnFzLnN0YXRlLnNjb3BlIHx8ICcnKS5zcGxpdChTQ09QRV9TUExJVCkpOwoJCQkJaWYgKGRpZmYubGVuZ3RoID09PSAwKSB7CgoJCQkJCS8vIE9LIHRyaWdnZXIgdGhlIGNhbGxiYWNrCgkJCQkJcHJvbWlzZS5mdWxmaWxsKHsKCQkJCQkJdW5jaGFuZ2VkOiB0cnVlLAoJCQkJCQluZXR3b3JrOiBwLm5ldHdvcmssCgkJCQkJCWF1dGhSZXNwb25zZTogc2Vzc2lvbgoJCQkJCX0pOwoKCQkJCQkvLyBOb3RoaW5nIGhhcyBjaGFuZ2VkCgkJCQkJcmV0dXJuIHByb21pc2U7CgkJCQl9CgkJCX0KCQl9CgoJCS8vIFBhZ2UgVVJMCgkJaWYgKG9wdHMuZGlzcGxheSA9PT0gJ3BhZ2UnICYmIG9wdHMucGFnZV91cmkpIHsKCQkJLy8gQWRkIGEgcGFnZSBsb2NhdGlvbiwgcGxhY2UgdG8gZW5kdXAgYWZ0ZXIgc2Vzc2lvbiBoYXMgYXV0aGVudGljYXRlZAoJCQlwLnFzLnN0YXRlLnBhZ2VfdXJpID0gdXRpbHMudXJsKG9wdHMucGFnZV91cmkpLmhyZWY7CgkJfQoKCQkvLyBCZXNwb2tlCgkJLy8gT3ZlcnJpZGUgbG9naW4gcXVlcnlzdHJpbmdzIGZyb20gYXV0aF9vcHRpb25zCgkJaWYgKCdsb2dpbicgaW4gcHJvdmlkZXIgJiYgdHlwZW9mIChwcm92aWRlci5sb2dpbikgPT09ICdmdW5jdGlvbicpIHsKCQkJLy8gRm9ybWF0IHRoZSBwYXJhbWF0ZXJzIGFjY29yZGluZyB0byB0aGUgcHJvdmlkZXJzIGZvcm1hdHRpbmcgZnVuY3Rpb24KCQkJcHJvdmlkZXIubG9naW4ocCk7CgkJfQoKCQkvLyBBZGQgT0F1dGggdG8gc3RhdGUKCQkvLyBXaGVyZSB0aGUgc2VydmljZSBpcyBnb2luZyB0byB0YWtlIGFkdmFudGFnZSBvZiB0aGUgb2F1dGhfcHJveHkKCQlpZiAoIS9cYnRva2VuXGIvLnRlc3QocmVzcG9uc2VUeXBlKSB8fAoJCXBhcnNlSW50KHByb3ZpZGVyLm9hdXRoLnZlcnNpb24sIDEwKSA8IDIgfHwKCQkob3B0cy5kaXNwbGF5ID09PSAnbm9uZScgJiYgcHJvdmlkZXIub2F1dGguZ3JhbnQgJiYgc2Vzc2lvbiAmJiBzZXNzaW9uLnJlZnJlc2hfdG9rZW4pKSB7CgoJCQkvLyBBZGQgdGhlIG9hdXRoIGVuZHBvaW50cwoJCQlwLnFzLnN0YXRlLm9hdXRoID0gcHJvdmlkZXIub2F1dGg7CgoJCQkvLyBBZGQgdGhlIHByb3h5IHVybAoJCQlwLnFzLnN0YXRlLm9hdXRoX3Byb3h5ID0gb3B0cy5vYXV0aF9wcm94eTsKCgkJfQoKCQkvLyBDb252ZXJ0IHN0YXRlIHRvIGEgc3RyaW5nCgkJcC5xcy5zdGF0ZSA9IGVuY29kZVVSSUNvbXBvbmVudChKU09OLnN0cmluZ2lmeShwLnFzLnN0YXRlKSk7CgoJCS8vIFVSTAoJCWlmIChwYXJzZUludChwcm92aWRlci5vYXV0aC52ZXJzaW9uLCAxMCkgPT09IDEpIHsKCgkJCS8vIFR1cm4gdGhlIHJlcXVlc3QgdG8gdGhlIE9BdXRoIFByb3h5IGZvciAzLWxlZ2dlZCBhdXRoCgkJCXVybCA9IHV0aWxzLnFzKG9wdHMub2F1dGhfcHJveHksIHAucXMsIGVuY29kZUZ1bmN0aW9uKTsKCQl9CgoJCS8vIFJlZnJlc2ggdG9rZW4KCQllbHNlIGlmIChvcHRzLmRpc3BsYXkgPT09ICdub25lJyAmJiBwcm92aWRlci5vYXV0aC5ncmFudCAmJiBzZXNzaW9uICYmIHNlc3Npb24ucmVmcmVzaF90b2tlbikgewoKCQkJLy8gQWRkIHRoZSByZWZyZXNoX3Rva2VuIHRvIHRoZSByZXF1ZXN0CgkJCXAucXMucmVmcmVzaF90b2tlbiA9IHNlc3Npb24ucmVmcmVzaF90b2tlbjsKCgkJCS8vIERlZmluZSB0aGUgcmVxdWVzdCBwYXRoCgkJCXVybCA9IHV0aWxzLnFzKG9wdHMub2F1dGhfcHJveHksIHAucXMsIGVuY29kZUZ1bmN0aW9uKTsKCQl9CgkJZWxzZSB7CgkJCXVybCA9IHV0aWxzLnFzKHByb3ZpZGVyLm9hdXRoLmF1dGgsIHAucXMsIGVuY29kZUZ1bmN0aW9uKTsKCQl9CgoJCS8vIEJyb2FkY2FzdCB0aGlzIGV2ZW50IGFzIGFuIGF1dGg6aW5pdAoJCWVtaXQoJ2F1dGguaW5pdCcsIHApOwoKCQkvLyBFeGVjdXRlCgkJLy8gVHJpZ2dlciBob3cgd2Ugd2FudCBzZWxmIGRpc3BsYXllZAoJCWlmIChvcHRzLmRpc3BsYXkgPT09ICdub25lJykgewoJCQkvLyBTaWduLWluIGluIHRoZSBiYWNrZ3JvdW5kLCBpZnJhbWUKCQkJdXRpbHMuaWZyYW1lKHVybCwgcmVkaXJlY3RVcmkpOwoJCX0KCgkJLy8gVHJpZ2dlcmluZyBwb3B1cD8KCQllbHNlIGlmIChvcHRzLmRpc3BsYXkgPT09ICdwb3B1cCcpIHsKCgkJCXZhciBwb3B1cCA9IHV0aWxzLnBvcHVwKHVybCwgcmVkaXJlY3RVcmksIG9wdHMucG9wdXApOwoKCQkJdmFyIHRpbWVyID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CgkJCQlpZiAoIXBvcHVwIHx8IHBvcHVwLmNsb3NlZCkgewoJCQkJCWNsZWFySW50ZXJ2YWwodGltZXIpOwoJCQkJCWlmICghcHJvbWlzZS5zdGF0ZSkgewoKCQkJCQkJdmFyIHJlc3BvbnNlID0gZXJyb3IoJ2NhbmNlbGxlZCcsICdMb2dpbiBoYXMgYmVlbiBjYW5jZWxsZWQnKTsKCgkJCQkJCWlmICghcG9wdXApIHsKCQkJCQkJCXJlc3BvbnNlID0gZXJyb3IoJ2Jsb2NrZWQnLCAnUG9wdXAgd2FzIGJsb2NrZWQnKTsKCQkJCQkJfQoKCQkJCQkJcmVzcG9uc2UubmV0d29yayA9IHAubmV0d29yazsKCgkJCQkJCXByb21pc2UucmVqZWN0KHJlc3BvbnNlKTsKCQkJCQl9CgkJCQl9CgkJCX0sIDEwMCk7CgkJfQoKCQllbHNlIHsKCQkJd2luZG93LmxvY2F0aW9uID0gdXJsOwoJCX0KCgkJcmV0dXJuIHByb21pc2UucHJveHk7CgoJCWZ1bmN0aW9uIGVuY29kZUZ1bmN0aW9uKHMpIHtyZXR1cm4gczt9CgoJCWZ1bmN0aW9uIGZpbHRlckVtcHR5KHMpIHtyZXR1cm4gISFzO30KCX0sCgoJLy8gUmVtb3ZlIGFueSBkYXRhIGFzc29jaWF0ZWQgd2l0aCBhIGdpdmVuIHNlcnZpY2UKCS8vIEBwYXJhbSBzdHJpbmcgbmFtZSBvZiB0aGUgc2VydmljZQoJLy8gQHBhcmFtIGZ1bmN0aW9uIGNhbGxiYWNrCglsb2dvdXQ6IGZ1bmN0aW9uKCkgewoKCQl2YXIgX3RoaXMgPSB0aGlzOwoJCXZhciB1dGlscyA9IF90aGlzLnV0aWxzOwoJCXZhciBlcnJvciA9IHV0aWxzLmVycm9yOwoKCQkvLyBDcmVhdGUgYSBuZXcgcHJvbWlzZQoJCXZhciBwcm9taXNlID0gdXRpbHMuUHJvbWlzZSgpOwoKCQl2YXIgcCA9IHV0aWxzLmFyZ3Moe25hbWU6J3MnLCBvcHRpb25zOiAnbycsIGNhbGxiYWNrOiAnZid9LCBhcmd1bWVudHMpOwoKCQlwLm9wdGlvbnMgPSBwLm9wdGlvbnMgfHwge307CgoJCS8vIEFkZCBjYWxsYmFjayB0byBldmVudHMKCQlwcm9taXNlLnByb3h5LnRoZW4ocC5jYWxsYmFjaywgcC5jYWxsYmFjayk7CgoJCS8vIFRyaWdnZXIgYW4gZXZlbnQgb24gdGhlIGdsb2JhbCBsaXN0ZW5lcgoJCWZ1bmN0aW9uIGVtaXQocywgdmFsdWUpIHsKCQkJaGVsbG8uZW1pdChzLCB2YWx1ZSk7CgkJfQoKCQlwcm9taXNlLnByb3h5LnRoZW4oZW1pdC5iaW5kKHRoaXMsICdhdXRoLmxvZ291dCBhdXRoJyksIGVtaXQuYmluZCh0aGlzLCAnZXJyb3InKSk7CgoJCS8vIE5ldHdvcmsKCQlwLm5hbWUgPSBwLm5hbWUgfHwgdGhpcy5zZXR0aW5ncy5kZWZhdWx0X3NlcnZpY2U7CgkJcC5hdXRoUmVzcG9uc2UgPSB1dGlscy5zdG9yZShwLm5hbWUpOwoKCQlpZiAocC5uYW1lICYmICEocC5uYW1lIGluIF90aGlzLnNlcnZpY2VzKSkgewoKCQkJcHJvbWlzZS5yZWplY3QoZXJyb3IoJ2ludmFsaWRfbmV0d29yaycsICdUaGUgbmV0d29yayB3YXMgdW5yZWNvZ25pemVkJykpOwoKCQl9CgkJZWxzZSBpZiAocC5uYW1lICYmIHAuYXV0aFJlc3BvbnNlKSB7CgoJCQkvLyBEZWZpbmUgdGhlIGNhbGxiYWNrCgkJCXZhciBjYWxsYmFjayA9IGZ1bmN0aW9uKG9wdHMpIHsKCgkJCQkvLyBSZW1vdmUgZnJvbSB0aGUgc3RvcmUKCQkJCXV0aWxzLnN0b3JlKHAubmFtZSwgbnVsbCk7CgoJCQkJLy8gRW1pdCBldmVudHMgYnkgZGVmYXVsdAoJCQkJcHJvbWlzZS5mdWxmaWxsKGhlbGxvLnV0aWxzLm1lcmdlKHtuZXR3b3JrOnAubmFtZX0sIG9wdHMgfHwge30pKTsKCQkJfTsKCgkJCS8vIFJ1biBhbiBhc3luYyBvcGVyYXRpb24gdG8gcmVtb3ZlIHRoZSB1c2VycyBzZXNzaW9uCgkJCXZhciBfb3B0cyA9IHt9OwoJCQlpZiAocC5vcHRpb25zLmZvcmNlKSB7CgkJCQl2YXIgbG9nb3V0ID0gX3RoaXMuc2VydmljZXNbcC5uYW1lXS5sb2dvdXQ7CgkJCQlpZiAobG9nb3V0KSB7CgkJCQkJLy8gQ29udmVydCBsb2dvdXQgdG8gVVJMIHN0cmluZywKCQkJCQkvLyBJZiBubyBzdHJpbmcgaXMgcmV0dXJuZWQsIHRoZW4gdGhpcyBmdW5jdGlvbiB3aWxsIGhhbmRsZSB0aGUgbG9nb3V0IGFzeW5jIHN0eWxlCgkJCQkJaWYgKHR5cGVvZiAobG9nb3V0KSA9PT0gJ2Z1bmN0aW9uJykgewoJCQkJCQlsb2dvdXQgPSBsb2dvdXQoY2FsbGJhY2ssIHApOwoJCQkJCX0KCgkJCQkJLy8gSWYgbG9nb3V0IGlzIGEgc3RyaW5nIHRoZW4gYXNzdW1lIFVSTCBhbmQgb3BlbiBpbiBpZnJhbWUuCgkJCQkJaWYgKHR5cGVvZiAobG9nb3V0KSA9PT0gJ3N0cmluZycpIHsKCQkJCQkJdXRpbHMuaWZyYW1lKGxvZ291dCk7CgkJCQkJCV9vcHRzLmZvcmNlID0gbnVsbDsKCQkJCQkJX29wdHMubWVzc2FnZSA9ICdMb2dvdXQgc3VjY2VzcyBvbiBwcm92aWRlcnMgc2l0ZSB3YXMgaW5kZXRlcm1pbmF0ZSc7CgkJCQkJfQoJCQkJCWVsc2UgaWYgKGxvZ291dCA9PT0gdW5kZWZpbmVkKSB7CgkJCQkJCS8vIFRoZSBjYWxsYmFjayBmdW5jdGlvbiB3aWxsIGhhbmRsZSB0aGUgcmVzcG9uc2UuCgkJCQkJCXJldHVybiBwcm9taXNlLnByb3h5OwoJCQkJCX0KCQkJCX0KCQkJfQoKCQkJLy8gUmVtb3ZlIGxvY2FsIGNyZWRlbnRpYWxzCgkJCWNhbGxiYWNrKF9vcHRzKTsKCQl9CgkJZWxzZSB7CgkJCXByb21pc2UucmVqZWN0KGVycm9yKCdpbnZhbGlkX3Nlc3Npb24nLCAnVGhlcmUgd2FzIG5vIHNlc3Npb24gdG8gcmVtb3ZlJykpOwoJCX0KCgkJcmV0dXJuIHByb21pc2UucHJveHk7Cgl9LAoKCS8vIFJldHVybnMgYWxsIHRoZSBzZXNzaW9ucyB0aGF0IGFyZSBzdWJzY3JpYmVkIHRvbwoJLy8gQHBhcmFtIHN0cmluZyBvcHRpb25hbCwgbmFtZSBvZiB0aGUgc2VydmljZSB0byBnZXQgaW5mb3JtYXRpb24gYWJvdXQuCglnZXRBdXRoUmVzcG9uc2U6IGZ1bmN0aW9uKHNlcnZpY2UpIHsKCgkJLy8gSWYgdGhlIHNlcnZpY2UgZG9lc24ndCBleGlzdAoJCXNlcnZpY2UgPSBzZXJ2aWNlIHx8IHRoaXMuc2V0dGluZ3MuZGVmYXVsdF9zZXJ2aWNlOwoKCQlpZiAoIXNlcnZpY2UgfHwgIShzZXJ2aWNlIGluIHRoaXMuc2VydmljZXMpKSB7CgkJCXJldHVybiBudWxsOwoJCX0KCgkJcmV0dXJuIHRoaXMudXRpbHMuc3RvcmUoc2VydmljZSkgfHwgbnVsbDsKCX0sCgoJLy8gRXZlbnRzOiBwbGFjZWhvbGRlciBmb3IgdGhlIGV2ZW50cwoJZXZlbnRzOiB7fQp9KTsKCi8vIENvcmUgdXRpbGl0aWVzCmhlbGxvLnV0aWxzLmV4dGVuZChoZWxsby51dGlscywgewoKCS8vIEVycm9yCgllcnJvcjogZnVuY3Rpb24oY29kZSwgbWVzc2FnZSkgewoJCXJldHVybiB7CgkJCWVycm9yOiB7CgkJCQljb2RlOiBjb2RlLAoJCQkJbWVzc2FnZTogbWVzc2FnZQoJCQl9CgkJfTsKCX0sCgoJLy8gQXBwZW5kIHRoZSBxdWVyeXN0cmluZyB0byBhIHVybAoJLy8gQHBhcmFtIHN0cmluZyB1cmwKCS8vIEBwYXJhbSBvYmplY3QgcGFyYW1ldGVycwoJcXM6IGZ1bmN0aW9uKHVybCwgcGFyYW1zLCBmb3JtYXRGdW5jdGlvbikgewoKCQlpZiAocGFyYW1zKSB7CgoJCQkvLyBTZXQgZGVmYXVsdCBmb3JtYXR0aW5nIGZ1bmN0aW9uCgkJCWZvcm1hdEZ1bmN0aW9uID0gZm9ybWF0RnVuY3Rpb24gfHwgZW5jb2RlVVJJQ29tcG9uZW50OwoKCQkJLy8gT3ZlcnJpZGUgdGhlIGl0ZW1zIGluIHRoZSBVUkwgd2hpY2ggYWxyZWFkeSBleGlzdAoJCQlmb3IgKHZhciB4IGluIHBhcmFtcykgewoJCQkJdmFyIHN0ciA9ICcoW1xcP1xcJl0pJyArIHggKyAnPVteXFwmXSonOwoJCQkJdmFyIHJlZyA9IG5ldyBSZWdFeHAoc3RyKTsKCQkJCWlmICh1cmwubWF0Y2gocmVnKSkgewoJCQkJCXVybCA9IHVybC5yZXBsYWNlKHJlZywgJyQxJyArIHggKyAnPScgKyBmb3JtYXRGdW5jdGlvbihwYXJhbXNbeF0pKTsKCQkJCQlkZWxldGUgcGFyYW1zW3hdOwoJCQkJfQoJCQl9CgkJfQoKCQlpZiAoIXRoaXMuaXNFbXB0eShwYXJhbXMpKSB7CgkJCXJldHVybiB1cmwgKyAodXJsLmluZGV4T2YoJz8nKSA+IC0xID8gJyYnIDogJz8nKSArIHRoaXMucGFyYW0ocGFyYW1zLCBmb3JtYXRGdW5jdGlvbik7CgkJfQoKCQlyZXR1cm4gdXJsOwoJfSwKCgkvLyBQYXJhbQoJLy8gRXhwbG9kZS9lbmNvZGUgdGhlIHBhcmFtZXRlcnMgb2YgYW4gVVJMIHN0cmluZy9vYmplY3QKCS8vIEBwYXJhbSBzdHJpbmcgcywgc3RyaW5nIHRvIGRlY29kZQoJcGFyYW06IGZ1bmN0aW9uKHMsIGZvcm1hdEZ1bmN0aW9uKSB7CgkJdmFyIGI7CgkJdmFyIGEgPSB7fTsKCQl2YXIgbTsKCgkJaWYgKHR5cGVvZiAocykgPT09ICdzdHJpbmcnKSB7CgoJCQlmb3JtYXRGdW5jdGlvbiA9IGZvcm1hdEZ1bmN0aW9uIHx8IGRlY29kZVVSSUNvbXBvbmVudDsKCgkJCW0gPSBzLnJlcGxhY2UoL15bXCNcP10vLCAnJykubWF0Y2goLyhbXj1cL1wmXSspPShbXlwmXSspL2cpOwoJCQlpZiAobSkgewoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBtLmxlbmd0aDsgaSsrKSB7CgkJCQkJYiA9IG1baV0ubWF0Y2goLyhbXj1dKyk9KC4qKS8pOwoJCQkJCWFbYlsxXV0gPSBmb3JtYXRGdW5jdGlvbihiWzJdKTsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuIGE7CgkJfQoJCWVsc2UgewoKCQkJZm9ybWF0RnVuY3Rpb24gPSBmb3JtYXRGdW5jdGlvbiB8fCBlbmNvZGVVUklDb21wb25lbnQ7CgoJCQl2YXIgbyA9IHM7CgoJCQlhID0gW107CgoJCQlmb3IgKHZhciB4IGluIG8pIHtpZiAoby5oYXNPd25Qcm9wZXJ0eSh4KSkgewoJCQkJaWYgKG8uaGFzT3duUHJvcGVydHkoeCkpIHsKCQkJCQlhLnB1c2goW3gsIG9beF0gPT09ICc/JyA/ICc/JyA6IGZvcm1hdEZ1bmN0aW9uKG9beF0pXS5qb2luKCc9JykpOwoJCQkJfQoJCQl9fQoKCQkJcmV0dXJuIGEuam9pbignJicpOwoJCX0KCX0sCgoJLy8gTG9jYWwgc3RvcmFnZSBmYWNhZGUKCXN0b3JlOiAoZnVuY3Rpb24oKSB7CgoJCXZhciBhID0gWydsb2NhbFN0b3JhZ2UnLCAnc2Vzc2lvblN0b3JhZ2UnXTsKCQl2YXIgaSA9IC0xOwoJCXZhciBwcmVmaXggPSAndGVzdCc7CgoJCS8vIFNldCBMb2NhbFN0b3JhZ2UKCQl2YXIgbG9jYWxTdG9yYWdlOwoKCQl3aGlsZSAoYVsrK2ldKSB7CgkJCXRyeSB7CgkJCQkvLyBJbiBDaHJvbWUgd2l0aCBjb29raWVzIGJsb2NrZWQsIGNhbGxpbmcgbG9jYWxTdG9yYWdlIHRocm93cyBhbiBlcnJvcgoJCQkJbG9jYWxTdG9yYWdlID0gd2luZG93W2FbaV1dOwoJCQkJbG9jYWxTdG9yYWdlLnNldEl0ZW0ocHJlZml4ICsgaSwgaSk7CgkJCQlsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbShwcmVmaXggKyBpKTsKCQkJCWJyZWFrOwoJCQl9CgkJCWNhdGNoIChlKSB7CgkJCQlsb2NhbFN0b3JhZ2UgPSBudWxsOwoJCQl9CgkJfQoKCQlpZiAoIWxvY2FsU3RvcmFnZSkgewoKCQkJdmFyIGNhY2hlID0gbnVsbDsKCgkJCWxvY2FsU3RvcmFnZSA9IHsKCQkJCWdldEl0ZW06IGZ1bmN0aW9uKHByb3ApIHsKCQkJCQlwcm9wID0gcHJvcCArICc9JzsKCQkJCQl2YXIgbSA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOycpOwoJCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgbS5sZW5ndGg7IGkrKykgewoJCQkJCQl2YXIgX20gPSBtW2ldLnJlcGxhY2UoLyheXHMrfFxzKyQpLywgJycpOwoJCQkJCQlpZiAoX20gJiYgX20uaW5kZXhPZihwcm9wKSA9PT0gMCkgewoJCQkJCQkJcmV0dXJuIF9tLnN1YnN0cihwcm9wLmxlbmd0aCk7CgkJCQkJCX0KCQkJCQl9CgoJCQkJCXJldHVybiBjYWNoZTsKCQkJCX0sCgoJCQkJc2V0SXRlbTogZnVuY3Rpb24ocHJvcCwgdmFsdWUpIHsKCQkJCQljYWNoZSA9IHZhbHVlOwoJCQkJCWRvY3VtZW50LmNvb2tpZSA9IHByb3AgKyAnPScgKyB2YWx1ZTsKCQkJCX0KCQkJfTsKCgkJCS8vIEZpbGwgdGhlIGNhY2hlIHVwCgkJCWNhY2hlID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2hlbGxvJyk7CgkJfQoKCQlmdW5jdGlvbiBnZXQoKSB7CgkJCXZhciBqc29uID0ge307CgkJCXRyeSB7CgkJCQlqc29uID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnaGVsbG8nKSkgfHwge307CgkJCX0KCQkJY2F0Y2ggKGUpIHt9CgoJCQlyZXR1cm4ganNvbjsKCQl9CgoJCWZ1bmN0aW9uIHNldChqc29uKSB7CgkJCWxvY2FsU3RvcmFnZS5zZXRJdGVtKCdoZWxsbycsIEpTT04uc3RyaW5naWZ5KGpzb24pKTsKCQl9CgoJCS8vIENoZWNrIGlmIHRoZSBicm93c2VyIHN1cHBvcnQgbG9jYWwgc3RvcmFnZQoJCXJldHVybiBmdW5jdGlvbihuYW1lLCB2YWx1ZSwgZGF5cykgewoKCQkJLy8gTG9jYWwgc3RvcmFnZQoJCQl2YXIganNvbiA9IGdldCgpOwoKCQkJaWYgKG5hbWUgJiYgdmFsdWUgPT09IHVuZGVmaW5lZCkgewoJCQkJcmV0dXJuIGpzb25bbmFtZV0gfHwgbnVsbDsKCQkJfQoJCQllbHNlIGlmIChuYW1lICYmIHZhbHVlID09PSBudWxsKSB7CgkJCQl0cnkgewoJCQkJCWRlbGV0ZSBqc29uW25hbWVdOwoJCQkJfQoJCQkJY2F0Y2ggKGUpIHsKCQkJCQlqc29uW25hbWVdID0gbnVsbDsKCQkJCX0KCQkJfQoJCQllbHNlIGlmIChuYW1lKSB7CgkJCQlqc29uW25hbWVdID0gdmFsdWU7CgkJCX0KCQkJZWxzZSB7CgkJCQlyZXR1cm4ganNvbjsKCQkJfQoKCQkJc2V0KGpzb24pOwoKCQkJcmV0dXJuIGpzb24gfHwgbnVsbDsKCQl9OwoKCX0pKCksCgoJLy8gQ3JlYXRlIGFuZCBBcHBlbmQgbmV3IERPTSBlbGVtZW50cwoJLy8gQHBhcmFtIG5vZGUgc3RyaW5nCgkvLyBAcGFyYW0gYXR0ciBvYmplY3QgbGl0ZXJhbAoJLy8gQHBhcmFtIGRvbS9zdHJpbmcKCWFwcGVuZDogZnVuY3Rpb24obm9kZSwgYXR0ciwgdGFyZ2V0KSB7CgoJCXZhciBuID0gdHlwZW9mIChub2RlKSA9PT0gJ3N0cmluZycgPyBkb2N1bWVudC5jcmVhdGVFbGVtZW50KG5vZGUpIDogbm9kZTsKCgkJaWYgKHR5cGVvZiAoYXR0cikgPT09ICdvYmplY3QnKSB7CgkJCWlmICgndGFnTmFtZScgaW4gYXR0cikgewoJCQkJdGFyZ2V0ID0gYXR0cjsKCQkJfQoJCQllbHNlIHsKCQkJCWZvciAodmFyIHggaW4gYXR0cikge2lmIChhdHRyLmhhc093blByb3BlcnR5KHgpKSB7CgkJCQkJaWYgKHR5cGVvZiAoYXR0clt4XSkgPT09ICdvYmplY3QnKSB7CgkJCQkJCWZvciAodmFyIHkgaW4gYXR0clt4XSkge2lmIChhdHRyW3hdLmhhc093blByb3BlcnR5KHkpKSB7CgkJCQkJCQluW3hdW3ldID0gYXR0clt4XVt5XTsKCQkJCQkJfX0KCQkJCQl9CgkJCQkJZWxzZSBpZiAoeCA9PT0gJ2h0bWwnKSB7CgkJCQkJCW4uaW5uZXJIVE1MID0gYXR0clt4XTsKCQkJCQl9CgoJCQkJCS8vIElFIGRvZXNuJ3QgbGlrZSB1cyBzZXR0aW5nIG1ldGhvZHMgd2l0aCBzZXRBdHRyaWJ1dGUKCQkJCQllbHNlIGlmICghL15vbi8udGVzdCh4KSkgewoJCQkJCQluLnNldEF0dHJpYnV0ZSh4LCBhdHRyW3hdKTsKCQkJCQl9CgkJCQkJZWxzZSB7CgkJCQkJCW5beF0gPSBhdHRyW3hdOwoJCQkJCX0KCQkJCX19CgkJCX0KCQl9CgoJCWlmICh0YXJnZXQgPT09ICdib2R5JykgewoJCQkoZnVuY3Rpb24gc2VsZigpIHsKCQkJCWlmIChkb2N1bWVudC5ib2R5KSB7CgkJCQkJZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChuKTsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCXNldFRpbWVvdXQoc2VsZiwgMTYpOwoJCQkJfQoJCQl9KSgpOwoJCX0KCQllbHNlIGlmICh0eXBlb2YgKHRhcmdldCkgPT09ICdvYmplY3QnKSB7CgkJCXRhcmdldC5hcHBlbmRDaGlsZChuKTsKCQl9CgkJZWxzZSBpZiAodHlwZW9mICh0YXJnZXQpID09PSAnc3RyaW5nJykgewoJCQlkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSh0YXJnZXQpWzBdLmFwcGVuZENoaWxkKG4pOwoJCX0KCgkJcmV0dXJuIG47Cgl9LAoKCS8vIEFuIGVhc3kgd2F5IHRvIGNyZWF0ZSBhIGhpZGRlbiBpZnJhbWUKCS8vIEBwYXJhbSBzdHJpbmcgc3JjCglpZnJhbWU6IGZ1bmN0aW9uKHNyYykgewoJCXRoaXMuYXBwZW5kKCdpZnJhbWUnLCB7c3JjOiBzcmMsIHN0eWxlOiB7cG9zaXRpb246J2Fic29sdXRlJywgbGVmdDogJy0xMDAwcHgnLCBib3R0b206IDAsIGhlaWdodDogJzFweCcsIHdpZHRoOiAnMXB4J319LCAnYm9keScpOwoJfSwKCgkvLyBSZWN1cnNpdmUgbWVyZ2UgdHdvIG9iamVjdHMgaW50byBvbmUsIHNlY29uZCBwYXJhbWV0ZXIgb3ZlcmlkZXMgdGhlIGZpcnN0CgkvLyBAcGFyYW0gYSBhcnJheQoJbWVyZ2U6IGZ1bmN0aW9uKC8qIEFyZ3M6IGEsIGIsIGMsIC4uIG4gKi8pIHsKCQl2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cyk7CgkJYXJncy51bnNoaWZ0KHt9KTsKCQlyZXR1cm4gdGhpcy5leHRlbmQuYXBwbHkobnVsbCwgYXJncyk7Cgl9LAoKCS8vIE1ha2VzIGl0IGVhc2llciB0byBhc3NpZ24gcGFyYW1ldGVycywgd2hlcmUgc29tZSBhcmUgb3B0aW9uYWwKCS8vIEBwYXJhbSBvIG9iamVjdAoJLy8gQHBhcmFtIGEgYXJndW1lbnRzCglhcmdzOiBmdW5jdGlvbihvLCBhcmdzKSB7CgoJCXZhciBwID0ge307CgkJdmFyIGkgPSAwOwoJCXZhciB0ID0gbnVsbDsKCQl2YXIgeCA9IG51bGw7CgoJCS8vICd4JyBpcyB0aGUgZmlyc3Qga2V5IGluIHRoZSBsaXN0IG9mIG9iamVjdCBwYXJhbWV0ZXJzCgkJZm9yICh4IGluIG8pIHtpZiAoby5oYXNPd25Qcm9wZXJ0eSh4KSkgewoJCQlicmVhazsKCQl9fQoKCQkvLyBQYXNzaW5nIGluIGhhc2ggb2JqZWN0IG9mIGFyZ3VtZW50cz8KCQkvLyBXaGVyZSB0aGUgZmlyc3QgYXJndW1lbnQgY2FuJ3QgYmUgYW4gb2JqZWN0CgkJaWYgKChhcmdzLmxlbmd0aCA9PT0gMSkgJiYgKHR5cGVvZiAoYXJnc1swXSkgPT09ICdvYmplY3QnKSAmJiBvW3hdICE9ICdvIScpIHsKCgkJCS8vIENvdWxkIHRoaXMgb2JqZWN0IHN0aWxsIGJlbG9uZyB0byBhIHByb3BlcnR5PwoJCQkvLyBDaGVjayB0aGUgb2JqZWN0IGtleXMgaWYgdGhleSBtYXRjaCBhbnkgb2YgdGhlIHByb3BlcnR5IGtleXMKCQkJZm9yICh4IGluIGFyZ3NbMF0pIHtpZiAoby5oYXNPd25Qcm9wZXJ0eSh4KSkgewoJCQkJLy8gRG9lcyB0aGlzIGtleSBleGlzdCBpbiB0aGUgcHJvcGVydHkgbGlzdD8KCQkJCWlmICh4IGluIG8pIHsKCQkJCQkvLyBZZXMgdGhpcyBrZXkgZG9lcyBleGlzdCBzbyBpdHMgbW9zdCBsaWtlbHkgdGhpcyBmdW5jdGlvbiBoYXMgYmVlbiBpbnZva2VkIHdpdGggYW4gb2JqZWN0IHBhcmFtZXRlcgoJCQkJCS8vIFJldHVybiBmaXJzdCBhcmd1bWVudCBhcyB0aGUgaGFzaCBvZiBhbGwgYXJndW1lbnRzCgkJCQkJcmV0dXJuIGFyZ3NbMF07CgkJCQl9CgkJCX19CgkJfQoKCQkvLyBFbHNlIGxvb3AgdGhyb3VnaCBhbmQgYWNjb3VudCBmb3IgdGhlIG1pc3Npbmcgb25lcy4KCQlmb3IgKHggaW4gbykge2lmIChvLmhhc093blByb3BlcnR5KHgpKSB7CgoJCQl0ID0gdHlwZW9mIChhcmdzW2ldKTsKCgkJCWlmICgodHlwZW9mIChvW3hdKSA9PT0gJ2Z1bmN0aW9uJyAmJiBvW3hdLnRlc3QoYXJnc1tpXSkpIHx8ICh0eXBlb2YgKG9beF0pID09PSAnc3RyaW5nJyAmJiAoCgkJCShvW3hdLmluZGV4T2YoJ3MnKSA+IC0xICYmIHQgPT09ICdzdHJpbmcnKSB8fAoJCQkob1t4XS5pbmRleE9mKCdvJykgPiAtMSAmJiB0ID09PSAnb2JqZWN0JykgfHwKCQkJKG9beF0uaW5kZXhPZignaScpID4gLTEgJiYgdCA9PT0gJ251bWJlcicpIHx8CgkJCShvW3hdLmluZGV4T2YoJ2EnKSA+IC0xICYmIHQgPT09ICdvYmplY3QnKSB8fAoJCQkob1t4XS5pbmRleE9mKCdmJykgPiAtMSAmJiB0ID09PSAnZnVuY3Rpb24nKQoJCQkpKQoJCQkpIHsKCQkJCXBbeF0gPSBhcmdzW2krK107CgkJCX0KCgkJCWVsc2UgaWYgKHR5cGVvZiAob1t4XSkgPT09ICdzdHJpbmcnICYmIG9beF0uaW5kZXhPZignIScpID4gLTEpIHsKCQkJCXJldHVybiBmYWxzZTsKCQkJfQoJCX19CgoJCXJldHVybiBwOwoJfSwKCgkvLyBSZXR1cm5zIGEgVVJMIGluc3RhbmNlCgl1cmw6IGZ1bmN0aW9uKHBhdGgpIHsKCgkJLy8gSWYgdGhlIHBhdGggaXMgZW1wdHkKCQlpZiAoIXBhdGgpIHsKCQkJcmV0dXJuIHdpbmRvdy5sb2NhdGlvbjsKCQl9CgoJCS8vIENocm9tZSBhbmQgRmlyZUZveCBzdXBwb3J0IG5ldyBVUkwoKSB0byBleHRyYWN0IFVSTCBvYmplY3RzCgkJZWxzZSBpZiAod2luZG93LlVSTCAmJiBVUkwgaW5zdGFuY2VvZiBGdW5jdGlvbiAmJiBVUkwubGVuZ3RoICE9PSAwKSB7CgkJCXJldHVybiBuZXcgVVJMKHBhdGgsIHdpbmRvdy5sb2NhdGlvbik7CgkJfQoKCQkvLyBVZ2x5IHNoaW0sIGl0IHdvcmtzIQoJCWVsc2UgewoJCQl2YXIgYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTsKCQkJYS5ocmVmID0gcGF0aDsKCQkJcmV0dXJuIGEuY2xvbmVOb2RlKGZhbHNlKTsKCQl9Cgl9LAoKCWRpZmY6IGZ1bmN0aW9uKGEsIGIpIHsKCQlyZXR1cm4gYi5maWx0ZXIoZnVuY3Rpb24oaXRlbSkgewoJCQlyZXR1cm4gYS5pbmRleE9mKGl0ZW0pID09PSAtMTsKCQl9KTsKCX0sCgoJLy8gR2V0IHRoZSBkaWZmZXJlbnQgaGFzaCBvZiBwcm9wZXJ0aWVzIHVuaXF1ZSB0byBgYWAsIGFuZCBub3QgaW4gYGJgCglkaWZmS2V5OiBmdW5jdGlvbihhLCBiKSB7CgkJaWYgKGEgfHwgIWIpIHsKCQkJdmFyIHIgPSB7fTsKCQkJZm9yICh2YXIgeCBpbiBhKSB7CgkJCQkvLyBEb2VzIHRoZSBwcm9wZXJ0eSBub3QgZXhpc3Q/CgkJCQlpZiAoISh4IGluIGIpKSB7CgkJCQkJclt4XSA9IGFbeF07CgkJCQl9CgkJCX0KCgkJCXJldHVybiByOwoJCX0KCgkJcmV0dXJuIGE7Cgl9LAoKCS8vIFVuaXF1ZQoJLy8gUmVtb3ZlIGR1cGxpY2F0ZSBhbmQgbnVsbCB2YWx1ZXMgZnJvbSBhbiBhcnJheQoJLy8gQHBhcmFtIGEgYXJyYXkKCXVuaXF1ZTogZnVuY3Rpb24oYSkgewoJCWlmICghQXJyYXkuaXNBcnJheShhKSkgeyByZXR1cm4gW107IH0KCgkJcmV0dXJuIGEuZmlsdGVyKGZ1bmN0aW9uKGl0ZW0sIGluZGV4KSB7CgkJCS8vIElzIHRoaXMgdGhlIGZpcnN0IGxvY2F0aW9uIG9mIGl0ZW0KCQkJcmV0dXJuIGEuaW5kZXhPZihpdGVtKSA9PT0gaW5kZXg7CgkJfSk7Cgl9LAoKCWlzRW1wdHk6IGZ1bmN0aW9uKG9iaikgewoKCQkvLyBTY2FsYXIKCQlpZiAoIW9iaikKCQkJcmV0dXJuIHRydWU7CgoJCS8vIEFycmF5CgkJaWYgKEFycmF5LmlzQXJyYXkob2JqKSkgewoJCQlyZXR1cm4gIW9iai5sZW5ndGg7CgkJfQoJCWVsc2UgaWYgKHR5cGVvZiAob2JqKSA9PT0gJ29iamVjdCcpIHsKCQkJLy8gT2JqZWN0CgkJCWZvciAodmFyIGtleSBpbiBvYmopIHsKCQkJCWlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkgewoJCQkJCXJldHVybiBmYWxzZTsKCQkJCX0KCQkJfQoJCX0KCgkJcmV0dXJuIHRydWU7Cgl9LAoKCS8vanNjczpkaXNhYmxlCgoJLyohCgkgKiogIFRoZW5hYmxlIC0tIEVtYmVkZGFibGUgTWluaW11bSBTdHJpY3RseS1Db21wbGlhbnQgUHJvbWlzZXMvQSsgMS4xLjEgVGhlbmFibGUKCSAqKiAgQ29weXJpZ2h0IChjKSAyMDEzLTIwMTQgUmFsZiBTLiBFbmdlbHNjaGFsbCA8aHR0cDovL2VuZ2Vsc2NoYWxsLmNvbT4KCSAqKiAgTGljZW5zZWQgdW5kZXIgVGhlIE1JVCBMaWNlbnNlIDxodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUPgoJICoqICBTb3VyY2UtQ29kZSBkaXN0cmlidXRlZCBvbiA8aHR0cDovL2dpdGh1Yi5jb20vcnNlL3RoZW5hYmxlPgoJICovCglQcm9taXNlOiAoZnVuY3Rpb24oKXsKCQkvKiAgcHJvbWlzZSBzdGF0ZXMgW1Byb21pc2VzL0ErIDIuMV0gICovCgkJdmFyIFNUQVRFX1BFTkRJTkcgICA9IDA7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiAgW1Byb21pc2VzL0ErIDIuMS4xXSAgKi8KCQl2YXIgU1RBVEVfRlVMRklMTEVEID0gMTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qICBbUHJvbWlzZXMvQSsgMi4xLjJdICAqLwoJCXZhciBTVEFURV9SRUpFQ1RFRCAgPSAyOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogIFtQcm9taXNlcy9BKyAyLjEuM10gICovCgoJCS8qICBwcm9taXNlIG9iamVjdCBjb25zdHJ1Y3RvciAgKi8KCQl2YXIgYXBpID0gZnVuY3Rpb24gKGV4ZWN1dG9yKSB7CgkJCS8qICBvcHRpb25hbGx5IHN1cHBvcnQgbm9uLWNvbnN0cnVjdG9yL3BsYWluLWZ1bmN0aW9uIGNhbGwgICovCgkJCWlmICghKHRoaXMgaW5zdGFuY2VvZiBhcGkpKQoJCQkJcmV0dXJuIG5ldyBhcGkoZXhlY3V0b3IpOwoKCQkJLyogIGluaXRpYWxpemUgb2JqZWN0ICAqLwoJCQl0aGlzLmlkICAgICAgICAgICA9ICJUaGVuYWJsZS8xLjAuNiI7CgkJCXRoaXMuc3RhdGUgICAgICAgID0gU1RBVEVfUEVORElORzsgLyogIGluaXRpYWwgc3RhdGUgICovCgkJCXRoaXMuZnVsZmlsbFZhbHVlID0gdW5kZWZpbmVkOyAgICAgLyogIGluaXRpYWwgdmFsdWUgICovICAgICAvKiAgW1Byb21pc2VzL0ErIDEuMywgMi4xLjIuMl0gICovCgkJCXRoaXMucmVqZWN0UmVhc29uID0gdW5kZWZpbmVkOyAgICAgLyogIGluaXRpYWwgcmVhc29uICovICAgICAvKiAgW1Byb21pc2VzL0ErIDEuNSwgMi4xLjMuMl0gICovCgkJCXRoaXMub25GdWxmaWxsZWQgID0gW107ICAgICAgICAgICAgLyogIGluaXRpYWwgaGFuZGxlcnMgICovCgkJCXRoaXMub25SZWplY3RlZCAgID0gW107ICAgICAgICAgICAgLyogIGluaXRpYWwgaGFuZGxlcnMgICovCgoJCQkvKiAgcHJvdmlkZSBvcHRpb25hbCBpbmZvcm1hdGlvbi1oaWRpbmcgcHJveHkgICovCgkJCXRoaXMucHJveHkgPSB7CgkJCQl0aGVuOiB0aGlzLnRoZW4uYmluZCh0aGlzKQoJCQl9OwoKCQkJLyogIHN1cHBvcnQgb3B0aW9uYWwgZXhlY3V0b3IgZnVuY3Rpb24gICovCgkJCWlmICh0eXBlb2YgZXhlY3V0b3IgPT09ICJmdW5jdGlvbiIpCgkJCQlleGVjdXRvci5jYWxsKHRoaXMsIHRoaXMuZnVsZmlsbC5iaW5kKHRoaXMpLCB0aGlzLnJlamVjdC5iaW5kKHRoaXMpKTsKCQl9OwoKCQkvKiAgcHJvbWlzZSBBUEkgbWV0aG9kcyAgKi8KCQlhcGkucHJvdG90eXBlID0gewoJCQkvKiAgcHJvbWlzZSByZXNvbHZpbmcgbWV0aG9kcyAgKi8KCQkJZnVsZmlsbDogZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiBkZWxpdmVyKHRoaXMsIFNUQVRFX0ZVTEZJTExFRCwgImZ1bGZpbGxWYWx1ZSIsIHZhbHVlKTsgfSwKCQkJcmVqZWN0OiAgZnVuY3Rpb24gKHZhbHVlKSB7IHJldHVybiBkZWxpdmVyKHRoaXMsIFNUQVRFX1JFSkVDVEVELCAgInJlamVjdFJlYXNvbiIsIHZhbHVlKTsgfSwKCgkJCS8qICAiVGhlIHRoZW4gTWV0aG9kIiBbUHJvbWlzZXMvQSsgMS4xLCAxLjIsIDIuMl0gICovCgkJCXRoZW46IGZ1bmN0aW9uIChvbkZ1bGZpbGxlZCwgb25SZWplY3RlZCkgewoJCQkJdmFyIGN1cnIgPSB0aGlzOwoJCQkJdmFyIG5leHQgPSBuZXcgYXBpKCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogIFtQcm9taXNlcy9BKyAyLjIuN10gICovCgkJCQljdXJyLm9uRnVsZmlsbGVkLnB1c2goCgkJCQkJcmVzb2x2ZXIob25GdWxmaWxsZWQsIG5leHQsICJmdWxmaWxsIikpOyAgICAgICAgICAgICAvKiAgW1Byb21pc2VzL0ErIDIuMi4yLzIuMi42XSAgKi8KCQkJCWN1cnIub25SZWplY3RlZC5wdXNoKAoJCQkJCXJlc29sdmVyKG9uUmVqZWN0ZWQsICBuZXh0LCAicmVqZWN0IiApKTsgICAgICAgICAgICAgLyogIFtQcm9taXNlcy9BKyAyLjIuMy8yLjIuNl0gICovCgkJCQlleGVjdXRlKGN1cnIpOwoJCQkJcmV0dXJuIG5leHQucHJveHk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogIFtQcm9taXNlcy9BKyAyLjIuNywgMy4zXSAgKi8KCQkJfQoJCX07CgoJCS8qICBkZWxpdmVyIGFuIGFjdGlvbiAgKi8KCQl2YXIgZGVsaXZlciA9IGZ1bmN0aW9uIChjdXJyLCBzdGF0ZSwgbmFtZSwgdmFsdWUpIHsKCQkJaWYgKGN1cnIuc3RhdGUgPT09IFNUQVRFX1BFTkRJTkcpIHsKCQkJCWN1cnIuc3RhdGUgPSBzdGF0ZTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qICBbUHJvbWlzZXMvQSsgMi4xLjIuMSwgMi4xLjMuMV0gICovCgkJCQljdXJyW25hbWVdID0gdmFsdWU7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiAgW1Byb21pc2VzL0ErIDIuMS4yLjIsIDIuMS4zLjJdICAqLwoJCQkJZXhlY3V0ZShjdXJyKTsKCQkJfQoJCQlyZXR1cm4gY3VycjsKCQl9OwoKCQkvKiAgZXhlY3V0ZSBhbGwgaGFuZGxlcnMgICovCgkJdmFyIGV4ZWN1dGUgPSBmdW5jdGlvbiAoY3VycikgewoJCQlpZiAoY3Vyci5zdGF0ZSA9PT0gU1RBVEVfRlVMRklMTEVEKQoJCQkJZXhlY3V0ZV9oYW5kbGVycyhjdXJyLCAib25GdWxmaWxsZWQiLCBjdXJyLmZ1bGZpbGxWYWx1ZSk7CgkJCWVsc2UgaWYgKGN1cnIuc3RhdGUgPT09IFNUQVRFX1JFSkVDVEVEKQoJCQkJZXhlY3V0ZV9oYW5kbGVycyhjdXJyLCAib25SZWplY3RlZCIsICBjdXJyLnJlamVjdFJlYXNvbik7CgkJfTsKCgkJLyogIGV4ZWN1dGUgcGFydGljdWxhciBzZXQgb2YgaGFuZGxlcnMgICovCgkJdmFyIGV4ZWN1dGVfaGFuZGxlcnMgPSBmdW5jdGlvbiAoY3VyciwgbmFtZSwgdmFsdWUpIHsKCQkJLyogZ2xvYmFsIHByb2Nlc3M6IHRydWUgKi8KCQkJLyogZ2xvYmFsIHNldEltbWVkaWF0ZTogdHJ1ZSAqLwoJCQkvKiBnbG9iYWwgc2V0VGltZW91dDogdHJ1ZSAqLwoKCQkJLyogIHNob3J0LWNpcmN1aXQgcHJvY2Vzc2luZyAgKi8KCQkJaWYgKGN1cnJbbmFtZV0ubGVuZ3RoID09PSAwKQoJCQkJcmV0dXJuOwoKCQkJLyogIGl0ZXJhdGUgb3ZlciBhbGwgaGFuZGxlcnMsIGV4YWN0bHkgb25jZSAgKi8KCQkJdmFyIGhhbmRsZXJzID0gY3VycltuYW1lXTsKCQkJY3VycltuYW1lXSA9IFtdOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qICBbUHJvbWlzZXMvQSsgMi4yLjIuMywgMi4yLjMuM10gICovCgkJCXZhciBmdW5jID0gZnVuY3Rpb24gKCkgewoJCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBoYW5kbGVycy5sZW5ndGg7IGkrKykKCQkJCQloYW5kbGVyc1tpXSh2YWx1ZSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qICBbUHJvbWlzZXMvQSsgMi4yLjVdICAqLwoJCQl9OwoKCQkJLyogIGV4ZWN1dGUgcHJvY2VkdXJlIGFzeW5jaHJvbm91c2x5ICAqLyAgICAgICAgICAgICAgICAgICAgIC8qICBbUHJvbWlzZXMvQSsgMi4yLjQsIDMuMV0gICovCgkJCWlmICh0eXBlb2YgcHJvY2VzcyA9PT0gIm9iamVjdCIgJiYgdHlwZW9mIHByb2Nlc3MubmV4dFRpY2sgPT09ICJmdW5jdGlvbiIpCgkJCQlwcm9jZXNzLm5leHRUaWNrKGZ1bmMpOwoJCQllbHNlIGlmICh0eXBlb2Ygc2V0SW1tZWRpYXRlID09PSAiZnVuY3Rpb24iKQoJCQkJc2V0SW1tZWRpYXRlKGZ1bmMpOwoJCQllbHNlCgkJCQlzZXRUaW1lb3V0KGZ1bmMsIDApOwoJCX07CgoJCS8qICBnZW5lcmF0ZSBhIHJlc29sdmVyIGZ1bmN0aW9uICAqLwoJCXZhciByZXNvbHZlciA9IGZ1bmN0aW9uIChjYiwgbmV4dCwgbWV0aG9kKSB7CgkJCXJldHVybiBmdW5jdGlvbiAodmFsdWUpIHsKCQkJCWlmICh0eXBlb2YgY2IgIT09ICJmdW5jdGlvbiIpICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qICBbUHJvbWlzZXMvQSsgMi4yLjEsIDIuMi43LjMsIDIuMi43LjRdICAqLwoJCQkJCW5leHRbbWV0aG9kXS5jYWxsKG5leHQsIHZhbHVlKTsgICAgICAgICAgICAgICAgICAgICAgLyogIFtQcm9taXNlcy9BKyAyLjIuNy4zLCAyLjIuNy40XSAgKi8KCQkJCWVsc2UgewoJCQkJCXZhciByZXN1bHQ7CgkJCQkJdHJ5IHsgcmVzdWx0ID0gY2IodmFsdWUpOyB9ICAgICAgICAgICAgICAgICAgICAgICAgICAvKiAgW1Byb21pc2VzL0ErIDIuMi4yLjEsIDIuMi4zLjEsIDIuMi41LCAzLjJdICAqLwoJCQkJCWNhdGNoIChlKSB7CgkJCQkJCW5leHQucmVqZWN0KGUpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiAgW1Byb21pc2VzL0ErIDIuMi43LjJdICAqLwoJCQkJCQlyZXR1cm47CgkJCQkJfQoJCQkJCXJlc29sdmUobmV4dCwgcmVzdWx0KTsgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogIFtQcm9taXNlcy9BKyAyLjIuNy4xXSAgKi8KCQkJCX0KCQkJfTsKCQl9OwoKCQkvKiAgIlByb21pc2UgUmVzb2x1dGlvbiBQcm9jZWR1cmUiICAqLyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qICBbUHJvbWlzZXMvQSsgMi4zXSAgKi8KCQl2YXIgcmVzb2x2ZSA9IGZ1bmN0aW9uIChwcm9taXNlLCB4KSB7CgkJCS8qICBzYW5pdHkgY2hlY2sgYXJndW1lbnRzICAqLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiAgW1Byb21pc2VzL0ErIDIuMy4xXSAgKi8KCQkJaWYgKHByb21pc2UgPT09IHggfHwgcHJvbWlzZS5wcm94eSA9PT0geCkgewoJCQkJcHJvbWlzZS5yZWplY3QobmV3IFR5cGVFcnJvcigiY2Fubm90IHJlc29sdmUgcHJvbWlzZSB3aXRoIGl0c2VsZiIpKTsKCQkJCXJldHVybjsKCQkJfQoKCQkJLyogIHN1cmdpY2FsbHkgY2hlY2sgZm9yIGEgInRoZW4iIG1ldGhvZAoJCQkJKG1haW5seSB0byBqdXN0IGNhbGwgdGhlICJnZXR0ZXIiIG9mICJ0aGVuIiBvbmx5IG9uY2UpICAqLwoJCQl2YXIgdGhlbjsKCQkJaWYgKCh0eXBlb2YgeCA9PT0gIm9iamVjdCIgJiYgeCAhPT0gbnVsbCkgfHwgdHlwZW9mIHggPT09ICJmdW5jdGlvbiIpIHsKCQkJCXRyeSB7IHRoZW4gPSB4LnRoZW47IH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qICBbUHJvbWlzZXMvQSsgMi4zLjMuMSwgMy41XSAgKi8KCQkJCWNhdGNoIChlKSB7CgkJCQkJcHJvbWlzZS5yZWplY3QoZSk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiAgW1Byb21pc2VzL0ErIDIuMy4zLjJdICAqLwoJCQkJCXJldHVybjsKCQkJCX0KCQkJfQoKCQkJLyogIGhhbmRsZSBvd24gVGhlbmFibGVzICAgIFtQcm9taXNlcy9BKyAyLjMuMl0KCQkJCWFuZCBzaW1pbGFyICJ0aGVuYWJsZXMiIFtQcm9taXNlcy9BKyAyLjMuM10gICovCgkJCWlmICh0eXBlb2YgdGhlbiA9PT0gImZ1bmN0aW9uIikgewoJCQkJdmFyIHJlc29sdmVkID0gZmFsc2U7CgkJCQl0cnkgewoJCQkJCS8qICBjYWxsIHJldHJpZXZlZCAidGhlbiIgbWV0aG9kICovICAgICAgICAgICAgICAgICAgLyogIFtQcm9taXNlcy9BKyAyLjMuMy4zXSAgKi8KCQkJCQl0aGVuLmNhbGwoeCwKCQkJCQkJLyogIHJlc29sdmVQcm9taXNlICAqLyAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qICBbUHJvbWlzZXMvQSsgMi4zLjMuMy4xXSAgKi8KCQkJCQkJZnVuY3Rpb24gKHkpIHsKCQkJCQkJCWlmIChyZXNvbHZlZCkgcmV0dXJuOyByZXNvbHZlZCA9IHRydWU7ICAgICAgIC8qICBbUHJvbWlzZXMvQSsgMi4zLjMuMy4zXSAgKi8KCQkJCQkJCWlmICh5ID09PSB4KSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qICBbUHJvbWlzZXMvQSsgMy42XSAgKi8KCQkJCQkJCQlwcm9taXNlLnJlamVjdChuZXcgVHlwZUVycm9yKCJjaXJjdWxhciB0aGVuYWJsZSBjaGFpbiIpKTsKCQkJCQkJCWVsc2UKCQkJCQkJCQlyZXNvbHZlKHByb21pc2UsIHkpOwoJCQkJCQl9LAoKCQkJCQkJLyogIHJlamVjdFByb21pc2UgICovICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8qICBbUHJvbWlzZXMvQSsgMi4zLjMuMy4yXSAgKi8KCQkJCQkJZnVuY3Rpb24gKHIpIHsKCQkJCQkJCWlmIChyZXNvbHZlZCkgcmV0dXJuOyByZXNvbHZlZCA9IHRydWU7ICAgICAgIC8qICBbUHJvbWlzZXMvQSsgMi4zLjMuMy4zXSAgKi8KCQkJCQkJCXByb21pc2UucmVqZWN0KHIpOwoJCQkJCQl9CgkJCQkJKTsKCQkJCX0KCQkJCWNhdGNoIChlKSB7CgkJCQkJaWYgKCFyZXNvbHZlZCkgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiAgW1Byb21pc2VzL0ErIDIuMy4zLjMuM10gICovCgkJCQkJCXByb21pc2UucmVqZWN0KGUpOyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvKiAgW1Byb21pc2VzL0ErIDIuMy4zLjMuNF0gICovCgkJCQl9CgkJCQlyZXR1cm47CgkJCX0KCgkJCS8qICBoYW5kbGUgb3RoZXIgdmFsdWVzICAqLwoJCQlwcm9taXNlLmZ1bGZpbGwoeCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLyogIFtQcm9taXNlcy9BKyAyLjMuNCwgMi4zLjMuNF0gICovCgkJfTsKCgkJLyogIGV4cG9ydCBBUEkgICovCgkJcmV0dXJuIGFwaTsKCX0pKCksCgoJLy9qc2NzOmVuYWJsZQoKCS8vIEV2ZW50CgkvLyBBIGNvbnRydWN0b3Igc3VwZXJjbGFzcyBmb3IgYWRkaW5nIGV2ZW50IG1lbnRob2RzLCBvbiwgb2ZmLCBlbWl0LgoJRXZlbnQ6IGZ1bmN0aW9uKCkgewoKCQl2YXIgc2VwYXJhdG9yID0gL1tcc1wsXSsvOwoKCQkvLyBJZiB0aGlzIGRvZXNuJ3Qgc3VwcG9ydCBnZXRQcm90b3R5cGUgdGhlbiB3ZSBjYW4ndCBnZXQgcHJvdG90eXBlLmV2ZW50cyBvZiB0aGUgcGFyZW50CgkJLy8gU28gbGV0cyBnZXQgdGhlIGN1cnJlbnQgaW5zdGFuY2UgZXZlbnRzLCBhbmQgYWRkIHRob3NlIHRvIGEgcGFyZW50IHByb3BlcnR5CgkJdGhpcy5wYXJlbnQgPSB7CgkJCWV2ZW50czogdGhpcy5ldmVudHMsCgkJCWZpbmRFdmVudHM6IHRoaXMuZmluZEV2ZW50cywKCQkJcGFyZW50OiB0aGlzLnBhcmVudCwKCQkJdXRpbHM6IHRoaXMudXRpbHMKCQl9OwoKCQl0aGlzLmV2ZW50cyA9IHt9OwoKCQkvLyBPbiwgc3Vic2NyaWJlIHRvIGV2ZW50cwoJCS8vIEBwYXJhbSBldnQgICBzdHJpbmcKCQkvLyBAcGFyYW0gY2FsbGJhY2sgIGZ1bmN0aW9uCgkJdGhpcy5vbiA9IGZ1bmN0aW9uKGV2dCwgY2FsbGJhY2spIHsKCgkJCWlmIChjYWxsYmFjayAmJiB0eXBlb2YgKGNhbGxiYWNrKSA9PT0gJ2Z1bmN0aW9uJykgewoJCQkJdmFyIGEgPSBldnQuc3BsaXQoc2VwYXJhdG9yKTsKCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgYS5sZW5ndGg7IGkrKykgewoKCQkJCQkvLyBIYXMgdGhpcyBldmVudCBhbHJlYWR5IGJlZW4gZmlyZWQgb24gdGhpcyBpbnN0YW5jZT8KCQkJCQl0aGlzLmV2ZW50c1thW2ldXSA9IFtjYWxsYmFja10uY29uY2F0KHRoaXMuZXZlbnRzW2FbaV1dIHx8IFtdKTsKCQkJCX0KCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgkJfTsKCgkJLy8gT2ZmLCB1bnN1YnNjcmliZSB0byBldmVudHMKCQkvLyBAcGFyYW0gZXZ0ICAgc3RyaW5nCgkJLy8gQHBhcmFtIGNhbGxiYWNrICBmdW5jdGlvbgoJCXRoaXMub2ZmID0gZnVuY3Rpb24oZXZ0LCBjYWxsYmFjaykgewoKCQkJdGhpcy5maW5kRXZlbnRzKGV2dCwgZnVuY3Rpb24obmFtZSwgaW5kZXgpIHsKCQkJCWlmICghY2FsbGJhY2sgfHwgdGhpcy5ldmVudHNbbmFtZV1baW5kZXhdID09PSBjYWxsYmFjaykgewoJCQkJCXRoaXMuZXZlbnRzW25hbWVdW2luZGV4XSA9IG51bGw7CgkJCQl9CgkJCX0pOwoKCQkJcmV0dXJuIHRoaXM7CgkJfTsKCgkJLy8gRW1pdAoJCS8vIFRyaWdnZXJzIGFueSBzdWJzY3JpYmVkIGV2ZW50cwoJCXRoaXMuZW1pdCA9IGZ1bmN0aW9uKGV2dCAvKiwgZGF0YSwgLi4uICovKSB7CgoJCQkvLyBHZXQgYXJndW1lbnRzIGFzIGFuIEFycmF5LCBrbm9jayBvZmYgdGhlIGZpcnN0IG9uZQoJCQl2YXIgYXJncyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7CgkJCWFyZ3MucHVzaChldnQpOwoKCQkJLy8gSGFuZGxlcgoJCQl2YXIgaGFuZGxlciA9IGZ1bmN0aW9uKG5hbWUsIGluZGV4KSB7CgoJCQkJLy8gUmVwbGFjZSB0aGUgbGFzdCBwcm9wZXJ0eSB3aXRoIHRoZSBldmVudCBuYW1lCgkJCQlhcmdzW2FyZ3MubGVuZ3RoIC0gMV0gPSAobmFtZSA9PT0gJyonID8gZXZ0IDogbmFtZSk7CgoJCQkJLy8gVHJpZ2dlcgoJCQkJdGhpcy5ldmVudHNbbmFtZV1baW5kZXhdLmFwcGx5KHRoaXMsIGFyZ3MpOwoJCQl9OwoKCQkJLy8gRmluZCB0aGUgY2FsbGJhY2tzIHdoaWNoIG1hdGNoIHRoZSBjb25kaXRpb24gYW5kIGNhbGwKCQkJdmFyIF90aGlzID0gdGhpczsKCQkJd2hpbGUgKF90aGlzICYmIF90aGlzLmZpbmRFdmVudHMpIHsKCgkJCQkvLyBGaW5kIGV2ZW50cyB3aGljaCBtYXRjaAoJCQkJX3RoaXMuZmluZEV2ZW50cyhldnQgKyAnLConLCBoYW5kbGVyKTsKCQkJCV90aGlzID0gX3RoaXMucGFyZW50OwoJCQl9CgoJCQlyZXR1cm4gdGhpczsKCQl9OwoKCQkvLwoJCS8vIEVhc3kgZnVuY3Rpb25zCgkJdGhpcy5lbWl0QWZ0ZXIgPSBmdW5jdGlvbigpIHsKCQkJdmFyIF90aGlzID0gdGhpczsKCQkJdmFyIGFyZ3MgPSBhcmd1bWVudHM7CgkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQlfdGhpcy5lbWl0LmFwcGx5KF90aGlzLCBhcmdzKTsKCQkJfSwgMCk7CgoJCQlyZXR1cm4gdGhpczsKCQl9OwoKCQl0aGlzLmZpbmRFdmVudHMgPSBmdW5jdGlvbihldnQsIGNhbGxiYWNrKSB7CgoJCQl2YXIgYSA9IGV2dC5zcGxpdChzZXBhcmF0b3IpOwoKCQkJZm9yICh2YXIgbmFtZSBpbiB0aGlzLmV2ZW50cykge2lmICh0aGlzLmV2ZW50cy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewoKCQkJCWlmIChhLmluZGV4T2YobmFtZSkgPiAtMSkgewoKCQkJCQlmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMuZXZlbnRzW25hbWVdLmxlbmd0aDsgaSsrKSB7CgoJCQkJCQkvLyBEb2VzIHRoZSBldmVudCBoYW5kbGVyIGV4aXN0PwoJCQkJCQlpZiAodGhpcy5ldmVudHNbbmFtZV1baV0pIHsKCQkJCQkJCS8vIEVtaXQgb24gdGhlIGxvY2FsIGluc3RhbmNlIG9mIHRoaXMKCQkJCQkJCWNhbGxiYWNrLmNhbGwodGhpcywgbmFtZSwgaSk7CgkJCQkJCX0KCQkJCQl9CgkJCQl9CgkJCX19CgkJfTsKCgkJcmV0dXJuIHRoaXM7Cgl9LAoKCS8vIEdsb2JhbCBFdmVudHMKCS8vIEF0dGFjaCB0aGUgY2FsbGJhY2sgdG8gdGhlIHdpbmRvdyBvYmplY3QKCS8vIFJldHVybiBpdHMgdW5pcXVlIHJlZmVyZW5jZQoJZ2xvYmFsRXZlbnQ6IGZ1bmN0aW9uKGNhbGxiYWNrLCBndWlkKSB7CgkJLy8gSWYgdGhlIGd1aWQgaGFzIG5vdCBiZWVuIHN1cHBsaWVkIHRoZW4gY3JlYXRlIGEgbmV3IG9uZS4KCQlndWlkID0gZ3VpZCB8fCAnX2hlbGxvanNfJyArIHBhcnNlSW50KE1hdGgucmFuZG9tKCkgKiAxZTEyLCAxMCkudG9TdHJpbmcoMzYpOwoKCQkvLyBEZWZpbmUgdGhlIGNhbGxiYWNrIGZ1bmN0aW9uCgkJd2luZG93W2d1aWRdID0gZnVuY3Rpb24oKSB7CgkJCS8vIFRyaWdnZXIgdGhlIGNhbGxiYWNrCgkJCXRyeSB7CgkJCQlpZiAoY2FsbGJhY2suYXBwbHkodGhpcywgYXJndW1lbnRzKSkgewoJCQkJCWRlbGV0ZSB3aW5kb3dbZ3VpZF07CgkJCQl9CgkJCX0KCQkJY2F0Y2ggKGUpIHsKCQkJCWNvbnNvbGUuZXJyb3IoZSk7CgkJCX0KCQl9OwoKCQlyZXR1cm4gZ3VpZDsKCX0sCgoJLy8gVHJpZ2dlciBhIGNsaWVudHNpZGUgcG9wdXAKCS8vIFRoaXMgaGFzIGJlZW4gYXVnbWVudGVkIHRvIHN1cHBvcnQgUGhvbmVHYXAKCXBvcHVwOiBmdW5jdGlvbih1cmwsIHJlZGlyZWN0VXJpLCBvcHRpb25zKSB7CgoJCXZhciBkb2N1bWVudEVsZW1lbnQgPSBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQ7CgoJCS8vIE11bHRpIFNjcmVlbiBQb3B1cCBQb3NpdGlvbmluZyAoaHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tL2EvMTY4NjEwNTApCgkJLy8gQ3JlZGl0OiBodHRwOi8vd3d3Lnh0Zi5kay8yMDExLzA4L2NlbnRlci1uZXctcG9wdXAtd2luZG93LWV2ZW4tb24uaHRtbAoJCS8vIEZpeGVzIGR1YWwtc2NyZWVuIHBvc2l0aW9uICAgICAgICAgICAgICAgICAgICAgICAgIE1vc3QgYnJvd3NlcnMgICAgICBGaXJlZm94CgoJCWlmIChvcHRpb25zLmhlaWdodCkgewoJCQl2YXIgZHVhbFNjcmVlblRvcCA9IHdpbmRvdy5zY3JlZW5Ub3AgIT09IHVuZGVmaW5lZCA/IHdpbmRvdy5zY3JlZW5Ub3AgOiBzY3JlZW4udG9wOwoJCQl2YXIgaGVpZ2h0ID0gc2NyZWVuLmhlaWdodCB8fCB3aW5kb3cuaW5uZXJIZWlnaHQgfHwgZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodDsKCQkJb3B0aW9ucy50b3AgPSBwYXJzZUludCgoaGVpZ2h0IC0gb3B0aW9ucy5oZWlnaHQpIC8gMiwgMTApICsgZHVhbFNjcmVlblRvcDsKCQl9CgoJCWlmIChvcHRpb25zLndpZHRoKSB7CgkJCXZhciBkdWFsU2NyZWVuTGVmdCA9IHdpbmRvdy5zY3JlZW5MZWZ0ICE9PSB1bmRlZmluZWQgPyB3aW5kb3cuc2NyZWVuTGVmdCA6IHNjcmVlbi5sZWZ0OwoJCQl2YXIgd2lkdGggPSBzY3JlZW4ud2lkdGggfHwgd2luZG93LmlubmVyV2lkdGggfHwgZG9jdW1lbnRFbGVtZW50LmNsaWVudFdpZHRoOwoJCQlvcHRpb25zLmxlZnQgPSBwYXJzZUludCgod2lkdGggLSBvcHRpb25zLndpZHRoKSAvIDIsIDEwKSArIGR1YWxTY3JlZW5MZWZ0OwoJCX0KCgkJLy8gQ29udmVydCBvcHRpb25zIGludG8gYW4gYXJyYXkKCQl2YXIgb3B0aW9uc0FycmF5ID0gW107CgkJT2JqZWN0LmtleXMob3B0aW9ucykuZm9yRWFjaChmdW5jdGlvbihuYW1lKSB7CgkJCXZhciB2YWx1ZSA9IG9wdGlvbnNbbmFtZV07CgkJCW9wdGlvbnNBcnJheS5wdXNoKG5hbWUgKyAodmFsdWUgIT09IG51bGwgPyAnPScgKyB2YWx1ZSA6ICcnKSk7CgkJfSk7CgoJCS8vIENhbGwgdGhlIG9wZW4oKSBmdW5jdGlvbiB3aXRoIHRoZSBpbml0aWFsIHBhdGgKCQkvLwoJCS8vIE9BdXRoIHJlZGlyZWN0LCBmaXhlcyBVUkkgZnJhZ21lbnRzIGZyb20gYmVpbmcgbG9zdCBpbiBTYWZhcmkKCQkvLyAoVVJJIEZyYWdtZW50cyB3aXRoaW4gMzAyIExvY2F0aW9uIFVSSSBhcmUgbG9zdCBvdmVyIEhUVFBTKQoJCS8vIExvYWRpbmcgdGhlIHJlZGlyZWN0Lmh0bWwgYmVmb3JlIHRyaWdnZXJpbmcgdGhlIE9BdXRoIEZsb3cgc2VlbXMgdG8gZml4IGl0LgoJCS8vCgkJLy8gRmlyZWZveCAgZGVjb2RlcyBVUkwgZnJhZ21lbnRzIHdoZW4gY2FsbGluZyBsb2NhdGlvbi5oYXNoLgoJCS8vICAtIFRoaXMgaXMgYmFkIGlmIHRoZSB2YWx1ZSBjb250YWlucyBicmVhayBwb2ludHMgd2hpY2ggYXJlIGVzY2FwZWQKCQkvLyAgLSBIZW5jZSB0aGUgdXJsIG11c3QgYmUgZW5jb2RlZCB0d2ljZSBhcyBpdCBjb250YWlucyBicmVha3BvaW50cy4KCQlpZiAobmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdTYWZhcmknKSAhPT0gLTEgJiYgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdDaHJvbWUnKSA9PT0gLTEpIHsKCQkJdXJsID0gcmVkaXJlY3RVcmkgKyAnI29hdXRoX3JlZGlyZWN0PScgKyBlbmNvZGVVUklDb21wb25lbnQoZW5jb2RlVVJJQ29tcG9uZW50KHVybCkpOwoJCX0KCgkJdmFyIHBvcHVwID0gd2luZG93Lm9wZW4oCgkJCXVybCwKCQkJJ19ibGFuaycsCgkJCW9wdGlvbnNBcnJheS5qb2luKCcsJykKCQkpOwoKCQlpZiAocG9wdXAgJiYgcG9wdXAuZm9jdXMpIHsKCQkJcG9wdXAuZm9jdXMoKTsKCQl9CgoJCXJldHVybiBwb3B1cDsKCX0sCgoJLy8gT0F1dGggYW5kIEFQSSByZXNwb25zZSBoYW5kbGVyCglyZXNwb25zZUhhbmRsZXI6IGZ1bmN0aW9uKHdpbmRvdywgcGFyZW50KSB7CgoJCXZhciBfdGhpcyA9IHRoaXM7CgkJdmFyIHA7CgkJdmFyIGxvY2F0aW9uID0gd2luZG93LmxvY2F0aW9uOwoKCQkvLyBJcyB0aGlzIGFuIGF1dGggcmVsYXkgbWVzc2FnZSB3aGljaCBuZWVkcyB0byBjYWxsIHRoZSBwcm94eT8KCQlwID0gX3RoaXMucGFyYW0obG9jYXRpb24uc2VhcmNoKTsKCgkJLy8gT0F1dGgyIG9yIE9BdXRoMSBzZXJ2ZXIgcmVzcG9uc2U/CgkJaWYgKHAgJiYgcC5zdGF0ZSAmJiAocC5jb2RlIHx8IHAub2F1dGhfdG9rZW4pKSB7CgoJCQl2YXIgc3RhdGUgPSBKU09OLnBhcnNlKHAuc3RhdGUpOwoKCQkJLy8gQWRkIHRoaXMgcGF0aCBhcyB0aGUgcmVkaXJlY3RfdXJpCgkJCXAucmVkaXJlY3RfdXJpID0gc3RhdGUucmVkaXJlY3RfdXJpIHx8IGxvY2F0aW9uLmhyZWYucmVwbGFjZSgvW1w/XCNdLiokLywgJycpOwoKCQkJLy8gUmVkaXJlY3QgdG8gdGhlIGhvc3QKCQkJdmFyIHBhdGggPSBzdGF0ZS5vYXV0aF9wcm94eSArICc/JyArIF90aGlzLnBhcmFtKHApOwoKCQkJbG9jYXRpb24uYXNzaWduKHBhdGgpOwoKCQkJcmV0dXJuOwoJCX0KCgkJLy8gU2F2ZSBzZXNzaW9uLCBmcm9tIHJlZGlyZWN0ZWQgYXV0aGVudGljYXRpb24KCQkvLyAjYWNjZXNzX3Rva2VuIGhhcyBjb21lIGluPwoJCS8vCgkJLy8gRkFDRUJPT0sgaXMgcmV0dXJuaW5nIGF1dGggZXJyb3JzIHdpdGhpbiBhcyBhIHF1ZXJ5X3N0cmluZy4uLiB0aGF0cyBhIHN0aWNrbGVyIGZvciBjb25zaXN0ZW5jeS4KCQkvLyBTb3VuZENsb3VkIGlzIHRoZSBzdGF0ZSBpbiB0aGUgcXVlcnlzdHJpbmcgYW5kIHRoZSB0b2tlbiBpbiB0aGUgaGFzaHRhZywgc28gd2UnbGwgbWl4IHRoZSB0d28gdG9nZXRoZXIKCgkJcCA9IF90aGlzLm1lcmdlKF90aGlzLnBhcmFtKGxvY2F0aW9uLnNlYXJjaCB8fCAnJyksIF90aGlzLnBhcmFtKGxvY2F0aW9uLmhhc2ggfHwgJycpKTsKCgkJLy8gSWYgcC5zdGF0ZQoJCWlmIChwICYmICdzdGF0ZScgaW4gcCkgewoKCQkJLy8gUmVtb3ZlIGFueSBhZGRpdGlvbiBpbmZvcm1hdGlvbgoJCQkvLyBFLmcuIHAuc3RhdGUgPSAnZmFjZWJvb2sucGFnZSc7CgkJCXRyeSB7CgkJCQl2YXIgYSA9IEpTT04ucGFyc2UocC5zdGF0ZSk7CgkJCQlfdGhpcy5leHRlbmQocCwgYSk7CgkJCX0KCQkJY2F0Y2ggKGUpIHsKCQkJCWNvbnNvbGUuZXJyb3IoJ0NvdWxkIG5vdCBkZWNvZGUgc3RhdGUgcGFyYW1ldGVyJyk7CgkJCX0KCgkJCS8vIEFjY2Vzc190b2tlbj8KCQkJaWYgKCgnYWNjZXNzX3Rva2VuJyBpbiBwICYmIHAuYWNjZXNzX3Rva2VuKSAmJiBwLm5ldHdvcmspIHsKCgkJCQlpZiAoIXAuZXhwaXJlc19pbiB8fCBwYXJzZUludChwLmV4cGlyZXNfaW4sIDEwKSA9PT0gMCkgewoJCQkJCS8vIElmIHAuZXhwaXJlc19pbiBpcyB1bnNldCwgc2V0IHRvIDAKCQkJCQlwLmV4cGlyZXNfaW4gPSAwOwoJCQkJfQoKCQkJCXAuZXhwaXJlc19pbiA9IHBhcnNlSW50KHAuZXhwaXJlc19pbiwgMTApOwoJCQkJcC5leHBpcmVzID0gKChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgLyAxZTMpICsgKHAuZXhwaXJlc19pbiB8fCAoNjAgKiA2MCAqIDI0ICogMzY1KSk7CgoJCQkJLy8gTGV0cyB1c2UgdGhlICJzdGF0ZSIgdG8gYXNzaWduIGl0IHRvIG9uZSBvZiBvdXIgbmV0d29ya3MKCQkJCWF1dGhDYWxsYmFjayhwLCB3aW5kb3csIHBhcmVudCk7CgkJCX0KCgkJCS8vIEVycm9yPT8KCQkJLy8gJmVycm9yX2Rlc2NyaXB0aW9uPT8KCQkJLy8gJnN0YXRlPT8KCQkJZWxzZSBpZiAoKCdlcnJvcicgaW4gcCAmJiBwLmVycm9yKSAmJiBwLm5ldHdvcmspIHsKCgkJCQlwLmVycm9yID0gewoJCQkJCWNvZGU6IHAuZXJyb3IsCgkJCQkJbWVzc2FnZTogcC5lcnJvcl9tZXNzYWdlIHx8IHAuZXJyb3JfZGVzY3JpcHRpb24KCQkJCX07CgoJCQkJLy8gTGV0IHRoZSBzdGF0ZSBoYW5kbGVyIGhhbmRsZSBpdAoJCQkJYXV0aENhbGxiYWNrKHAsIHdpbmRvdywgcGFyZW50KTsKCQkJfQoKCQkJLy8gQVBJIGNhbGwsIG9yIGEgY2FuY2VsbGVkIGxvZ2luCgkJCS8vIFJlc3VsdCBpcyBzZXJpYWxpemVkIEpTT04gc3RyaW5nCgkJCWVsc2UgaWYgKHAuY2FsbGJhY2sgJiYgcC5jYWxsYmFjayBpbiBwYXJlbnQpIHsKCgkJCQkvLyBUcmlnZ2VyIGEgZnVuY3Rpb24gaW4gdGhlIHBhcmVudAoJCQkJdmFyIHJlcyA9ICdyZXN1bHQnIGluIHAgJiYgcC5yZXN1bHQgPyBKU09OLnBhcnNlKHAucmVzdWx0KSA6IGZhbHNlOwoKCQkJCS8vIFRyaWdnZXIgdGhlIGNhbGxiYWNrIG9uIHRoZSBwYXJlbnQKCQkJCXBhcmVudFtwLmNhbGxiYWNrXShyZXMpOwoJCQkJY2xvc2VXaW5kb3coKTsKCQkJfQoKCQkJLy8gSWYgdGhpcyBwYWdlIGlzIHN0aWxsIG9wZW4KCQkJaWYgKHAucGFnZV91cmkpIHsKCQkJCWxvY2F0aW9uLmFzc2lnbihwLnBhZ2VfdXJpKTsKCQkJfQoJCX0KCgkJLy8gT0F1dGggcmVkaXJlY3QsIGZpeGVzIFVSSSBmcmFnbWVudHMgZnJvbSBiZWluZyBsb3N0IGluIFNhZmFyaQoJCS8vIChVUkkgRnJhZ21lbnRzIHdpdGhpbiAzMDIgTG9jYXRpb24gVVJJIGFyZSBsb3N0IG92ZXIgSFRUUFMpCgkJLy8gTG9hZGluZyB0aGUgcmVkaXJlY3QuaHRtbCBiZWZvcmUgdHJpZ2dlcmluZyB0aGUgT0F1dGggRmxvdyBzZWVtcyB0byBmaXggaXQuCgkJZWxzZSBpZiAoJ29hdXRoX3JlZGlyZWN0JyBpbiBwKSB7CgoJCQlsb2NhdGlvbi5hc3NpZ24oZGVjb2RlVVJJQ29tcG9uZW50KHAub2F1dGhfcmVkaXJlY3QpKTsKCQkJcmV0dXJuOwoJCX0KCgkJLy8gVHJpZ2dlciBhIGNhbGxiYWNrIHRvIGF1dGhlbnRpY2F0ZQoJCWZ1bmN0aW9uIGF1dGhDYWxsYmFjayhvYmosIHdpbmRvdywgcGFyZW50KSB7CgoJCQl2YXIgY2IgPSBvYmouY2FsbGJhY2s7CgkJCXZhciBuZXR3b3JrID0gb2JqLm5ldHdvcms7CgoJCQkvLyBUcmlnZ2VyIHRoZSBjYWxsYmFjayBvbiB0aGUgcGFyZW50CgkJCV90aGlzLnN0b3JlKG5ldHdvcmssIG9iaik7CgoJCQkvLyBJZiB0aGlzIGlzIGEgcGFnZSByZXF1ZXN0IGl0IGhhcyBubyBwYXJlbnQgb3Igb3BlbmVyIHdpbmRvdyB0byBoYW5kbGUgY2FsbGJhY2tzCgkJCWlmICgoJ2Rpc3BsYXknIGluIG9iaikgJiYgb2JqLmRpc3BsYXkgPT09ICdwYWdlJykgewoJCQkJcmV0dXJuOwoJCQl9CgoJCQkvLyBSZW1vdmUgZnJvbSBzZXNzaW9uIG9iamVjdAoJCQlpZiAocGFyZW50ICYmIGNiICYmIGNiIGluIHBhcmVudCkgewoKCQkJCXRyeSB7CgkJCQkJZGVsZXRlIG9iai5jYWxsYmFjazsKCQkJCX0KCQkJCWNhdGNoIChlKSB7fQoKCQkJCS8vIFVwZGF0ZSBzdG9yZQoJCQkJX3RoaXMuc3RvcmUobmV0d29yaywgb2JqKTsKCgkJCQkvLyBDYWxsIHRoZSBnbG9iYWxFdmVudCBmdW5jdGlvbiBvbiB0aGUgcGFyZW50CgkJCQkvLyBJdCdzIHNhZmVyIHRvIHBhc3MgYmFjayBhIHN0cmluZyB0byB0aGUgcGFyZW50LAoJCQkJLy8gUmF0aGVyIHRoYW4gYW4gb2JqZWN0L2FycmF5IChiZXR0ZXIgZm9yIElFOCkKCQkJCXZhciBzdHIgPSBKU09OLnN0cmluZ2lmeShvYmopOwoKCQkJCXRyeSB7CgkJCQkJcGFyZW50W2NiXShzdHIpOwoJCQkJfQoJCQkJY2F0Y2ggKGUpIHsKCQkJCQkvLyBFcnJvciB0aHJvd24gd2hpbHN0IGV4ZWN1dGluZyBwYXJlbnQgY2FsbGJhY2sKCQkJCX0KCQkJfQoKCQkJY2xvc2VXaW5kb3coKTsKCQl9CgoJCWZ1bmN0aW9uIGNsb3NlV2luZG93KCkgewoKCQkJaWYgKHdpbmRvdy5mcmFtZUVsZW1lbnQpIHsKCQkJCS8vIEluc2lkZSBhbiBpZnJhbWUsIHJlbW92ZSBmcm9tIHBhcmVudAoJCQkJcGFyZW50LmRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQod2luZG93LmZyYW1lRWxlbWVudCk7CgkJCX0KCQkJZWxzZSB7CgkJCQkvLyBDbG9zZSB0aGlzIGN1cnJlbnQgd2luZG93CgkJCQl0cnkgewoJCQkJCXdpbmRvdy5jbG9zZSgpOwoJCQkJfQoJCQkJY2F0Y2ggKGUpIHt9CgoJCQkJLy8gSU9TIGJ1ZyB3b250IGxldCB1cyBjbG9zZSBhIHBvcHVwIGlmIHN0aWxsIGxvYWRpbmcKCQkJCWlmICh3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcikgewoJCQkJCXdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdsb2FkJywgZnVuY3Rpb24oKSB7CgkJCQkJCXdpbmRvdy5jbG9zZSgpOwoJCQkJCX0pOwoJCQkJfQoJCQl9CgoJCX0KCX0KfSk7CgovLyBFdmVudHMKLy8gRXh0ZW5kIHRoZSBoZWxsbyBvYmplY3Qgd2l0aCBpdHMgb3duIGV2ZW50IGluc3RhbmNlCmhlbGxvLnV0aWxzLkV2ZW50LmNhbGwoaGVsbG8pOwoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gTW9uaXRvcmluZyBzZXNzaW9uIHN0YXRlCi8vIENoZWNrIGZvciBzZXNzaW9uIGNoYW5nZXMKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KCihmdW5jdGlvbihoZWxsbykgewoKCS8vIE1vbml0b3IgZm9yIGEgY2hhbmdlIGluIHN0YXRlIGFuZCBmaXJlCgl2YXIgb2xkU2Vzc2lvbnMgPSB7fTsKCgkvLyBIYXNoIG9mIGV4cGlyZWQgdG9rZW5zCgl2YXIgZXhwaXJlZCA9IHt9OwoKCS8vIExpc3RlbiB0byBvdGhlciB0cmlnZ2VycyB0byBBdXRoIGV2ZW50cywgdXNlIHRoZXNlIHRvIHVwZGF0ZSB0aGlzCgloZWxsby5vbignYXV0aC5sb2dpbiwgYXV0aC5sb2dvdXQnLCBmdW5jdGlvbihhdXRoKSB7CgkJaWYgKGF1dGggJiYgdHlwZW9mIChhdXRoKSA9PT0gJ29iamVjdCcgJiYgYXV0aC5uZXR3b3JrKSB7CgkJCW9sZFNlc3Npb25zW2F1dGgubmV0d29ya10gPSBoZWxsby51dGlscy5zdG9yZShhdXRoLm5ldHdvcmspIHx8IHt9OwoJCX0KCX0pOwoKCShmdW5jdGlvbiBzZWxmKCkgewoKCQl2YXIgQ1VSUkVOVF9USU1FID0gKChuZXcgRGF0ZSgpKS5nZXRUaW1lKCkgLyAxZTMpOwoJCXZhciBlbWl0ID0gZnVuY3Rpb24oZXZlbnROYW1lKSB7CgkJCWhlbGxvLmVtaXQoJ2F1dGguJyArIGV2ZW50TmFtZSwgewoJCQkJbmV0d29yazogbmFtZSwKCQkJCWF1dGhSZXNwb25zZTogc2Vzc2lvbgoJCQl9KTsKCQl9OwoKCQkvLyBMb29wIHRocm91Z2ggdGhlIHNlcnZpY2VzCgkJZm9yICh2YXIgbmFtZSBpbiBoZWxsby5zZXJ2aWNlcykge2lmIChoZWxsby5zZXJ2aWNlcy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgewoKCQkJaWYgKCFoZWxsby5zZXJ2aWNlc1tuYW1lXS5pZCkgewoJCQkJLy8gV2UgaGF2ZW4ndCBhdHRhY2hlZCBhbiBJRCBzbyBkb250IGxpc3Rlbi4KCQkJCWNvbnRpbnVlOwoJCQl9CgoJCQkvLyBHZXQgc2Vzc2lvbgoJCQl2YXIgc2Vzc2lvbiA9IGhlbGxvLnV0aWxzLnN0b3JlKG5hbWUpIHx8IHt9OwoJCQl2YXIgcHJvdmlkZXIgPSBoZWxsby5zZXJ2aWNlc1tuYW1lXTsKCQkJdmFyIG9sZFNlc3MgPSBvbGRTZXNzaW9uc1tuYW1lXSB8fCB7fTsKCgkJCS8vIExpc3RlbiBmb3IgZ2xvYmFsRXZlbnRzIHRoYXQgZGlkIG5vdCBnZXQgdHJpZ2dlcmVkIGZyb20gdGhlIGNoaWxkCgkJCWlmIChzZXNzaW9uICYmICdjYWxsYmFjaycgaW4gc2Vzc2lvbikgewoKCQkJCS8vIFRvIGRvIHJlbW92ZSBmcm9tIHNlc3Npb24gb2JqZWN0Li4uCgkJCQl2YXIgY2IgPSBzZXNzaW9uLmNhbGxiYWNrOwoJCQkJdHJ5IHsKCQkJCQlkZWxldGUgc2Vzc2lvbi5jYWxsYmFjazsKCQkJCX0KCQkJCWNhdGNoIChlKSB7fQoKCQkJCS8vIFVwZGF0ZSBzdG9yZQoJCQkJLy8gUmVtb3ZpbmcgdGhlIGNhbGxiYWNrCgkJCQloZWxsby51dGlscy5zdG9yZShuYW1lLCBzZXNzaW9uKTsKCgkJCQkvLyBFbWl0IGdsb2JhbCBldmVudHMKCQkJCXRyeSB7CgkJCQkJd2luZG93W2NiXShzZXNzaW9uKTsKCQkJCX0KCQkJCWNhdGNoIChlKSB7fQoJCQl9CgoJCQkvLyBSZWZyZXNoIHRva2VuCgkJCWlmIChzZXNzaW9uICYmICgnZXhwaXJlcycgaW4gc2Vzc2lvbikgJiYgc2Vzc2lvbi5leHBpcmVzIDwgQ1VSUkVOVF9USU1FKSB7CgoJCQkJLy8gSWYgYXV0byByZWZyZXNoIGlzIHBvc3NpYmxlCgkJCQkvLyBFaXRoZXIgdGhlIGJyb3dzZXIgc3VwcG9ydHMKCQkJCXZhciByZWZyZXNoID0gcHJvdmlkZXIucmVmcmVzaCB8fCBzZXNzaW9uLnJlZnJlc2hfdG9rZW47CgoJCQkJLy8gSGFzIHRoZSByZWZyZXNoIGJlZW4gcnVuIHJlY2VudGx5PwoJCQkJaWYgKHJlZnJlc2ggJiYgKCEobmFtZSBpbiBleHBpcmVkKSB8fCBleHBpcmVkW25hbWVdIDwgQ1VSUkVOVF9USU1FKSkgewoJCQkJCS8vIFRyeSB0byByZXNpZ25pbgoJCQkJCWhlbGxvLmVtaXQoJ25vdGljZScsIG5hbWUgKyAnIGhhcyBleHBpcmVkIHRyeWluZyB0byByZXNpZ25pbicpOwoJCQkJCWhlbGxvLmxvZ2luKG5hbWUsIHtkaXNwbGF5OiAnbm9uZScsIGZvcmNlOiBmYWxzZX0pOwoKCQkJCQkvLyBVcGRhdGUgZXhwaXJlZCwgZXZlcnkgMTAgbWludXRlcwoJCQkJCWV4cGlyZWRbbmFtZV0gPSBDVVJSRU5UX1RJTUUgKyA2MDA7CgkJCQl9CgoJCQkJLy8gRG9lcyB0aGlzIHByb3ZpZGVyIG5vdCBzdXBwb3J0IHJlZnJlc2gKCQkJCWVsc2UgaWYgKCFyZWZyZXNoICYmICEobmFtZSBpbiBleHBpcmVkKSkgewoJCQkJCS8vIExhYmVsIHRoZSBldmVudAoJCQkJCWVtaXQoJ2V4cGlyZWQnKTsKCQkJCQlleHBpcmVkW25hbWVdID0gdHJ1ZTsKCQkJCX0KCgkJCQkvLyBJZiBzZXNzaW9uIGhhcyBleHBpcmVkIHRoZW4gd2UgZG9udCB3YW50IHRvIHN0b3JlIGl0cyB2YWx1ZSB1bnRpbCBpdCBjYW4gYmUgZXN0YWJsaXNoZWQgdGhhdCBpdHMgYmVlbiB1cGRhdGVkCgkJCQljb250aW51ZTsKCQkJfQoKCQkJLy8gSGFzIHNlc3Npb24gY2hhbmdlZD8KCQkJZWxzZSBpZiAob2xkU2Vzcy5hY2Nlc3NfdG9rZW4gPT09IHNlc3Npb24uYWNjZXNzX3Rva2VuICYmCgkJCW9sZFNlc3MuZXhwaXJlcyA9PT0gc2Vzc2lvbi5leHBpcmVzKSB7CgkJCQljb250aW51ZTsKCQkJfQoKCQkJLy8gQWNjZXNzX3Rva2VuIGhhcyBiZWVuIHJlbW92ZWQKCQkJZWxzZSBpZiAoIXNlc3Npb24uYWNjZXNzX3Rva2VuICYmIG9sZFNlc3MuYWNjZXNzX3Rva2VuKSB7CgkJCQllbWl0KCdsb2dvdXQnKTsKCQkJfQoKCQkJLy8gQWNjZXNzX3Rva2VuIGhhcyBiZWVuIGNyZWF0ZWQKCQkJZWxzZSBpZiAoc2Vzc2lvbi5hY2Nlc3NfdG9rZW4gJiYgIW9sZFNlc3MuYWNjZXNzX3Rva2VuKSB7CgkJCQllbWl0KCdsb2dpbicpOwoJCQl9CgoJCQkvLyBBY2Nlc3NfdG9rZW4gaGFzIGJlZW4gdXBkYXRlZAoJCQllbHNlIGlmIChzZXNzaW9uLmV4cGlyZXMgIT09IG9sZFNlc3MuZXhwaXJlcykgewoJCQkJZW1pdCgndXBkYXRlJyk7CgkJCX0KCgkJCS8vIFVwZGF0ZWQgc3RvcmVkIHNlc3Npb24KCQkJb2xkU2Vzc2lvbnNbbmFtZV0gPSBzZXNzaW9uOwoKCQkJLy8gUmVtb3ZlIHRoZSBleHBpcmVkIGZsYWdzCgkJCWlmIChuYW1lIGluIGV4cGlyZWQpIHsKCQkJCWRlbGV0ZSBleHBpcmVkW25hbWVdOwoJCQl9CgkJfX0KCgkJLy8gQ2hlY2sgZXJyb3IgZXZlbnRzCgkJc2V0VGltZW91dChzZWxmLCAxMDAwKTsKCX0pKCk7Cgp9KShoZWxsbyk7CgovLyBFT0YgQ09SRSBsaWIKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLwoKLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8KLy8gQVBJCi8vIEBwYXJhbSBwYXRoICAgIHN0cmluZwovLyBAcGFyYW0gcXVlcnkgICBvYmplY3QgKG9wdGlvbmFsKQovLyBAcGFyYW0gbWV0aG9kICBzdHJpbmcgKG9wdGlvbmFsKQovLyBAcGFyYW0gZGF0YSAgICBvYmplY3QgKG9wdGlvbmFsKQovLyBAcGFyYW0gdGltZW91dCBpbnRlZ2VyIChvcHRpb25hbCkKLy8gQHBhcmFtIGNhbGxiYWNrICBmdW5jdGlvbiAob3B0aW9uYWwpCgpoZWxsby5hcGkgPSBmdW5jdGlvbigpIHsKCgkvLyBTaG9ydGhhbmQKCXZhciBfdGhpcyA9IHRoaXM7Cgl2YXIgdXRpbHMgPSBfdGhpcy51dGlsczsKCXZhciBlcnJvciA9IHV0aWxzLmVycm9yOwoKCS8vIENvbnN0cnVjdCBhIG5ldyBQcm9taXNlIG9iamVjdAoJdmFyIHByb21pc2UgPSB1dGlscy5Qcm9taXNlKCk7CgoJLy8gQXJndW1lbnRzCgl2YXIgcCA9IHV0aWxzLmFyZ3Moe3BhdGg6ICdzIScsIHF1ZXJ5OiAnbycsIG1ldGhvZDogJ3MnLCBkYXRhOiAnbycsIHRpbWVvdXQ6ICdpJywgY2FsbGJhY2s6ICdmJ30sIGFyZ3VtZW50cyk7CgoJLy8gTWV0aG9kCglwLm1ldGhvZCA9IChwLm1ldGhvZCB8fCAnZ2V0JykudG9Mb3dlckNhc2UoKTsKCgkvLyBIZWFkZXJzCglwLmhlYWRlcnMgPSBwLmhlYWRlcnMgfHwge307CgoJLy8gUXVlcnkKCXAucXVlcnkgPSBwLnF1ZXJ5IHx8IHt9OwoKCS8vIElmIGdldCwgcHV0IGFsbCBwYXJhbWV0ZXJzIGludG8gcXVlcnkKCWlmIChwLm1ldGhvZCA9PT0gJ2dldCcgfHwgcC5tZXRob2QgPT09ICdkZWxldGUnKSB7CgkJdXRpbHMuZXh0ZW5kKHAucXVlcnksIHAuZGF0YSk7CgkJcC5kYXRhID0ge307Cgl9CgoJdmFyIGRhdGEgPSBwLmRhdGEgPSBwLmRhdGEgfHwge307CgoJLy8gQ29tcGxldGVkIGV2ZW50IGNhbGxiYWNrCglwcm9taXNlLnRoZW4ocC5jYWxsYmFjaywgcC5jYWxsYmFjayk7CgoJLy8gUmVtb3ZlIHRoZSBuZXR3b3JrIGZyb20gcGF0aCwgZS5nLiBmYWNlYm9vazovbWUvZnJpZW5kcwoJLy8gUmVzdWx0cyBpbiB7IG5ldHdvcmsgOiBmYWNlYm9vaywgcGF0aCA6IG1lL2ZyaWVuZHMgfQoJaWYgKCFwLnBhdGgpIHsKCQlyZXR1cm4gcHJvbWlzZS5yZWplY3QoZXJyb3IoJ2ludmFsaWRfcGF0aCcsICdNaXNzaW5nIHRoZSBwYXRoIHBhcmFtZXRlciBmcm9tIHRoZSByZXF1ZXN0JykpOwoJfQoKCXAucGF0aCA9IHAucGF0aC5yZXBsYWNlKC9eXC8rLywgJycpOwoJdmFyIGEgPSAocC5wYXRoLnNwbGl0KC9bXC9cOl0vLCAyKSB8fCBbXSlbMF0udG9Mb3dlckNhc2UoKTsKCglpZiAoYSBpbiBfdGhpcy5zZXJ2aWNlcykgewoJCXAubmV0d29yayA9IGE7CgkJdmFyIHJlZyA9IG5ldyBSZWdFeHAoJ14nICsgYSArICc6P1wvPycpOwoJCXAucGF0aCA9IHAucGF0aC5yZXBsYWNlKHJlZywgJycpOwoJfQoKCS8vIE5ldHdvcmsgJiBQcm92aWRlcgoJLy8gRGVmaW5lIHRoZSBuZXR3b3JrIHRoYXQgdGhpcyByZXF1ZXN0IGlzIG1hZGUgZm9yCglwLm5ldHdvcmsgPSBfdGhpcy5zZXR0aW5ncy5kZWZhdWx0X3NlcnZpY2UgPSBwLm5ldHdvcmsgfHwgX3RoaXMuc2V0dGluZ3MuZGVmYXVsdF9zZXJ2aWNlOwoJdmFyIG8gPSBfdGhpcy5zZXJ2aWNlc1twLm5ldHdvcmtdOwoKCS8vIElOVkFMSUQKCS8vIElzIHRoZXJlIG5vIHNlcnZpY2UgYnkgdGhlIGdpdmVuIG5ldHdvcmsgbmFtZT8KCWlmICghbykgewoJCXJldHVybiBwcm9taXNlLnJlamVjdChlcnJvcignaW52YWxpZF9uZXR3b3JrJywgJ0NvdWxkIG5vdCBtYXRjaCB0aGUgc2VydmljZSByZXF1ZXN0ZWQ6ICcgKyBwLm5ldHdvcmspKTsKCX0KCgkvLyBQQVRICgkvLyBBcyBsb25nIGFzIHRoZSBwYXRoIGlzbid0IGZsYWdnZWQgYXMgdW5hdmFpYWJsZSwgZS5nLiBwYXRoID09IGZhbHNlCgoJaWYgKCEoIShwLm1ldGhvZCBpbiBvKSB8fCAhKHAucGF0aCBpbiBvW3AubWV0aG9kXSkgfHwgb1twLm1ldGhvZF1bcC5wYXRoXSAhPT0gZmFsc2UpKSB7CgkJcmV0dXJuIHByb21pc2UucmVqZWN0KGVycm9yKCdpbnZhbGlkX3BhdGgnLCAnVGhlIHByb3ZpZGVkIHBhdGggaXMgbm90IGF2YWlsYWJsZSBvbiB0aGUgc2VsZWN0ZWQgbmV0d29yaycpKTsKCX0KCgkvLyBQUk9YWQoJLy8gT0F1dGgxIGNhbGxzIGFsd2F5cyBuZWVkIGEgcHJveHkKCglpZiAoIXAub2F1dGhfcHJveHkpIHsKCQlwLm9hdXRoX3Byb3h5ID0gX3RoaXMuc2V0dGluZ3Mub2F1dGhfcHJveHk7Cgl9CgoJaWYgKCEoJ3Byb3h5JyBpbiBwKSkgewoJCXAucHJveHkgPSBwLm9hdXRoX3Byb3h5ICYmIG8ub2F1dGggJiYgcGFyc2VJbnQoby5vYXV0aC52ZXJzaW9uLCAxMCkgPT09IDE7Cgl9CgoJLy8gVElNRU9VVAoJLy8gQWRvcHQgdGltZW91dCBmcm9tIGdsb2JhbCBzZXR0aW5ncyBieSBkZWZhdWx0CgoJaWYgKCEoJ3RpbWVvdXQnIGluIHApKSB7CgkJcC50aW1lb3V0ID0gX3RoaXMuc2V0dGluZ3MudGltZW91dDsKCX0KCgkvLyBGb3JtYXQgcmVzcG9uc2UKCS8vIFdoZXRoZXIgdG8gcnVuIHRoZSByYXcgcmVzcG9uc2UgdGhyb3VnaCBwb3N0IHByb2Nlc3NpbmcuCglpZiAoISgnZm9ybWF0UmVzcG9uc2UnIGluIHApKSB7CgkJcC5mb3JtYXRSZXNwb25zZSA9IHRydWU7Cgl9CgoJLy8gR2V0IHRoZSBjdXJyZW50IHNlc3Npb24KCS8vIEFwcGVuZCB0aGUgYWNjZXNzX3Rva2VuIHRvIHRoZSBxdWVyeQoJcC5hdXRoUmVzcG9uc2UgPSBfdGhpcy5nZXRBdXRoUmVzcG9uc2UocC5uZXR3b3JrKTsKCWlmIChwLmF1dGhSZXNwb25zZSAmJiBwLmF1dGhSZXNwb25zZS5hY2Nlc3NfdG9rZW4pIHsKCQlwLnF1ZXJ5LmFjY2Vzc190b2tlbiA9IHAuYXV0aFJlc3BvbnNlLmFjY2Vzc190b2tlbjsKCX0KCgl2YXIgdXJsID0gcC5wYXRoOwoJdmFyIG07CgoJLy8gU3RvcmUgdGhlIHF1ZXJ5IGFzIG9wdGlvbnMKCS8vIFRoaXMgaXMgdXNlZCB0byBwb3B1bGF0ZSB0aGUgcmVxdWVzdCBvYmplY3QgYmVmb3JlIHRoZSBkYXRhIGlzIGF1Z21lbnRlZCBieSB0aGUgcHJld3JhcCBoYW5kbGVycy4KCXAub3B0aW9ucyA9IHV0aWxzLmNsb25lKHAucXVlcnkpOwoKCS8vIENsb25lIHRoZSBkYXRhIG9iamVjdAoJLy8gUHJldmVudCB0aGlzIHNjcmlwdCBvdmVyd3JpdGluZyB0aGUgZGF0YSBvZiB0aGUgaW5jb21pbmcgb2JqZWN0LgoJLy8gRW5zdXJlIHRoYXQgZXZlcnl0aW1lIHdlIHJ1biBhbiBpdGVyYXRpb24gdGhlIGNhbGxiYWNrcyBoYXZlbid0IHJlbW92ZWQgc29tZSBkYXRhCglwLmRhdGEgPSB1dGlscy5jbG9uZShkYXRhKTsKCgkvLyBVUkwgTWFwcGluZwoJLy8gSXMgdGhlcmUgYSBtYXAgZm9yIHRoZSBnaXZlbiBVUkw/Cgl2YXIgYWN0aW9ucyA9IG9beydkZWxldGUnOiAnZGVsJ31bcC5tZXRob2RdIHx8IHAubWV0aG9kXSB8fCB7fTsKCgkvLyBFeHRyYXBvbGF0ZSB0aGUgUXVlcnlTdHJpbmcKCS8vIFByb3ZpZGUgYSBjbGVhbiBwYXRoCgkvLyBNb3ZlIHRoZSBxdWVyeXN0cmluZyBpbnRvIHRoZSBkYXRhCglpZiAocC5tZXRob2QgPT09ICdnZXQnKSB7CgoJCXZhciBxdWVyeSA9IHVybC5zcGxpdCgvW1w/I10vKVsxXTsKCQlpZiAocXVlcnkpIHsKCQkJdXRpbHMuZXh0ZW5kKHAucXVlcnksIHV0aWxzLnBhcmFtKHF1ZXJ5KSk7CgoJCQkvLyBSZW1vdmUgdGhlIHF1ZXJ5IHBhcnQgZnJvbSB0aGUgVVJMCgkJCXVybCA9IHVybC5yZXBsYWNlKC9cPy4qPygjfCQpLywgJyQxJyk7CgkJfQoJfQoKCS8vIElzIHRoZSBoYXNoIGZyYWdtZW50IGRlZmluZWQKCWlmICgobSA9IHVybC5tYXRjaCgvIyguKykvLCAnJykpKSB7CgkJdXJsID0gdXJsLnNwbGl0KCcjJylbMF07CgkJcC5wYXRoID0gbVsxXTsKCX0KCWVsc2UgaWYgKHVybCBpbiBhY3Rpb25zKSB7CgkJcC5wYXRoID0gdXJsOwoJCXVybCA9IGFjdGlvbnNbdXJsXTsKCX0KCWVsc2UgaWYgKCdkZWZhdWx0JyBpbiBhY3Rpb25zKSB7CgkJdXJsID0gYWN0aW9uc1snZGVmYXVsdCddOwoJfQoKCS8vIFJlZGlyZWN0IEhhbmRsZXIKCS8vIFRoaXMgZGVmaW5lcyBmb3IgdGhlIEZvcm0rSWZyYW1lK0hhc2ggaGFjayB3aGVyZSB0byByZXR1cm4gdGhlIHJlc3VsdHMgdG9vLgoJcC5yZWRpcmVjdF91cmkgPSBfdGhpcy5zZXR0aW5ncy5yZWRpcmVjdF91cmk7CgoJLy8gRGVmaW5lIEZvcm1hdEhhbmRsZXIKCS8vIFRoZSByZXF1ZXN0IGNhbiBiZSBwcm9jZXNlZCBpbiBhIG11bHRpdHVkZSBvZiB3YXlzCgkvLyBIZXJlJ3MgdGhlIG9wdGlvbnMgLSBkZXBlbmRpbmcgb24gdGhlIGJyb3dzZXIgYW5kIGVuZHBvaW50CglwLnhociA9IG8ueGhyOwoJcC5qc29ucCA9IG8uanNvbnA7CglwLmZvcm0gPSBvLmZvcm07CgoJLy8gTWFrZSByZXF1ZXN0CglpZiAodHlwZW9mICh1cmwpID09PSAnZnVuY3Rpb24nKSB7CgkJLy8gRG9lcyBzZWxmIGhhdmUgaXRzIG93biBjYWxsYmFjaz8KCQl1cmwocCwgZ2V0UGF0aCk7Cgl9CgllbHNlIHsKCQkvLyBFbHNlIHRoZSBVUkwgaXMgYSBzdHJpbmcKCQlnZXRQYXRoKHVybCk7Cgl9CgoJcmV0dXJuIHByb21pc2UucHJveHk7CgoJLy8gSWYgdXJsIG5lZWRzIGEgYmFzZQoJLy8gV3JhcCBldmVyeXRoaW5nIGluCglmdW5jdGlvbiBnZXRQYXRoKHVybCkgewoKCQkvLyBGb3JtYXQgdGhlIHN0cmluZyBpZiBpdCBuZWVkcyBpdAoJCXVybCA9IHVybC5yZXBsYWNlKC9cQFx7KFthLXpcX1wtXSspKFx8Lio/KT9cfS9naSwgZnVuY3Rpb24obSwga2V5LCBkZWZhdWx0cykgewoJCQl2YXIgdmFsID0gZGVmYXVsdHMgPyBkZWZhdWx0cy5yZXBsYWNlKC9eXHwvLCAnJykgOiAnJzsKCQkJaWYgKGtleSBpbiBwLnF1ZXJ5KSB7CgkJCQl2YWwgPSBwLnF1ZXJ5W2tleV07CgkJCQlkZWxldGUgcC5xdWVyeVtrZXldOwoJCQl9CgkJCWVsc2UgaWYgKHAuZGF0YSAmJiBrZXkgaW4gcC5kYXRhKSB7CgkJCQl2YWwgPSBwLmRhdGFba2V5XTsKCQkJCWRlbGV0ZSBwLmRhdGFba2V5XTsKCQkJfQoJCQllbHNlIGlmICghZGVmYXVsdHMpIHsKCQkJCXByb21pc2UucmVqZWN0KGVycm9yKCdtaXNzaW5nX2F0dHJpYnV0ZScsICdUaGUgYXR0cmlidXRlICcgKyBrZXkgKyAnIGlzIG1pc3NpbmcgZnJvbSB0aGUgcmVxdWVzdCcpKTsKCQkJfQoKCQkJcmV0dXJuIHZhbDsKCQl9KTsKCgkJLy8gQWRkIGJhc2UKCQlpZiAoIXVybC5tYXRjaCgvXmh0dHBzPzpcL1wvLykpIHsKCQkJdXJsID0gby5iYXNlICsgdXJsOwoJCX0KCgkJLy8gRGVmaW5lIHRoZSByZXF1ZXN0IFVSTAoJCXAudXJsID0gdXJsOwoKCQkvLyBNYWtlIHRoZSBIVFRQIHJlcXVlc3Qgd2l0aCB0aGUgY3VyYXRlZCByZXF1ZXN0IG9iamVjdAoJCS8vIENBTExCQUNLIEhBTkRMRVIKCQkvLyBAIHJlc3BvbnNlIG9iamVjdAoJCS8vIEAgc3RhdHVzQ29kZSBpbnRlZ2VyIGlmIGF2YWlsYWJsZQoJCXV0aWxzLnJlcXVlc3QocCwgZnVuY3Rpb24ociwgaGVhZGVycykgewoKCQkJLy8gSXMgdGhpcyBhIHJhdyByZXNwb25zZT8KCQkJaWYgKCFwLmZvcm1hdFJlc3BvbnNlKSB7CgkJCQkvLyBCYWQgcmVxdWVzdD8gZXJyb3Igc3RhdHVzQ29kZSBvciBvdGhlcndpc2UgY29udGFpbnMgYW4gZXJyb3IgcmVzcG9uc2UgdmlzIEpTT05QPwoJCQkJaWYgKHR5cGVvZiBoZWFkZXJzID09PSAnb2JqZWN0JyA/IChoZWFkZXJzLnN0YXR1c0NvZGUgPj0gNDAwKSA6ICh0eXBlb2YgciA9PT0gJ29iamVjdCcgJiYgJ2Vycm9yJyBpbiByKSkgewoJCQkJCXByb21pc2UucmVqZWN0KHIpOwoJCQkJfQoJCQkJZWxzZSB7CgkJCQkJcHJvbWlzZS5mdWxmaWxsKHIpOwoJCQkJfQoKCQkJCXJldHVybjsKCQkJfQoKCQkJLy8gU2hvdWxkIHRoaXMgYmUgYW4gb2JqZWN0CgkJCWlmIChyID09PSB0cnVlKSB7CgkJCQlyID0ge3N1Y2Nlc3M6dHJ1ZX07CgkJCX0KCQkJZWxzZSBpZiAoIXIpIHsKCQkJCXIgPSB7fTsKCQkJfQoKCQkJLy8gVGhlIGRlbGV0ZSBjYWxsYmFjayBuZWVkcyBhIGJldHRlciByZXNwb25zZQoJCQlpZiAocC5tZXRob2QgPT09ICdkZWxldGUnKSB7CgkJCQlyID0gKCFyIHx8IHV0aWxzLmlzRW1wdHkocikpID8ge3N1Y2Nlc3M6dHJ1ZX0gOiByOwoJCQl9CgoJCQkvLyBGT1JNQVQgUkVTUE9OU0U/CgkJCS8vIERvZXMgc2VsZiByZXF1ZXN0IGhhdmUgYSBjb3JyZXNwb25kaW5nIGZvcm1hdHRlcgoJCQlpZiAoby53cmFwICYmICgocC5wYXRoIGluIG8ud3JhcCkgfHwgKCdkZWZhdWx0JyBpbiBvLndyYXApKSkgewoJCQkJdmFyIHdyYXAgPSAocC5wYXRoIGluIG8ud3JhcCA/IHAucGF0aCA6ICdkZWZhdWx0Jyk7CgkJCQl2YXIgdGltZSA9IChuZXcgRGF0ZSgpKS5nZXRUaW1lKCk7CgoJCQkJLy8gRk9STUFUIFJFU1BPTlNFCgkJCQl2YXIgYiA9IG8ud3JhcFt3cmFwXShyLCBoZWFkZXJzLCBwKTsKCgkJCQkvLyBIYXMgdGhlIHJlc3BvbnNlIGJlZW4gdXR0ZXJseSBvdmVyd3JpdHRlbj8KCQkJCS8vIFR5cGljYWxseSBzZWxmIGF1Z21lbnRzIHRoZSBleGlzdGluZyBvYmplY3QuLiBidXQgZm9yIHRob3NlIHJhcmUgb2NjYXNzaW9ucwoJCQkJaWYgKGIpIHsKCQkJCQlyID0gYjsKCQkJCX0KCQkJfQoKCQkJLy8gSXMgdGhlcmUgYSBuZXh0X3BhZ2UgZGVmaW5lZCBpbiB0aGUgcmVzcG9uc2U/CgkJCWlmIChyICYmICdwYWdpbmcnIGluIHIgJiYgci5wYWdpbmcubmV4dCkgewoKCQkJCS8vIEFkZCB0aGUgcmVsYXRpdmUgcGF0aCBpZiBpdCBpcyBtaXNzaW5nIGZyb20gdGhlIHBhZ2luZy9uZXh0IHBhdGgKCQkJCWlmIChyLnBhZ2luZy5uZXh0WzBdID09PSAnPycpIHsKCQkJCQlyLnBhZ2luZy5uZXh0ID0gcC5wYXRoICsgci5wYWdpbmcubmV4dDsKCQkJCX0KCgkJCQkvLyBUaGUgcmVsYXRpdmUgcGF0aCBoYXMgYmVlbiBkZWZpbmVkLCBsZXRzIG1hcmt1cCB0aGUgaGFuZGxlciBpbiB0aGUgSGFzaEZyYWdtZW50CgkJCQllbHNlIHsKCQkJCQlyLnBhZ2luZy5uZXh0ICs9ICcjJyArIHAucGF0aDsKCQkJCX0KCQkJfQoKCQkJLy8gRGlzcGF0Y2ggdG8gbGlzdGVuZXJzCgkJCS8vIEVtaXQgZXZlbnRzIHdoaWNoIHBlcnRhaW4gdG8gdGhlIGZvcm1hdHRlZCByZXNwb25zZQoJCQlpZiAoIXIgfHwgJ2Vycm9yJyBpbiByKSB7CgkJCQlwcm9taXNlLnJlamVjdChyKTsKCQkJfQoJCQllbHNlIHsKCQkJCXByb21pc2UuZnVsZmlsbChyKTsKCQkJfQoJCX0pOwoJfQp9OwoKLy8gQVBJIHV0aWxpdGllcwpoZWxsby51dGlscy5leHRlbmQoaGVsbG8udXRpbHMsIHsKCgkvLyBNYWtlIGFuIEhUVFAgcmVxdWVzdAoJcmVxdWVzdDogZnVuY3Rpb24ocCwgY2FsbGJhY2spIHsKCgkJdmFyIF90aGlzID0gdGhpczsKCQl2YXIgZXJyb3IgPSBfdGhpcy5lcnJvcjsKCgkJLy8gVGhpcyBoYXMgdG8gZ28gdGhyb3VnaCBhIFBPU1QgcmVxdWVzdAoJCWlmICghX3RoaXMuaXNFbXB0eShwLmRhdGEpICYmICEoJ0ZpbGVMaXN0JyBpbiB3aW5kb3cpICYmIF90aGlzLmhhc0JpbmFyeShwLmRhdGEpKSB7CgoJCQkvLyBEaXNhYmxlIFhIUiBhbmQgSlNPTlAKCQkJcC54aHIgPSBmYWxzZTsKCQkJcC5qc29ucCA9IGZhbHNlOwoJCX0KCgkJLy8gQ2hlY2sgaWYgdGhlIGJyb3dzZXIgYW5kIHNlcnZpY2Ugc3VwcG9ydCBDT1JTCgkJdmFyIGNvcnMgPSB0aGlzLnJlcXVlc3RfY29ycyhmdW5jdGlvbigpIHsKCQkJLy8gSWYgaXQgZG9lcyB0aGVuIHJ1biB0aGlzLi4uCgkJCXJldHVybiAoKHAueGhyID09PSB1bmRlZmluZWQpIHx8IChwLnhociAmJiAodHlwZW9mIChwLnhocikgIT09ICdmdW5jdGlvbicgfHwgcC54aHIocCwgcC5xdWVyeSkpKSk7CgkJfSk7CgoJCWlmIChjb3JzKSB7CgoJCQlmb3JtYXRVcmwocCwgZnVuY3Rpb24odXJsKSB7CgoJCQkJdmFyIHggPSBfdGhpcy54aHIocC5tZXRob2QsIHVybCwgcC5oZWFkZXJzLCBwLmRhdGEsIGNhbGxiYWNrKTsKCQkJCXgub25wcm9ncmVzcyA9IHAub25wcm9ncmVzcyB8fCBudWxsOwoKCQkJCS8vIFdpbmRvd3MgUGhvbmUgZG9lcyBub3Qgc3VwcG9ydCB4aHIudXBsb2FkLCBzZWUgIzc0CgkJCQkvLyBGZWF0dXJlIGRldGVjdAoJCQkJaWYgKHgudXBsb2FkICYmIHAub251cGxvYWRwcm9ncmVzcykgewoJCQkJCXgudXBsb2FkLm9ucHJvZ3Jlc3MgPSBwLm9udXBsb2FkcHJvZ3Jlc3M7CgkJCQl9CgoJCQl9KTsKCgkJCXJldHVybjsKCQl9CgoJCS8vIENsb25lIHRoZSBxdWVyeSBvYmplY3QKCQkvLyBFYWNoIHJlcXVlc3QgbW9kaWZpZXMgdGhlIHF1ZXJ5IG9iamVjdCBhbmQgbmVlZHMgdG8gYmUgdGFyZWQgYWZ0ZXIgZWFjaCBvbmUuCgkJdmFyIF9xdWVyeSA9IHAucXVlcnk7CgoJCXAucXVlcnkgPSBfdGhpcy5jbG9uZShwLnF1ZXJ5KTsKCgkJLy8gQXNzaWduIGEgbmV3IGNhbGxiYWNrSUQKCQlwLmNhbGxiYWNrSUQgPSBfdGhpcy5nbG9iYWxFdmVudCgpOwoKCQkvLyBKU09OUAoJCWlmIChwLmpzb25wICE9PSBmYWxzZSkgewoKCQkJLy8gQ2xvbmUgdGhlIHF1ZXJ5IG9iamVjdAoJCQlwLnF1ZXJ5LmNhbGxiYWNrID0gcC5jYWxsYmFja0lEOwoKCQkJLy8gSWYgdGhlIEpTT05QIGlzIGEgZnVuY3Rpb24gdGhlbiBydW4gaXQKCQkJaWYgKHR5cGVvZiAocC5qc29ucCkgPT09ICdmdW5jdGlvbicpIHsKCQkJCXAuanNvbnAocCwgcC5xdWVyeSk7CgkJCX0KCgkJCS8vIExldHMgdXNlIEpTT05QIGlmIHRoZSBtZXRob2QgaXMgJ2dldCcKCQkJaWYgKHAubWV0aG9kID09PSAnZ2V0JykgewoKCQkJCWZvcm1hdFVybChwLCBmdW5jdGlvbih1cmwpIHsKCQkJCQlfdGhpcy5qc29ucCh1cmwsIGNhbGxiYWNrLCBwLmNhbGxiYWNrSUQsIHAudGltZW91dCk7CgkJCQl9KTsKCgkJCQlyZXR1cm47CgkJCX0KCQkJZWxzZSB7CgkJCQkvLyBJdCdzIG5vdCBjb21wYXRpYmxlIHJlc2V0IHF1ZXJ5CgkJCQlwLnF1ZXJ5ID0gX3F1ZXJ5OwoJCQl9CgoJCX0KCgkJLy8gT3RoZXJ3aXNlIHdlJ3JlIG9uIHRvIHRoZSBvbGQgc2Nob29sLCBpZnJhbWUgaGFja3MgYW5kIEpTT05QCgkJaWYgKHAuZm9ybSAhPT0gZmFsc2UpIHsKCgkJCS8vIEFkZCBzb21lIGFkZGl0aW9uYWwgcXVlcnkgcGFyYW1ldGVycyB0byB0aGUgVVJMCgkJCS8vIFdlJ3JlIHByZXR0eSBzdHVmZmVkIGlmIHRoZSBlbmRwb2ludCBkb2Vzbid0IGxpa2UgdGhlc2UKCQkJcC5xdWVyeS5yZWRpcmVjdF91cmkgPSBwLnJlZGlyZWN0X3VyaTsKCQkJcC5xdWVyeS5zdGF0ZSA9IEpTT04uc3RyaW5naWZ5KHtjYWxsYmFjazpwLmNhbGxiYWNrSUR9KTsKCgkJCXZhciBvcHRzOwoKCQkJaWYgKHR5cGVvZiAocC5mb3JtKSA9PT0gJ2Z1bmN0aW9uJykgewoKCQkJCS8vIEZvcm1hdCB0aGUgcmVxdWVzdAoJCQkJb3B0cyA9IHAuZm9ybShwLCBwLnF1ZXJ5KTsKCQkJfQoKCQkJaWYgKHAubWV0aG9kID09PSAncG9zdCcgJiYgb3B0cyAhPT0gZmFsc2UpIHsKCgkJCQlmb3JtYXRVcmwocCwgZnVuY3Rpb24odXJsKSB7CgkJCQkJX3RoaXMucG9zdCh1cmwsIHAuZGF0YSwgb3B0cywgY2FsbGJhY2ssIHAuY2FsbGJhY2tJRCwgcC50aW1lb3V0KTsKCQkJCX0pOwoKCQkJCXJldHVybjsKCQkJfQoJCX0KCgkJLy8gTm9uZSBvZiB0aGUgbWV0aG9kcyB3ZXJlIHN1Y2Nlc3NmdWwgdGhyb3cgYW4gZXJyb3IKCQljYWxsYmFjayhlcnJvcignaW52YWxpZF9yZXF1ZXN0JywgJ1RoZXJlIHdhcyBubyBtZWNoYW5pc20gZm9yIGhhbmRsaW5nIHRoaXMgcmVxdWVzdCcpKTsKCgkJcmV0dXJuOwoKCQkvLyBGb3JtYXQgVVJMCgkJLy8gQ29uc3RydWN0cyB0aGUgcmVxdWVzdCBVUkwsIG9wdGlvbmFsbHkgd3JhcHMgdGhlIFVSTCB0aHJvdWdoIGEgY2FsbCB0byBhIHByb3h5IHNlcnZlcgoJCS8vIFJldHVybnMgdGhlIGZvcm1hdHRlZCBVUkwKCQlmdW5jdGlvbiBmb3JtYXRVcmwocCwgY2FsbGJhY2spIHsKCgkJCS8vIEFyZSB3ZSBzaWduaW5nIHRoZSByZXF1ZXN0PwoJCQl2YXIgc2lnbjsKCgkJCS8vIE9BdXRoMQoJCQkvLyBSZW1vdmUgdGhlIHRva2VuIGZyb20gdGhlIHF1ZXJ5IGJlZm9yZSBzaWduaW5nCgkJCWlmIChwLmF1dGhSZXNwb25zZSAmJiBwLmF1dGhSZXNwb25zZS5vYXV0aCAmJiBwYXJzZUludChwLmF1dGhSZXNwb25zZS5vYXV0aC52ZXJzaW9uLCAxMCkgPT09IDEpIHsKCgkJCQkvLyBPQVVUSCBTSUdOSU5HIFBST1hZCgkJCQlzaWduID0gcC5xdWVyeS5hY2Nlc3NfdG9rZW47CgoJCQkJLy8gUmVtb3ZlIHRoZSBhY2Nlc3NfdG9rZW4KCQkJCWRlbGV0ZSBwLnF1ZXJ5LmFjY2Vzc190b2tlbjsKCgkJCQkvLyBFbmZvcmUgdXNlIG9mIFByb3h5CgkJCQlwLnByb3h5ID0gdHJ1ZTsKCQkJfQoKCQkJLy8gUE9TVCBib2R5IHRvIHF1ZXJ5c3RyaW5nCgkJCWlmIChwLmRhdGEgJiYgKHAubWV0aG9kID09PSAnZ2V0JyB8fCBwLm1ldGhvZCA9PT0gJ2RlbGV0ZScpKSB7CgkJCQkvLyBBdHRhY2ggdGhlIHAuZGF0YSB0byB0aGUgcXVlcnlzdHJpbmcuCgkJCQlfdGhpcy5leHRlbmQocC5xdWVyeSwgcC5kYXRhKTsKCQkJCXAuZGF0YSA9IG51bGw7CgkJCX0KCgkJCS8vIENvbnN0cnVjdCB0aGUgcGF0aAoJCQl2YXIgcGF0aCA9IF90aGlzLnFzKHAudXJsLCBwLnF1ZXJ5KTsKCgkJCS8vIFByb3h5IHRoZSByZXF1ZXN0IHRocm91Z2ggYSBzZXJ2ZXIKCQkJLy8gVXNlZCBmb3Igc2lnbmluZyBPQXV0aDEKCQkJLy8gQW5kIGNpcmN1bXZlbnRpbmcgc2VydmljZXMgd2l0aG91dCBBY2Nlc3MtQ29udHJvbCBIZWFkZXJzCgkJCWlmIChwLnByb3h5KSB7CgkJCQkvLyBVc2UgdGhlIHByb3h5IGFzIGEgcGF0aAoJCQkJcGF0aCA9IF90aGlzLnFzKHAub2F1dGhfcHJveHksIHsKCQkJCQlwYXRoOiBwYXRoLAoJCQkJCWFjY2Vzc190b2tlbjogc2lnbiB8fCAnJywKCgkJCQkJLy8gVGhpcyB3aWxsIHByb21wdCB0aGUgcmVxdWVzdCB0byBiZSBzaWduZWQgYXMgdGhvdWdoIGl0IGlzIE9BdXRoMQoJCQkJCXRoZW46IHAucHJveHlfcmVzcG9uc2VfdHlwZSB8fCAocC5tZXRob2QudG9Mb3dlckNhc2UoKSA9PT0gJ2dldCcgPyAncmVkaXJlY3QnIDogJ3Byb3h5JyksCgkJCQkJbWV0aG9kOiBwLm1ldGhvZC50b0xvd2VyQ2FzZSgpLAoJCQkJCXN1cHByZXNzX3Jlc3BvbnNlX2NvZGVzOiB0cnVlCgkJCQl9KTsKCQkJfQoKCQkJY2FsbGJhY2socGF0aCk7CgkJfQoJfSwKCgkvLyBUZXN0IHdoZXRoZXIgdGhlIGJyb3dzZXIgc3VwcG9ydHMgdGhlIENPUlMgcmVzcG9uc2UKCXJlcXVlc3RfY29yczogZnVuY3Rpb24oY2FsbGJhY2spIHsKCQlyZXR1cm4gJ3dpdGhDcmVkZW50aWFscycgaW4gbmV3IFhNTEh0dHBSZXF1ZXN0KCkgJiYgY2FsbGJhY2soKTsKCX0sCgoJLy8gUmV0dXJuIHRoZSB0eXBlIG9mIERPTSBvYmplY3QKCWRvbUluc3RhbmNlOiBmdW5jdGlvbih0eXBlLCBkYXRhKSB7CgkJdmFyIHRlc3QgPSAnSFRNTCcgKyAodHlwZSB8fCAnJykucmVwbGFjZSgKCQkJL15bYS16XS8sCgkJCWZ1bmN0aW9uKG0pIHsKCQkJCXJldHVybiBtLnRvVXBwZXJDYXNlKCk7CgkJCX0KCgkJKSArICdFbGVtZW50JzsKCgkJaWYgKCFkYXRhKSB7CgkJCXJldHVybiBmYWxzZTsKCQl9CgoJCWlmICh3aW5kb3dbdGVzdF0pIHsKCQkJcmV0dXJuIGRhdGEgaW5zdGFuY2VvZiB3aW5kb3dbdGVzdF07CgkJfQoJCWVsc2UgaWYgKHdpbmRvdy5FbGVtZW50KSB7CgkJCXJldHVybiBkYXRhIGluc3RhbmNlb2Ygd2luZG93LkVsZW1lbnQgJiYgKCF0eXBlIHx8IChkYXRhLnRhZ05hbWUgJiYgZGF0YS50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IHR5cGUpKTsKCQl9CgkJZWxzZSB7CgkJCXJldHVybiAoIShkYXRhIGluc3RhbmNlb2YgT2JqZWN0IHx8IGRhdGEgaW5zdGFuY2VvZiBBcnJheSB8fCBkYXRhIGluc3RhbmNlb2YgU3RyaW5nIHx8IGRhdGEgaW5zdGFuY2VvZiBOdW1iZXIpICYmIGRhdGEudGFnTmFtZSAmJiBkYXRhLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gdHlwZSk7CgkJfQoJfSwKCgkvLyBDcmVhdGUgYSBjbG9uZSBvZiBhbiBvYmplY3QKCWNsb25lOiBmdW5jdGlvbihvYmopIHsKCQkvLyBEb2VzIG5vdCBjbG9uZSBET00gZWxlbWVudHMsIG5vciBCaW5hcnkgZGF0YSwgZS5nLiBCbG9icywgRmlsZWxpc3RzCgkJaWYgKG9iaiA9PT0gbnVsbCB8fCB0eXBlb2YgKG9iaikgIT09ICdvYmplY3QnIHx8IG9iaiBpbnN0YW5jZW9mIERhdGUgfHwgJ25vZGVOYW1lJyBpbiBvYmogfHwgdGhpcy5pc0JpbmFyeShvYmopKSB7CgkJCXJldHVybiBvYmo7CgkJfQoKCQlpZiAoQXJyYXkuaXNBcnJheShvYmopKSB7CgkJCS8vIENsb25lIGVhY2ggaXRlbSBpbiB0aGUgYXJyYXkKCQkJcmV0dXJuIG9iai5tYXAodGhpcy5jbG9uZS5iaW5kKHRoaXMpKTsKCQl9CgoJCS8vIEJ1dCBkb2VzIGNsb25lIGV2ZXJ5dGhpbmcgZWxzZS4KCQl2YXIgY2xvbmUgPSB7fTsKCQlmb3IgKHZhciB4IGluIG9iaikgewoJCQljbG9uZVt4XSA9IHRoaXMuY2xvbmUob2JqW3hdKTsKCQl9CgoJCXJldHVybiBjbG9uZTsKCX0sCgoJLy8gWEhSOiB1c2VzIENPUlMgdG8gbWFrZSByZXF1ZXN0cwoJeGhyOiBmdW5jdGlvbihtZXRob2QsIHVybCwgaGVhZGVycywgZGF0YSwgY2FsbGJhY2spIHsKCgkJdmFyIHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKCQl2YXIgZXJyb3IgPSB0aGlzLmVycm9yOwoKCQkvLyBCaW5hcnk/CgkJdmFyIGJpbmFyeSA9IGZhbHNlOwoJCWlmIChtZXRob2QgPT09ICdibG9iJykgewoJCQliaW5hcnkgPSBtZXRob2Q7CgkJCW1ldGhvZCA9ICdHRVQnOwoJCX0KCgkJbWV0aG9kID0gbWV0aG9kLnRvVXBwZXJDYXNlKCk7CgoJCS8vIFhoci5yZXNwb25zZVR5cGUgJ2pzb24nIGlzIG5vdCBzdXBwb3J0ZWQgaW4gYW55IG9mIHRoZSB2ZW5kb3JzIHlldC4KCQlyLm9ubG9hZCA9IGZ1bmN0aW9uKGUpIHsKCQkJdmFyIGpzb24gPSByLnJlc3BvbnNlOwoJCQl0cnkgewoJCQkJanNvbiA9IEpTT04ucGFyc2Uoci5yZXNwb25zZVRleHQpOwoJCQl9CgkJCWNhdGNoIChfZSkgewoJCQkJaWYgKHIuc3RhdHVzID09PSA0MDEpIHsKCQkJCQlqc29uID0gZXJyb3IoJ2FjY2Vzc19kZW5pZWQnLCByLnN0YXR1c1RleHQpOwoJCQkJfQoJCQl9CgoJCQl2YXIgaGVhZGVycyA9IGhlYWRlcnNUb0pTT04oci5nZXRBbGxSZXNwb25zZUhlYWRlcnMoKSk7CgkJCWhlYWRlcnMuc3RhdHVzQ29kZSA9IHIuc3RhdHVzOwoKCQkJY2FsbGJhY2soanNvbiB8fCAobWV0aG9kID09PSAnR0VUJyA/IGVycm9yKCdlbXB0eV9yZXNwb25zZScsICdDb3VsZCBub3QgZ2V0IHJlc291cmNlJykgOiB7fSksIGhlYWRlcnMpOwoJCX07CgoJCXIub25lcnJvciA9IGZ1bmN0aW9uKGUpIHsKCQkJdmFyIGpzb24gPSByLnJlc3BvbnNlVGV4dDsKCQkJdHJ5IHsKCQkJCWpzb24gPSBKU09OLnBhcnNlKHIucmVzcG9uc2VUZXh0KTsKCQkJfQoJCQljYXRjaCAoX2UpIHt9CgoJCQljYWxsYmFjayhqc29uIHx8IGVycm9yKCdhY2Nlc3NfZGVuaWVkJywgJ0NvdWxkIG5vdCBnZXQgcmVzb3VyY2UnKSk7CgkJfTsKCgkJdmFyIHg7CgoJCS8vIFNob3VsZCB3ZSBhZGQgdGhlIHF1ZXJ5IHRvIHRoZSBVUkw/CgkJaWYgKG1ldGhvZCA9PT0gJ0dFVCcgfHwgbWV0aG9kID09PSAnREVMRVRFJykgewoJCQlkYXRhID0gbnVsbDsKCQl9CgkJZWxzZSBpZiAoZGF0YSAmJiB0eXBlb2YgKGRhdGEpICE9PSAnc3RyaW5nJyAmJiAhKGRhdGEgaW5zdGFuY2VvZiBGb3JtRGF0YSkgJiYgIShkYXRhIGluc3RhbmNlb2YgRmlsZSkgJiYgIShkYXRhIGluc3RhbmNlb2YgQmxvYikpIHsKCQkJLy8gTG9vcCB0aHJvdWdoIGFuZCBhZGQgZm9ybURhdGEKCQkJdmFyIGYgPSBuZXcgRm9ybURhdGEoKTsKCQkJZm9yICh4IGluIGRhdGEpIGlmIChkYXRhLmhhc093blByb3BlcnR5KHgpKSB7CgkJCQlpZiAoZGF0YVt4XSBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpIHsKCQkJCQlpZiAoJ2ZpbGVzJyBpbiBkYXRhW3hdICYmIGRhdGFbeF0uZmlsZXMubGVuZ3RoID4gMCkgewoJCQkJCQlmLmFwcGVuZCh4LCBkYXRhW3hdLmZpbGVzWzBdKTsKCQkJCQl9CgkJCQl9CgkJCQllbHNlIGlmIChkYXRhW3hdIGluc3RhbmNlb2YgQmxvYikgewoJCQkJCWYuYXBwZW5kKHgsIGRhdGFbeF0sIGRhdGEubmFtZSk7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlmLmFwcGVuZCh4LCBkYXRhW3hdKTsKCQkJCX0KCQkJfQoKCQkJZGF0YSA9IGY7CgkJfQoKCQkvLyBPcGVuIHRoZSBwYXRoLCBhc3luYwoJCXIub3BlbihtZXRob2QsIHVybCwgdHJ1ZSk7CgoJCWlmIChiaW5hcnkpIHsKCQkJaWYgKCdyZXNwb25zZVR5cGUnIGluIHIpIHsKCQkJCXIucmVzcG9uc2VUeXBlID0gYmluYXJ5OwoJCQl9CgkJCWVsc2UgewoJCQkJci5vdmVycmlkZU1pbWVUeXBlKCd0ZXh0L3BsYWluOyBjaGFyc2V0PXgtdXNlci1kZWZpbmVkJyk7CgkJCX0KCQl9CgoJCS8vIFNldCBhbnkgYmVzcG9rZSBoZWFkZXJzCgkJaWYgKGhlYWRlcnMpIHsKCQkJZm9yICh4IGluIGhlYWRlcnMpIHsKCQkJCXIuc2V0UmVxdWVzdEhlYWRlcih4LCBoZWFkZXJzW3hdKTsKCQkJfQoJCX0KCgkJci5zZW5kKGRhdGEpOwoKCQlyZXR1cm4gcjsKCgkJLy8gSGVhZGVycyBhcmUgcmV0dXJuZWQgYXMgYSBzdHJpbmcKCQlmdW5jdGlvbiBoZWFkZXJzVG9KU09OKHMpIHsKCQkJdmFyIHIgPSB7fTsKCQkJdmFyIHJlZyA9IC8oW2EtelwtXSspOlxzPyguKik7Py9naTsKCQkJdmFyIG07CgkJCXdoaWxlICgobSA9IHJlZy5leGVjKHMpKSkgewoJCQkJclttWzFdXSA9IG1bMl07CgkJCX0KCgkJCXJldHVybiByOwoJCX0KCX0sCgoJLy8gSlNPTlAKCS8vIEluamVjdHMgYSBzY3JpcHQgdGFnIGludG8gdGhlIERPTSB0byBiZSBleGVjdXRlZCBhbmQgYXBwZW5kcyBhIGNhbGxiYWNrIGZ1bmN0aW9uIHRvIHRoZSB3aW5kb3cgb2JqZWN0CgkvLyBAcGFyYW0gc3RyaW5nL2Z1bmN0aW9uIHBhdGhGdW5jIGVpdGhlciBhIHN0cmluZyBvZiB0aGUgVVJMIG9yIGEgY2FsbGJhY2sgZnVuY3Rpb24gcGF0aEZ1bmMocXVlcnlzdHJpbmdoYXNoLCBjb250aW51ZUZ1bmMpOwoJLy8gQHBhcmFtIGZ1bmN0aW9uIGNhbGxiYWNrIGEgZnVuY3Rpb24gdG8gY2FsbCBvbiBjb21wbGV0aW9uOwoJanNvbnA6IGZ1bmN0aW9uKHVybCwgY2FsbGJhY2ssIGNhbGxiYWNrSUQsIHRpbWVvdXQpIHsKCgkJdmFyIF90aGlzID0gdGhpczsKCQl2YXIgZXJyb3IgPSBfdGhpcy5lcnJvcjsKCgkJLy8gQ2hhbmdlIHRoZSBuYW1lIG9mIHRoZSBjYWxsYmFjawoJCXZhciBib29sID0gMDsKCQl2YXIgaGVhZCA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdoZWFkJylbMF07CgkJdmFyIG9wZXJhRml4OwoJCXZhciByZXN1bHQgPSBlcnJvcignc2VydmVyX2Vycm9yJywgJ3NlcnZlcl9lcnJvcicpOwoJCXZhciBjYiA9IGZ1bmN0aW9uKCkgewoJCQlpZiAoIShib29sKyspKSB7CgkJCQl3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHsKCQkJCQljYWxsYmFjayhyZXN1bHQpOwoJCQkJCWhlYWQucmVtb3ZlQ2hpbGQoc2NyaXB0KTsKCQkJCX0sIDApOwoJCQl9CgoJCX07CgoJCS8vIEFkZCBjYWxsYmFjayB0byB0aGUgd2luZG93IG9iamVjdAoJCWNhbGxiYWNrSUQgPSBfdGhpcy5nbG9iYWxFdmVudChmdW5jdGlvbihqc29uKSB7CgkJCXJlc3VsdCA9IGpzb247CgkJCXJldHVybiB0cnVlOwoKCQkJLy8gTWFyayBjYWxsYmFjayBhcyBkb25lCgkJfSwgY2FsbGJhY2tJRCk7CgoJCS8vIFRoZSBVUkwgaXMgYSBmdW5jdGlvbiBmb3Igc29tZSBjYXNlcyBhbmQgYXMgc3VjaAoJCS8vIERldGVybWluZSBpdHMgdmFsdWUgd2l0aCBhIGNhbGxiYWNrIGNvbnRhaW5pbmcgdGhlIG5ldyBwYXJhbWV0ZXJzIG9mIHRoaXMgZnVuY3Rpb24uCgkJdXJsID0gdXJsLnJlcGxhY2UobmV3IFJlZ0V4cCgnPVxcPygmfCQpJyksICc9JyArIGNhbGxiYWNrSUQgKyAnJDEnKTsKCgkJLy8gQnVpbGQgc2NyaXB0IHRhZwoJCXZhciBzY3JpcHQgPSBfdGhpcy5hcHBlbmQoJ3NjcmlwdCcsIHsKCQkJaWQ6IGNhbGxiYWNrSUQsCgkJCW5hbWU6IGNhbGxiYWNrSUQsCgkJCXNyYzogdXJsLAoJCQlhc3luYzogdHJ1ZSwKCQkJb25sb2FkOiBjYiwKCQkJb25lcnJvcjogY2IsCgkJCW9ucmVhZHlzdGF0ZWNoYW5nZTogZnVuY3Rpb24oKSB7CgkJCQlpZiAoL2xvYWRlZHxjb21wbGV0ZS9pLnRlc3QodGhpcy5yZWFkeVN0YXRlKSkgewoJCQkJCWNiKCk7CgkJCQl9CgkJCX0KCQl9KTsKCgkJLy8gT3BlcmEgZml4IGVycm9yCgkJLy8gUHJvYmxlbTogSWYgYW4gZXJyb3Igb2NjdXJzIHdpdGggc2NyaXB0IGxvYWRpbmcgT3BlcmEgZmFpbHMgdG8gdHJpZ2dlciB0aGUgc2NyaXB0Lm9uZXJyb3IgaGFuZGxlciB3ZSBzcGVjaWZpZWQKCQkvLwoJCS8vIEZpeDoKCQkvLyBCeSBzZXR0aW5nIHRoZSByZXF1ZXN0IHRvIHN5bmNocm9ub3VzIHdlIGNhbiB0cmlnZ2VyIHRoZSBlcnJvciBoYW5kbGVyIHdoZW4gYWxsIGVsc2UgZmFpbHMuCgkJLy8gVGhpcyBhY3Rpb24gd2lsbCBiZSBpZ25vcmVkIGlmIHdlJ3ZlIGFscmVhZHkgY2FsbGVkIHRoZSBjYWxsYmFjayBoYW5kbGVyICJjYiIgd2l0aCBhIHN1Y2Nlc3NmdWwgb25sb2FkIGV2ZW50CgkJaWYgKHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZignb3BlcmEnKSA+IC0xKSB7CgkJCW9wZXJhRml4ID0gX3RoaXMuYXBwZW5kKCdzY3JpcHQnLCB7CgkJCQl0ZXh0OiAnZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCcnICsgY2FsbGJhY2tJRCArICdcJykub25lcnJvcigpOycKCQkJfSk7CgkJCXNjcmlwdC5hc3luYyA9IGZhbHNlOwoJCX0KCgkJLy8gQWRkIHRpbWVvdXQKCQlpZiAodGltZW91dCkgewoJCQl3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbigpIHsKCQkJCXJlc3VsdCA9IGVycm9yKCd0aW1lb3V0JywgJ3RpbWVvdXQnKTsKCQkJCWNiKCk7CgkJCX0sIHRpbWVvdXQpOwoJCX0KCgkJLy8gVE9ETzogYWRkIGZpeCBmb3IgSUUsCgkJLy8gSG93ZXZlcjogdW5hYmxlIHJlY3JlYXRlIHRoZSBidWcgb2YgZmlyaW5nIG9mZiB0aGUgb25yZWFkeXN0YXRlY2hhbmdlIGJlZm9yZSB0aGUgc2NyaXB0IGNvbnRlbnQgaGFzIGJlZW4gZXhlY3V0ZWQgYW5kIHRoZSB2YWx1ZSBvZiAicmVzdWx0IiBoYXMgYmVlbiBkZWZpbmVkLgoJCS8vIEluamVjdCBzY3JpcHQgdGFnIGludG8gdGhlIGhlYWQgZWxlbWVudAoJCWhlYWQuYXBwZW5kQ2hpbGQoc2NyaXB0KTsKCgkJLy8gQXBwZW5kIE9wZXJhIEZpeCB0byBydW4gYWZ0ZXIgb3VyIHNjcmlwdAoJCWlmIChvcGVyYUZpeCkgewoJCQloZWFkLmFwcGVuZENoaWxkKG9wZXJhRml4KTsKCQl9Cgl9LAoKCS8vIFBvc3QKCS8vIFNlbmQgaW5mb3JtYXRpb24gdG8gYSByZW1vdGUgbG9jYXRpb24gdXNpbmcgdGhlIHBvc3QgbWVjaGFuaXNtCgkvLyBAcGFyYW0gc3RyaW5nIHVyaSBwYXRoCgkvLyBAcGFyYW0gb2JqZWN0IGRhdGEsIGtleSB2YWx1ZSBkYXRhIHRvIHNlbmQKCS8vIEBwYXJhbSBmdW5jdGlvbiBjYWxsYmFjaywgZnVuY3Rpb24gdG8gZXhlY3V0ZSBpbiByZXNwb25zZQoJcG9zdDogZnVuY3Rpb24odXJsLCBkYXRhLCBvcHRpb25zLCBjYWxsYmFjaywgY2FsbGJhY2tJRCwgdGltZW91dCkgewoKCQl2YXIgX3RoaXMgPSB0aGlzOwoJCXZhciBlcnJvciA9IF90aGlzLmVycm9yOwoJCXZhciBkb2MgPSBkb2N1bWVudDsKCgkJLy8gVGhpcyBoYWNrIG5lZWRzIGEgZm9ybQoJCXZhciBmb3JtID0gbnVsbDsKCQl2YXIgcmVlbmFibGVBZnRlclN1Ym1pdCA9IFtdOwoJCXZhciBuZXdmb3JtOwoJCXZhciBpID0gMDsKCQl2YXIgeCA9IG51bGw7CgkJdmFyIGJvb2wgPSAwOwoJCXZhciBjYiA9IGZ1bmN0aW9uKHIpIHsKCQkJaWYgKCEoYm9vbCsrKSkgewoJCQkJY2FsbGJhY2socik7CgkJCX0KCQl9OwoKCQkvLyBXaGF0IGlzIHRoZSBuYW1lIG9mIHRoZSBjYWxsYmFjayB0byBjb250YWluCgkJLy8gV2UnbGwgYWxzbyB1c2UgdGhpcyB0byBuYW1lIHRoZSBpZnJhbWUKCQlfdGhpcy5nbG9iYWxFdmVudChjYiwgY2FsbGJhY2tJRCk7CgoJCS8vIEJ1aWxkIHRoZSBpZnJhbWUgd2luZG93CgkJdmFyIHdpbjsKCQl0cnkgewoJCQkvLyBJRTcgaGFjaywgb25seSBsZXRzIHVzIGRlZmluZSB0aGUgbmFtZSBoZXJlLCBub3QgbGF0ZXIuCgkJCXdpbiA9IGRvYy5jcmVhdGVFbGVtZW50KCc8aWZyYW1lIG5hbWU9IicgKyBjYWxsYmFja0lEICsgJyI+Jyk7CgkJfQoJCWNhdGNoIChlKSB7CgkJCXdpbiA9IGRvYy5jcmVhdGVFbGVtZW50KCdpZnJhbWUnKTsKCQl9CgoJCXdpbi5uYW1lID0gY2FsbGJhY2tJRDsKCQl3aW4uaWQgPSBjYWxsYmFja0lEOwoJCXdpbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwoKCQkvLyBPdmVycmlkZSBjYWxsYmFjayBtZWNoYW5pc20uIFRyaWdnZ2VyIGEgcmVzcG9uc2Ugb25sb2FkL29uZXJyb3IKCQlpZiAob3B0aW9ucyAmJiBvcHRpb25zLmNhbGxiYWNrb25sb2FkKSB7CgkJCS8vIE9ubG9hZCBpcyBiZWluZyBmaXJlZCB0d2ljZQoJCQl3aW4ub25sb2FkID0gZnVuY3Rpb24oKSB7CgkJCQljYih7CgkJCQkJcmVzcG9uc2U6ICdwb3N0ZWQnLAoJCQkJCW1lc3NhZ2U6ICdDb250ZW50IHdhcyBwb3N0ZWQnCgkJCQl9KTsKCQkJfTsKCQl9CgoJCWlmICh0aW1lb3V0KSB7CgkJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCQljYihlcnJvcigndGltZW91dCcsICdUaGUgcG9zdCBvcGVyYXRpb24gdGltZWQgb3V0JykpOwoJCQl9LCB0aW1lb3V0KTsKCQl9CgoJCWRvYy5ib2R5LmFwcGVuZENoaWxkKHdpbik7CgoJCS8vIElmIHdlIGFyZSBqdXN0IHBvc3RpbmcgYSBzaW5nbGUgaXRlbQoJCWlmIChfdGhpcy5kb21JbnN0YW5jZSgnZm9ybScsIGRhdGEpKSB7CgkJCS8vIEdldCB0aGUgcGFyZW50IGZvcm0KCQkJZm9ybSA9IGRhdGEuZm9ybTsKCgkJCS8vIExvb3AgdGhyb3VnaCBhbmQgZGlzYWJsZSBhbGwgb2YgaXRzIHNpYmxpbmdzCgkJCWZvciAoaSA9IDA7IGkgPCBmb3JtLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAoZm9ybS5lbGVtZW50c1tpXSAhPT0gZGF0YSkgewoJCQkJCWZvcm0uZWxlbWVudHNbaV0uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsIHRydWUpOwoJCQkJfQoJCQl9CgoJCQkvLyBNb3ZlIHRoZSBmb2N1cyB0byB0aGUgZm9ybQoJCQlkYXRhID0gZm9ybTsKCQl9CgoJCS8vIFBvc3RpbmcgYSBmb3JtCgkJaWYgKF90aGlzLmRvbUluc3RhbmNlKCdmb3JtJywgZGF0YSkpIHsKCQkJLy8gVGhpcyBpcyBhIGZvcm0gZWxlbWVudAoJCQlmb3JtID0gZGF0YTsKCgkJCS8vIERvZXMgdGhpcyBmb3JtIG5lZWQgdG8gYmUgYSBtdWx0aXBhcnQgZm9ybT8KCQkJZm9yIChpID0gMDsgaSA8IGZvcm0uZWxlbWVudHMubGVuZ3RoOyBpKyspIHsKCQkJCWlmICghZm9ybS5lbGVtZW50c1tpXS5kaXNhYmxlZCAmJiBmb3JtLmVsZW1lbnRzW2ldLnR5cGUgPT09ICdmaWxlJykgewoJCQkJCWZvcm0uZW5jb2RpbmcgPSBmb3JtLmVuY3R5cGUgPSAnbXVsdGlwYXJ0L2Zvcm0tZGF0YSc7CgkJCQkJZm9ybS5lbGVtZW50c1tpXS5zZXRBdHRyaWJ1dGUoJ25hbWUnLCAnZmlsZScpOwoJCQkJfQoJCQl9CgkJfQoJCWVsc2UgewoJCQkvLyBJdHMgbm90IGEgZm9ybSBlbGVtZW50LAoJCQkvLyBUaGVyZWZvcmUgaXQgbXVzdCBiZSBhIEpTT04gb2JqZWN0IG9mIEtleT0+VmFsdWUgb3IgS2V5PT5FbGVtZW50CgkJCS8vIElmIGFueW9uZSBvZiB0aG9zZSB2YWx1ZXMgYXJlIGEgaW5wdXQgdHlwZT1maWxlIHdlIHNoYWxsIHNoYWxsIGluc2VydCBpdHMgc2libGluZ3MgaW50byB0aGUgZm9ybSBmb3Igd2hpY2ggaXQgYmVsb25ncy4KCQkJZm9yICh4IGluIGRhdGEpIGlmIChkYXRhLmhhc093blByb3BlcnR5KHgpKSB7CgkJCQkvLyBJcyB0aGlzIGFuIGlucHV0IEVsZW1lbnQ/CgkJCQlpZiAoX3RoaXMuZG9tSW5zdGFuY2UoJ2lucHV0JywgZGF0YVt4XSkgJiYgZGF0YVt4XS50eXBlID09PSAnZmlsZScpIHsKCQkJCQlmb3JtID0gZGF0YVt4XS5mb3JtOwoJCQkJCWZvcm0uZW5jb2RpbmcgPSBmb3JtLmVuY3R5cGUgPSAnbXVsdGlwYXJ0L2Zvcm0tZGF0YSc7CgkJCQl9CgkJCX0KCgkJCS8vIERvIElmIHRoZXJlIGlzIG5vIGRlZmluZWQgZm9ybSBlbGVtZW50LCBsZXRzIGNyZWF0ZSBvbmUuCgkJCWlmICghZm9ybSkgewoJCQkJLy8gQnVpbGQgZm9ybQoJCQkJZm9ybSA9IGRvYy5jcmVhdGVFbGVtZW50KCdmb3JtJyk7CgkJCQlkb2MuYm9keS5hcHBlbmRDaGlsZChmb3JtKTsKCQkJCW5ld2Zvcm0gPSBmb3JtOwoJCQl9CgoJCQl2YXIgaW5wdXQ7CgoJCQkvLyBBZGQgZWxlbWVudHMgdG8gdGhlIGZvcm0gaWYgdGhleSBkb250IGV4aXN0CgkJCWZvciAoeCBpbiBkYXRhKSBpZiAoZGF0YS5oYXNPd25Qcm9wZXJ0eSh4KSkgewoKCQkJCS8vIElzIHRoaXMgYW4gZWxlbWVudD8KCQkJCXZhciBlbCA9IChfdGhpcy5kb21JbnN0YW5jZSgnaW5wdXQnLCBkYXRhW3hdKSB8fCBfdGhpcy5kb21JbnN0YW5jZSgndGV4dEFyZWEnLCBkYXRhW3hdKSB8fCBfdGhpcy5kb21JbnN0YW5jZSgnc2VsZWN0JywgZGF0YVt4XSkpOwoKCQkJCS8vIElzIHRoaXMgbm90IGFuIGlucHV0IGVsZW1lbnQsIG9yIG9uZSB0aGF0IGV4aXN0cyBvdXRzaWRlIHRoZSBmb3JtLgoJCQkJaWYgKCFlbCB8fCBkYXRhW3hdLmZvcm0gIT09IGZvcm0pIHsKCgkJCQkJLy8gRG9lcyBhbiBlbGVtZW50IGhhdmUgdGhlIHNhbWUgbmFtZT8KCQkJCQl2YXIgaW5wdXRzID0gZm9ybS5lbGVtZW50c1t4XTsKCQkJCQlpZiAoaW5wdXQpIHsKCQkJCQkJLy8gUmVtb3ZlIGl0LgoJCQkJCQlpZiAoIShpbnB1dHMgaW5zdGFuY2VvZiBOb2RlTGlzdCkpIHsKCQkJCQkJCWlucHV0cyA9IFtpbnB1dHNdOwoJCQkJCQl9CgoJCQkJCQlmb3IgKGkgPSAwOyBpIDwgaW5wdXRzLmxlbmd0aDsgaSsrKSB7CgkJCQkJCQlpbnB1dHNbaV0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChpbnB1dHNbaV0pOwoJCQkJCQl9CgoJCQkJCX0KCgkJCQkJLy8gQ3JlYXRlIGFuIGlucHV0IGVsZW1lbnQKCQkJCQlpbnB1dCA9IGRvYy5jcmVhdGVFbGVtZW50KCdpbnB1dCcpOwoJCQkJCWlucHV0LnNldEF0dHJpYnV0ZSgndHlwZScsICdoaWRkZW4nKTsKCQkJCQlpbnB1dC5zZXRBdHRyaWJ1dGUoJ25hbWUnLCB4KTsKCgkJCQkJLy8gRG9lcyBpdCBoYXZlIGEgdmFsdWUgYXR0cmlidXRlPwoJCQkJCWlmIChlbCkgewoJCQkJCQlpbnB1dC52YWx1ZSA9IGRhdGFbeF0udmFsdWU7CgkJCQkJfQoJCQkJCWVsc2UgaWYgKF90aGlzLmRvbUluc3RhbmNlKG51bGwsIGRhdGFbeF0pKSB7CgkJCQkJCWlucHV0LnZhbHVlID0gZGF0YVt4XS5pbm5lckhUTUwgfHwgZGF0YVt4XS5pbm5lclRleHQ7CgkJCQkJfQoJCQkJCWVsc2UgewoJCQkJCQlpbnB1dC52YWx1ZSA9IGRhdGFbeF07CgkJCQkJfQoKCQkJCQlmb3JtLmFwcGVuZENoaWxkKGlucHV0KTsKCQkJCX0KCgkJCQkvLyBJdCBpcyBhbiBlbGVtZW50LCB3aGljaCBleGlzdHMgd2l0aGluIHRoZSBmb3JtLCBidXQgdGhlIG5hbWUgaXMgd3JvbmcKCQkJCWVsc2UgaWYgKGVsICYmIGRhdGFbeF0ubmFtZSAhPT0geCkgewoJCQkJCWRhdGFbeF0uc2V0QXR0cmlidXRlKCduYW1lJywgeCk7CgkJCQkJZGF0YVt4XS5uYW1lID0geDsKCQkJCX0KCQkJfQoKCQkJLy8gRGlzYWJsZSBlbGVtZW50cyBmcm9tIHdpdGhpbiB0aGUgZm9ybSBpZiB0aGV5IHdlcmVuJ3Qgc3BlY2lmaWVkCgkJCWZvciAoaSA9IDA7IGkgPCBmb3JtLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CgoJCQkJaW5wdXQgPSBmb3JtLmVsZW1lbnRzW2ldOwoKCQkJCS8vIERvZXMgdGhlIHNhbWUgbmFtZSBhbmQgdmFsdWUgZXhpc3QgaW4gdGhlIHBhcmVudAoJCQkJaWYgKCEoaW5wdXQubmFtZSBpbiBkYXRhKSAmJiBpbnB1dC5nZXRBdHRyaWJ1dGUoJ2Rpc2FibGVkJykgIT09IHRydWUpIHsKCQkJCQkvLyBEaXNhYmxlCgkJCQkJaW5wdXQuc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsIHRydWUpOwoKCQkJCQkvLyBBZGQgcmUtZW5hYmxlIHRvIGNhbGxiYWNrCgkJCQkJcmVlbmFibGVBZnRlclN1Ym1pdC5wdXNoKGlucHV0KTsKCQkJCX0KCQkJfQoJCX0KCgkJLy8gU2V0IHRoZSB0YXJnZXQgb2YgdGhlIGZvcm0KCQlmb3JtLnNldEF0dHJpYnV0ZSgnbWV0aG9kJywgJ1BPU1QnKTsKCQlmb3JtLnNldEF0dHJpYnV0ZSgndGFyZ2V0JywgY2FsbGJhY2tJRCk7CgkJZm9ybS50YXJnZXQgPSBjYWxsYmFja0lEOwoKCQkvLyBVcGRhdGUgdGhlIGZvcm0gVVJMCgkJZm9ybS5zZXRBdHRyaWJ1dGUoJ2FjdGlvbicsIHVybCk7CgoJCS8vIFN1Ym1pdCB0aGUgZm9ybQoJCS8vIFNvbWUgcmVhc29uIHRoaXMgbmVlZHMgdG8gYmUgb2Zmc2V0IGZyb20gdGhlIGN1cnJlbnQgd2luZG93IGV4ZWN1dGlvbgoJCXNldFRpbWVvdXQoZnVuY3Rpb24oKSB7CgkJCWZvcm0uc3VibWl0KCk7CgoJCQlzZXRUaW1lb3V0KGZ1bmN0aW9uKCkgewoJCQkJdHJ5IHsKCQkJCQkvLyBSZW1vdmUgdGhlIGlmcmFtZSBmcm9tIHRoZSBwYWdlLgoJCQkJCS8vd2luLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQod2luKTsKCQkJCQkvLyBSZW1vdmUgdGhlIGZvcm0KCQkJCQlpZiAobmV3Zm9ybSkgewoJCQkJCQluZXdmb3JtLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQobmV3Zm9ybSk7CgkJCQkJfQoJCQkJfQoJCQkJY2F0Y2ggKGUpIHsKCQkJCQl0cnkgewoJCQkJCQljb25zb2xlLmVycm9yKCdIZWxsb0pTOiBjb3VsZCBub3QgcmVtb3ZlIGlmcmFtZScpOwoJCQkJCX0KCQkJCQljYXRjaCAoZWUpIHt9CgkJCQl9CgoJCQkJLy8gUmVlbmFibGUgdGhlIGRpc2FibGVkIGZvcm0KCQkJCWZvciAodmFyIGkgPSAwOyBpIDwgcmVlbmFibGVBZnRlclN1Ym1pdC5sZW5ndGg7IGkrKykgewoJCQkJCWlmIChyZWVuYWJsZUFmdGVyU3VibWl0W2ldKSB7CgkJCQkJCXJlZW5hYmxlQWZ0ZXJTdWJtaXRbaV0uc2V0QXR0cmlidXRlKCdkaXNhYmxlZCcsIGZhbHNlKTsKCQkJCQkJcmVlbmFibGVBZnRlclN1Ym1pdFtpXS5kaXNhYmxlZCA9IGZhbHNlOwoJCQkJCX0KCQkJCX0KCQkJfSwgMCk7CgkJfSwgMTAwKTsKCX0sCgoJLy8gU29tZSBvZiB0aGUgcHJvdmlkZXJzIHJlcXVpcmUgdGhhdCBvbmx5IG11bHRpcGFydCBpcyB1c2VkIHdpdGggbm9uLWJpbmFyeSBmb3Jtcy4KCS8vIFRoaXMgZnVuY3Rpb24gY2hlY2tzIHdoZXRoZXIgdGhlIGZvcm0gY29udGFpbnMgYmluYXJ5IGRhdGEKCWhhc0JpbmFyeTogZnVuY3Rpb24oZGF0YSkgewoJCWZvciAodmFyIHggaW4gZGF0YSkgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoeCkpIHsKCQkJaWYgKHRoaXMuaXNCaW5hcnkoZGF0YVt4XSkpIHsKCQkJCXJldHVybiB0cnVlOwoJCQl9CgkJfQoKCQlyZXR1cm4gZmFsc2U7Cgl9LAoKCS8vIERldGVybWluZXMgaWYgYSB2YXJpYWJsZSBFaXRoZXIgSXMgb3IgbGlrZSBhIEZvcm1JbnB1dCBoYXMgdGhlIHZhbHVlIG9mIGEgQmxvYgoKCWlzQmluYXJ5OiBmdW5jdGlvbihkYXRhKSB7CgoJCXJldHVybiBkYXRhIGluc3RhbmNlb2YgT2JqZWN0ICYmICgKCQkodGhpcy5kb21JbnN0YW5jZSgnaW5wdXQnLCBkYXRhKSAmJiBkYXRhLnR5cGUgPT09ICdmaWxlJykgfHwKCQkoJ0ZpbGVMaXN0JyBpbiB3aW5kb3cgJiYgZGF0YSBpbnN0YW5jZW9mIHdpbmRvdy5GaWxlTGlzdCkgfHwKCQkoJ0ZpbGUnIGluIHdpbmRvdyAmJiBkYXRhIGluc3RhbmNlb2Ygd2luZG93LkZpbGUpIHx8CgkJKCdCbG9iJyBpbiB3aW5kb3cgJiYgZGF0YSBpbnN0YW5jZW9mIHdpbmRvdy5CbG9iKSk7CgoJfSwKCgkvLyBDb252ZXJ0IERhdGEtVVJJIHRvIEJsb2Igc3RyaW5nCgl0b0Jsb2I6IGZ1bmN0aW9uKGRhdGFVUkkpIHsKCQl2YXIgcmVnID0gL15kYXRhXDooW147LF0rKFw7Y2hhcnNldD1bXjssXSspPykoXDtiYXNlNjQpPywvaTsKCQl2YXIgbSA9IGRhdGFVUkkubWF0Y2gocmVnKTsKCQlpZiAoIW0pIHsKCQkJcmV0dXJuIGRhdGFVUkk7CgkJfQoKCQl2YXIgYmluYXJ5ID0gYXRvYihkYXRhVVJJLnJlcGxhY2UocmVnLCAnJykpOwoJCXZhciBhcnJheSA9IFtdOwoJCWZvciAodmFyIGkgPSAwOyBpIDwgYmluYXJ5Lmxlbmd0aDsgaSsrKSB7CgkJCWFycmF5LnB1c2goYmluYXJ5LmNoYXJDb2RlQXQoaSkpOwoJCX0KCgkJcmV0dXJuIG5ldyBCbG9iKFtuZXcgVWludDhBcnJheShhcnJheSldLCB7dHlwZTogbVsxXX0pOwoJfQoKfSk7CgovLyBFWFRSQTogQ29udmVydCBGb3JtRWxlbWVudCB0byBKU09OIGZvciBQT1NUaW5nCi8vIFdyYXBwZXJzIHRvIGFkZCBhZGRpdGlvbmFsIGZ1bmN0aW9uYWxpdHkgdG8gZXhpc3RpbmcgZnVuY3Rpb25zCihmdW5jdGlvbihoZWxsbykgewoKCS8vIENvcHkgb3JpZ2luYWwgZnVuY3Rpb24KCXZhciBhcGkgPSBoZWxsby5hcGk7Cgl2YXIgdXRpbHMgPSBoZWxsby51dGlsczsKCgl1dGlscy5leHRlbmQodXRpbHMsIHsKCgkJLy8gRGF0YVRvSlNPTgoJCS8vIFRoaXMgdGFrZXMgYSBGb3JtRWxlbWVudHxOb2RlTGlzdHxJbnB1dEVsZW1lbnR8TWl4ZWRPYmplY3RzIGFuZCBjb252ZXJzIHRoZSBkYXRhIG9iamVjdCB0byBKU09OLgoJCWRhdGFUb0pTT046IGZ1bmN0aW9uKHApIHsKCgkJCXZhciBfdGhpcyA9IHRoaXM7CgkJCXZhciB3ID0gd2luZG93OwoJCQl2YXIgZGF0YSA9IHAuZGF0YTsKCgkJCS8vIElzIGRhdGEgYSBmb3JtIG9iamVjdAoJCQlpZiAoX3RoaXMuZG9tSW5zdGFuY2UoJ2Zvcm0nLCBkYXRhKSkgewoJCQkJZGF0YSA9IF90aGlzLm5vZGVMaXN0VG9KU09OKGRhdGEuZWxlbWVudHMpOwoJCQl9CgkJCWVsc2UgaWYgKCdOb2RlTGlzdCcgaW4gdyAmJiBkYXRhIGluc3RhbmNlb2YgTm9kZUxpc3QpIHsKCQkJCWRhdGEgPSBfdGhpcy5ub2RlTGlzdFRvSlNPTihkYXRhKTsKCQkJfQoJCQllbHNlIGlmIChfdGhpcy5kb21JbnN0YW5jZSgnaW5wdXQnLCBkYXRhKSkgewoJCQkJZGF0YSA9IF90aGlzLm5vZGVMaXN0VG9KU09OKFtkYXRhXSk7CgkJCX0KCgkJCS8vIElzIGRhdGEgYSBibG9iLCBGaWxlLCBGaWxlTGlzdD8KCQkJaWYgKCgnRmlsZScgaW4gdyAmJiBkYXRhIGluc3RhbmNlb2Ygdy5GaWxlKSB8fAoJCQkJKCdCbG9iJyBpbiB3ICYmIGRhdGEgaW5zdGFuY2VvZiB3LkJsb2IpIHx8CgkJCQkoJ0ZpbGVMaXN0JyBpbiB3ICYmIGRhdGEgaW5zdGFuY2VvZiB3LkZpbGVMaXN0KSkgewoJCQkJZGF0YSA9IHtmaWxlOiBkYXRhfTsKCQkJfQoKCQkJLy8gTG9vcCB0aHJvdWdoIGRhdGEgaWYgaXQncyBub3QgZm9ybSBkYXRhIGl0IG11c3Qgbm93IGJlIGEgSlNPTiBvYmplY3QKCQkJaWYgKCEoJ0Zvcm1EYXRhJyBpbiB3ICYmIGRhdGEgaW5zdGFuY2VvZiB3LkZvcm1EYXRhKSkgewoKCQkJCWZvciAodmFyIHggaW4gZGF0YSkgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoeCkpIHsKCgkJCQkJaWYgKCdGaWxlTGlzdCcgaW4gdyAmJiBkYXRhW3hdIGluc3RhbmNlb2Ygdy5GaWxlTGlzdCkgewoJCQkJCQlpZiAoZGF0YVt4XS5sZW5ndGggPT09IDEpIHsKCQkJCQkJCWRhdGFbeF0gPSBkYXRhW3hdWzBdOwoJCQkJCQl9CgkJCQkJfQoJCQkJCWVsc2UgaWYgKF90aGlzLmRvbUluc3RhbmNlKCdpbnB1dCcsIGRhdGFbeF0pICYmIGRhdGFbeF0udHlwZSA9PT0gJ2ZpbGUnKSB7CgkJCQkJCWNvbnRpbnVlOwoJCQkJCX0KCQkJCQllbHNlIGlmIChfdGhpcy5kb21JbnN0YW5jZSgnaW5wdXQnLCBkYXRhW3hdKSB8fAoJCQkJCQlfdGhpcy5kb21JbnN0YW5jZSgnc2VsZWN0JywgZGF0YVt4XSkgfHwKCQkJCQkJX3RoaXMuZG9tSW5zdGFuY2UoJ3RleHRBcmVhJywgZGF0YVt4XSkpIHsKCQkJCQkJZGF0YVt4XSA9IGRhdGFbeF0udmFsdWU7CgkJCQkJfQoJCQkJCWVsc2UgaWYgKF90aGlzLmRvbUluc3RhbmNlKG51bGwsIGRhdGFbeF0pKSB7CgkJCQkJCWRhdGFbeF0gPSBkYXRhW3hdLmlubmVySFRNTCB8fCBkYXRhW3hdLmlubmVyVGV4dDsKCQkJCQl9CgkJCQl9CgkJCX0KCgkJCXAuZGF0YSA9IGRhdGE7CgkJCXJldHVybiBkYXRhOwoJCX0sCgoJCS8vIE5vZGVMaXN0VG9KU09OCgkJLy8gR2l2ZW4gYSBsaXN0IG9mIGVsZW1lbnRzIGV4dHJhcG9sYXRlIHRoZWlyIHZhbHVlcyBhbmQgcmV0dXJuIGFzIGEganNvbiBvYmplY3QKCQlub2RlTGlzdFRvSlNPTjogZnVuY3Rpb24obm9kZWxpc3QpIHsKCgkJCXZhciBqc29uID0ge307CgoJCQkvLyBDcmVhdGUgYSBkYXRhIHN0cmluZwoJCQlmb3IgKHZhciBpID0gMDsgaSA8IG5vZGVsaXN0Lmxlbmd0aDsgaSsrKSB7CgoJCQkJdmFyIGlucHV0ID0gbm9kZWxpc3RbaV07CgoJCQkJLy8gSWYgdGhlIG5hbWUgb2YgdGhlIGlucHV0IGlzIGVtcHR5IG9yIGRpYWJsZWQsIGRvbnQgYWRkIGl0LgoJCQkJaWYgKGlucHV0LmRpc2FibGVkIHx8ICFpbnB1dC5uYW1lKSB7CgkJCQkJY29udGludWU7CgkJCQl9CgoJCQkJLy8gSXMgdGhpcyBhIGZpbGUsIGRvZXMgdGhlIGJyb3dzZXIgbm90IHN1cHBvcnQgJ2ZpbGVzJyBhbmQgJ0Zvcm1EYXRhJz8KCQkJCWlmIChpbnB1dC50eXBlID09PSAnZmlsZScpIHsKCQkJCQlqc29uW2lucHV0Lm5hbWVdID0gaW5wdXQ7CgkJCQl9CgkJCQllbHNlIHsKCQkJCQlqc29uW2lucHV0Lm5hbWVdID0gaW5wdXQudmFsdWUgfHwgaW5wdXQuaW5uZXJIVE1MOwoJCQkJfQoJCQl9CgoJCQlyZXR1cm4ganNvbjsKCQl9Cgl9KTsKCgkvLyBSZXBsYWNlIGl0CgloZWxsby5hcGkgPSBmdW5jdGlvbigpIHsKCgkJLy8gR2V0IGFyZ3VtZW50cwoJCXZhciBwID0gdXRpbHMuYXJncyh7cGF0aDogJ3MhJywgbWV0aG9kOiAncycsIGRhdGE6J28nLCB0aW1lb3V0OiAnaScsIGNhbGxiYWNrOiAnZid9LCBhcmd1bWVudHMpOwoKCQkvLyBDaGFuZ2UgZm9yIGludG8gYSBkYXRhIG9iamVjdAoJCWlmIChwLmRhdGEpIHsKCQkJdXRpbHMuZGF0YVRvSlNPTihwKTsKCQl9CgoJCXJldHVybiBhcGkuY2FsbCh0aGlzLCBwKTsKCX07Cgp9KShoZWxsbyk7CgovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCi8vCi8vIFNhdmUgYW55IGFjY2VzcyB0b2tlbiB0aGF0IGlzIGluIHRoZSBjdXJyZW50IHBhZ2UgVVJMCi8vIEhhbmRsZSBhbnkgcmVzcG9uc2Ugc29saWNpdGVkIHRocm91Z2ggaWZyYW1lIGhhc2ggdGFnIGZvbGxvd2luZyBhbiBBUEkgcmVxdWVzdAovLwovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vCgpoZWxsby51dGlscy5yZXNwb25zZUhhbmRsZXIod2luZG93LCB3aW5kb3cub3BlbmVyIHx8IHdpbmRvdy5wYXJlbnQpOwoKLy8gU2NyaXB0IHRvIHN1cHBvcnQgQ2hyb21lQXBwcwovLyBUaGlzIG92ZXJpZGVzIHRoZSBoZWxsby51dGlscy5wb3B1cCBtZXRob2QgdG8gc3VwcG9ydCBjaHJvbWUuaWRlbnRpdHkubGF1bmNoV2ViQXV0aEZsb3cKLy8gU2VlIGh0dHBzOi8vZGV2ZWxvcGVyLmNocm9tZS5jb20vYXBwcy9hcHBfaWRlbnRpdHkjbm9uCgovLyBJcyB0aGlzIGEgY2hyb21lIGFwcD8KCmlmICh0eXBlb2YgY2hyb21lID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgY2hyb21lLmlkZW50aXR5ID09PSAnb2JqZWN0JyAmJiBjaHJvbWUuaWRlbnRpdHkubGF1bmNoV2ViQXV0aEZsb3cpIHsKCgkoZnVuY3Rpb24oKSB7CgoJCS8vIFN3YXAgdGhlIHBvcHVwIG1ldGhvZAoJCWhlbGxvLnV0aWxzLnBvcHVwID0gZnVuY3Rpb24odXJsKSB7CgoJCQlyZXR1cm4gX29wZW4odXJsLCB0cnVlKTsKCgkJfTsKCgkJLy8gU3dhcCB0aGUgaGlkZGVuIGlmcmFtZSBtZXRob2QKCQloZWxsby51dGlscy5pZnJhbWUgPSBmdW5jdGlvbih1cmwpIHsKCgkJCV9vcGVuKHVybCwgZmFsc2UpOwoKCQl9OwoKCQkvLyBTd2FwIHRoZSByZXF1ZXN0X2NvcnMgbWV0aG9kCgkJaGVsbG8udXRpbHMucmVxdWVzdF9jb3JzID0gZnVuY3Rpb24oY2FsbGJhY2spIHsKCgkJCWNhbGxiYWNrKCk7CgoJCQkvLyBBbHdheXMgcnVuIGFzIENPUlMKCgkJCXJldHVybiB0cnVlOwoJCX07CgoJCS8vIFN3YXAgdGhlIHN0b3JhZ2UgbWV0aG9kCgkJdmFyIF9jYWNoZSA9IHt9OwoJCWNocm9tZS5zdG9yYWdlLmxvY2FsLmdldCgnaGVsbG8nLCBmdW5jdGlvbihyKSB7CgkJCS8vIFVwZGF0ZSB0aGUgY2FjaGUKCQkJX2NhY2hlID0gci5oZWxsbyB8fCB7fTsKCQl9KTsKCgkJaGVsbG8udXRpbHMuc3RvcmUgPSBmdW5jdGlvbihuYW1lLCB2YWx1ZSkgewoKCQkJLy8gR2V0IGFsbAoJCQlpZiAoYXJndW1lbnRzLmxlbmd0aCA9PT0gMCkgewoJCQkJcmV0dXJuIF9jYWNoZTsKCQkJfQoKCQkJLy8gR2V0CgkJCWlmIChhcmd1bWVudHMubGVuZ3RoID09PSAxKSB7CgkJCQlyZXR1cm4gX2NhY2hlW25hbWVdIHx8IG51bGw7CgkJCX0KCgkJCS8vIFNldAoJCQlpZiAodmFsdWUpIHsKCQkJCV9jYWNoZVtuYW1lXSA9IHZhbHVlOwoJCQkJY2hyb21lLnN0b3JhZ2UubG9jYWwuc2V0KHtoZWxsbzogX2NhY2hlfSk7CgkJCQlyZXR1cm4gdmFsdWU7CgkJCX0KCgkJCS8vIERlbGV0ZQoJCQlpZiAodmFsdWUgPT09IG51bGwpIHsKCQkJCWRlbGV0ZSBfY2FjaGVbbmFtZV07CgkJCQljaHJvbWUuc3RvcmFnZS5sb2NhbC5zZXQoe2hlbGxvOiBfY2FjaGV9KTsKCQkJCXJldHVybiBudWxsOwoJCQl9CgkJfTsKCgkJLy8gT3BlbiBmdW5jdGlvbgoJCWZ1bmN0aW9uIF9vcGVuKHVybCwgaW50ZXJhY3RpdmUpIHsKCgkJCS8vIExhdW5jaAoJCQl2YXIgcmVmID0gewoJCQkJY2xvc2VkOiBmYWxzZQoJCQl9OwoKCQkJLy8gTGF1bmNoIHRoZSB3ZWJBdXRoRmxvdwoJCQljaHJvbWUuaWRlbnRpdHkubGF1bmNoV2ViQXV0aEZsb3coewoJCQkJdXJsOiB1cmwsCgkJCQlpbnRlcmFjdGl2ZTogaW50ZXJhY3RpdmUKCQkJfSwgZnVuY3Rpb24ocmVzcG9uc2VVcmwpIHsKCgkJCQkvLyBEaWQgdGhlIHVzZXIgY2FuY2VsIHRoaXMgcHJlbWF0dXJlbHkKCQkJCWlmIChyZXNwb25zZVVybCA9PT0gdW5kZWZpbmVkKSB7CgkJCQkJcmVmLmNsb3NlZCA9IHRydWU7CgkJCQkJcmV0dXJuOwoJCQkJfQoKCQkJCS8vIFNwbGl0IGFwcGFydCB0aGUgVVJMCgkJCQl2YXIgYSA9IGhlbGxvLnV0aWxzLnVybChyZXNwb25zZVVybCk7CgoJCQkJLy8gVGhlIGxvY2F0aW9uIGNhbiBiZSBhdWdtZW50ZWQgaW4gdG8gYSBsb2NhdGlvbiBvYmplY3QgbGlrZSBzby4uLgoJCQkJLy8gV2UgZG9udCBoYXZlIHdpbmRvdyBvcGVyYXRpb25zIG9uIHRoZSBwb3B1cCBzbyBsZXRzIGNyZWF0ZSBzb21lCgkJCQl2YXIgX3BvcHVwID0gewoJCQkJCWxvY2F0aW9uOiB7CgoJCQkJCQkvLyBDaGFuZ2UgdGhlIGxvY2F0aW9uIG9mIHRoZSBwb3B1cAoJCQkJCQlhc3NpZ246IGZ1bmN0aW9uKHVybCkgewoKCQkJCQkJCS8vIElmIHRoZXJlIGlzIGEgc2Vjb25kYXJ5IHJlYXNzaWduCgkJCQkJCQkvLyBJbiB0aGUgY2FzZSBvZiBPQXV0aDEKCQkJCQkJCS8vIFRyaWdnZXIgdGhpcyBpbiBub24taW50ZXJhY3RpdmUgbW9kZS4KCQkJCQkJCV9vcGVuKHVybCwgZmFsc2UpOwoJCQkJCQl9LAoKCQkJCQkJc2VhcmNoOiBhLnNlYXJjaCwKCQkJCQkJaGFzaDogYS5oYXNoLAoJCQkJCQlocmVmOiBhLmhyZWYKCQkJCQl9LAoJCQkJCWNsb3NlOiBmdW5jdGlvbigpIHt9CgkJCQl9OwoKCQkJCS8vIFRoZW4gdGhpcyBVUkwgY29udGFpbnMgaW5mb3JtYXRpb24gd2hpY2ggSGVsbG9KUyBtdXN0IHByb2Nlc3MKCQkJCS8vIFVSTCBzdHJpbmcKCQkJCS8vIFdpbmRvdyAtIGFueSBhY3Rpb24gc3VjaCBhcyB3aW5kb3cgcmVsb2NhdGlvbiBnb2VzIGhlcmUKCQkJCS8vIE9wZW5lciAtIHRoZSBwYXJlbnQgd2luZG93IHdoaWNoIG9wZW5lZCB0aGlzLCBha2EgdGhpcyBzY3JpcHQKCgkJCQloZWxsby51dGlscy5yZXNwb25zZUhhbmRsZXIoX3BvcHVwLCB3aW5kb3cpOwoJCQl9KTsKCgkJCS8vIFJldHVybiB0aGUgcmVmZXJlbmNlCgkJCXJldHVybiByZWY7CgkJfQoKCX0pKCk7Cn0KCi8vIFBob25lZ2FwIG92ZXJyaWRlIGZvciBoZWxsby5waG9uZWdhcC5qcwooZnVuY3Rpb24oKSB7CgoJLy8gSXMgdGhpcyBhIHBob25lZ2FwIGltcGxlbWVudGF0aW9uPwoJaWYgKCEoL15maWxlOlwvezN9W15cL10vLnRlc3Qod2luZG93LmxvY2F0aW9uLmhyZWYpICYmIHdpbmRvdy5jb3Jkb3ZhKSkgewoJCS8vIENvcmRvdmEgaXMgbm90IGluY2x1ZGVkLgoJCXJldHVybjsKCX0KCgkvLyBBdWdtZW50IHRoZSBoaWRkZW4gaWZyYW1lIG1ldGhvZAoJaGVsbG8udXRpbHMuaWZyYW1lID0gZnVuY3Rpb24odXJsLCByZWRpcmVjdFVyaSkgewoJCWhlbGxvLnV0aWxzLnBvcHVwKHVybCwgcmVkaXJlY3RVcmksIHtoaWRkZW46ICd5ZXMnfSk7Cgl9OwoKCS8vIEF1Z21lbnQgdGhlIHBvcHVwCgl2YXIgdXRpbFBvcHVwID0gaGVsbG8udXRpbHMucG9wdXA7CgoJLy8gUmVwbGFjZSBwb3B1cAoJaGVsbG8udXRpbHMucG9wdXAgPSBmdW5jdGlvbih1cmwsIHJlZGlyZWN0VXJpLCBvcHRpb25zKSB7CgoJCS8vIFJ1biB0aGUgc3RhbmRhcmQKCQl2YXIgcG9wdXAgPSB1dGlsUG9wdXAuY2FsbCh0aGlzLCB1cmwsIHJlZGlyZWN0VXJpLCBvcHRpb25zKTsKCgkJLy8gQ3JlYXRlIGEgZnVuY3Rpb24gZm9yIHJlb3BlbmluZyB0aGUgcG9wdXAsIGFuZCBhc3NpZ25pbmcgZXZlbnRzIHRvIHRoZSBuZXcgcG9wdXAgb2JqZWN0CgkJLy8gUGhvbmVHYXAgc3VwcG9ydAoJCS8vIEFkZCBhbiBldmVudCBsaXN0ZW5lciB0byBsaXN0ZW4gdG8gdGhlIGNoYW5nZSBpbiB0aGUgcG9wdXAgd2luZG93cyBVUkwKCQkvLyBUaGlzIG11c3QgYXBwZWFyIGJlZm9yZSBwb3B1cC5mb2N1cygpOwoJCXRyeSB7CgkJCWlmIChwb3B1cCAmJiBwb3B1cC5hZGRFdmVudExpc3RlbmVyKSB7CgoJCQkJLy8gR2V0IHRoZSBvcmlnaW4gb2YgdGhlIHJlZGlyZWN0IFVSSQoKCQkJCXZhciBhID0gaGVsbG8udXRpbHMudXJsKHJlZGlyZWN0VXJpKTsKCQkJCXZhciByZWRpcmVjdFVyaU9yaWdpbiA9IGEub3JpZ2luIHx8IChhLnByb3RvY29sICsgJy8vJyArIGEuaG9zdG5hbWUpOwoKCQkJCS8vIExpc3RlbiB0byBjaGFuZ2VzIGluIHRoZSBJbkFwcEJyb3dzZXIgd2luZG93CgoJCQkJcG9wdXAuYWRkRXZlbnRMaXN0ZW5lcignbG9hZHN0YXJ0JywgZnVuY3Rpb24oZSkgewoKCQkJCQl2YXIgdXJsID0gZS51cmw7CgoJCQkJCS8vIElzIHRoaXMgdGhlIHBhdGgsIGFzIGdpdmVuIGJ5IHRoZSByZWRpcmVjdFVyaT8KCQkJCQkvLyBDaGVjayB0aGUgbmV3IFVSTCBhZ2FpbnMgdGhlIHJlZGlyZWN0VXJpT3JpZ2luLgoJCQkJCS8vIEFjY29yZGluZyB0byAjNjMgYSB1c2VyIGNvdWxkIGNsaWNrICdjYW5jZWwnIGluIHNvbWUgZGlhbG9nIGJveGVzIC4uLi4KCQkJCQkvLyBUaGUgcG9wdXAgcmVkaXJlY3RzIHRvIGFub3RoZXIgcGFnZSB3aXRoIHRoZSBzYW1lIG9yaWdpbiwgeWV0IHdlIHN0aWxsIHdpc2ggaXQgdG8gY2xvc2UuCgoJCQkJCWlmICh1cmwuaW5kZXhPZihyZWRpcmVjdFVyaU9yaWdpbikgIT09IDApIHsKCQkJCQkJcmV0dXJuOwoJCQkJCX0KCgkJCQkJLy8gU3BsaXQgYXBwYXJ0IHRoZSBVUkwKCQkJCQl2YXIgYSA9IGhlbGxvLnV0aWxzLnVybCh1cmwpOwoKCQkJCQkvLyBXZSBkb250IGhhdmUgd2luZG93IG9wZXJhdGlvbnMgb24gdGhlIHBvcHVwIHNvIGxldHMgY3JlYXRlIHNvbWUKCQkJCQkvLyBUaGUgbG9jYXRpb24gY2FuIGJlIGF1Z21lbnRlZCBpbiB0byBhIGxvY2F0aW9uIG9iamVjdCBsaWtlIHNvLi4uCgoJCQkJCXZhciBfcG9wdXAgPSB7CgkJCQkJCWxvY2F0aW9uOiB7CgkJCQkJCQkvLyBDaGFuZ2UgdGhlIGxvY2F0aW9uIG9mIHRoZSBwb3B1cAoJCQkJCQkJYXNzaWduOiBmdW5jdGlvbihsb2NhdGlvbikgewoKCQkJCQkJCQkvLyBVbmZvdXJ0dW5hdGx5IGFuIGFwcCBpcyBtYXkgbm90IGNoYW5nZSB0aGUgbG9jYXRpb24gb2YgYSBJbkFwcEJyb3dzZXIgd2luZG93LgoJCQkJCQkJCS8vIFNvIHRvIHNoaW0gdGhpcywganVzdCBvcGVuIGEgbmV3IG9uZS4KCQkJCQkJCQlwb3B1cC5leGVjdXRlU2NyaXB0KHtjb2RlOiAnd2luZG93LmxvY2F0aW9uLmhyZWYgPSAiJyArIGxvY2F0aW9uICsgJzsiJ30pOwoJCQkJCQkJfSwKCgkJCQkJCQlzZWFyY2g6IGEuc2VhcmNoLAoJCQkJCQkJaGFzaDogYS5oYXNoLAoJCQkJCQkJaHJlZjogYS5ocmVmCgkJCQkJCX0sCgkJCQkJCWNsb3NlOiBmdW5jdGlvbigpIHsKCQkJCQkJCWlmIChwb3B1cC5jbG9zZSkgewoJCQkJCQkJCXBvcHVwLmNsb3NlKCk7CgkJCQkJCQkJdHJ5IHsKCQkJCQkJCQkJcG9wdXAuY2xvc2VkID0gdHJ1ZTsKCQkJCQkJCQl9CgkJCQkJCQkJY2F0Y2ggKF9lKSB7fQoJCQkJCQkJfQoJCQkJCQl9CgkJCQkJfTsKCgkJCQkJLy8gVGhlbiB0aGlzIFVSTCBjb250YWlucyBpbmZvcm1hdGlvbiB3aGljaCBIZWxsb0pTIG11c3QgcHJvY2VzcwoJCQkJCS8vIFVSTCBzdHJpbmcKCQkJCQkvLyBXaW5kb3cgLSBhbnkgYWN0aW9uIHN1Y2ggYXMgd2luZG93IHJlbG9jYXRpb24gZ29lcyBoZXJlCgkJCQkJLy8gT3BlbmVyIC0gdGhlIHBhcmVudCB3aW5kb3cgd2hpY2ggb3BlbmVkIHRoaXMsIGFrYSB0aGlzIHNjcmlwdAoKCQkJCQloZWxsby51dGlscy5yZXNwb25zZUhhbmRsZXIoX3BvcHVwLCB3aW5kb3cpOwoKCQkJCX0pOwoJCQl9CgkJfQoJCWNhdGNoIChlKSB7fQoKCQlyZXR1cm4gcG9wdXA7Cgl9OwoKfSkoKTsKCihmdW5jdGlvbihoZWxsbykgewoKCS8vIE9BdXRoMQoJdmFyIE9BdXRoMVNldHRpbmdzID0gewoJCXZlcnNpb246ICcxLjAnLAoJCWF1dGg6ICdodHRwczovL3d3dy5kcm9wYm94LmNvbS8xL29hdXRoL2F1dGhvcml6ZScsCgkJcmVxdWVzdDogJ2h0dHBzOi8vYXBpLmRyb3Bib3guY29tLzEvb2F1dGgvcmVxdWVzdF90b2tlbicsCgkJdG9rZW46ICdodHRwczovL2FwaS5kcm9wYm94LmNvbS8xL29hdXRoL2FjY2Vzc190b2tlbicKCX07CgoJLy8gT0F1dGgyIFNldHRpbmdzCgl2YXIgT0F1dGgyU2V0dGluZ3MgPSB7CgkJdmVyc2lvbjogMiwKCQlhdXRoOiAnaHR0cHM6Ly93d3cuZHJvcGJveC5jb20vMS9vYXV0aDIvYXV0aG9yaXplJywKCQlncmFudDogJ2h0dHBzOi8vYXBpLmRyb3Bib3guY29tLzEvb2F1dGgyL3Rva2VuJwoJfTsKCgkvLyBJbml0aWF0ZSB0aGUgRHJvcGJveCBtb2R1bGUKCWhlbGxvLmluaXQoewoKCQlkcm9wYm94OiB7CgoJCQluYW1lOiAnRHJvcGJveCcsCgoJCQlvYXV0aDogT0F1dGgyU2V0dGluZ3MsCgoJCQlsb2dpbjogZnVuY3Rpb24ocCkgewoJCQkJLy8gT0F1dGgyIG5vbi1zdGFuZGFyZCBhZGp1c3RtZW50cwoJCQkJcC5xcy5zY29wZSA9ICcnOwoJCQkJZGVsZXRlIHAucXMuZGlzcGxheTsKCgkJCQkvLyBTaG91bGQgdGhpcyBiZSBydW4gYXMgT0F1dGgxPwoJCQkJLy8gSWYgdGhlIHJlZGlyZWN0X3VyaSBpcyBpcyBIVFRQIChub24tc2VjdXJlKSB0aGVuIGl0cyByZXF1aXJlZCB0byByZXZlcnQgdG8gdGhlIE9BdXRoMSBlbmRwb2ludHMKCQkJCXZhciByZWRpcmVjdCA9IGRlY29kZVVSSUNvbXBvbmVudChwLnFzLnJlZGlyZWN0X3VyaSk7CgkJCQlpZiAocmVkaXJlY3QuaW5kZXhPZignaHR0cDonKSA9PT0gMCAmJiByZWRpcmVjdC5pbmRleE9mKCdodHRwOi8vbG9jYWxob3N0LycpICE9PSAwKSB7CgoJCQkJCS8vIE92ZXJyaWRlIHRoZSBkcm9wYm94IE9BdXRoIHNldHRpbmdzLgoJCQkJCWhlbGxvLnNlcnZpY2VzLmRyb3Bib3gub2F1dGggPSBPQXV0aDFTZXR0aW5nczsKCQkJCX0KCQkJCWVsc2UgewoJCQkJCS8vIE92ZXJyaWRlIHRoZSBkcm9wYm94IE9BdXRoIHNldHRpbmdzLgoJCQkJCWhlbGxvLnNlcnZpY2VzLmRyb3Bib3gub2F1dGggPSBPQXV0aDJTZXR0aW5nczsKCQkJCX0KCgkJCQkvLyBUaGUgZHJvcGJveCBsb2dpbiB3aW5kb3cgaXMgYSBkaWZmZXJlbnQgc2l6ZQoJCQkJcC5vcHRpb25zLnBvcHVwLndpZHRoID0gMTAwMDsKCQkJCXAub3B0aW9ucy5wb3B1cC5oZWlnaHQgPSAxMDAwOwoJCQl9LAoKCQkJLyoKCQkJCURyb3Bib3ggZG9lcyBub3QgYWxsb3cgaW5zZWN1cmUgSFRUUCBVUkkncyBpbiB0aGUgcmVkaXJlY3RfdXJpIGZpZWxkCgkJCQkuLi5vdGhlcndpc2UgSSdkIGxvdmUgdG8gdXNlIE9BdXRoMgoKCQkJCUZvbGxvdyByZXF1ZXN0IGh0dHBzOi8vZm9ydW1zLmRyb3Bib3guY29tL3RvcGljLnBocD9pZD0xMDY1MDUKCgkJCQlwLnFzLnJlc3BvbnNlX3R5cGUgPSAnY29kZSc7CgkJCQlvYXV0aDogewoJCQkJCXZlcnNpb246IDIsCgkJCQkJYXV0aDogJ2h0dHBzOi8vd3d3LmRyb3Bib3guY29tLzEvb2F1dGgyL2F1dGhvcml6ZScsCgkJCQkJZ3JhbnQ6ICdodHRwczovL2FwaS5kcm9wYm94LmNvbS8xL29hdXRoMi90b2tlbicKCQkJCX0KCQkJKi8KCgkJCS8vIEFQSSBCYXNlIFVSTAoJCQliYXNlOiAnaHR0cHM6Ly9hcGkuZHJvcGJveC5jb20vMS8nLAoKCQkJLy8gQmVzcG9rZSBzZXR0aW5nOiB0aGlzIGlzIHN0YXRlcyB3aGV0aGVyIHRvIHVzZSB0aGUgY3VzdG9tIGVudmlyb25tZW50IG9mIERyb3Bib3ggb3IgdG8gdXNlIHRoZWlyIG93biBlbnZpcm9ubWVudAoJCQkvLyBCZWNhdXNlIGl0J3Mgbm90b3Jpb3VzbHkgZGlmZmljdWx0IGZvciBEcm9wYm94IHRvbyBwcm92aWRlIGFjY2VzcyBmcm9tIG90aGVyIHdlYnNlcnZpY2VzLCB0aGlzIGRlZmF1bHRzIHRvIFNhbmRib3gKCQkJcm9vdDogJ3NhbmRib3gnLAoKCQkJLy8gTWFwIEdFVCByZXF1ZXN0cwoJCQlnZXQ6IHsKCQkJCW1lOiAnYWNjb3VudC9pbmZvJywKCgkJCQkvLyBIdHRwczovL3d3dy5kcm9wYm94LmNvbS9kZXZlbG9wZXJzL2NvcmUvZG9jcyNtZXRhZGF0YQoJCQkJJ21lL2ZpbGVzJzogcmVxKCdtZXRhZGF0YS9hdXRvL0B7cGFyZW50fH0nKSwKCQkJCSdtZS9mb2xkZXInOiByZXEoJ21ldGFkYXRhL2F1dG8vQHtpZH0nKSwKCQkJCSdtZS9mb2xkZXJzJzogcmVxKCdtZXRhZGF0YS9hdXRvLycpLAoKCQkJCSdkZWZhdWx0JzogZnVuY3Rpb24ocCwgY2FsbGJhY2spIHsKCQkJCQlpZiAocC5wYXRoLm1hdGNoKCdodHRwczovL2FwaS1jb250ZW50LmRyb3Bib3guY29tLzEvZmlsZXMvJykpIHsKCQkJCQkJLy8gVGhpcyBpcyBhIGZpbGUsIHJldHVybiBiaW5hcnkgZGF0YQoJCQkJCQlwLm1ldGhvZCA9ICdibG9iJzsKCQkJCQl9CgoJCQkJCWNhbGxiYWNrKHAucGF0aCk7CgkJCQl9CgkJCX0sCgoJCQlwb3N0OiB7CgkJCQknbWUvZmlsZXMnOiBmdW5jdGlvbihwLCBjYWxsYmFjaykgewoKCQkJCQl2YXIgcGF0aCA9IHAuZGF0YS5wYXJlbnQ7CgkJCQkJdmFyIGZpbGVOYW1lID0gcC5kYXRhLm5hbWU7CgoJCQkJCXAuZGF0YSA9IHsKCQkJCQkJZmlsZTogcC5kYXRhLmZpbGUKCQkJCQl9OwoKCQkJCQkvLyBEb2VzIHRoaXMgaGF2ZSBhIGRhdGEtdXJpIHRvIHVwbG9hZCBhcyBhIGZpbGU/CgkJCQkJaWYgKHR5cGVvZiAocC5kYXRhLmZpbGUpID09PSAnc3RyaW5nJykgewoJCQkJCQlwLmRhdGEuZmlsZSA9IGhlbGxvLnV0aWxzLnRvQmxvYihwLmRhdGEuZmlsZSk7CgkJCQkJfQoKCQkJCQljYWxsYmFjaygnaHR0cHM6Ly9hcGktY29udGVudC5kcm9wYm94LmNvbS8xL2ZpbGVzX3B1dC9hdXRvLycgKyBwYXRoICsgJy8nICsgZmlsZU5hbWUpOwoJCQkJfSwKCgkJCQknbWUvZm9sZGVycyc6IGZ1bmN0aW9uKHAsIGNhbGxiYWNrKSB7CgoJCQkJCXZhciBuYW1lID0gcC5kYXRhLm5hbWU7CgkJCQkJcC5kYXRhID0ge307CgoJCQkJCWNhbGxiYWNrKCdmaWxlb3BzL2NyZWF0ZV9mb2xkZXI/cm9vdD1Ae3Jvb3R8c2FuZGJveH0mJyArIGhlbGxvLnV0aWxzLnBhcmFtKHsKCQkJCQkJcGF0aDogbmFtZQoJCQkJCX0pKTsKCQkJCX0KCQkJfSwKCgkJCS8vIE1hcCBERUxFVEUgcmVxdWVzdHMKCQkJZGVsOiB7CgkJCQknbWUvZmlsZXMnOiAnZmlsZW9wcy9kZWxldGU/cm9vdD1Ae3Jvb3R8c2FuZGJveH0mcGF0aD1Ae2lkfScsCgkJCQknbWUvZm9sZGVyJzogJ2ZpbGVvcHMvZGVsZXRlP3Jvb3Q9QHtyb290fHNhbmRib3h9JnBhdGg9QHtpZH0nCgkJCX0sCgoJCQl3cmFwOiB7CgkJCQltZTogZnVuY3Rpb24obykgewoJCQkJCWZvcm1hdEVycm9yKG8pOwoJCQkJCWlmICghby51aWQpIHsKCQkJCQkJcmV0dXJuIG87CgkJCQkJfQoKCQkJCQlvLm5hbWUgPSBvLmRpc3BsYXlfbmFtZTsKCQkJCQl2YXIgbSA9IG8ubmFtZS5zcGxpdCgnICcpOwoJCQkJCW8uZmlyc3RfbmFtZSA9IG0uc2hpZnQoKTsKCQkJCQlvLmxhc3RfbmFtZSA9IG0uam9pbignICcpOwoJCQkJCW8uaWQgPSBvLnVpZDsKCQkJCQlkZWxldGUgby51aWQ7CgkJCQkJZGVsZXRlIG8uZGlzcGxheV9uYW1lOwoJCQkJCXJldHVybiBvOwoJCQkJfSwKCgkJCQknZGVmYXVsdCc6IGZ1bmN0aW9uKG8sIGhlYWRlcnMsIHJlcSkgewoJCQkJCWZvcm1hdEVycm9yKG8pOwoJCQkJCWlmIChvLmlzX2RpciAmJiBvLmNvbnRlbnRzKSB7CgkJCQkJCW8uZGF0YSA9IG8uY29udGVudHM7CgkJCQkJCWRlbGV0ZSBvLmNvbnRlbnRzOwoKCQkJCQkJby5kYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewoJCQkJCQkJaXRlbS5yb290ID0gby5yb290OwoJCQkJCQkJZm9ybWF0RmlsZShpdGVtLCBoZWFkZXJzLCByZXEpOwoJCQkJCQl9KTsKCQkJCQl9CgoJCQkJCWZvcm1hdEZpbGUobywgaGVhZGVycywgcmVxKTsKCgkJCQkJaWYgKG8uaXNfZGVsZXRlZCkgewoJCQkJCQlvLnN1Y2Nlc3MgPSB0cnVlOwoJCQkJCX0KCgkJCQkJcmV0dXJuIG87CgkJCQl9CgkJCX0sCgoJCQkvLyBEb2Vzbid0IHJldHVybiB0aGUgQ09SUyBoZWFkZXJzCgkJCXhocjogZnVuY3Rpb24ocCkgewoKCQkJCS8vIFRoZSBwcm94eSBzdXBwb3J0cyBhbGxvdy1jcm9zcy1vcmlnaW4tcmVzb3VyY2UKCQkJCS8vIEFsYXMgdGhhdCdzIHRoZSBvbmx5IHRoaW5nIHdlJ3JlIHVzaW5nLgoJCQkJaWYgKHAuZGF0YSAmJiBwLmRhdGEuZmlsZSkgewoJCQkJCXZhciBmaWxlID0gcC5kYXRhLmZpbGU7CgkJCQkJaWYgKGZpbGUpIHsKCQkJCQkJaWYgKGZpbGUuZmlsZXMpIHsKCQkJCQkJCXAuZGF0YSA9IGZpbGUuZmlsZXNbMF07CgkJCQkJCX0KCQkJCQkJZWxzZSB7CgkJCQkJCQlwLmRhdGEgPSBmaWxlOwoJCQkJCQl9CgkJCQkJfQoJCQkJfQoKCQkJCWlmIChwLm1ldGhvZCA9PT0gJ2RlbGV0ZScpIHsKCQkJCQlwLm1ldGhvZCA9ICdwb3N0JzsKCQkJCX0KCgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfSwKCgkJCWZvcm06IGZ1bmN0aW9uKHAsIHFzKSB7CgkJCQlkZWxldGUgcXMuc3RhdGU7CgkJCQlkZWxldGUgcXMucmVkaXJlY3RfdXJpOwoJCQl9CgkJfQoJfSk7CgoJZnVuY3Rpb24gZm9ybWF0RXJyb3IobykgewoJCWlmIChvICYmICdlcnJvcicgaW4gbykgewoJCQlvLmVycm9yID0gewoJCQkJY29kZTogJ3NlcnZlcl9lcnJvcicsCgkJCQltZXNzYWdlOiBvLmVycm9yLm1lc3NhZ2UgfHwgby5lcnJvcgoJCQl9OwoJCX0KCX0KCglmdW5jdGlvbiBmb3JtYXRGaWxlKG8sIGhlYWRlcnMsIHJlcSkgewoKCQlpZiAodHlwZW9mIG8gIT09ICdvYmplY3QnIHx8CgkJCSh0eXBlb2YgQmxvYiAhPT0gJ3VuZGVmaW5lZCcgJiYgbyBpbnN0YW5jZW9mIEJsb2IpIHx8CgkJCSh0eXBlb2YgQXJyYXlCdWZmZXIgIT09ICd1bmRlZmluZWQnICYmIG8gaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikpIHsKCQkJLy8gVGhpcyBpcyBhIGZpbGUsIGxldCBpdCB0aHJvdWdoIHVuZm9ybWF0dGVkCgkJCXJldHVybjsKCQl9CgoJCWlmICgnZXJyb3InIGluIG8pIHsKCQkJcmV0dXJuOwoJCX0KCgkJdmFyIHBhdGggPSAoby5yb290ICE9PSAnYXBwX2ZvbGRlcicgPyBvLnJvb3QgOiAnJykgKyBvLnBhdGgucmVwbGFjZSgvXCYvZywgJyUyNicpOwoJCXBhdGggPSBwYXRoLnJlcGxhY2UoL15cLy8sICcnKTsKCQlpZiAoby50aHVtYl9leGlzdHMpIHsKCQkJby50aHVtYm5haWwgPSByZXEub2F1dGhfcHJveHkgKyAnP3BhdGg9JyArCgkJCWVuY29kZVVSSUNvbXBvbmVudCgnaHR0cHM6Ly9hcGktY29udGVudC5kcm9wYm94LmNvbS8xL3RodW1ibmFpbHMvYXV0by8nICsgcGF0aCArICc/Zm9ybWF0PWpwZWcmc2l6ZT1tJykgKyAnJmFjY2Vzc190b2tlbj0nICsgcmVxLm9wdGlvbnMuYWNjZXNzX3Rva2VuOwoJCX0KCgkJby50eXBlID0gKG8uaXNfZGlyID8gJ2ZvbGRlcicgOiBvLm1pbWVfdHlwZSk7CgkJby5uYW1lID0gby5wYXRoLnJlcGxhY2UoLy4qXC8vZywgJycpOwoJCWlmIChvLmlzX2RpcikgewoJCQlvLmZpbGVzID0gcGF0aC5yZXBsYWNlKC9eXC8vLCAnJyk7CgkJfQoJCWVsc2UgewoJCQlvLmRvd25sb2FkTGluayA9IGhlbGxvLnNldHRpbmdzLm9hdXRoX3Byb3h5ICsgJz9wYXRoPScgKwoJCQllbmNvZGVVUklDb21wb25lbnQoJ2h0dHBzOi8vYXBpLWNvbnRlbnQuZHJvcGJveC5jb20vMS9maWxlcy9hdXRvLycgKyBwYXRoKSArICcmYWNjZXNzX3Rva2VuPScgKyByZXEub3B0aW9ucy5hY2Nlc3NfdG9rZW47CgkJCW8uZmlsZSA9ICdodHRwczovL2FwaS1jb250ZW50LmRyb3Bib3guY29tLzEvZmlsZXMvYXV0by8nICsgcGF0aDsKCQl9CgoJCWlmICghby5pZCkgewoJCQlvLmlkID0gby5wYXRoLnJlcGxhY2UoL15cLy8sICcnKTsKCQl9CgoJCS8vIE8ubWVkaWEgPSAnaHR0cHM6Ly9hcGktY29udGVudC5kcm9wYm94LmNvbS8xL2ZpbGVzLycgKyBwYXRoOwoJfQoKCWZ1bmN0aW9uIHJlcShzdHIpIHsKCQlyZXR1cm4gZnVuY3Rpb24ocCwgY2IpIHsKCQkJZGVsZXRlIHAucXVlcnkubGltaXQ7CgkJCWNiKHN0cik7CgkJfTsKCX0KCn0pKGhlbGxvKTsKCihmdW5jdGlvbihoZWxsbykgewoKCWhlbGxvLmluaXQoewoKCQlmYWNlYm9vazogewoKCQkJbmFtZTogJ0ZhY2Vib29rJywKCgkJCS8vIFNFRSBodHRwczovL2RldmVsb3BlcnMuZmFjZWJvb2suY29tL2RvY3MvZmFjZWJvb2stbG9naW4vbWFudWFsbHktYnVpbGQtYS1sb2dpbi1mbG93L3YyLjEKCQkJb2F1dGg6IHsKCQkJCXZlcnNpb246IDIsCgkJCQlhdXRoOiAnaHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL2RpYWxvZy9vYXV0aC8nLAoJCQkJZ3JhbnQ6ICdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS9vYXV0aC9hY2Nlc3NfdG9rZW4nCgkJCX0sCgoJCQkvLyBBdXRob3JpemF0aW9uIHNjb3BlcwoJCQlzY29wZTogewoJCQkJYmFzaWM6ICdwdWJsaWNfcHJvZmlsZScsCgkJCQllbWFpbDogJ2VtYWlsJywKCQkJCXNoYXJlOiAndXNlcl9wb3N0cycsCgkJCQliaXJ0aGRheTogJ3VzZXJfYmlydGhkYXknLAoJCQkJZXZlbnRzOiAndXNlcl9ldmVudHMnLAoJCQkJcGhvdG9zOiAndXNlcl9waG90b3MnLAoJCQkJdmlkZW9zOiAndXNlcl92aWRlb3MnLAoJCQkJZnJpZW5kczogJ3VzZXJfZnJpZW5kcycsCgkJCQlmaWxlczogJ3VzZXJfcGhvdG9zLHVzZXJfdmlkZW9zJywKCQkJCXB1Ymxpc2hfZmlsZXM6ICd1c2VyX3Bob3Rvcyx1c2VyX3ZpZGVvcyxwdWJsaXNoX2FjdGlvbnMnLAoJCQkJcHVibGlzaDogJ3B1Ymxpc2hfYWN0aW9ucycsCgoJCQkJLy8gRGVwcmVjYXRlZCBpbiB2Mi4wCgkJCQkvLyBDcmVhdGVfZXZlbnQJOiAnY3JlYXRlX2V2ZW50JywKCgkJCQlvZmZsaW5lX2FjY2VzczogJ29mZmxpbmVfYWNjZXNzJwoJCQl9LAoKCQkJLy8gUmVmcmVzaCB0aGUgYWNjZXNzX3Rva2VuCgkJCXJlZnJlc2g6IHRydWUsCgoJCQlsb2dpbjogZnVuY3Rpb24ocCkgewoKCQkJCS8vIFJlYXV0aGVudGljYXRlCgkJCQkvLyBodHRwczovL2RldmVsb3BlcnMuZmFjZWJvb2suY29tL2RvY3MvZmFjZWJvb2stbG9naW4vcmVhdXRoZW50aWNhdGlvbgoJCQkJaWYgKHAub3B0aW9ucy5mb3JjZSkgewoJCQkJCXAucXMuYXV0aF90eXBlID0gJ3JlYXV0aGVudGljYXRlJzsKCQkJCX0KCgkJCQkvLyBUaGUgZmFjZWJvb2sgbG9naW4gd2luZG93IGlzIGEgZGlmZmVyZW50IHNpemUuCgkJCQlwLm9wdGlvbnMucG9wdXAud2lkdGggPSA1ODA7CgkJCQlwLm9wdGlvbnMucG9wdXAuaGVpZ2h0ID0gNDAwOwoJCQl9LAoKCQkJbG9nb3V0OiBmdW5jdGlvbihjYWxsYmFjaywgb3B0aW9ucykgewoJCQkJLy8gQXNzaWduIGNhbGxiYWNrIHRvIGEgZ2xvYmFsIGhhbmRsZXIKCQkJCXZhciBjYWxsYmFja0lEID0gaGVsbG8udXRpbHMuZ2xvYmFsRXZlbnQoY2FsbGJhY2spOwoJCQkJdmFyIHJlZGlyZWN0ID0gZW5jb2RlVVJJQ29tcG9uZW50KGhlbGxvLnNldHRpbmdzLnJlZGlyZWN0X3VyaSArICc/JyArIGhlbGxvLnV0aWxzLnBhcmFtKHtjYWxsYmFjazpjYWxsYmFja0lELCByZXN1bHQ6IEpTT04uc3RyaW5naWZ5KHtmb3JjZTp0cnVlfSksIHN0YXRlOiAne30nfSkpOwoJCQkJdmFyIHRva2VuID0gKG9wdGlvbnMuYXV0aFJlc3BvbnNlIHx8IHt9KS5hY2Nlc3NfdG9rZW47CgkJCQloZWxsby51dGlscy5pZnJhbWUoJ2h0dHBzOi8vd3d3LmZhY2Vib29rLmNvbS9sb2dvdXQucGhwP25leHQ9JyArIHJlZGlyZWN0ICsgJyZhY2Nlc3NfdG9rZW49JyArIHRva2VuKTsKCgkJCQkvLyBQb3NzaWJsZSByZXNwb25zZXM6CgkJCQkvLyBTdHJpbmcgVVJMCS0gaGVsbG8ubG9nb3V0IHNob3VsZCBoYW5kbGUgdGhlIGxvZ291dAoJCQkJLy8gVW5kZWZpbmVkCS0gdGhpcyBmdW5jdGlvbiB3aWxsIGhhbmRsZSB0aGUgY2FsbGJhY2sKCQkJCS8vIFRydWUgLSB0aHJvdyBhIHN1Y2Nlc3MsIHRoaXMgY2FsbGJhY2sgaXNuJ3QgaGFuZGxpbmcgdGhlIGNhbGxiYWNrCgkJCQkvLyBGYWxzZSAtIHRocm93IGEgZXJyb3IKCQkJCWlmICghdG9rZW4pIHsKCQkJCQkvLyBJZiB0aGVyZSBpc24ndCBhIHRva2VuLCB0aGUgYWJvdmUgd29udCByZXR1cm4gYSByZXNwb25zZSwgc28gbGV0cyB0cmlnZ2VyIGEgcmVzcG9uc2UKCQkJCQlyZXR1cm4gZmFsc2U7CgkJCQl9CgkJCX0sCgoJCQkvLyBBUEkgQmFzZSBVUkwKCQkJYmFzZTogJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YyLjQvJywKCgkJCS8vIE1hcCBHRVQgcmVxdWVzdHMKCQkJZ2V0OiB7CgkJCQltZTogJ21lP2ZpZWxkcz1lbWFpbCxmaXJzdF9uYW1lLGxhc3RfbmFtZSxuYW1lLHRpbWV6b25lLHZlcmlmaWVkJywKCQkJCSdtZS9mcmllbmRzJzogJ21lL2ZyaWVuZHMnLAoJCQkJJ21lL2ZvbGxvd2luZyc6ICdtZS9mcmllbmRzJywKCQkJCSdtZS9mb2xsb3dlcnMnOiAnbWUvZnJpZW5kcycsCgkJCQknbWUvc2hhcmUnOiAnbWUvZmVlZCcsCgkJCQknbWUvbGlrZSc6ICdtZS9saWtlcycsCgkJCQknbWUvZmlsZXMnOiAnbWUvYWxidW1zJywKCQkJCSdtZS9hbGJ1bXMnOiAnbWUvYWxidW1zP2ZpZWxkcz1jb3Zlcl9waG90byxuYW1lJywKCQkJCSdtZS9hbGJ1bSc6ICdAe2lkfS9waG90b3M/ZmllbGRzPXBpY3R1cmUnLAoJCQkJJ21lL3Bob3Rvcyc6ICdtZS9waG90b3MnLAoJCQkJJ21lL3Bob3RvJzogJ0B7aWR9JywKCQkJCSdmcmllbmQvYWxidW1zJzogJ0B7aWR9L2FsYnVtcycsCgkJCQknZnJpZW5kL3Bob3Rvcyc6ICdAe2lkfS9waG90b3MnCgoJCQkJLy8gUGFnaW5hdGlvbgoJCQkJLy8gSHR0cHM6Ly9kZXZlbG9wZXJzLmZhY2Vib29rLmNvbS9kb2NzL3JlZmVyZW5jZS9hcGkvcGFnaW5hdGlvbi8KCQkJfSwKCgkJCS8vIE1hcCBQT1NUIHJlcXVlc3RzCgkJCXBvc3Q6IHsKCQkJCSdtZS9zaGFyZSc6ICdtZS9mZWVkJywKCQkJCSdtZS9waG90byc6ICdAe2lkfScKCgkJCQkvLyBIdHRwczovL2RldmVsb3BlcnMuZmFjZWJvb2suY29tL2RvY3MvZ3JhcGgtYXBpL3JlZmVyZW5jZS92Mi4yL29iamVjdC9saWtlcy8KCQkJfSwKCgkJCXdyYXA6IHsKCQkJCW1lOiBmb3JtYXRVc2VyLAoJCQkJJ21lL2ZyaWVuZHMnOiBmb3JtYXRGcmllbmRzLAoJCQkJJ21lL2ZvbGxvd2luZyc6IGZvcm1hdEZyaWVuZHMsCgkJCQknbWUvZm9sbG93ZXJzJzogZm9ybWF0RnJpZW5kcywKCQkJCSdtZS9hbGJ1bXMnOiBmb3JtYXQsCgkJCQknbWUvcGhvdG9zJzogZm9ybWF0LAoJCQkJJ21lL2ZpbGVzJzogZm9ybWF0LAoJCQkJJ2RlZmF1bHQnOiBmb3JtYXQKCQkJfSwKCgkJCS8vIFNwZWNpYWwgcmVxdWlyZW1lbnRzIGZvciBoYW5kbGluZyBYSFIKCQkJeGhyOiBmdW5jdGlvbihwLCBxcykgewoJCQkJaWYgKHAubWV0aG9kID09PSAnZ2V0JyB8fCBwLm1ldGhvZCA9PT0gJ3Bvc3QnKSB7CgkJCQkJcXMuc3VwcHJlc3NfcmVzcG9uc2VfY29kZXMgPSB0cnVlOwoJCQkJfQoKCQkJCS8vIElzIHRoaXMgYSBwb3N0IHdpdGggYSBkYXRhLXVyaT8KCQkJCWlmIChwLm1ldGhvZCA9PT0gJ3Bvc3QnICYmIHAuZGF0YSAmJiB0eXBlb2YgKHAuZGF0YS5maWxlKSA9PT0gJ3N0cmluZycpIHsKCQkJCQkvLyBDb252ZXJ0IHRoZSBEYXRhLVVSSSB0byBhIEJsb2IKCQkJCQlwLmRhdGEuZmlsZSA9IGhlbGxvLnV0aWxzLnRvQmxvYihwLmRhdGEuZmlsZSk7CgkJCQl9CgoJCQkJcmV0dXJuIHRydWU7CgkJCX0sCgoJCQkvLyBTcGVjaWFsIHJlcXVpcmVtZW50cyBmb3IgaGFuZGxpbmcgSlNPTlAgZmFsbGJhY2sKCQkJanNvbnA6IGZ1bmN0aW9uKHAsIHFzKSB7CgkJCQl2YXIgbSA9IHAubWV0aG9kOwoJCQkJaWYgKG0gIT09ICdnZXQnICYmICFoZWxsby51dGlscy5oYXNCaW5hcnkocC5kYXRhKSkgewoJCQkJCXAuZGF0YS5tZXRob2QgPSBtOwoJCQkJCXAubWV0aG9kID0gJ2dldCc7CgkJCQl9CgkJCQllbHNlIGlmIChwLm1ldGhvZCA9PT0gJ2RlbGV0ZScpIHsKCQkJCQlxcy5tZXRob2QgPSAnZGVsZXRlJzsKCQkJCQlwLm1ldGhvZCA9ICdwb3N0JzsKCQkJCX0KCQkJfSwKCgkJCS8vIFNwZWNpYWwgcmVxdWlyZW1lbnRzIGZvciBpZnJhbWUgZm9ybSBoYWNrCgkJCWZvcm06IGZ1bmN0aW9uKHApIHsKCQkJCXJldHVybiB7CgkJCQkJLy8gRmlyZSB0aGUgY2FsbGJhY2sgb25sb2FkCgkJCQkJY2FsbGJhY2tvbmxvYWQ6IHRydWUKCQkJCX07CgkJCX0KCQl9Cgl9KTsKCgl2YXIgYmFzZSA9ICdodHRwczovL2dyYXBoLmZhY2Vib29rLmNvbS8nOwoKCWZ1bmN0aW9uIGZvcm1hdFVzZXIobykgewoJCWlmIChvLmlkKSB7CgkJCW8udGh1bWJuYWlsID0gby5waWN0dXJlID0gJ2h0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tLycgKyBvLmlkICsgJy9waWN0dXJlJzsKCQl9CgoJCXJldHVybiBvOwoJfQoKCWZ1bmN0aW9uIGZvcm1hdEZyaWVuZHMobykgewoJCWlmICgnZGF0YScgaW4gbykgewoJCQlvLmRhdGEuZm9yRWFjaChmb3JtYXRVc2VyKTsKCQl9CgoJCXJldHVybiBvOwoJfQoKCWZ1bmN0aW9uIGZvcm1hdChvLCBoZWFkZXJzLCByZXEpIHsKCQlpZiAodHlwZW9mIG8gPT09ICdib29sZWFuJykgewoJCQlvID0ge3N1Y2Nlc3M6IG99OwoJCX0KCgkJaWYgKG8gJiYgJ2RhdGEnIGluIG8pIHsKCQkJdmFyIHRva2VuID0gcmVxLnF1ZXJ5LmFjY2Vzc190b2tlbjsKCgkJCWlmICghKG8uZGF0YSBpbnN0YW5jZW9mIEFycmF5KSkgewoJCQkJdmFyIGRhdGEgPSBvLmRhdGE7CgkJCQlkZWxldGUgby5kYXRhOwoJCQkJby5kYXRhID0gW2RhdGFdOwoJCQl9CgoJCQlvLmRhdGEuZm9yRWFjaChmdW5jdGlvbihkKSB7CgoJCQkJaWYgKGQucGljdHVyZSkgewoJCQkJCWQudGh1bWJuYWlsID0gZC5waWN0dXJlOwoJCQkJfQoKCQkJCWQucGljdHVyZXMgPSAoZC5pbWFnZXMgfHwgW10pCgkJCQkJLnNvcnQoZnVuY3Rpb24oYSwgYikgewoJCQkJCQlyZXR1cm4gYS53aWR0aCAtIGIud2lkdGg7CgkJCQkJfSk7CgoJCQkJaWYgKGQuY292ZXJfcGhvdG8gJiYgZC5jb3Zlcl9waG90by5pZCkgewoJCQkJCWQudGh1bWJuYWlsID0gYmFzZSArIGQuY292ZXJfcGhvdG8uaWQgKyAnL3BpY3R1cmU/YWNjZXNzX3Rva2VuPScgKyB0b2tlbjsKCQkJCX0KCgkJCQlpZiAoZC50eXBlID09PSAnYWxidW0nKSB7CgkJCQkJZC5maWxlcyA9IGQucGhvdG9zID0gYmFzZSArIGQuaWQgKyAnL3Bob3Rvcyc7CgkJCQl9CgoJCQkJaWYgKGQuY2FuX3VwbG9hZCkgewoJCQkJCWQudXBsb2FkX2xvY2F0aW9uID0gYmFzZSArIGQuaWQgKyAnL3Bob3Rvcyc7CgkJCQl9CgkJCX0pOwoJCX0KCgkJcmV0dXJuIG87Cgl9Cgp9KShoZWxsbyk7CgooZnVuY3Rpb24oaGVsbG8pIHsKCgloZWxsby5pbml0KHsKCgkJZmxpY2tyOiB7CgoJCQluYW1lOiAnRmxpY2tyJywKCgkJCS8vIEVuc3VyZSB0aGF0IHlvdSBkZWZpbmUgYW4gb2F1dGhfcHJveHkKCQkJb2F1dGg6IHsKCQkJCXZlcnNpb246ICcxLjBhJywKCQkJCWF1dGg6ICdodHRwczovL3d3dy5mbGlja3IuY29tL3NlcnZpY2VzL29hdXRoL2F1dGhvcml6ZT9wZXJtcz1yZWFkJywKCQkJCXJlcXVlc3Q6ICdodHRwczovL3d3dy5mbGlja3IuY29tL3NlcnZpY2VzL29hdXRoL3JlcXVlc3RfdG9rZW4nLAoJCQkJdG9rZW46ICdodHRwczovL3d3dy5mbGlja3IuY29tL3NlcnZpY2VzL29hdXRoL2FjY2Vzc190b2tlbicKCQkJfSwKCgkJCS8vIEFQSSBiYXNlIFVSTAoJCQliYXNlOiAnaHR0cHM6Ly9hcGkuZmxpY2tyLmNvbS9zZXJ2aWNlcy9yZXN0JywKCgkJCS8vIE1hcCBHRVQgcmVzcXVlc3RzCgkJCWdldDogewoJCQkJbWU6IHNpZ24oJ2ZsaWNrci5wZW9wbGUuZ2V0SW5mbycpLAoJCQkJJ21lL2ZyaWVuZHMnOiBzaWduKCdmbGlja3IuY29udGFjdHMuZ2V0TGlzdCcsIHtwZXJfcGFnZTonQHtsaW1pdHw1MH0nfSksCgkJCQknbWUvZm9sbG93aW5nJzogc2lnbignZmxpY2tyLmNvbnRhY3RzLmdldExpc3QnLCB7cGVyX3BhZ2U6J0B7bGltaXR8NTB9J30pLAoJCQkJJ21lL2ZvbGxvd2Vycyc6IHNpZ24oJ2ZsaWNrci5jb250YWN0cy5nZXRMaXN0Jywge3Blcl9wYWdlOidAe2xpbWl0fDUwfSd9KSwKCQkJCSdtZS9hbGJ1bXMnOiBzaWduKCdmbGlja3IucGhvdG9zZXRzLmdldExpc3QnLCB7cGVyX3BhZ2U6J0B7bGltaXR8NTB9J30pLAoJCQkJJ21lL2FsYnVtJzogc2lnbignZmxpY2tyLnBob3Rvc2V0cy5nZXRQaG90b3MnLCB7cGhvdG9zZXRfaWQ6ICdAe2lkfSd9KSwKCQkJCSdtZS9waG90b3MnOiBzaWduKCdmbGlja3IucGVvcGxlLmdldFBob3RvcycsIHtwZXJfcGFnZTonQHtsaW1pdHw1MH0nfSkKCQkJfSwKCgkJCXdyYXA6IHsKCQkJCW1lOiBmdW5jdGlvbihvKSB7CgkJCQkJZm9ybWF0RXJyb3Iobyk7CgkJCQkJbyA9IGNoZWNrUmVzcG9uc2UobywgJ3BlcnNvbicpOwoJCQkJCWlmIChvLmlkKSB7CgkJCQkJCWlmIChvLnJlYWxuYW1lKSB7CgkJCQkJCQlvLm5hbWUgPSBvLnJlYWxuYW1lLl9jb250ZW50OwoJCQkJCQkJdmFyIG0gPSBvLm5hbWUuc3BsaXQoJyAnKTsKCQkJCQkJCW8uZmlyc3RfbmFtZSA9IG0uc2hpZnQoKTsKCQkJCQkJCW8ubGFzdF9uYW1lID0gbS5qb2luKCcgJyk7CgkJCQkJCX0KCgkJCQkJCW8udGh1bWJuYWlsID0gZ2V0QnVkZHlJY29uKG8sICdsJyk7CgkJCQkJCW8ucGljdHVyZSA9IGdldEJ1ZGR5SWNvbihvLCAnbCcpOwoJCQkJCX0KCgkJCQkJcmV0dXJuIG87CgkJCQl9LAoKCQkJCSdtZS9mcmllbmRzJzogZm9ybWF0RnJpZW5kcywKCQkJCSdtZS9mb2xsb3dlcnMnOiBmb3JtYXRGcmllbmRzLAoJCQkJJ21lL2ZvbGxvd2luZyc6IGZvcm1hdEZyaWVuZHMsCgkJCQknbWUvYWxidW1zJzogZnVuY3Rpb24obykgewoJCQkJCWZvcm1hdEVycm9yKG8pOwoJCQkJCW8gPSBjaGVja1Jlc3BvbnNlKG8sICdwaG90b3NldHMnKTsKCQkJCQlwYWdpbmcobyk7CgkJCQkJaWYgKG8ucGhvdG9zZXQpIHsKCQkJCQkJby5kYXRhID0gby5waG90b3NldDsKCQkJCQkJby5kYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewoJCQkJCQkJaXRlbS5uYW1lID0gaXRlbS50aXRsZS5fY29udGVudDsKCQkJCQkJCWl0ZW0ucGhvdG9zID0gJ2h0dHBzOi8vYXBpLmZsaWNrci5jb20vc2VydmljZXMvcmVzdCcgKyBnZXRBcGlVcmwoJ2ZsaWNrci5waG90b3NldHMuZ2V0UGhvdG9zJywge3Bob3Rvc2V0X2lkOiBpdGVtLmlkfSwgdHJ1ZSk7CgkJCQkJCX0pOwoKCQkJCQkJZGVsZXRlIG8ucGhvdG9zZXQ7CgkJCQkJfQoKCQkJCQlyZXR1cm4gbzsKCQkJCX0sCgoJCQkJJ21lL3Bob3Rvcyc6IGZ1bmN0aW9uKG8pIHsKCQkJCQlmb3JtYXRFcnJvcihvKTsKCQkJCQlyZXR1cm4gZm9ybWF0UGhvdG9zKG8pOwoJCQkJfSwKCgkJCQknZGVmYXVsdCc6IGZ1bmN0aW9uKG8pIHsKCQkJCQlmb3JtYXRFcnJvcihvKTsKCQkJCQlyZXR1cm4gZm9ybWF0UGhvdG9zKG8pOwoJCQkJfQoJCQl9LAoKCQkJeGhyOiBmYWxzZSwKCgkJCWpzb25wOiBmdW5jdGlvbihwLCBxcykgewoJCQkJaWYgKHAubWV0aG9kID09ICdnZXQnKSB7CgkJCQkJZGVsZXRlIHFzLmNhbGxiYWNrOwoJCQkJCXFzLmpzb25jYWxsYmFjayA9IHAuY2FsbGJhY2tJRDsKCQkJCX0KCQkJfQoJCX0KCX0pOwoKCWZ1bmN0aW9uIGdldEFwaVVybChtZXRob2QsIGV4dHJhUGFyYW1zLCBza2lwTmV0d29yaykgewoJCXZhciB1cmwgPSAoKHNraXBOZXR3b3JrKSA/ICcnIDogJ2ZsaWNrcjonKSArCgkJCSc/bWV0aG9kPScgKyBtZXRob2QgKwoJCQknJmFwaV9rZXk9JyArIGhlbGxvLnNlcnZpY2VzLmZsaWNrci5pZCArCgkJCScmZm9ybWF0PWpzb24nOwoJCWZvciAodmFyIHBhcmFtIGluIGV4dHJhUGFyYW1zKSB7CgkJCWlmIChleHRyYVBhcmFtcy5oYXNPd25Qcm9wZXJ0eShwYXJhbSkpIHsKCQkJCXVybCArPSAnJicgKyBwYXJhbSArICc9JyArIGV4dHJhUGFyYW1zW3BhcmFtXTsKCQkJfQoJCX0KCgkJcmV0dXJuIHVybDsKCX0KCgkvLyBUaGlzIGlzIG5vdCBleGFjdGx5IG5lYXQgYnV0IGF2b2lkIHRvIGNhbGwKCS8vIFRoZSBtZXRob2QgJ2ZsaWNrci50ZXN0LmxvZ2luJyBmb3IgZWFjaCBhcGkgY2FsbAoKCWZ1bmN0aW9uIHdpdGhVc2VyKGNiKSB7CgkJdmFyIGF1dGggPSBoZWxsby5nZXRBdXRoUmVzcG9uc2UoJ2ZsaWNrcicpOwoJCWNiKGF1dGggJiYgYXV0aC51c2VyX25zaWQgPyBhdXRoLnVzZXJfbnNpZCA6IG51bGwpOwoJfQoKCWZ1bmN0aW9uIHNpZ24odXJsLCBwYXJhbXMpIHsKCQlpZiAoIXBhcmFtcykgewoJCQlwYXJhbXMgPSB7fTsKCQl9CgoJCXJldHVybiBmdW5jdGlvbihwLCBjYWxsYmFjaykgewoJCQl3aXRoVXNlcihmdW5jdGlvbih1c2VySWQpIHsKCQkJCXBhcmFtcy51c2VyX2lkID0gdXNlcklkOwoJCQkJY2FsbGJhY2soZ2V0QXBpVXJsKHVybCwgcGFyYW1zLCB0cnVlKSk7CgkJCX0pOwoJCX07Cgl9CgoJZnVuY3Rpb24gZ2V0QnVkZHlJY29uKHByb2ZpbGUsIHNpemUpIHsKCQl2YXIgdXJsID0gJ2h0dHBzOi8vd3d3LmZsaWNrci5jb20vaW1hZ2VzL2J1ZGR5aWNvbi5naWYnOwoJCWlmIChwcm9maWxlLm5zaWQgJiYgcHJvZmlsZS5pY29uc2VydmVyICYmIHByb2ZpbGUuaWNvbmZhcm0pIHsKCQkJdXJsID0gJ2h0dHBzOi8vZmFybScgKyBwcm9maWxlLmljb25mYXJtICsgJy5zdGF0aWNmbGlja3IuY29tLycgKwoJCQkJcHJvZmlsZS5pY29uc2VydmVyICsgJy8nICsKCQkJCSdidWRkeWljb25zLycgKyBwcm9maWxlLm5zaWQgKwoJCQkJKChzaXplKSA/ICdfJyArIHNpemUgOiAnJykgKyAnLmpwZyc7CgkJfQoKCQlyZXR1cm4gdXJsOwoJfQoKCS8vIFNlZTogaHR0cHM6Ly93d3cuZmxpY2tyLmNvbS9zZXJ2aWNlcy9hcGkvbWlzYy51cmxzLmh0bWwKCWZ1bmN0aW9uIGNyZWF0ZVBob3RvVXJsKGlkLCBmYXJtLCBzZXJ2ZXIsIHNlY3JldCwgc2l6ZSkgewoJCXNpemUgPSAoc2l6ZSkgPyAnXycgKyBzaXplIDogJyc7CgkJcmV0dXJuICdodHRwczovL2Zhcm0nICsgZmFybSArICcuc3RhdGljZmxpY2tyLmNvbS8nICsgc2VydmVyICsgJy8nICsgaWQgKyAnXycgKyBzZWNyZXQgKyBzaXplICsgJy5qcGcnOwoJfQoKCWZ1bmN0aW9uIGZvcm1hdFVzZXIobykgewoJfQoKCWZ1bmN0aW9uIGZvcm1hdEVycm9yKG8pIHsKCQlpZiAobyAmJiBvLnN0YXQgJiYgby5zdGF0LnRvTG93ZXJDYXNlKCkgIT0gJ29rJykgewoJCQlvLmVycm9yID0gewoJCQkJY29kZTogJ2ludmFsaWRfcmVxdWVzdCcsCgkJCQltZXNzYWdlOiBvLm1lc3NhZ2UKCQkJfTsKCQl9Cgl9CgoJZnVuY3Rpb24gZm9ybWF0UGhvdG9zKG8pIHsKCQlpZiAoby5waG90b3NldCB8fCBvLnBob3RvcykgewoJCQl2YXIgc2V0ID0gKCdwaG90b3NldCcgaW4gbykgPyAncGhvdG9zZXQnIDogJ3Bob3Rvcyc7CgkJCW8gPSBjaGVja1Jlc3BvbnNlKG8sIHNldCk7CgkJCXBhZ2luZyhvKTsKCQkJby5kYXRhID0gby5waG90bzsKCQkJZGVsZXRlIG8ucGhvdG87CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgby5kYXRhLmxlbmd0aDsgaSsrKSB7CgkJCQl2YXIgcGhvdG8gPSBvLmRhdGFbaV07CgkJCQlwaG90by5uYW1lID0gcGhvdG8udGl0bGU7CgkJCQlwaG90by5waWN0dXJlID0gY3JlYXRlUGhvdG9VcmwocGhvdG8uaWQsIHBob3RvLmZhcm0sIHBob3RvLnNlcnZlciwgcGhvdG8uc2VjcmV0LCAnJyk7CgkJCQlwaG90by5waWN0dXJlcyA9IGNyZWF0ZVBpY3R1cmVzKHBob3RvLmlkLCBwaG90by5mYXJtLCBwaG90by5zZXJ2ZXIsIHBob3RvLnNlY3JldCk7CgkJCQlwaG90by5zb3VyY2UgPSBjcmVhdGVQaG90b1VybChwaG90by5pZCwgcGhvdG8uZmFybSwgcGhvdG8uc2VydmVyLCBwaG90by5zZWNyZXQsICdiJyk7CgkJCQlwaG90by50aHVtYm5haWwgPSBjcmVhdGVQaG90b1VybChwaG90by5pZCwgcGhvdG8uZmFybSwgcGhvdG8uc2VydmVyLCBwaG90by5zZWNyZXQsICdtJyk7CgkJCX0KCQl9CgoJCXJldHVybiBvOwoJfQoKCS8vIFNlZTogaHR0cHM6Ly93d3cuZmxpY2tyLmNvbS9zZXJ2aWNlcy9hcGkvbWlzYy51cmxzLmh0bWwKCWZ1bmN0aW9uIGNyZWF0ZVBpY3R1cmVzKGlkLCBmYXJtLCBzZXJ2ZXIsIHNlY3JldCkgewoKCQl2YXIgTk9fTElNSVQgPSAyMDQ4OwoJCXZhciBzaXplcyA9IFsKCQkJe2lkOiAndCcsIG1heDogMTAwfSwKCQkJe2lkOiAnbScsIG1heDogMjQwfSwKCQkJe2lkOiAnbicsIG1heDogMzIwfSwKCQkJe2lkOiAnJywgbWF4OiA1MDB9LAoJCQl7aWQ6ICd6JywgbWF4OiA2NDB9LAoJCQl7aWQ6ICdjJywgbWF4OiA4MDB9LAoJCQl7aWQ6ICdiJywgbWF4OiAxMDI0fSwKCQkJe2lkOiAnaCcsIG1heDogMTYwMH0sCgkJCXtpZDogJ2snLCBtYXg6IDIwNDh9LAoJCQl7aWQ6ICdvJywgbWF4OiBOT19MSU1JVH0KCQldOwoKCQlyZXR1cm4gc2l6ZXMubWFwKGZ1bmN0aW9uKHNpemUpIHsKCQkJcmV0dXJuIHsKCQkJCXNvdXJjZTogY3JlYXRlUGhvdG9VcmwoaWQsIGZhcm0sIHNlcnZlciwgc2VjcmV0LCBzaXplLmlkKSwKCgkJCQkvLyBOb3RlOiB0aGlzIGlzIGEgZ3Vlc3MgdGhhdCdzIGFsbW9zdCBjZXJ0YWluIHRvIGJlIHdyb25nICh1bmxlc3Mgc3F1YXJlIHNvdXJjZSkKCQkJCXdpZHRoOiBzaXplLm1heCwKCQkJCWhlaWdodDogc2l6ZS5tYXgKCQkJfTsKCQl9KTsKCX0KCglmdW5jdGlvbiBjaGVja1Jlc3BvbnNlKG8sIGtleSkgewoKCQlpZiAoa2V5IGluIG8pIHsKCQkJbyA9IG9ba2V5XTsKCQl9CgkJZWxzZSBpZiAoISgnZXJyb3InIGluIG8pKSB7CgkJCW8uZXJyb3IgPSB7CgkJCQljb2RlOiAnaW52YWxpZF9yZXF1ZXN0JywKCQkJCW1lc3NhZ2U6IG8ubWVzc2FnZSB8fCAnRmFpbGVkIHRvIGdldCBkYXRhIGZyb20gRmxpY2tyJwoJCQl9OwoJCX0KCgkJcmV0dXJuIG87Cgl9CgoJZnVuY3Rpb24gZm9ybWF0RnJpZW5kcyhvKSB7CgkJZm9ybWF0RXJyb3Iobyk7CgkJaWYgKG8uY29udGFjdHMpIHsKCQkJbyA9IGNoZWNrUmVzcG9uc2UobywgJ2NvbnRhY3RzJyk7CgkJCXBhZ2luZyhvKTsKCQkJby5kYXRhID0gby5jb250YWN0OwoJCQlkZWxldGUgby5jb250YWN0OwoJCQlmb3IgKHZhciBpID0gMDsgaSA8IG8uZGF0YS5sZW5ndGg7IGkrKykgewoJCQkJdmFyIGl0ZW0gPSBvLmRhdGFbaV07CgkJCQlpdGVtLmlkID0gaXRlbS5uc2lkOwoJCQkJaXRlbS5uYW1lID0gaXRlbS5yZWFsbmFtZSB8fCBpdGVtLnVzZXJuYW1lOwoJCQkJaXRlbS50aHVtYm5haWwgPSBnZXRCdWRkeUljb24oaXRlbSwgJ20nKTsKCQkJfQoJCX0KCgkJcmV0dXJuIG87Cgl9CgoJZnVuY3Rpb24gcGFnaW5nKHJlcykgewoJCWlmIChyZXMucGFnZSAmJiByZXMucGFnZXMgJiYgcmVzLnBhZ2UgIT09IHJlcy5wYWdlcykgewoJCQlyZXMucGFnaW5nID0gewoJCQkJbmV4dDogJz9wYWdlPScgKyAoKytyZXMucGFnZSkKCQkJfTsKCQl9Cgl9Cgp9KShoZWxsbyk7CgooZnVuY3Rpb24oaGVsbG8pIHsKCgloZWxsby5pbml0KHsKCgkJZm91cnNxdWFyZTogewoKCQkJbmFtZTogJ0ZvdXJzcXVhcmUnLAoKCQkJb2F1dGg6IHsKCQkJCS8vIFNlZTogaHR0cHM6Ly9kZXZlbG9wZXIuZm91cnNxdWFyZS5jb20vb3ZlcnZpZXcvYXV0aAoJCQkJdmVyc2lvbjogMiwKCQkJCWF1dGg6ICdodHRwczovL2ZvdXJzcXVhcmUuY29tL29hdXRoMi9hdXRoZW50aWNhdGUnLAoJCQkJZ3JhbnQ6ICdodHRwczovL2ZvdXJzcXVhcmUuY29tL29hdXRoMi9hY2Nlc3NfdG9rZW4nCgkJCX0sCgoJCQkvLyBSZWZyZXNoIHRoZSBhY2Nlc3NfdG9rZW4gb25jZSBleHBpcmVkCgkJCXJlZnJlc2g6IHRydWUsCgoJCQliYXNlOiAnaHR0cHM6Ly9hcGkuZm91cnNxdWFyZS5jb20vdjIvJywKCgkJCWdldDogewoJCQkJbWU6ICd1c2Vycy9zZWxmJywKCQkJCSdtZS9mcmllbmRzJzogJ3VzZXJzL3NlbGYvZnJpZW5kcycsCgkJCQknbWUvZm9sbG93ZXJzJzogJ3VzZXJzL3NlbGYvZnJpZW5kcycsCgkJCQknbWUvZm9sbG93aW5nJzogJ3VzZXJzL3NlbGYvZnJpZW5kcycKCQkJfSwKCgkJCXdyYXA6IHsKCQkJCW1lOiBmdW5jdGlvbihvKSB7CgkJCQkJZm9ybWF0RXJyb3Iobyk7CgkJCQkJaWYgKG8gJiYgby5yZXNwb25zZSkgewoJCQkJCQlvID0gby5yZXNwb25zZS51c2VyOwoJCQkJCQlmb3JtYXRVc2VyKG8pOwoJCQkJCX0KCgkJCQkJcmV0dXJuIG87CgkJCQl9LAoKCQkJCSdkZWZhdWx0JzogZnVuY3Rpb24obykgewoJCQkJCWZvcm1hdEVycm9yKG8pOwoKCQkJCQkvLyBGb3JtYXQgZnJpZW5kcwoJCQkJCWlmIChvICYmICdyZXNwb25zZScgaW4gbyAmJiAnZnJpZW5kcycgaW4gby5yZXNwb25zZSAmJiAnaXRlbXMnIGluIG8ucmVzcG9uc2UuZnJpZW5kcykgewoJCQkJCQlvLmRhdGEgPSBvLnJlc3BvbnNlLmZyaWVuZHMuaXRlbXM7CgkJCQkJCW8uZGF0YS5mb3JFYWNoKGZvcm1hdFVzZXIpOwoJCQkJCQlkZWxldGUgby5yZXNwb25zZTsKCQkJCQl9CgoJCQkJCXJldHVybiBvOwoJCQkJfQoJCQl9LAoKCQkJeGhyOiBmb3JtYXRSZXF1ZXN0LAoJCQlqc29ucDogZm9ybWF0UmVxdWVzdAoJCX0KCX0pOwoKCWZ1bmN0aW9uIGZvcm1hdEVycm9yKG8pIHsKCQlpZiAoby5tZXRhICYmIChvLm1ldGEuY29kZSA9PT0gNDAwIHx8IG8ubWV0YS5jb2RlID09PSA0MDEpKSB7CgkJCW8uZXJyb3IgPSB7CgkJCQljb2RlOiAnYWNjZXNzX2RlbmllZCcsCgkJCQltZXNzYWdlOiBvLm1ldGEuZXJyb3JEZXRhaWwKCQkJfTsKCQl9Cgl9CgoJZnVuY3Rpb24gZm9ybWF0VXNlcihvKSB7CgkJaWYgKG8gJiYgby5pZCkgewoJCQlvLnRodW1ibmFpbCA9IG8ucGhvdG8ucHJlZml4ICsgJzEwMHgxMDAnICsgby5waG90by5zdWZmaXg7CgkJCW8ubmFtZSA9IG8uZmlyc3ROYW1lICsgJyAnICsgby5sYXN0TmFtZTsKCQkJby5maXJzdF9uYW1lID0gby5maXJzdE5hbWU7CgkJCW8ubGFzdF9uYW1lID0gby5sYXN0TmFtZTsKCQkJaWYgKG8uY29udGFjdCkgewoJCQkJaWYgKG8uY29udGFjdC5lbWFpbCkgewoJCQkJCW8uZW1haWwgPSBvLmNvbnRhY3QuZW1haWw7CgkJCQl9CgkJCX0KCQl9Cgl9CgoJZnVuY3Rpb24gZm9ybWF0UmVxdWVzdChwLCBxcykgewoJCXZhciB0b2tlbiA9IHFzLmFjY2Vzc190b2tlbjsKCQlkZWxldGUgcXMuYWNjZXNzX3Rva2VuOwoJCXFzLm9hdXRoX3Rva2VuID0gdG9rZW47CgkJcXMudiA9IDIwMTIxMTI1OwoJCXJldHVybiB0cnVlOwoJfQoKfSkoaGVsbG8pOwoKKGZ1bmN0aW9uKGhlbGxvKSB7CgoJaGVsbG8uaW5pdCh7CgoJCWdpdGh1YjogewoKCQkJbmFtZTogJ0dpdEh1YicsCgoJCQlvYXV0aDogewoJCQkJdmVyc2lvbjogMiwKCQkJCWF1dGg6ICdodHRwczovL2dpdGh1Yi5jb20vbG9naW4vb2F1dGgvYXV0aG9yaXplJywKCQkJCWdyYW50OiAnaHR0cHM6Ly9naXRodWIuY29tL2xvZ2luL29hdXRoL2FjY2Vzc190b2tlbicsCgkJCQlyZXNwb25zZV90eXBlOiAnY29kZScKCQkJfSwKCgkJCXNjb3BlOiB7CgkJCQllbWFpbDogJ3VzZXI6ZW1haWwnCgkJCX0sCgoJCQliYXNlOiAnaHR0cHM6Ly9hcGkuZ2l0aHViLmNvbS8nLAoKCQkJZ2V0OiB7CgkJCQltZTogJ3VzZXInLAoJCQkJJ21lL2ZyaWVuZHMnOiAndXNlci9mb2xsb3dpbmc/cGVyX3BhZ2U9QHtsaW1pdHwxMDB9JywKCQkJCSdtZS9mb2xsb3dpbmcnOiAndXNlci9mb2xsb3dpbmc/cGVyX3BhZ2U9QHtsaW1pdHwxMDB9JywKCQkJCSdtZS9mb2xsb3dlcnMnOiAndXNlci9mb2xsb3dlcnM/cGVyX3BhZ2U9QHtsaW1pdHwxMDB9JywKCQkJCSdtZS9saWtlJzogJ3VzZXIvc3RhcnJlZD9wZXJfcGFnZT1Ae2xpbWl0fDEwMH0nCgkJCX0sCgoJCQl3cmFwOiB7CgkJCQltZTogZnVuY3Rpb24obywgaGVhZGVycykgewoKCQkJCQlmb3JtYXRFcnJvcihvLCBoZWFkZXJzKTsKCQkJCQlmb3JtYXRVc2VyKG8pOwoKCQkJCQlyZXR1cm4gbzsKCQkJCX0sCgoJCQkJJ2RlZmF1bHQnOiBmdW5jdGlvbihvLCBoZWFkZXJzLCByZXEpIHsKCgkJCQkJZm9ybWF0RXJyb3IobywgaGVhZGVycyk7CgoJCQkJCWlmIChBcnJheS5pc0FycmF5KG8pKSB7CgkJCQkJCW8gPSB7ZGF0YTpvfTsKCQkJCQl9CgoJCQkJCWlmIChvLmRhdGEpIHsKCQkJCQkJcGFnaW5nKG8sIGhlYWRlcnMsIHJlcSk7CgkJCQkJCW8uZGF0YS5mb3JFYWNoKGZvcm1hdFVzZXIpOwoJCQkJCX0KCgkJCQkJcmV0dXJuIG87CgkJCQl9CgkJCX0sCgoJCQl4aHI6IGZ1bmN0aW9uKHApIHsKCgkJCQlpZiAocC5tZXRob2QgIT09ICdnZXQnICYmIHAuZGF0YSkgewoKCQkJCQkvLyBTZXJpYWxpemUgcGF5bG9hZCBhcyBKU09OCgkJCQkJcC5oZWFkZXJzID0gcC5oZWFkZXJzIHx8IHt9OwoJCQkJCXAuaGVhZGVyc1snQ29udGVudC1UeXBlJ10gPSAnYXBwbGljYXRpb24vanNvbic7CgkJCQkJaWYgKHR5cGVvZiAocC5kYXRhKSA9PT0gJ29iamVjdCcpIHsKCQkJCQkJcC5kYXRhID0gSlNPTi5zdHJpbmdpZnkocC5kYXRhKTsKCQkJCQl9CgkJCQl9CgoJCQkJcmV0dXJuIHRydWU7CgkJCX0KCQl9Cgl9KTsKCglmdW5jdGlvbiBmb3JtYXRFcnJvcihvLCBoZWFkZXJzKSB7CgkJdmFyIGNvZGUgPSBoZWFkZXJzID8gaGVhZGVycy5zdGF0dXNDb2RlIDogKG8gJiYgJ21ldGEnIGluIG8gJiYgJ3N0YXR1cycgaW4gby5tZXRhICYmIG8ubWV0YS5zdGF0dXMpOwoJCWlmICgoY29kZSA9PT0gNDAxIHx8IGNvZGUgPT09IDQwMykpIHsKCQkJby5lcnJvciA9IHsKCQkJCWNvZGU6ICdhY2Nlc3NfZGVuaWVkJywKCQkJCW1lc3NhZ2U6IG8ubWVzc2FnZSB8fCAoby5kYXRhID8gby5kYXRhLm1lc3NhZ2UgOiAnQ291bGQgbm90IGdldCByZXNwb25zZScpCgkJCX07CgkJCWRlbGV0ZSBvLm1lc3NhZ2U7CgkJfQoJfQoKCWZ1bmN0aW9uIGZvcm1hdFVzZXIobykgewoJCWlmIChvLmlkKSB7CgkJCW8udGh1bWJuYWlsID0gby5waWN0dXJlID0gby5hdmF0YXJfdXJsOwoJCQlvLm5hbWUgPSBvLmxvZ2luOwoJCX0KCX0KCglmdW5jdGlvbiBwYWdpbmcocmVzLCBoZWFkZXJzLCByZXEpIHsKCQlpZiAocmVzLmRhdGEgJiYgcmVzLmRhdGEubGVuZ3RoICYmIGhlYWRlcnMgJiYgaGVhZGVycy5MaW5rKSB7CgkJCXZhciBuZXh0ID0gaGVhZGVycy5MaW5rLm1hdGNoKC88KC4qPyk+O1xzKnJlbD1cIm5leHRcIi8pOwoJCQlpZiAobmV4dCkgewoJCQkJcmVzLnBhZ2luZyA9IHsKCQkJCQluZXh0OiBuZXh0WzFdCgkJCQl9OwoJCQl9CgkJfQoJfQoKfSkoaGVsbG8pOwoKKGZ1bmN0aW9uKGhlbGxvKSB7CgoJdmFyIGNvbnRhY3RzVXJsID0gJ2h0dHBzOi8vd3d3Lmdvb2dsZS5jb20vbTgvZmVlZHMvY29udGFjdHMvZGVmYXVsdC9mdWxsP3Y9My4wJmFsdD1qc29uJm1heC1yZXN1bHRzPUB7bGltaXR8MTAwMH0mc3RhcnQtaW5kZXg9QHtzdGFydHwxfSc7CgoJaGVsbG8uaW5pdCh7CgoJCWdvb2dsZTogewoKCQkJbmFtZTogJ0dvb2dsZSBQbHVzJywKCgkJCS8vIFNlZTogaHR0cDovL2NvZGUuZ29vZ2xlLmNvbS9hcGlzL2FjY291bnRzL2RvY3MvT0F1dGgyVXNlckFnZW50Lmh0bWwKCQkJb2F1dGg6IHsKCQkJCXZlcnNpb246IDIsCgkJCQlhdXRoOiAnaHR0cHM6Ly9hY2NvdW50cy5nb29nbGUuY29tL28vb2F1dGgyL2F1dGgnLAoJCQkJZ3JhbnQ6ICdodHRwczovL2FjY291bnRzLmdvb2dsZS5jb20vby9vYXV0aDIvdG9rZW4nCgkJCX0sCgoJCQkvLyBBdXRob3JpemF0aW9uIHNjb3BlcwoJCQlzY29wZTogewoJCQkJYmFzaWM6ICdodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9hdXRoL3BsdXMubWUgcHJvZmlsZScsCgkJCQllbWFpbDogJ2VtYWlsJywKCQkJCWJpcnRoZGF5OiAnJywKCQkJCWV2ZW50czogJycsCgkJCQlwaG90b3M6ICdodHRwczovL3BpY2FzYXdlYi5nb29nbGUuY29tL2RhdGEvJywKCQkJCXZpZGVvczogJ2h0dHA6Ly9nZGF0YS55b3V0dWJlLmNvbScsCgkJCQlmcmllbmRzOiAnaHR0cHM6Ly93d3cuZ29vZ2xlLmNvbS9tOC9mZWVkcywgaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vYXV0aC9wbHVzLmxvZ2luJywKCQkJCWZpbGVzOiAnaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vYXV0aC9kcml2ZS5yZWFkb25seScsCgkJCQlwdWJsaXNoOiAnJywKCQkJCXB1Ymxpc2hfZmlsZXM6ICdodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9hdXRoL2RyaXZlJywKCQkJCWNyZWF0ZV9ldmVudDogJycsCgkJCQlvZmZsaW5lX2FjY2VzczogJycKCQkJfSwKCgkJCXNjb3BlX2RlbGltOiAnICcsCgoJCQlsb2dpbjogZnVuY3Rpb24ocCkgewoJCQkJaWYgKHAucXMuZGlzcGxheSA9PT0gJ25vbmUnKSB7CgkJCQkJLy8gR29vZ2xlIGRvZXNuJ3QgbGlrZSBkaXNwbGF5PW5vbmUKCQkJCQlwLnFzLmRpc3BsYXkgPSAnJzsKCQkJCX0KCgkJCQlpZiAocC5xcy5yZXNwb25zZV90eXBlID09PSAnY29kZScpIHsKCgkJCQkJLy8gTGV0J3Mgc2V0IHRoaXMgdG8gYW4gb2ZmbGluZSBhY2Nlc3MgdG8gcmV0dXJuIGEgcmVmcmVzaF90b2tlbgoJCQkJCXAucXMuYWNjZXNzX3R5cGUgPSAnb2ZmbGluZSc7CgkJCQl9CgoJCQkJLy8gUmVhdXRoZW50aWNhdGUKCQkJCS8vIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2lkZW50aXR5L3Byb3RvY29scy8KCQkJCWlmIChwLm9wdGlvbnMuZm9yY2UpIHsKCQkJCQlwLnFzLmFwcHJvdmFsX3Byb21wdCA9ICdmb3JjZSc7CgkJCQl9CgkJCX0sCgoJCQkvLyBBUEkgYmFzZSBVUkkKCQkJYmFzZTogJ2h0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tLycsCgoJCQkvLyBNYXAgR0VUIHJlcXVlc3RzCgkJCWdldDogewoJCQkJbWU6ICdwbHVzL3YxL3Blb3BsZS9tZScsCgoJCQkJLy8gRGVwcmVjYXRlZCBTZXB0IDEsIDIwMTQKCQkJCS8vJ21lJzogJ29hdXRoMi92MS91c2VyaW5mbz9hbHQ9anNvbicsCgoJCQkJLy8gU2VlOiBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS8rL2FwaS9sYXRlc3QvcGVvcGxlL2xpc3QKCQkJCSdtZS9mcmllbmRzJzogJ3BsdXMvdjEvcGVvcGxlL21lL3Blb3BsZS92aXNpYmxlP21heFJlc3VsdHM9QHtsaW1pdHwxMDB9JywKCQkJCSdtZS9mb2xsb3dpbmcnOiBjb250YWN0c1VybCwKCQkJCSdtZS9mb2xsb3dlcnMnOiBjb250YWN0c1VybCwKCQkJCSdtZS9jb250YWN0cyc6IGNvbnRhY3RzVXJsLAoJCQkJJ21lL3NoYXJlJzogJ3BsdXMvdjEvcGVvcGxlL21lL2FjdGl2aXRpZXMvcHVibGljP21heFJlc3VsdHM9QHtsaW1pdHwxMDB9JywKCQkJCSdtZS9mZWVkJzogJ3BsdXMvdjEvcGVvcGxlL21lL2FjdGl2aXRpZXMvcHVibGljP21heFJlc3VsdHM9QHtsaW1pdHwxMDB9JywKCQkJCSdtZS9hbGJ1bXMnOiAnaHR0cHM6Ly9waWNhc2F3ZWIuZ29vZ2xlLmNvbS9kYXRhL2ZlZWQvYXBpL3VzZXIvZGVmYXVsdD9hbHQ9anNvbiZtYXgtcmVzdWx0cz1Ae2xpbWl0fDEwMH0mc3RhcnQtaW5kZXg9QHtzdGFydHwxfScsCgkJCQknbWUvYWxidW0nOiBmdW5jdGlvbihwLCBjYWxsYmFjaykgewoJCQkJCXZhciBrZXkgPSBwLnF1ZXJ5LmlkOwoJCQkJCWRlbGV0ZSBwLnF1ZXJ5LmlkOwoJCQkJCWNhbGxiYWNrKGtleS5yZXBsYWNlKCcvZW50cnkvJywgJy9mZWVkLycpKTsKCQkJCX0sCgoJCQkJJ21lL3Bob3Rvcyc6ICdodHRwczovL3BpY2FzYXdlYi5nb29nbGUuY29tL2RhdGEvZmVlZC9hcGkvdXNlci9kZWZhdWx0P2FsdD1qc29uJmtpbmQ9cGhvdG8mbWF4LXJlc3VsdHM9QHtsaW1pdHwxMDB9JnN0YXJ0LWluZGV4PUB7c3RhcnR8MX0nLAoKCQkJCS8vIFNlZTogaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vZHJpdmUvdjIvcmVmZXJlbmNlL2ZpbGVzL2xpc3QKCQkJCSdtZS9maWxlJzogJ2RyaXZlL3YyL2ZpbGVzL0B7aWR9JywKCQkJCSdtZS9maWxlcyc6ICdkcml2ZS92Mi9maWxlcz9xPSUyMkB7cGFyZW50fHJvb3R9JTIyK2luK3BhcmVudHMrYW5kK3RyYXNoZWQ9ZmFsc2UmbWF4UmVzdWx0cz1Ae2xpbWl0fDEwMH0nLAoKCQkJCS8vIFNlZTogaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vZHJpdmUvdjIvcmVmZXJlbmNlL2ZpbGVzL2xpc3QKCQkJCSdtZS9mb2xkZXJzJzogJ2RyaXZlL3YyL2ZpbGVzP3E9JTIyQHtpZHxyb290fSUyMitpbitwYXJlbnRzK2FuZCttaW1lVHlwZSs9KyUyMmFwcGxpY2F0aW9uL3ZuZC5nb29nbGUtYXBwcy5mb2xkZXIlMjIrYW5kK3RyYXNoZWQ9ZmFsc2UmbWF4UmVzdWx0cz1Ae2xpbWl0fDEwMH0nLAoKCQkJCS8vIFNlZTogaHR0cHM6Ly9kZXZlbG9wZXJzLmdvb2dsZS5jb20vZHJpdmUvdjIvcmVmZXJlbmNlL2ZpbGVzL2xpc3QKCQkJCSdtZS9mb2xkZXInOiAnZHJpdmUvdjIvZmlsZXM/cT0lMjJAe2lkfHJvb3R9JTIyK2luK3BhcmVudHMrYW5kK3RyYXNoZWQ9ZmFsc2UmbWF4UmVzdWx0cz1Ae2xpbWl0fDEwMH0nCgkJCX0sCgoJCQkvLyBNYXAgUE9TVCByZXF1ZXN0cwoJCQlwb3N0OiB7CgoJCQkJLy8gR29vZ2xlIERyaXZlCgkJCQknbWUvZmlsZXMnOiB1cGxvYWREcml2ZSwKCQkJCSdtZS9mb2xkZXJzJzogZnVuY3Rpb24ocCwgY2FsbGJhY2spIHsKCQkJCQlwLmRhdGEgPSB7CgkJCQkJCXRpdGxlOiBwLmRhdGEubmFtZSwKCQkJCQkJcGFyZW50czogW3tpZDogcC5kYXRhLnBhcmVudCB8fCAncm9vdCd9XSwKCQkJCQkJbWltZVR5cGU6ICdhcHBsaWNhdGlvbi92bmQuZ29vZ2xlLWFwcHMuZm9sZGVyJwoJCQkJCX07CgkJCQkJY2FsbGJhY2soJ2RyaXZlL3YyL2ZpbGVzJyk7CgkJCQl9CgkJCX0sCgoJCQkvLyBNYXAgUFVUIHJlcXVlc3RzCgkJCXB1dDogewoJCQkJJ21lL2ZpbGVzJzogdXBsb2FkRHJpdmUKCQkJfSwKCgkJCS8vIE1hcCBERUxFVEUgcmVxdWVzdHMKCQkJZGVsOiB7CgkJCQknbWUvZmlsZXMnOiAnZHJpdmUvdjIvZmlsZXMvQHtpZH0nLAoJCQkJJ21lL2ZvbGRlcic6ICdkcml2ZS92Mi9maWxlcy9Ae2lkfScKCQkJfSwKCgkJCS8vIE1hcCBQQVRDSCByZXF1ZXN0cwoJCQlwYXRjaDogewoJCQkJJ21lL2ZpbGUnOiAnZHJpdmUvdjIvZmlsZXMvQHtpZH0nCgkJCX0sCgoJCQl3cmFwOiB7CgkJCQltZTogZnVuY3Rpb24obykgewoJCQkJCWlmIChvLmlkKSB7CgkJCQkJCW8ubGFzdF9uYW1lID0gby5mYW1pbHlfbmFtZSB8fCAoby5uYW1lID8gby5uYW1lLmZhbWlseU5hbWUgOiBudWxsKTsKCQkJCQkJby5maXJzdF9uYW1lID0gby5naXZlbl9uYW1lIHx8IChvLm5hbWUgPyBvLm5hbWUuZ2l2ZW5OYW1lIDogbnVsbCk7CgoJCQkJCQlpZiAoby5lbWFpbHMgJiYgby5lbWFpbHMubGVuZ3RoKSB7CgkJCQkJCQlvLmVtYWlsID0gby5lbWFpbHNbMF0udmFsdWU7CgkJCQkJCX0KCgkJCQkJCWZvcm1hdFBlcnNvbihvKTsKCQkJCQl9CgoJCQkJCXJldHVybiBvOwoJCQkJfSwKCgkJCQknbWUvZnJpZW5kcyc6IGZ1bmN0aW9uKG8pIHsKCQkJCQlpZiAoby5pdGVtcykgewoJCQkJCQlwYWdpbmcobyk7CgkJCQkJCW8uZGF0YSA9IG8uaXRlbXM7CgkJCQkJCW8uZGF0YS5mb3JFYWNoKGZvcm1hdFBlcnNvbik7CgkJCQkJCWRlbGV0ZSBvLml0ZW1zOwoJCQkJCX0KCgkJCQkJcmV0dXJuIG87CgkJCQl9LAoKCQkJCSdtZS9jb250YWN0cyc6IGZvcm1hdEZyaWVuZHMsCgkJCQknbWUvZm9sbG93ZXJzJzogZm9ybWF0RnJpZW5kcywKCQkJCSdtZS9mb2xsb3dpbmcnOiBmb3JtYXRGcmllbmRzLAoJCQkJJ21lL3NoYXJlJzogZm9ybWF0RmVlZCwKCQkJCSdtZS9mZWVkJzogZm9ybWF0RmVlZCwKCQkJCSdtZS9hbGJ1bXMnOiBnRW50cnksCgkJCQknbWUvcGhvdG9zJzogZm9ybWF0UGhvdG9zLAoJCQkJJ2RlZmF1bHQnOiBnRW50cnkKCQkJfSwKCgkJCXhocjogZnVuY3Rpb24ocCkgewoKCQkJCWlmIChwLm1ldGhvZCA9PT0gJ3Bvc3QnIHx8IHAubWV0aG9kID09PSAncHV0JykgewoJCQkJCXRvSlNPTihwKTsKCQkJCX0KCQkJCWVsc2UgaWYgKHAubWV0aG9kID09PSAncGF0Y2gnKSB7CgkJCQkJaGVsbG8udXRpbHMuZXh0ZW5kKHAucXVlcnksIHAuZGF0YSk7CgkJCQkJcC5kYXRhID0gbnVsbDsKCQkJCX0KCgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfSwKCgkJCS8vIERvbid0IGV2ZW4gdHJ5IHN1Ym1pdHRpbmcgdmlhIGZvcm0uCgkJCS8vIFRoaXMgbWVhbnMgbm8gUE9TVCBvcGVyYXRpb25zIGluIDw9SUU5CgkJCWZvcm06IGZhbHNlCgkJfQoJfSk7CgoJZnVuY3Rpb24gdG9JbnQocykgewoJCXJldHVybiBwYXJzZUludChzLCAxMCk7Cgl9CgoJZnVuY3Rpb24gZm9ybWF0RmVlZChvKSB7CgkJcGFnaW5nKG8pOwoJCW8uZGF0YSA9IG8uaXRlbXM7CgkJZGVsZXRlIG8uaXRlbXM7CgkJcmV0dXJuIG87Cgl9CgoJLy8gRm9ybWF0OiBlbnN1cmUgZWFjaCByZWNvcmQgY29udGFpbnMgYSBuYW1lLCBpZCBldGMuCglmdW5jdGlvbiBmb3JtYXRJdGVtKG8pIHsKCQlpZiAoby5lcnJvcikgewoJCQlyZXR1cm47CgkJfQoKCQlpZiAoIW8ubmFtZSkgewoJCQlvLm5hbWUgPSBvLnRpdGxlIHx8IG8ubWVzc2FnZTsKCQl9CgoJCWlmICghby5waWN0dXJlKSB7CgkJCW8ucGljdHVyZSA9IG8udGh1bWJuYWlsTGluazsKCQl9CgoJCWlmICghby50aHVtYm5haWwpIHsKCQkJby50aHVtYm5haWwgPSBvLnRodW1ibmFpbExpbms7CgkJfQoKCQlpZiAoby5taW1lVHlwZSA9PT0gJ2FwcGxpY2F0aW9uL3ZuZC5nb29nbGUtYXBwcy5mb2xkZXInKSB7CgkJCW8udHlwZSA9ICdmb2xkZXInOwoJCQlvLmZpbGVzID0gJ2h0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL2RyaXZlL3YyL2ZpbGVzP3E9JTIyJyArIG8uaWQgKyAnJTIyK2luK3BhcmVudHMnOwoJCX0KCgkJcmV0dXJuIG87Cgl9CgoJZnVuY3Rpb24gZm9ybWF0SW1hZ2UoaW1hZ2UpIHsKCQlyZXR1cm4gewoJCQlzb3VyY2U6IGltYWdlLnVybCwKCQkJd2lkdGg6IGltYWdlLndpZHRoLAoJCQloZWlnaHQ6IGltYWdlLmhlaWdodAoJCX07Cgl9CgoJZnVuY3Rpb24gZm9ybWF0UGhvdG9zKG8pIHsKCQlvLmRhdGEgPSBvLmZlZWQuZW50cnkubWFwKGZvcm1hdEVudHJ5KTsKCQlkZWxldGUgby5mZWVkOwoJfQoKCS8vIEdvb2dsZSBoYXMgYSBob3JyaWJsZSBKU09OIEFQSQoJZnVuY3Rpb24gZ0VudHJ5KG8pIHsKCQlwYWdpbmcobyk7CgoJCWlmICgnZmVlZCcgaW4gbyAmJiAnZW50cnknIGluIG8uZmVlZCkgewoJCQlvLmRhdGEgPSBvLmZlZWQuZW50cnkubWFwKGZvcm1hdEVudHJ5KTsKCQkJZGVsZXRlIG8uZmVlZDsKCQl9CgoJCS8vIE9sZCBzdHlsZTogUGljYXNhLCBldGMuCgkJZWxzZSBpZiAoJ2VudHJ5JyBpbiBvKSB7CgkJCXJldHVybiBmb3JtYXRFbnRyeShvLmVudHJ5KTsKCQl9CgoJCS8vIE5ldyBzdHlsZTogR29vZ2xlIERyaXZlICYgUGx1cwoJCWVsc2UgaWYgKCdpdGVtcycgaW4gbykgewoJCQlvLmRhdGEgPSBvLml0ZW1zLm1hcChmb3JtYXRJdGVtKTsKCQkJZGVsZXRlIG8uaXRlbXM7CgkJfQoJCWVsc2UgewoJCQlmb3JtYXRJdGVtKG8pOwoJCX0KCgkJcmV0dXJuIG87Cgl9CgoJZnVuY3Rpb24gZm9ybWF0UGVyc29uKG8pIHsKCQlvLm5hbWUgPSBvLmRpc3BsYXlOYW1lIHx8IG8ubmFtZTsKCQlvLnBpY3R1cmUgPSBvLnBpY3R1cmUgfHwgKG8uaW1hZ2UgPyBvLmltYWdlLnVybCA6IG51bGwpOwoJCW8udGh1bWJuYWlsID0gby5waWN0dXJlOwoJfQoKCWZ1bmN0aW9uIGZvcm1hdEZyaWVuZHMobywgaGVhZGVycywgcmVxKSB7CgkJcGFnaW5nKG8pOwoJCXZhciByID0gW107CgkJaWYgKCdmZWVkJyBpbiBvICYmICdlbnRyeScgaW4gby5mZWVkKSB7CgkJCXZhciB0b2tlbiA9IHJlcS5xdWVyeS5hY2Nlc3NfdG9rZW47CgkJCWZvciAodmFyIGkgPSAwOyBpIDwgby5mZWVkLmVudHJ5Lmxlbmd0aDsgaSsrKSB7CgkJCQl2YXIgYSA9IG8uZmVlZC5lbnRyeVtpXTsKCgkJCQlhLmlkCT0gYS5pZC4kdDsKCQkJCWEubmFtZQk9IGEudGl0bGUuJHQ7CgkJCQlkZWxldGUgYS50aXRsZTsKCQkJCWlmIChhLmdkJGVtYWlsKSB7CgkJCQkJYS5lbWFpbAk9IChhLmdkJGVtYWlsICYmIGEuZ2QkZW1haWwubGVuZ3RoID4gMCkgPyBhLmdkJGVtYWlsWzBdLmFkZHJlc3MgOiBudWxsOwoJCQkJCWEuZW1haWxzID0gYS5nZCRlbWFpbDsKCQkJCQlkZWxldGUgYS5nZCRlbWFpbDsKCQkJCX0KCgkJCQlpZiAoYS51cGRhdGVkKSB7CgkJCQkJYS51cGRhdGVkID0gYS51cGRhdGVkLiR0OwoJCQkJfQoKCQkJCWlmIChhLmxpbmspIHsKCgkJCQkJdmFyIHBpYyA9IChhLmxpbmsubGVuZ3RoID4gMCkgPyBhLmxpbmtbMF0uaHJlZiA6IG51bGw7CgkJCQkJaWYgKHBpYyAmJiBhLmxpbmtbMF0uZ2QkZXRhZykgewoJCQkJCQlwaWMgKz0gKHBpYy5pbmRleE9mKCc/JykgPiAtMSA/ICcmJyA6ICc/JykgKyAnYWNjZXNzX3Rva2VuPScgKyB0b2tlbjsKCQkJCQkJYS5waWN0dXJlID0gcGljOwoJCQkJCQlhLnRodW1ibmFpbCA9IHBpYzsKCQkJCQl9CgoJCQkJCWRlbGV0ZSBhLmxpbms7CgkJCQl9CgoJCQkJaWYgKGEuY2F0ZWdvcnkpIHsKCQkJCQlkZWxldGUgYS5jYXRlZ29yeTsKCQkJCX0KCQkJfQoKCQkJby5kYXRhID0gby5mZWVkLmVudHJ5OwoJCQlkZWxldGUgby5mZWVkOwoJCX0KCgkJcmV0dXJuIG87Cgl9CgoJZnVuY3Rpb24gZm9ybWF0RW50cnkoYSkgewoKCQl2YXIgZ3JvdXAgPSBhLm1lZGlhJGdyb3VwOwoJCXZhciBwaG90byA9IGdyb3VwLm1lZGlhJGNvbnRlbnQubGVuZ3RoID8gZ3JvdXAubWVkaWEkY29udGVudFswXSA6IHt9OwoJCXZhciBtZWRpYUNvbnRlbnQgPSBncm91cC5tZWRpYSRjb250ZW50IHx8IFtdOwoJCXZhciBtZWRpYVRodW1ibmFpbCA9IGdyb3VwLm1lZGlhJHRodW1ibmFpbCB8fCBbXTsKCgkJdmFyIHBpY3R1cmVzID0gbWVkaWFDb250ZW50CgkJCS5jb25jYXQobWVkaWFUaHVtYm5haWwpCgkJCS5tYXAoZm9ybWF0SW1hZ2UpCgkJCS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKCQkJCXJldHVybiBhLndpZHRoIC0gYi53aWR0aDsKCQkJfSk7CgoJCXZhciBpID0gMDsKCQl2YXIgX2E7CgkJdmFyIHAgPSB7CgkJCWlkOiBhLmlkLiR0LAoJCQluYW1lOiBhLnRpdGxlLiR0LAoJCQlkZXNjcmlwdGlvbjogYS5zdW1tYXJ5LiR0LAoJCQl1cGRhdGVkX3RpbWU6IGEudXBkYXRlZC4kdCwKCQkJY3JlYXRlZF90aW1lOiBhLnB1Ymxpc2hlZC4kdCwKCQkJcGljdHVyZTogcGhvdG8gPyBwaG90by51cmwgOiBudWxsLAoJCQlwaWN0dXJlczogcGljdHVyZXMsCgkJCWltYWdlczogW10sCgkJCXRodW1ibmFpbDogcGhvdG8gPyBwaG90by51cmwgOiBudWxsLAoJCQl3aWR0aDogcGhvdG8ud2lkdGgsCgkJCWhlaWdodDogcGhvdG8uaGVpZ2h0CgkJfTsKCgkJLy8gR2V0IGZlZWQvY2hpbGRyZW4KCQlpZiAoJ2xpbmsnIGluIGEpIHsKCQkJZm9yIChpID0gMDsgaSA8IGEubGluay5sZW5ndGg7IGkrKykgewoJCQkJdmFyIGQgPSBhLmxpbmtbaV07CgkJCQlpZiAoZC5yZWwubWF0Y2goL1wjZmVlZCQvKSkgewoJCQkJCXAudXBsb2FkX2xvY2F0aW9uID0gcC5maWxlcyA9IHAucGhvdG9zID0gZC5ocmVmOwoJCQkJCWJyZWFrOwoJCQkJfQoJCQl9CgkJfQoKCQkvLyBHZXQgaW1hZ2VzIG9mIGRpZmZlcmVudCBzY2FsZXMKCQlpZiAoJ2NhdGVnb3J5JyBpbiBhICYmIGEuY2F0ZWdvcnkubGVuZ3RoKSB7CgkJCV9hID0gYS5jYXRlZ29yeTsKCQkJZm9yIChpID0gMDsgaSA8IF9hLmxlbmd0aDsgaSsrKSB7CgkJCQlpZiAoX2FbaV0uc2NoZW1lICYmIF9hW2ldLnNjaGVtZS5tYXRjaCgvXCNraW5kJC8pKSB7CgkJCQkJcC50eXBlID0gX2FbaV0udGVybS5yZXBsYWNlKC9eLio/XCMvLCAnJyk7CgkJCQl9CgkJCX0KCQl9CgoJCS8vIEdldCBpbWFnZXMgb2YgZGlmZmVyZW50IHNjYWxlcwoJCWlmICgnbWVkaWEkdGh1bWJuYWlsJyBpbiBncm91cCAmJiBncm91cC5tZWRpYSR0aHVtYm5haWwubGVuZ3RoKSB7CgkJCV9hID0gZ3JvdXAubWVkaWEkdGh1bWJuYWlsOwoJCQlwLnRodW1ibmFpbCA9IF9hWzBdLnVybDsKCQkJcC5pbWFnZXMgPSBfYS5tYXAoZm9ybWF0SW1hZ2UpOwoJCX0KCgkJX2EgPSBncm91cC5tZWRpYSRjb250ZW50OwoKCQlpZiAoX2EgJiYgX2EubGVuZ3RoKSB7CgkJCXAuaW1hZ2VzLnB1c2goZm9ybWF0SW1hZ2UoX2FbMF0pKTsKCQl9CgoJCXJldHVybiBwOwoJfQoKCWZ1bmN0aW9uIHBhZ2luZyhyZXMpIHsKCgkJLy8gQ29udGFjdHMgVjIKCQlpZiAoJ2ZlZWQnIGluIHJlcyAmJiByZXMuZmVlZC5vcGVuU2VhcmNoJGl0ZW1zUGVyUGFnZSkgewoJCQl2YXIgbGltaXQgPSB0b0ludChyZXMuZmVlZC5vcGVuU2VhcmNoJGl0ZW1zUGVyUGFnZS4kdCk7CgkJCXZhciBzdGFydCA9IHRvSW50KHJlcy5mZWVkLm9wZW5TZWFyY2gkc3RhcnRJbmRleC4kdCk7CgkJCXZhciB0b3RhbCA9IHRvSW50KHJlcy5mZWVkLm9wZW5TZWFyY2gkdG90YWxSZXN1bHRzLiR0KTsKCgkJCWlmICgoc3RhcnQgKyBsaW1pdCkgPCB0b3RhbCkgewoJCQkJcmVzLnBhZ2luZyA9IHsKCQkJCQluZXh0OiAnP3N0YXJ0PScgKyAoc3RhcnQgKyBsaW1pdCkKCQkJCX07CgkJCX0KCQl9CgkJZWxzZSBpZiAoJ25leHRQYWdlVG9rZW4nIGluIHJlcykgewoJCQlyZXMucGFnaW5nID0gewoJCQkJbmV4dDogJz9wYWdlVG9rZW49JyArIHJlcy5uZXh0UGFnZVRva2VuCgkJCX07CgkJfQoJfQoKCS8vIENvbnN0cnVjdCBhIG11bHRpcGFydCBtZXNzYWdlCglmdW5jdGlvbiBNdWx0aXBhcnQoKSB7CgoJCS8vIEludGVybmFsIGJvZHkKCQl2YXIgYm9keSA9IFtdOwoJCXZhciBib3VuZGFyeSA9IChNYXRoLnJhbmRvbSgpICogMWUxMCkudG9TdHJpbmcoMzIpOwoJCXZhciBjb3VudGVyID0gMDsKCQl2YXIgbGluZUJyZWFrID0gJ1xyXG4nOwoJCXZhciBkZWxpbSA9IGxpbmVCcmVhayArICctLScgKyBib3VuZGFyeTsKCQl2YXIgcmVhZHkgPSBmdW5jdGlvbigpIHt9OwoKCQl2YXIgZGF0YVVyaSA9IC9eZGF0YVw6KFteOyxdKyhcO2NoYXJzZXQ9W147LF0rKT8pKFw7YmFzZTY0KT8sL2k7CgoJCS8vIEFkZCBmaWxlCgkJZnVuY3Rpb24gYWRkRmlsZShpdGVtKSB7CgkJCXZhciBmciA9IG5ldyBGaWxlUmVhZGVyKCk7CgkJCWZyLm9ubG9hZCA9IGZ1bmN0aW9uKGUpIHsKCQkJCWFkZENvbnRlbnQoYnRvYShlLnRhcmdldC5yZXN1bHQpLCBpdGVtLnR5cGUgKyBsaW5lQnJlYWsgKyAnQ29udGVudC1UcmFuc2Zlci1FbmNvZGluZzogYmFzZTY0Jyk7CgkJCX07CgoJCQlmci5yZWFkQXNCaW5hcnlTdHJpbmcoaXRlbSk7CgkJfQoKCQkvLyBBZGQgY29udGVudAoJCWZ1bmN0aW9uIGFkZENvbnRlbnQoY29udGVudCwgdHlwZSkgewoJCQlib2R5LnB1c2gobGluZUJyZWFrICsgJ0NvbnRlbnQtVHlwZTogJyArIHR5cGUgKyBsaW5lQnJlYWsgKyBsaW5lQnJlYWsgKyBjb250ZW50KTsKCQkJY291bnRlci0tOwoJCQlyZWFkeSgpOwoJCX0KCgkJLy8gQWRkIG5ldyB0aGluZ3MgdG8gdGhlIG9iamVjdAoJCXRoaXMuYXBwZW5kID0gZnVuY3Rpb24oY29udGVudCwgdHlwZSkgewoKCQkJLy8gRG9lcyB0aGUgY29udGVudCBoYXZlIGFuIGFycmF5CgkJCWlmICh0eXBlb2YgKGNvbnRlbnQpID09PSAnc3RyaW5nJyB8fCAhKCdsZW5ndGgnIGluIE9iamVjdChjb250ZW50KSkpIHsKCQkJCS8vIENvbnZlcnRpIHRvIG11bHRpcGxlcwoJCQkJY29udGVudCA9IFtjb250ZW50XTsKCQkJfQoKCQkJZm9yICh2YXIgaSA9IDA7IGkgPCBjb250ZW50Lmxlbmd0aDsgaSsrKSB7CgoJCQkJY291bnRlcisrOwoKCQkJCXZhciBpdGVtID0gY29udGVudFtpXTsKCgkJCQkvLyBJcyB0aGlzIGEgZmlsZT8KCQkJCS8vIEZpbGVzIGNhbiBiZSBlaXRoZXIgQmxvYnMgb3IgRmlsZSB0eXBlcwoJCQkJaWYgKAoJCQkJCSh0eXBlb2YgKEZpbGUpICE9PSAndW5kZWZpbmVkJyAmJiBpdGVtIGluc3RhbmNlb2YgRmlsZSkgfHwKCQkJCQkodHlwZW9mIChCbG9iKSAhPT0gJ3VuZGVmaW5lZCcgJiYgaXRlbSBpbnN0YW5jZW9mIEJsb2IpCgkJCQkpIHsKCQkJCQkvLyBSZWFkIHRoZSBmaWxlIGluCgkJCQkJYWRkRmlsZShpdGVtKTsKCQkJCX0KCgkJCQkvLyBEYXRhLVVSST8KCQkJCS8vIERhdGE6WzxtaW1lIHR5cGU+XVs7Y2hhcnNldD08Y2hhcnNldD5dWztiYXNlNjRdLDxlbmNvZGVkIGRhdGE+CgkJCQkvLyAvXmRhdGFcOihbXjssXSsoXDtjaGFyc2V0PVteOyxdKyk/KShcO2Jhc2U2NCk/LC9pCgkJCQllbHNlIGlmICh0eXBlb2YgKGl0ZW0pID09PSAnc3RyaW5nJyAmJiBpdGVtLm1hdGNoKGRhdGFVcmkpKSB7CgkJCQkJdmFyIG0gPSBpdGVtLm1hdGNoKGRhdGFVcmkpOwoJCQkJCWFkZENvbnRlbnQoaXRlbS5yZXBsYWNlKGRhdGFVcmksICcnKSwgbVsxXSArIGxpbmVCcmVhayArICdDb250ZW50LVRyYW5zZmVyLUVuY29kaW5nOiBiYXNlNjQnKTsKCQkJCX0KCgkJCQkvLyBSZWd1bGFyIHN0cmluZwoJCQkJZWxzZSB7CgkJCQkJYWRkQ29udGVudChpdGVtLCB0eXBlKTsKCQkJCX0KCQkJfQoJCX07CgoJCXRoaXMub25yZWFkeSA9IGZ1bmN0aW9uKGZuKSB7CgkJCXJlYWR5ID0gZnVuY3Rpb24oKSB7CgkJCQlpZiAoY291bnRlciA9PT0gMCkgewoJCQkJCS8vIFRyaWdnZXIgcmVhZHkKCQkJCQlib2R5LnVuc2hpZnQoJycpOwoJCQkJCWJvZHkucHVzaCgnLS0nKTsKCQkJCQlmbihib2R5LmpvaW4oZGVsaW0pLCBib3VuZGFyeSk7CgkJCQkJYm9keSA9IFtdOwoJCQkJfQoJCQl9OwoKCQkJcmVhZHkoKTsKCQl9OwoJfQoKCS8vIFVwbG9hZCB0byBEcml2ZQoJLy8gSWYgdGhpcyBpcyBQVVQgdGhlbiBvbmx5IGF1Z21lbnQgdGhlIGZpbGUgdXBsb2FkZWQKCS8vIFBVVCBodHRwczovL2RldmVsb3BlcnMuZ29vZ2xlLmNvbS9kcml2ZS92Mi9yZWZlcmVuY2UvZmlsZXMvdXBkYXRlCgkvLyBQT1NUIGh0dHBzOi8vZGV2ZWxvcGVycy5nb29nbGUuY29tL2RyaXZlL21hbmFnZS11cGxvYWRzCglmdW5jdGlvbiB1cGxvYWREcml2ZShwLCBjYWxsYmFjaykgewoKCQl2YXIgZGF0YSA9IHt9OwoKCQkvLyBUZXN0IGZvciBET00gZWxlbWVudAoJCWlmIChwLmRhdGEgJiYKCQkJKHR5cGVvZiAoSFRNTElucHV0RWxlbWVudCkgIT09ICd1bmRlZmluZWQnICYmIHAuZGF0YSBpbnN0YW5jZW9mIEhUTUxJbnB1dEVsZW1lbnQpCgkJKSB7CgkJCXAuZGF0YSA9IHtmaWxlOiBwLmRhdGF9OwoJCX0KCgkJaWYgKCFwLmRhdGEubmFtZSAmJiBPYmplY3QoT2JqZWN0KHAuZGF0YS5maWxlKS5maWxlcykubGVuZ3RoICYmIHAubWV0aG9kID09PSAncG9zdCcpIHsKCQkJcC5kYXRhLm5hbWUgPSBwLmRhdGEuZmlsZS5maWxlc1swXS5uYW1lOwoJCX0KCgkJaWYgKHAubWV0aG9kID09PSAncG9zdCcpIHsKCQkJcC5kYXRhID0gewoJCQkJdGl0bGU6IHAuZGF0YS5uYW1lLAoJCQkJcGFyZW50czogW3tpZDogcC5kYXRhLnBhcmVudCB8fCAncm9vdCd9XSwKCQkJCWZpbGU6IHAuZGF0YS5maWxlCgkJCX07CgkJfQoJCWVsc2UgewoKCQkJLy8gTWFrZSBhIHJlZmVyZW5jZQoJCQlkYXRhID0gcC5kYXRhOwoJCQlwLmRhdGEgPSB7fTsKCgkJCS8vIEFkZCB0aGUgcGFydHMgdG8gY2hhbmdlIGFzIHJlcXVpcmVkCgkJCWlmIChkYXRhLnBhcmVudCkgewoJCQkJcC5kYXRhLnBhcmVudHMgPSBbe2lkOiBwLmRhdGEucGFyZW50IHx8ICdyb290J31dOwoJCQl9CgoJCQlpZiAoZGF0YS5maWxlKSB7CgkJCQlwLmRhdGEuZmlsZSA9IGRhdGEuZmlsZTsKCQkJfQoKCQkJaWYgKGRhdGEubmFtZSkgewoJCQkJcC5kYXRhLnRpdGxlID0gZGF0YS5uYW1lOwoJCQl9CgkJfQoKCQkvLyBFeHRyYWN0IHRoZSBmaWxlLCBpZiBpdCBleGlzdHMgZnJvbSB0aGUgZGF0YSBvYmplY3QKCQkvLyBJZiB0aGUgRmlsZSBpcyBhbiBJTlBVVCBlbGVtZW50IGxldHMganVzdCBjb25jZXJuIG91cnNlbHZlcyB3aXRoIHRoZSBOb2RlTGlzdAoJCXZhciBmaWxlOwoJCWlmICgnZmlsZScgaW4gcC5kYXRhKSB7CgkJCWZpbGUgPSBwLmRhdGEuZmlsZTsKCQkJZGVsZXRlIHAuZGF0YS5maWxlOwoKCQkJaWYgKHR5cGVvZiAoZmlsZSkgPT09ICdvYmplY3QnICYmICdmaWxlcycgaW4gZmlsZSkgewoJCQkJLy8gQXNzaWduIHRoZSBOb2RlTGlzdAoJCQkJZmlsZSA9IGZpbGUuZmlsZXM7CgkJCX0KCgkJCWlmICghZmlsZSB8fCAhZmlsZS5sZW5ndGgpIHsKCQkJCWNhbGxiYWNrKHsKCQkJCQllcnJvcjogewoJCQkJCQljb2RlOiAncmVxdWVzdF9pbnZhbGlkJywKCQkJCQkJbWVzc2FnZTogJ1RoZXJlIHdlcmUgbm8gZmlsZXMgYXR0YWNoZWQgd2l0aCB0aGlzIHJlcXVlc3QgdG8gdXBsb2FkJwoJCQkJCX0KCQkJCX0pOwoJCQkJcmV0dXJuOwoJCQl9CgkJfQoKCQkvLyBTZXQgdHlwZSBwLmRhdGEubWltZVR5cGUgPSBPYmplY3QoZmlsZVswXSkudHlwZSB8fCAnYXBwbGljYXRpb24vb2N0ZXQtc3RyZWFtJzsKCgkJLy8gQ29uc3RydWN0IGEgbXVsdGlwYXJ0IG1lc3NhZ2UKCQl2YXIgcGFydHMgPSBuZXcgTXVsdGlwYXJ0KCk7CgkJcGFydHMuYXBwZW5kKEpTT04uc3RyaW5naWZ5KHAuZGF0YSksICdhcHBsaWNhdGlvbi9qc29uJyk7CgoJCS8vIFJlYWQgdGhlIGZpbGUgaW50byBhICBiYXNlNjQgc3RyaW5nLi4uIHllcCBhIGhhc3NsZSwgaSBrbm93CgkJLy8gRm9ybURhdGEgZG9lc24ndCBsZXQgdXMgYXNzaWduIG91ciBvd24gTXVsdGlwYXJ0IGhlYWRlcnMgYW5kIEhUVFAgQ29udGVudC1UeXBlCgkJLy8gQWxhcyBHb29nbGVBcGkgbmVlZCB0aGVzZSBpbiBhIHBhcnRpY3VsYXIgZm9ybWF0CgkJaWYgKGZpbGUpIHsKCQkJcGFydHMuYXBwZW5kKGZpbGUpOwoJCX0KCgkJcGFydHMub25yZWFkeShmdW5jdGlvbihib2R5LCBib3VuZGFyeSkgewoKCQkJcC5oZWFkZXJzWydjb250ZW50LXR5cGUnXSA9ICdtdWx0aXBhcnQvcmVsYXRlZDsgYm91bmRhcnk9IicgKyBib3VuZGFyeSArICciJzsKCQkJcC5kYXRhID0gYm9keTsKCgkJCWNhbGxiYWNrKCd1cGxvYWQvZHJpdmUvdjIvZmlsZXMnICsgKGRhdGEuaWQgPyAnLycgKyBkYXRhLmlkIDogJycpICsgJz91cGxvYWRUeXBlPW11bHRpcGFydCcpOwoJCX0pOwoKCX0KCglmdW5jdGlvbiB0b0pTT04ocCkgewoJCWlmICh0eXBlb2YgKHAuZGF0YSkgPT09ICdvYmplY3QnKSB7CgkJCS8vIENvbnZlcnQgdGhlIFBPU1QgaW50byBhIGphdmFzY3JpcHQgb2JqZWN0CgkJCXRyeSB7CgkJCQlwLmRhdGEgPSBKU09OLnN0cmluZ2lmeShwLmRhdGEpOwoJCQkJcC5oZWFkZXJzWydjb250ZW50LXR5cGUnXSA9ICdhcHBsaWNhdGlvbi9qc29uJzsKCQkJfQoJCQljYXRjaCAoZSkge30KCQl9Cgl9Cgp9KShoZWxsbyk7CgooZnVuY3Rpb24oaGVsbG8pIHsKCgloZWxsby5pbml0KHsKCgkJaW5zdGFncmFtOiB7CgoJCQluYW1lOiAnSW5zdGFncmFtJywKCgkJCW9hdXRoOiB7CgkJCQkvLyBTZWU6IGh0dHA6Ly9pbnN0YWdyYW0uY29tL2RldmVsb3Blci9hdXRoZW50aWNhdGlvbi8KCQkJCXZlcnNpb246IDIsCgkJCQlhdXRoOiAnaHR0cHM6Ly9pbnN0YWdyYW0uY29tL29hdXRoL2F1dGhvcml6ZS8nLAoJCQkJZ3JhbnQ6ICdodHRwczovL2FwaS5pbnN0YWdyYW0uY29tL29hdXRoL2FjY2Vzc190b2tlbicKCQkJfSwKCgkJCS8vIFJlZnJlc2ggdGhlIGFjY2Vzc190b2tlbiBvbmNlIGV4cGlyZWQKCQkJcmVmcmVzaDogdHJ1ZSwKCgkJCXNjb3BlOiB7CgkJCQliYXNpYzogJ2Jhc2ljJywKCQkJCXBob3RvczogJycsCgkJCQlmcmllbmRzOiAncmVsYXRpb25zaGlwcycsCgkJCQlwdWJsaXNoOiAnbGlrZXMgY29tbWVudHMnCgkJCX0sCgoJCQlzY29wZV9kZWxpbTogJyAnLAoKCQkJbG9naW46IGZ1bmN0aW9uKHApIHsKCQkJCS8vIEluc3RhZ3JhbSB0aHJvd3MgZXJyb3JzIGxpa2UgJ0phdmFTY3JpcHQgQVBJIGlzIHVuc3VwcG9ydGVkJyBpZiB0aGUgZGlzcGxheSBpcyAncG9wdXAnLgoJCQkJLy8gTWFrZSB0aGUgZGlzcGxheSBhbnl0aGluZyBidXQgJ3BvcHVwJwoJCQkJcC5xcy5kaXNwbGF5ID0gJyc7CgkJCX0sCgoJCQliYXNlOiAnaHR0cHM6Ly9hcGkuaW5zdGFncmFtLmNvbS92MS8nLAoKCQkJZ2V0OiB7CgkJCQltZTogJ3VzZXJzL3NlbGYnLAoJCQkJJ21lL2ZlZWQnOiAndXNlcnMvc2VsZi9mZWVkP2NvdW50PUB7bGltaXR8MTAwfScsCgkJCQknbWUvcGhvdG9zJzogJ3VzZXJzL3NlbGYvbWVkaWEvcmVjZW50P21pbl9pZD0wJmNvdW50PUB7bGltaXR8MTAwfScsCgkJCQknbWUvZnJpZW5kcyc6ICd1c2Vycy9zZWxmL2ZvbGxvd3M/Y291bnQ9QHtsaW1pdHwxMDB9JywKCQkJCSdtZS9mb2xsb3dpbmcnOiAndXNlcnMvc2VsZi9mb2xsb3dzP2NvdW50PUB7bGltaXR8MTAwfScsCgkJCQknbWUvZm9sbG93ZXJzJzogJ3VzZXJzL3NlbGYvZm9sbG93ZWQtYnk/Y291bnQ9QHtsaW1pdHwxMDB9JywKCQkJCSdmcmllbmQvcGhvdG9zJzogJ3VzZXJzL0B7aWR9L21lZGlhL3JlY2VudD9taW5faWQ9MCZjb3VudD1Ae2xpbWl0fDEwMH0nCgkJCX0sCgoJCQlwb3N0OiB7CgkJCQknbWUvbGlrZSc6IGZ1bmN0aW9uKHAsIGNhbGxiYWNrKSB7CgkJCQkJdmFyIGlkID0gcC5kYXRhLmlkOwoJCQkJCXAuZGF0YSA9IHt9OwoJCQkJCWNhbGxiYWNrKCdtZWRpYS8nICsgaWQgKyAnL2xpa2VzJyk7CgkJCQl9CgkJCX0sCgoJCQlkZWw6IHsKCQkJCSdtZS9saWtlJzogJ21lZGlhL0B7aWR9L2xpa2VzJwoJCQl9LAoKCQkJd3JhcDogewoJCQkJbWU6IGZ1bmN0aW9uKG8pIHsKCgkJCQkJZm9ybWF0RXJyb3Iobyk7CgoJCQkJCWlmICgnZGF0YScgaW4gbykgewoJCQkJCQlvLmlkID0gby5kYXRhLmlkOwoJCQkJCQlvLnRodW1ibmFpbCA9IG8uZGF0YS5wcm9maWxlX3BpY3R1cmU7CgkJCQkJCW8ubmFtZSA9IG8uZGF0YS5mdWxsX25hbWUgfHwgby5kYXRhLnVzZXJuYW1lOwoJCQkJCX0KCgkJCQkJcmV0dXJuIG87CgkJCQl9LAoKCQkJCSdtZS9mcmllbmRzJzogZm9ybWF0RnJpZW5kcywKCQkJCSdtZS9mb2xsb3dpbmcnOiBmb3JtYXRGcmllbmRzLAoJCQkJJ21lL2ZvbGxvd2Vycyc6IGZvcm1hdEZyaWVuZHMsCgkJCQknbWUvcGhvdG9zJzogZnVuY3Rpb24obykgewoKCQkJCQlmb3JtYXRFcnJvcihvKTsKCQkJCQlwYWdpbmcobyk7CgoJCQkJCWlmICgnZGF0YScgaW4gbykgewoJCQkJCQlvLmRhdGEgPSBvLmRhdGEuZmlsdGVyKGZ1bmN0aW9uKGQpIHsKCQkJCQkJCXJldHVybiBkLnR5cGUgPT09ICdpbWFnZSc7CgkJCQkJCX0pOwoKCQkJCQkJby5kYXRhLmZvckVhY2goZnVuY3Rpb24oZCkgewoJCQkJCQkJZC5uYW1lID0gZC5jYXB0aW9uID8gZC5jYXB0aW9uLnRleHQgOiBudWxsOwoJCQkJCQkJZC50aHVtYm5haWwgPSBkLmltYWdlcy50aHVtYm5haWwudXJsOwoJCQkJCQkJZC5waWN0dXJlID0gZC5pbWFnZXMuc3RhbmRhcmRfcmVzb2x1dGlvbi51cmw7CgkJCQkJCQlkLnBpY3R1cmVzID0gT2JqZWN0LmtleXMoZC5pbWFnZXMpCgkJCQkJCQkJLm1hcChmdW5jdGlvbihrZXkpIHsKCQkJCQkJCQkJdmFyIGltYWdlID0gZC5pbWFnZXNba2V5XTsKCQkJCQkJCQkJcmV0dXJuIGZvcm1hdEltYWdlKGltYWdlKTsKCQkJCQkJCQl9KQoJCQkJCQkJCS5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKCQkJCQkJCQkJcmV0dXJuIGEud2lkdGggLSBiLndpZHRoOwoJCQkJCQkJCX0pOwoJCQkJCQl9KTsKCQkJCQl9CgoJCQkJCXJldHVybiBvOwoJCQkJfSwKCgkJCQknZGVmYXVsdCc6IGZ1bmN0aW9uKG8pIHsKCQkJCQlvID0gZm9ybWF0RXJyb3Iobyk7CgkJCQkJcGFnaW5nKG8pOwoJCQkJCXJldHVybiBvOwoJCQkJfQoJCQl9LAoKCQkJLy8gSW5zdGFncmFtIGRvZXMgbm90IHJldHVybiBhbnkgQ09SUyBIZWFkZXJzCgkJCS8vIFNvIGJlc2lkZXMgSlNPTlAgd2UncmUgc3R1Y2sgd2l0aCBwcm94eQoJCQl4aHI6IGZ1bmN0aW9uKHAsIHFzKSB7CgoJCQkJdmFyIG1ldGhvZCA9IHAubWV0aG9kOwoJCQkJdmFyIHByb3h5ID0gbWV0aG9kICE9PSAnZ2V0JzsKCgkJCQlpZiAocHJveHkpIHsKCgkJCQkJaWYgKChtZXRob2QgPT09ICdwb3N0JyB8fCBtZXRob2QgPT09ICdwdXQnKSAmJiBwLnF1ZXJ5LmFjY2Vzc190b2tlbikgewoJCQkJCQlwLmRhdGEuYWNjZXNzX3Rva2VuID0gcC5xdWVyeS5hY2Nlc3NfdG9rZW47CgkJCQkJCWRlbGV0ZSBwLnF1ZXJ5LmFjY2Vzc190b2tlbjsKCQkJCQl9CgoJCQkJCS8vIE5vIGFjY2VzcyBjb250cm9sIGhlYWRlcnMKCQkJCQkvLyBVc2UgdGhlIHByb3h5IGluc3RlYWQKCQkJCQlwLnByb3h5ID0gcHJveHk7CgkJCQl9CgoJCQkJcmV0dXJuIHByb3h5OwoJCQl9LAoKCQkJLy8gTm8gZm9ybQoJCQlmb3JtOiBmYWxzZQoJCX0KCX0pOwoKCWZ1bmN0aW9uIGZvcm1hdEltYWdlKGltYWdlKSB7CgkJcmV0dXJuIHsKCQkJc291cmNlOiBpbWFnZS51cmwsCgkJCXdpZHRoOiBpbWFnZS53aWR0aCwKCQkJaGVpZ2h0OiBpbWFnZS5oZWlnaHQKCQl9OwoJfQoKCWZ1bmN0aW9uIGZvcm1hdEVycm9yKG8pIHsKCQlpZiAodHlwZW9mIG8gPT09ICdzdHJpbmcnKSB7CgkJCXJldHVybiB7CgkJCQllcnJvcjogewoJCQkJCWNvZGU6ICdpbnZhbGlkX3JlcXVlc3QnLAoJCQkJCW1lc3NhZ2U6IG8KCQkJCX0KCQkJfTsKCQl9CgoJCWlmIChvICYmICdtZXRhJyBpbiBvICYmICdlcnJvcl90eXBlJyBpbiBvLm1ldGEpIHsKCQkJby5lcnJvciA9IHsKCQkJCWNvZGU6IG8ubWV0YS5lcnJvcl90eXBlLAoJCQkJbWVzc2FnZTogby5tZXRhLmVycm9yX21lc3NhZ2UKCQkJfTsKCQl9CgoJCXJldHVybiBvOwoJfQoKCWZ1bmN0aW9uIGZvcm1hdEZyaWVuZHMobykgewoJCXBhZ2luZyhvKTsKCQlpZiAobyAmJiAnZGF0YScgaW4gbykgewoJCQlvLmRhdGEuZm9yRWFjaChmb3JtYXRGcmllbmQpOwoJCX0KCgkJcmV0dXJuIG87Cgl9CgoJZnVuY3Rpb24gZm9ybWF0RnJpZW5kKG8pIHsKCQlpZiAoby5pZCkgewoJCQlvLnRodW1ibmFpbCA9IG8ucHJvZmlsZV9waWN0dXJlOwoJCQlvLm5hbWUgPSBvLmZ1bGxfbmFtZSB8fCBvLnVzZXJuYW1lOwoJCX0KCX0KCgkvLyBTZWU6IGh0dHA6Ly9pbnN0YWdyYW0uY29tL2RldmVsb3Blci9lbmRwb2ludHMvCglmdW5jdGlvbiBwYWdpbmcocmVzKSB7CgkJaWYgKCdwYWdpbmF0aW9uJyBpbiByZXMpIHsKCQkJcmVzLnBhZ2luZyA9IHsKCQkJCW5leHQ6IHJlcy5wYWdpbmF0aW9uLm5leHRfdXJsCgkJCX07CgkJCWRlbGV0ZSByZXMucGFnaW5hdGlvbjsKCQl9Cgl9Cgp9KShoZWxsbyk7CgooZnVuY3Rpb24oaGVsbG8pIHsKCgloZWxsby5pbml0KHsKCgkJam9pbm1lOiB7CgoJCQluYW1lOiAnam9pbi5tZScsCgoJCQlvYXV0aDogewoJCQkJdmVyc2lvbjogMiwKCQkJCWF1dGg6ICdodHRwczovL3NlY3VyZS5qb2luLm1lL2FwaS9wdWJsaWMvdjEvYXV0aC9vYXV0aDInLAoJCQkJZ3JhbnQ6ICdodHRwczovL3NlY3VyZS5qb2luLm1lL2FwaS9wdWJsaWMvdjEvYXV0aC9vYXV0aDInCgkJCX0sCgoJCQlyZWZyZXNoOiBmYWxzZSwKCgkJCXNjb3BlOiB7CgkJCQliYXNpYzogJ3VzZXJfaW5mbycsCgkJCQl1c2VyOiAndXNlcl9pbmZvJywKCQkJCXNjaGVkdWxlcjogJ3NjaGVkdWxlcicsCgkJCQlzdGFydDogJ3N0YXJ0X21lZXRpbmcnCgkJCX0sCgoJCQlzY29wZV9kZWxpbTogJyAnLAoKCQkJbG9naW46IGZ1bmN0aW9uKHApIHsKCQkJCXAub3B0aW9ucy5wb3B1cC53aWR0aCA9IDQwMDsKCQkJCXAub3B0aW9ucy5wb3B1cC5oZWlnaHQgPSA3MDA7CgkJCX0sCgoJCQliYXNlOiAnaHR0cHM6Ly9hcGkuam9pbi5tZS92MS8nLAoKCQkJZ2V0OiB7CgkJCQltZTogJ3VzZXInLAoJCQkJbWVldGluZ3M6ICdtZWV0aW5ncycsCgkJCQknbWVldGluZ3MvaW5mbyc6ICdtZWV0aW5ncy9Ae2lkfScKCQkJfSwKCgkJCXBvc3Q6IHsKCQkJCSdtZWV0aW5ncy9zdGFydC9hZGhvYyc6IGZ1bmN0aW9uKHAsIGNhbGxiYWNrKSB7CgkJCQkJY2FsbGJhY2soJ21lZXRpbmdzL3N0YXJ0Jyk7CgkJCQl9LAoKCQkJCSdtZWV0aW5ncy9zdGFydC9zY2hlZHVsZWQnOiBmdW5jdGlvbihwLCBjYWxsYmFjaykgewoJCQkJCXZhciBtZWV0aW5nSWQgPSBwLmRhdGEubWVldGluZ0lkOwoJCQkJCXAuZGF0YSA9IHt9OwoJCQkJCWNhbGxiYWNrKCdtZWV0aW5ncy8nICsgbWVldGluZ0lkICsgJy9zdGFydCcpOwoJCQkJfSwKCgkJCQknbWVldGluZ3Mvc2NoZWR1bGUnOiBmdW5jdGlvbihwLCBjYWxsYmFjaykgewoJCQkJCWNhbGxiYWNrKCdtZWV0aW5ncycpOwoJCQkJfQoJCQl9LAoKCQkJcGF0Y2g6IHsKCQkJCSdtZWV0aW5ncy91cGRhdGUnOiBmdW5jdGlvbihwLCBjYWxsYmFjaykgewoJCQkJCWNhbGxiYWNrKCdtZWV0aW5ncy8nICsgcC5kYXRhLm1lZXRpbmdJZCk7CgkJCQl9CgkJCX0sCgoJCQlkZWw6IHsKCQkJCSdtZWV0aW5ncy9kZWxldGUnOiAnbWVldGluZ3MvQHtpZH0nCgkJCX0sCgoJCQl3cmFwOiB7CgkJCQltZTogZnVuY3Rpb24obywgaGVhZGVycykgewoJCQkJCWZvcm1hdEVycm9yKG8sIGhlYWRlcnMpOwoKCQkJCQlpZiAoIW8uZW1haWwpIHsKCQkJCQkJcmV0dXJuIG87CgkJCQkJfQoKCQkJCQlvLm5hbWUgPSBvLmZ1bGxOYW1lOwoJCQkJCW8uZmlyc3RfbmFtZSA9IG8ubmFtZS5zcGxpdCgnICcpWzBdOwoJCQkJCW8ubGFzdF9uYW1lID0gby5uYW1lLnNwbGl0KCcgJylbMV07CgkJCQkJby5pZCA9IG8uZW1haWw7CgoJCQkJCXJldHVybiBvOwoJCQkJfSwKCgkJCQknZGVmYXVsdCc6IGZ1bmN0aW9uKG8sIGhlYWRlcnMpIHsKCQkJCQlmb3JtYXRFcnJvcihvLCBoZWFkZXJzKTsKCgkJCQkJcmV0dXJuIG87CgkJCQl9CgkJCX0sCgoJCQl4aHI6IGZvcm1hdFJlcXVlc3QKCgkJfQoJfSk7CgoJZnVuY3Rpb24gZm9ybWF0RXJyb3IobywgaGVhZGVycykgewoJCXZhciBlcnJvckNvZGU7CgkJdmFyIG1lc3NhZ2U7CgkJdmFyIGRldGFpbHM7CgoJCWlmIChvICYmICgnTWVzc2FnZScgaW4gbykpIHsKCQkJbWVzc2FnZSA9IG8uTWVzc2FnZTsKCQkJZGVsZXRlIG8uTWVzc2FnZTsKCgkJCWlmICgnRXJyb3JDb2RlJyBpbiBvKSB7CgkJCQllcnJvckNvZGUgPSBvLkVycm9yQ29kZTsKCQkJCWRlbGV0ZSBvLkVycm9yQ29kZTsKCQkJfQoJCQllbHNlIHsKCQkJCWVycm9yQ29kZSA9IGdldEVycm9yQ29kZShoZWFkZXJzKTsKCQkJfQoKCQkJby5lcnJvciA9IHsKCQkJCWNvZGU6IGVycm9yQ29kZSwKCQkJCW1lc3NhZ2U6IG1lc3NhZ2UsCgkJCQlkZXRhaWxzOiBvCgkJCX07CgkJfQoKCQlyZXR1cm4gbzsKCX0KCglmdW5jdGlvbiBmb3JtYXRSZXF1ZXN0KHAsIHFzKSB7CgkJLy8gTW92ZSB0aGUgYWNjZXNzIHRva2VuIGZyb20gdGhlIHJlcXVlc3QgYm9keSB0byB0aGUgcmVxdWVzdCBoZWFkZXIKCQl2YXIgdG9rZW4gPSBxcy5hY2Nlc3NfdG9rZW47CgkJZGVsZXRlIHFzLmFjY2Vzc190b2tlbjsKCQlwLmhlYWRlcnMuQXV0aG9yaXphdGlvbiA9ICdCZWFyZXIgJyArIHRva2VuOwoKCQkvLyBGb3JtYXQgbm9uLWdldCByZXF1ZXN0cyB0byBpbmRpY2F0ZSBqc29uIGJvZHkKCQlpZiAocC5tZXRob2QgIT09ICdnZXQnICYmIHAuZGF0YSkgewoJCQlwLmhlYWRlcnNbJ0NvbnRlbnQtVHlwZSddID0gJ2FwcGxpY2F0aW9uL2pzb24nOwoJCQlpZiAodHlwZW9mIChwLmRhdGEpID09PSAnb2JqZWN0JykgewoJCQkJcC5kYXRhID0gSlNPTi5zdHJpbmdpZnkocC5kYXRhKTsKCQkJfQoJCX0KCgkJaWYgKHAubWV0aG9kID09PSAncHV0JykgewoJCQlwLm1ldGhvZCA9ICdwYXRjaCc7CgkJfQoKCQlyZXR1cm4gdHJ1ZTsKCX0KCglmdW5jdGlvbiBnZXRFcnJvckNvZGUoaGVhZGVycykgewoJCXN3aXRjaCAoaGVhZGVycy5zdGF0dXNDb2RlKSB7CgkJCWNhc2UgNDAwOgoJCQkJcmV0dXJuICdpbnZhbGlkX3JlcXVlc3QnOwoJCQljYXNlIDQwMzoKCQkJCXJldHVybiAnc3RhbGVfdG9rZW4nOwoJCQljYXNlIDQwMToKCQkJCXJldHVybiAnaW52YWxpZF90b2tlbic7CgkJCWNhc2UgNTAwOgoJCQkJcmV0dXJuICdzZXJ2ZXJfZXJyb3InOwoJCQlkZWZhdWx0OgoJCQkJcmV0dXJuICdzZXJ2ZXJfZXJyb3InOwoJCX0KCX0KCn0oaGVsbG8pKTsKCihmdW5jdGlvbihoZWxsbykgewoKCWhlbGxvLmluaXQoewoKCQlsaW5rZWRpbjogewoKCQkJb2F1dGg6IHsKCQkJCXZlcnNpb246IDIsCgkJCQlyZXNwb25zZV90eXBlOiAnY29kZScsCgkJCQlhdXRoOiAnaHR0cHM6Ly93d3cubGlua2VkaW4uY29tL3Vhcy9vYXV0aDIvYXV0aG9yaXphdGlvbicsCgkJCQlncmFudDogJ2h0dHBzOi8vd3d3LmxpbmtlZGluLmNvbS91YXMvb2F1dGgyL2FjY2Vzc1Rva2VuJwoJCQl9LAoKCQkJLy8gUmVmcmVzaCB0aGUgYWNjZXNzX3Rva2VuIG9uY2UgZXhwaXJlZAoJCQlyZWZyZXNoOiB0cnVlLAoKCQkJc2NvcGU6IHsKCQkJCWJhc2ljOiAncl9iYXNpY3Byb2ZpbGUnLAoJCQkJZW1haWw6ICdyX2VtYWlsYWRkcmVzcycsCgkJCQlmcmllbmRzOiAnJywKCQkJCXB1Ymxpc2g6ICd3X3NoYXJlJwoJCQl9LAoJCQlzY29wZV9kZWxpbTogJyAnLAoKCQkJYmFzZTogJ2h0dHBzOi8vYXBpLmxpbmtlZGluLmNvbS92MS8nLAoKCQkJZ2V0OiB7CgkJCQltZTogJ3Blb3BsZS9+OihwaWN0dXJlLXVybCxmaXJzdC1uYW1lLGxhc3QtbmFtZSxpZCxmb3JtYXR0ZWQtbmFtZSxlbWFpbC1hZGRyZXNzKScsCgoJCQkJLy8gU2VlOiBodHRwOi8vZGV2ZWxvcGVyLmxpbmtlZGluLmNvbS9kb2N1bWVudHMvZ2V0LW5ldHdvcmstdXBkYXRlcy1hbmQtc3RhdGlzdGljcy1hcGkKCQkJCSdtZS9zaGFyZSc6ICdwZW9wbGUvfi9uZXR3b3JrL3VwZGF0ZXM/Y291bnQ9QHtsaW1pdHwyNTB9JwoJCQl9LAoKCQkJcG9zdDogewoKCQkJCS8vIFNlZTogaHR0cHM6Ly9kZXZlbG9wZXIubGlua2VkaW4uY29tL2RvY3VtZW50cy9hcGktcmVxdWVzdHMtanNvbgoJCQkJJ21lL3NoYXJlJzogZnVuY3Rpb24ocCwgY2FsbGJhY2spIHsKCQkJCQl2YXIgZGF0YSA9IHsKCQkJCQkJdmlzaWJpbGl0eTogewoJCQkJCQkJY29kZTogJ2FueW9uZScKCQkJCQkJfQoJCQkJCX07CgoJCQkJCWlmIChwLmRhdGEuaWQpIHsKCgkJCQkJCWRhdGEuYXR0cmlidXRpb24gPSB7CgkJCQkJCQlzaGFyZTogewoJCQkJCQkJCWlkOiBwLmRhdGEuaWQKCQkJCQkJCX0KCQkJCQkJfTsKCgkJCQkJfQoJCQkJCWVsc2UgewoJCQkJCQlkYXRhLmNvbW1lbnQgPSBwLmRhdGEubWVzc2FnZTsKCQkJCQkJaWYgKHAuZGF0YS5waWN0dXJlICYmIHAuZGF0YS5saW5rKSB7CgkJCQkJCQlkYXRhLmNvbnRlbnQgPSB7CgkJCQkJCQkJJ3N1Ym1pdHRlZC11cmwnOiBwLmRhdGEubGluaywKCQkJCQkJCQknc3VibWl0dGVkLWltYWdlLXVybCc6IHAuZGF0YS5waWN0dXJlCgkJCQkJCQl9OwoJCQkJCQl9CgkJCQkJfQoKCQkJCQlwLmRhdGEgPSBKU09OLnN0cmluZ2lmeShkYXRhKTsKCgkJCQkJY2FsbGJhY2soJ3Blb3BsZS9+L3NoYXJlcz9mb3JtYXQ9anNvbicpOwoJCQkJfSwKCgkJCQknbWUvbGlrZSc6IGxpa2UKCQkJfSwKCgkJCWRlbDp7CgkJCQknbWUvbGlrZSc6IGxpa2UKCQkJfSwKCgkJCXdyYXA6IHsKCQkJCW1lOiBmdW5jdGlvbihvKSB7CgkJCQkJZm9ybWF0RXJyb3Iobyk7CgkJCQkJZm9ybWF0VXNlcihvKTsKCQkJCQlyZXR1cm4gbzsKCQkJCX0sCgoJCQkJJ21lL2ZyaWVuZHMnOiBmb3JtYXRGcmllbmRzLAoJCQkJJ21lL2ZvbGxvd2luZyc6IGZvcm1hdEZyaWVuZHMsCgkJCQknbWUvZm9sbG93ZXJzJzogZm9ybWF0RnJpZW5kcywKCQkJCSdtZS9zaGFyZSc6IGZ1bmN0aW9uKG8pIHsKCQkJCQlmb3JtYXRFcnJvcihvKTsKCQkJCQlwYWdpbmcobyk7CgkJCQkJaWYgKG8udmFsdWVzKSB7CgkJCQkJCW8uZGF0YSA9IG8udmFsdWVzLm1hcChmb3JtYXRVc2VyKTsKCQkJCQkJby5kYXRhLmZvckVhY2goZnVuY3Rpb24oaXRlbSkgewoJCQkJCQkJaXRlbS5tZXNzYWdlID0gaXRlbS5oZWFkbGluZTsKCQkJCQkJfSk7CgoJCQkJCQlkZWxldGUgby52YWx1ZXM7CgkJCQkJfQoKCQkJCQlyZXR1cm4gbzsKCQkJCX0sCgoJCQkJJ2RlZmF1bHQnOiBmdW5jdGlvbihvLCBoZWFkZXJzKSB7CgkJCQkJZm9ybWF0RXJyb3Iobyk7CgkJCQkJZW1wdHkobywgaGVhZGVycyk7CgkJCQkJcGFnaW5nKG8pOwoJCQkJfQoJCQl9LAoKCQkJanNvbnA6IGZ1bmN0aW9uKHAsIHFzKSB7CgkJCQlmb3JtYXRRdWVyeShxcyk7CgkJCQlpZiAocC5tZXRob2QgPT09ICdnZXQnKSB7CgkJCQkJcXMuZm9ybWF0ID0gJ2pzb25wJzsKCQkJCQlxc1snZXJyb3ItY2FsbGJhY2snXSA9IHAuY2FsbGJhY2tJRDsKCQkJCX0KCQkJfSwKCgkJCXhocjogZnVuY3Rpb24ocCwgcXMpIHsKCQkJCWlmIChwLm1ldGhvZCAhPT0gJ2dldCcpIHsKCQkJCQlmb3JtYXRRdWVyeShxcyk7CgkJCQkJcC5oZWFkZXJzWydDb250ZW50LVR5cGUnXSA9ICdhcHBsaWNhdGlvbi9qc29uJzsKCgkJCQkJLy8gTm90ZTogeC1saS1mb3JtYXQgZW5zdXJlcyBlcnJvciByZXNwb25zZXMgYXJlIG5vdCByZXR1cm5lZCBpbiBYTUwKCQkJCQlwLmhlYWRlcnNbJ3gtbGktZm9ybWF0J10gPSAnanNvbic7CgkJCQkJcC5wcm94eSA9IHRydWU7CgkJCQkJcmV0dXJuIHRydWU7CgkJCQl9CgoJCQkJcmV0dXJuIGZhbHNlOwoJCQl9CgkJfQoJfSk7CgoJZnVuY3Rpb24gZm9ybWF0RXJyb3IobykgewoJCWlmIChvICYmICdlcnJvckNvZGUnIGluIG8pIHsKCQkJby5lcnJvciA9IHsKCQkJCWNvZGU6IG8uc3RhdHVzLAoJCQkJbWVzc2FnZTogby5tZXNzYWdlCgkJCX07CgkJfQoJfQoKCWZ1bmN0aW9uIGZvcm1hdFVzZXIobykgewoJCWlmIChvLmVycm9yKSB7CgkJCXJldHVybjsKCQl9CgoJCW8uZmlyc3RfbmFtZSA9IG8uZmlyc3ROYW1lOwoJCW8ubGFzdF9uYW1lID0gby5sYXN0TmFtZTsKCQlvLm5hbWUgPSBvLmZvcm1hdHRlZE5hbWUgfHwgKG8uZmlyc3RfbmFtZSArICcgJyArIG8ubGFzdF9uYW1lKTsKCQlvLnRodW1ibmFpbCA9IG8ucGljdHVyZVVybDsKCQlvLmVtYWlsID0gby5lbWFpbEFkZHJlc3M7CgkJcmV0dXJuIG87Cgl9CgoJZnVuY3Rpb24gZm9ybWF0RnJpZW5kcyhvKSB7CgkJZm9ybWF0RXJyb3Iobyk7CgkJcGFnaW5nKG8pOwoJCWlmIChvLnZhbHVlcykgewoJCQlvLmRhdGEgPSBvLnZhbHVlcy5tYXAoZm9ybWF0VXNlcik7CgkJCWRlbGV0ZSBvLnZhbHVlczsKCQl9CgoJCXJldHVybiBvOwoJfQoKCWZ1bmN0aW9uIHBhZ2luZyhyZXMpIHsKCQlpZiAoJ19jb3VudCcgaW4gcmVzICYmICdfc3RhcnQnIGluIHJlcyAmJiAocmVzLl9jb3VudCArIHJlcy5fc3RhcnQpIDwgcmVzLl90b3RhbCkgewoJCQlyZXMucGFnaW5nID0gewoJCQkJbmV4dDogJz9zdGFydD0nICsgKHJlcy5fc3RhcnQgKyByZXMuX2NvdW50KSArICcmY291bnQ9JyArIHJlcy5fY291bnQKCQkJfTsKCQl9Cgl9CgoJZnVuY3Rpb24gZW1wdHkobywgaGVhZGVycykgewoJCWlmIChKU09OLnN0cmluZ2lmeShvKSA9PT0gJ3t9JyAmJiBoZWFkZXJzLnN0YXR1c0NvZGUgPT09IDIwMCkgewoJCQlvLnN1Y2Nlc3MgPSB0cnVlOwoJCX0KCX0KCglmdW5jdGlvbiBmb3JtYXRRdWVyeShxcykgewoJCS8vIExpbmtlZEluIHNpZ25zIHJlcXVlc3RzIHdpdGggdGhlIHBhcmFtZXRlciAnb2F1dGgyX2FjY2Vzc190b2tlbicKCQkvLyAuLi4geWVhaCBhbm90aGVyIG9uZSB3aG8gdGhpbmtzIHRoZXkgc2hvdWxkIGJlIGRpZmZlcmVudCEKCQlpZiAocXMuYWNjZXNzX3Rva2VuKSB7CgkJCXFzLm9hdXRoMl9hY2Nlc3NfdG9rZW4gPSBxcy5hY2Nlc3NfdG9rZW47CgkJCWRlbGV0ZSBxcy5hY2Nlc3NfdG9rZW47CgkJfQoJfQoKCWZ1bmN0aW9uIGxpa2UocCwgY2FsbGJhY2spIHsKCQlwLmhlYWRlcnNbJ3gtbGktZm9ybWF0J10gPSAnanNvbic7CgkJdmFyIGlkID0gcC5kYXRhLmlkOwoJCXAuZGF0YSA9IChwLm1ldGhvZCAhPT0gJ2RlbGV0ZScpLnRvU3RyaW5nKCk7CgkJcC5tZXRob2QgPSAncHV0JzsKCQljYWxsYmFjaygncGVvcGxlL34vbmV0d29yay91cGRhdGVzL2tleT0nICsgaWQgKyAnL2lzLWxpa2VkJyk7Cgl9Cgp9KShoZWxsbyk7CgovLyBTZWU6IGh0dHBzOi8vZGV2ZWxvcGVycy5zb3VuZGNsb3VkLmNvbS9kb2NzL2FwaS9yZWZlcmVuY2UKKGZ1bmN0aW9uKGhlbGxvKSB7CgoJaGVsbG8uaW5pdCh7CgoJCXNvdW5kY2xvdWQ6IHsKCQkJbmFtZTogJ1NvdW5kQ2xvdWQnLAoKCQkJb2F1dGg6IHsKCQkJCXZlcnNpb246IDIsCgkJCQlhdXRoOiAnaHR0cHM6Ly9zb3VuZGNsb3VkLmNvbS9jb25uZWN0JywKCQkJCWdyYW50OiAnaHR0cHM6Ly9zb3VuZGNsb3VkLmNvbS9vYXV0aDIvdG9rZW4nCgkJCX0sCgoJCQkvLyBSZXF1ZXN0IHBhdGggdHJhbnNsYXRlZAoJCQliYXNlOiAnaHR0cHM6Ly9hcGkuc291bmRjbG91ZC5jb20vJywKCQkJZ2V0OiB7CgkJCQltZTogJ21lLmpzb24nLAoKCQkJCS8vIEh0dHA6Ly9kZXZlbG9wZXJzLnNvdW5kY2xvdWQuY29tL2RvY3MvYXBpL3JlZmVyZW5jZSNtZQoJCQkJJ21lL2ZyaWVuZHMnOiAnbWUvZm9sbG93aW5ncy5qc29uJywKCQkJCSdtZS9mb2xsb3dlcnMnOiAnbWUvZm9sbG93ZXJzLmpzb24nLAoJCQkJJ21lL2ZvbGxvd2luZyc6ICdtZS9mb2xsb3dpbmdzLmpzb24nLAoKCQkJCS8vIFNlZTogaHR0cDovL2RldmVsb3BlcnMuc291bmRjbG91ZC5jb20vZG9jcy9hcGkvcmVmZXJlbmNlI2FjdGl2aXRpZXMKCQkJCSdkZWZhdWx0JzogZnVuY3Rpb24ocCwgY2FsbGJhY2spIHsKCgkJCQkJLy8gSW5jbHVkZSAnLmpzb24gYXQgdGhlIGVuZCBvZiBlYWNoIHJlcXVlc3QnCgkJCQkJY2FsbGJhY2socC5wYXRoICsgJy5qc29uJyk7CgkJCQl9CgkJCX0sCgoJCQkvLyBSZXNwb25zZSBoYW5kbGVycwoJCQl3cmFwOiB7CgkJCQltZTogZnVuY3Rpb24obykgewoJCQkJCWZvcm1hdFVzZXIobyk7CgkJCQkJcmV0dXJuIG87CgkJCQl9LAoKCQkJCSdkZWZhdWx0JzogZnVuY3Rpb24obykgewoJCQkJCWlmIChBcnJheS5pc0FycmF5KG8pKSB7CgkJCQkJCW8gPSB7CgkJCQkJCQlkYXRhOiBvLm1hcChmb3JtYXRVc2VyKQoJCQkJCQl9OwoJCQkJCX0KCgkJCQkJcGFnaW5nKG8pOwoJCQkJCXJldHVybiBvOwoJCQkJfQoJCQl9LAoKCQkJeGhyOiBmb3JtYXRSZXF1ZXN0LAoJCQlqc29ucDogZm9ybWF0UmVxdWVzdAoJCX0KCX0pOwoKCWZ1bmN0aW9uIGZvcm1hdFJlcXVlc3QocCwgcXMpIHsKCQkvLyBBbHRlciB0aGUgcXVlcnlzdHJpbmcKCQl2YXIgdG9rZW4gPSBxcy5hY2Nlc3NfdG9rZW47CgkJZGVsZXRlIHFzLmFjY2Vzc190b2tlbjsKCQlxcy5vYXV0aF90b2tlbiA9IHRva2VuOwoJCXFzWydfc3RhdHVzX2NvZGVfbWFwWzMwMl0nXSA9IDIwMDsKCQlyZXR1cm4gdHJ1ZTsKCX0KCglmdW5jdGlvbiBmb3JtYXRVc2VyKG8pIHsKCQlpZiAoby5pZCkgewoJCQlvLnBpY3R1cmUgPSBvLmF2YXRhcl91cmw7CgkJCW8udGh1bWJuYWlsID0gby5hdmF0YXJfdXJsOwoJCQlvLm5hbWUgPSBvLnVzZXJuYW1lIHx8IG8uZnVsbF9uYW1lOwoJCX0KCgkJcmV0dXJuIG87Cgl9CgoJLy8gU2VlOiBodHRwOi8vZGV2ZWxvcGVycy5zb3VuZGNsb3VkLmNvbS9kb2NzL2FwaS9yZWZlcmVuY2UjYWN0aXZpdGllcwoJZnVuY3Rpb24gcGFnaW5nKHJlcykgewoJCWlmICgnbmV4dF9ocmVmJyBpbiByZXMpIHsKCQkJcmVzLnBhZ2luZyA9IHsKCQkJCW5leHQ6IHJlcy5uZXh0X2hyZWYKCQkJfTsKCQl9Cgl9Cgp9KShoZWxsbyk7CgooZnVuY3Rpb24oaGVsbG8pIHsKCgl2YXIgYmFzZSA9ICdodHRwczovL2FwaS50d2l0dGVyLmNvbS8nOwoKCWhlbGxvLmluaXQoewoKCQl0d2l0dGVyOiB7CgoJCQkvLyBFbnN1cmUgdGhhdCB5b3UgZGVmaW5lIGFuIG9hdXRoX3Byb3h5CgkJCW9hdXRoOiB7CgkJCQl2ZXJzaW9uOiAnMS4wYScsCgkJCQlhdXRoOiBiYXNlICsgJ29hdXRoL2F1dGhlbnRpY2F0ZScsCgkJCQlyZXF1ZXN0OiBiYXNlICsgJ29hdXRoL3JlcXVlc3RfdG9rZW4nLAoJCQkJdG9rZW46IGJhc2UgKyAnb2F1dGgvYWNjZXNzX3Rva2VuJwoJCQl9LAoKCQkJbG9naW46IGZ1bmN0aW9uKHApIHsKCQkJCS8vIFJlYXV0aGVudGljYXRlCgkJCQkvLyBodHRwczovL2Rldi50d2l0dGVyLmNvbS9vYXV0aC9yZWZlcmVuY2UvZ2V0L29hdXRoL2F1dGhlbnRpY2F0ZQoJCQkJdmFyIHByZWZpeCA9ICc/Zm9yY2VfbG9naW49dHJ1ZSc7CgkJCQl0aGlzLm9hdXRoLmF1dGggPSB0aGlzLm9hdXRoLmF1dGgucmVwbGFjZShwcmVmaXgsICcnKSArIChwLm9wdGlvbnMuZm9yY2UgPyBwcmVmaXggOiAnJyk7CgkJCX0sCgoJCQliYXNlOiBiYXNlICsgJzEuMS8nLAoKCQkJZ2V0OiB7CgkJCQltZTogJ2FjY291bnQvdmVyaWZ5X2NyZWRlbnRpYWxzLmpzb24nLAoJCQkJJ21lL2ZyaWVuZHMnOiAnZnJpZW5kcy9saXN0Lmpzb24/Y291bnQ9QHtsaW1pdHwyMDB9JywKCQkJCSdtZS9mb2xsb3dpbmcnOiAnZnJpZW5kcy9saXN0Lmpzb24/Y291bnQ9QHtsaW1pdHwyMDB9JywKCQkJCSdtZS9mb2xsb3dlcnMnOiAnZm9sbG93ZXJzL2xpc3QuanNvbj9jb3VudD1Ae2xpbWl0fDIwMH0nLAoKCQkJCS8vIEh0dHBzOi8vZGV2LnR3aXR0ZXIuY29tL2RvY3MvYXBpLzEuMS9nZXQvc3RhdHVzZXMvdXNlcl90aW1lbGluZQoJCQkJJ21lL3NoYXJlJzogJ3N0YXR1c2VzL3VzZXJfdGltZWxpbmUuanNvbj9jb3VudD1Ae2xpbWl0fDIwMH0nLAoKCQkJCS8vIEh0dHBzOi8vZGV2LnR3aXR0ZXIuY29tL3Jlc3QvcmVmZXJlbmNlL2dldC9mYXZvcml0ZXMvbGlzdAoJCQkJJ21lL2xpa2UnOiAnZmF2b3JpdGVzL2xpc3QuanNvbj9jb3VudD1Ae2xpbWl0fDIwMH0nCgkJCX0sCgoJCQlwb3N0OiB7CgkJCQknbWUvc2hhcmUnOiBmdW5jdGlvbihwLCBjYWxsYmFjaykgewoKCQkJCQl2YXIgZGF0YSA9IHAuZGF0YTsKCQkJCQlwLmRhdGEgPSBudWxsOwoKCQkJCQl2YXIgc3RhdHVzID0gW107CgoJCQkJCS8vIENoYW5nZSBtZXNzYWdlIHRvIHN0YXR1cwoJCQkJCWlmIChkYXRhLm1lc3NhZ2UpIHsKCQkJCQkJc3RhdHVzLnB1c2goZGF0YS5tZXNzYWdlKTsKCQkJCQkJZGVsZXRlIGRhdGEubWVzc2FnZTsKCQkJCQl9CgoJCQkJCS8vIElmIGxpbmsgaXMgZ2l2ZW4KCQkJCQlpZiAoZGF0YS5saW5rKSB7CgkJCQkJCXN0YXR1cy5wdXNoKGRhdGEubGluayk7CgkJCQkJCWRlbGV0ZSBkYXRhLmxpbms7CgkJCQkJfQoKCQkJCQlpZiAoZGF0YS5waWN0dXJlKSB7CgkJCQkJCXN0YXR1cy5wdXNoKGRhdGEucGljdHVyZSk7CgkJCQkJCWRlbGV0ZSBkYXRhLnBpY3R1cmU7CgkJCQkJfQoKCQkJCQkvLyBDb21wb3VuZCBhbGwgdGhlIGNvbXBvbmVudHMKCQkJCQlpZiAoc3RhdHVzLmxlbmd0aCkgewoJCQkJCQlkYXRhLnN0YXR1cyA9IHN0YXR1cy5qb2luKCcgJyk7CgkJCQkJfQoKCQkJCQkvLyBUd2VldCBtZWRpYQoJCQkJCWlmIChkYXRhLmZpbGUpIHsKCQkJCQkJZGF0YVsnbWVkaWFbXSddID0gZGF0YS5maWxlOwoJCQkJCQlkZWxldGUgZGF0YS5maWxlOwoJCQkJCQlwLmRhdGEgPSBkYXRhOwoJCQkJCQljYWxsYmFjaygnc3RhdHVzZXMvdXBkYXRlX3dpdGhfbWVkaWEuanNvbicpOwoJCQkJCX0KCgkJCQkJLy8gUmV0d2VldD8KCQkJCQllbHNlIGlmICgnaWQnIGluIGRhdGEpIHsKCQkJCQkJY2FsbGJhY2soJ3N0YXR1c2VzL3JldHdlZXQvJyArIGRhdGEuaWQgKyAnLmpzb24nKTsKCQkJCQl9CgoJCQkJCS8vIFR3ZWV0CgkJCQkJZWxzZSB7CgkJCQkJCS8vIEFzc2lnbiB0aGUgcG9zdCBib2R5IHRvIHRoZSBxdWVyeSBwYXJhbWV0ZXJzCgkJCQkJCWhlbGxvLnV0aWxzLmV4dGVuZChwLnF1ZXJ5LCBkYXRhKTsKCQkJCQkJY2FsbGJhY2soJ3N0YXR1c2VzL3VwZGF0ZS5qc29uP2luY2x1ZGVfZW50aXRpZXM9MScpOwoJCQkJCX0KCQkJCX0sCgoJCQkJLy8gU2VlOiBodHRwczovL2Rldi50d2l0dGVyLmNvbS9yZXN0L3JlZmVyZW5jZS9wb3N0L2Zhdm9yaXRlcy9jcmVhdGUKCQkJCSdtZS9saWtlJzogZnVuY3Rpb24ocCwgY2FsbGJhY2spIHsKCQkJCQl2YXIgaWQgPSBwLmRhdGEuaWQ7CgkJCQkJcC5kYXRhID0gbnVsbDsKCQkJCQljYWxsYmFjaygnZmF2b3JpdGVzL2NyZWF0ZS5qc29uP2lkPScgKyBpZCk7CgkJCQl9CgkJCX0sCgoJCQlkZWw6IHsKCgkJCQkvLyBTZWU6IGh0dHBzOi8vZGV2LnR3aXR0ZXIuY29tL3Jlc3QvcmVmZXJlbmNlL3Bvc3QvZmF2b3JpdGVzL2Rlc3Ryb3kKCQkJCSdtZS9saWtlJzogZnVuY3Rpb24oKSB7CgkJCQkJcC5tZXRob2QgPSAncG9zdCc7CgkJCQkJdmFyIGlkID0gcC5kYXRhLmlkOwoJCQkJCXAuZGF0YSA9IG51bGw7CgkJCQkJY2FsbGJhY2soJ2Zhdm9yaXRlcy9kZXN0cm95Lmpzb24/aWQ9JyArIGlkKTsKCQkJCX0KCQkJfSwKCgkJCXdyYXA6IHsKCQkJCW1lOiBmdW5jdGlvbihyZXMpIHsKCQkJCQlmb3JtYXRFcnJvcihyZXMpOwoJCQkJCWZvcm1hdFVzZXIocmVzKTsKCQkJCQlyZXR1cm4gcmVzOwoJCQkJfSwKCgkJCQknbWUvZnJpZW5kcyc6IGZvcm1hdEZyaWVuZHMsCgkJCQknbWUvZm9sbG93ZXJzJzogZm9ybWF0RnJpZW5kcywKCQkJCSdtZS9mb2xsb3dpbmcnOiBmb3JtYXRGcmllbmRzLAoKCQkJCSdtZS9zaGFyZSc6IGZ1bmN0aW9uKHJlcykgewoJCQkJCWZvcm1hdEVycm9yKHJlcyk7CgkJCQkJcGFnaW5nKHJlcyk7CgkJCQkJaWYgKCFyZXMuZXJyb3IgJiYgJ2xlbmd0aCcgaW4gcmVzKSB7CgkJCQkJCXJldHVybiB7ZGF0YTogcmVzfTsKCQkJCQl9CgoJCQkJCXJldHVybiByZXM7CgkJCQl9LAoKCQkJCSdkZWZhdWx0JzogZnVuY3Rpb24ocmVzKSB7CgkJCQkJcmVzID0gYXJyYXlUb0RhdGFSZXNwb25zZShyZXMpOwoJCQkJCXBhZ2luZyhyZXMpOwoJCQkJCXJldHVybiByZXM7CgkJCQl9CgkJCX0sCgkJCXhocjogZnVuY3Rpb24ocCkgewoKCQkJCS8vIFJlbHkgb24gdGhlIHByb3h5IGZvciBub24tR0VUIHJlcXVlc3RzLgoJCQkJcmV0dXJuIChwLm1ldGhvZCAhPT0gJ2dldCcpOwoJCQl9CgkJfQoJfSk7CgoJZnVuY3Rpb24gZm9ybWF0VXNlcihvKSB7CgkJaWYgKG8uaWQpIHsKCQkJaWYgKG8ubmFtZSkgewoJCQkJdmFyIG0gPSBvLm5hbWUuc3BsaXQoJyAnKTsKCQkJCW8uZmlyc3RfbmFtZSA9IG0uc2hpZnQoKTsKCQkJCW8ubGFzdF9uYW1lID0gbS5qb2luKCcgJyk7CgkJCX0KCgkJCS8vIFNlZTogaHR0cHM6Ly9kZXYudHdpdHRlci5jb20vb3ZlcnZpZXcvZ2VuZXJhbC91c2VyLXByb2ZpbGUtaW1hZ2VzLWFuZC1iYW5uZXJzCgkJCW8udGh1bWJuYWlsID0gby5wcm9maWxlX2ltYWdlX3VybF9odHRwcyB8fCBvLnByb2ZpbGVfaW1hZ2VfdXJsOwoJCX0KCgkJcmV0dXJuIG87Cgl9CgoJZnVuY3Rpb24gZm9ybWF0RnJpZW5kcyhvKSB7CgkJZm9ybWF0RXJyb3Iobyk7CgkJcGFnaW5nKG8pOwoJCWlmIChvLnVzZXJzKSB7CgkJCW8uZGF0YSA9IG8udXNlcnMubWFwKGZvcm1hdFVzZXIpOwoJCQlkZWxldGUgby51c2VyczsKCQl9CgoJCXJldHVybiBvOwoJfQoKCWZ1bmN0aW9uIGZvcm1hdEVycm9yKG8pIHsKCQlpZiAoby5lcnJvcnMpIHsKCQkJdmFyIGUgPSBvLmVycm9yc1swXTsKCQkJby5lcnJvciA9IHsKCQkJCWNvZGU6ICdyZXF1ZXN0X2ZhaWxlZCcsCgkJCQltZXNzYWdlOiBlLm1lc3NhZ2UKCQkJfTsKCQl9Cgl9CgoJLy8gVGFrZSBhIGN1cnNvciBhbmQgYWRkIGl0IHRvIHRoZSBwYXRoCglmdW5jdGlvbiBwYWdpbmcocmVzKSB7CgkJLy8gRG9lcyB0aGUgcmVzcG9uc2UgaW5jbHVkZSBhICduZXh0X2N1cnNvcl9zdHJpbmcnCgkJaWYgKCduZXh0X2N1cnNvcl9zdHInIGluIHJlcykgewoJCQkvLyBTZWU6IGh0dHBzOi8vZGV2LnR3aXR0ZXIuY29tL2RvY3MvbWlzYy9jdXJzb3JpbmcKCQkJcmVzLnBhZ2luZyA9IHsKCQkJCW5leHQ6ICc/Y3Vyc29yPScgKyByZXMubmV4dF9jdXJzb3Jfc3RyCgkJCX07CgkJfQoJfQoKCWZ1bmN0aW9uIGFycmF5VG9EYXRhUmVzcG9uc2UocmVzKSB7CgkJcmV0dXJuIEFycmF5LmlzQXJyYXkocmVzKSA/IHtkYXRhOiByZXN9IDogcmVzOwoJfQoKCS8qKgoJLy8gVGhlIGRvY3VtZW50YXRpb24gc2F5cyB0byBkZWZpbmUgdXNlciBpbiB0aGUgcmVxdWVzdAoJLy8gQWx0aG91Z2ggaXRzIG5vdCBhY3R1YWxseSByZXF1aXJlZC4KCgl2YXIgdXNlcl9pZDsKCglmdW5jdGlvbiB3aXRoVXNlcklkKGNhbGxiYWNrKXsKCQlpZih1c2VyX2lkKXsKCQkJY2FsbGJhY2sodXNlcl9pZCk7CgkJfQoJCWVsc2V7CgkJCWhlbGxvLmFwaSgndHdpdHRlcjovbWUnLCBmdW5jdGlvbihvKXsKCQkJCXVzZXJfaWQgPSBvLmlkOwoJCQkJY2FsbGJhY2soby5pZCk7CgkJCX0pOwoJCX0KCX0KCglmdW5jdGlvbiBzaWduKHVybCl7CgkJcmV0dXJuIGZ1bmN0aW9uKHAsIGNhbGxiYWNrKXsKCQkJd2l0aFVzZXJJZChmdW5jdGlvbih1c2VyX2lkKXsKCQkJCWNhbGxiYWNrKHVybCsnP3VzZXJfaWQ9Jyt1c2VyX2lkKTsKCQkJfSk7CgkJfTsKCX0KCSovCgp9KShoZWxsbyk7CgovLyBWa29udGFrdGUgKHZrLmNvbSkKKGZ1bmN0aW9uKGhlbGxvKSB7CgoJaGVsbG8uaW5pdCh7CgoJCXZrOiB7CgkJCW5hbWU6ICdWaycsCgoJCQkvLyBTZWUgaHR0cHM6Ly92ay5jb20vZGV2L29hdXRoX2RpYWxvZwoJCQlvYXV0aDogewoJCQkJdmVyc2lvbjogMiwKCQkJCWF1dGg6ICdodHRwczovL29hdXRoLnZrLmNvbS9hdXRob3JpemUnLAoJCQkJZ3JhbnQ6ICdodHRwczovL29hdXRoLnZrLmNvbS9hY2Nlc3NfdG9rZW4nCgkJCX0sCgoJCQkvLyBBdXRob3JpemF0aW9uIHNjb3BlcwoJCQlzY29wZTogewoJCQkJZW1haWw6ICdlbWFpbCcsCgkJCQlvZmZsaW5lX2FjY2VzczogJ29mZmxpbmUnCgkJCX0sCgoJCQkvLyBSZWZyZXNoIHRoZSBhY2Nlc3NfdG9rZW4KCQkJcmVmcmVzaDogdHJ1ZSwKCgkJCWxvZ2luOiBmdW5jdGlvbihwKSB7CgkJCQlwLnFzLmRpc3BsYXkgPSB3aW5kb3cubmF2aWdhdG9yICYmCgkJCQkJd2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQgJiYKCQkJCQkvaXBhZHxwaG9uZXxwaG9uZXxhbmRyb2lkLy50ZXN0KHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkpID8gJ21vYmlsZScgOiAncG9wdXAnOwoJCQl9LAoKCQkJLy8gQVBJIEJhc2UgVVJMCgkJCWJhc2U6ICdodHRwczovL2FwaS52ay5jb20vbWV0aG9kLycsCgoJCQkvLyBNYXAgR0VUIHJlcXVlc3RzCgkJCWdldDogewoJCQkJbWU6IGZ1bmN0aW9uKHAsIGNhbGxiYWNrKSB7CgkJCQkJcC5xdWVyeS5maWVsZHMgPSAnaWQsZmlyc3RfbmFtZSxsYXN0X25hbWUscGhvdG9fbWF4JzsKCQkJCQljYWxsYmFjaygndXNlcnMuZ2V0Jyk7CgkJCQl9CgkJCX0sCgoJCQl3cmFwOiB7CgkJCQltZTogZnVuY3Rpb24ocmVzLCBoZWFkZXJzLCByZXEpIHsKCQkJCQlmb3JtYXRFcnJvcihyZXMpOwoJCQkJCXJldHVybiBmb3JtYXRVc2VyKHJlcywgcmVxKTsKCQkJCX0KCQkJfSwKCgkJCS8vIE5vIFhIUgoJCQl4aHI6IGZhbHNlLAoKCQkJLy8gQWxsIHJlcXVlc3RzIHNob3VsZCBiZSBKU09OUCBhcyBvZiBtaXNzaW5nIENPUlMgaGVhZGVycyBpbiBodHRwczovL2FwaS52ay5jb20vbWV0aG9kLyoKCQkJanNvbnA6IHRydWUsCgoJCQkvLyBObyBmb3JtCgkJCWZvcm06IGZhbHNlCgkJfQoJfSk7CgoJZnVuY3Rpb24gZm9ybWF0VXNlcihvLCByZXEpIHsKCgkJaWYgKG8gIT09IG51bGwgJiYgJ3Jlc3BvbnNlJyBpbiBvICYmIG8ucmVzcG9uc2UgIT09IG51bGwgJiYgby5yZXNwb25zZS5sZW5ndGgpIHsKCQkJbyA9IG8ucmVzcG9uc2VbMF07CgkJCW8uaWQgPSBvLnVpZDsKCQkJby50aHVtYm5haWwgPSBvLnBpY3R1cmUgPSBvLnBob3RvX21heDsKCQkJby5uYW1lID0gby5maXJzdF9uYW1lICsgJyAnICsgby5sYXN0X25hbWU7CgoJCQlpZiAocmVxLmF1dGhSZXNwb25zZSAmJiByZXEuYXV0aFJlc3BvbnNlLmVtYWlsICE9PSBudWxsKQoJCQkJby5lbWFpbCA9IHJlcS5hdXRoUmVzcG9uc2UuZW1haWw7CgkJfQoKCQlyZXR1cm4gbzsKCX0KCglmdW5jdGlvbiBmb3JtYXRFcnJvcihvKSB7CgoJCWlmIChvLmVycm9yKSB7CgkJCXZhciBlID0gby5lcnJvcjsKCQkJby5lcnJvciA9IHsKCQkJCWNvZGU6IGUuZXJyb3JfY29kZSwKCQkJCW1lc3NhZ2U6IGUuZXJyb3JfbXNnCgkJCX07CgkJfQoJfQoKfSkoaGVsbG8pOwoKKGZ1bmN0aW9uKGhlbGxvKSB7CgoJaGVsbG8uaW5pdCh7CgkJd2luZG93czogewoJCQluYW1lOiAnV2luZG93cyBsaXZlJywKCgkJCS8vIFJFRjogaHR0cDovL21zZG4ubWljcm9zb2Z0LmNvbS9lbi11cy9saWJyYXJ5L2hoMjQzNjQxLmFzcHgKCQkJb2F1dGg6IHsKCQkJCXZlcnNpb246IDIsCgkJCQlhdXRoOiAnaHR0cHM6Ly9sb2dpbi5saXZlLmNvbS9vYXV0aDIwX2F1dGhvcml6ZS5zcmYnLAoJCQkJZ3JhbnQ6ICdodHRwczovL2xvZ2luLmxpdmUuY29tL29hdXRoMjBfdG9rZW4uc3JmJwoJCQl9LAoKCQkJLy8gUmVmcmVzaCB0aGUgYWNjZXNzX3Rva2VuIG9uY2UgZXhwaXJlZAoJCQlyZWZyZXNoOiB0cnVlLAoKCQkJbG9nb3V0OiBmdW5jdGlvbigpIHsKCQkJCXJldHVybiAnaHR0cDovL2xvZ2luLmxpdmUuY29tL29hdXRoMjBfbG9nb3V0LnNyZj90cz0nICsgKG5ldyBEYXRlKCkpLmdldFRpbWUoKTsKCQkJfSwKCgkJCS8vIEF1dGhvcml6YXRpb24gc2NvcGVzCgkJCXNjb3BlOiB7CgkJCQliYXNpYzogJ3dsLnNpZ25pbix3bC5iYXNpYycsCgkJCQllbWFpbDogJ3dsLmVtYWlscycsCgkJCQliaXJ0aGRheTogJ3dsLmJpcnRoZGF5JywKCQkJCWV2ZW50czogJ3dsLmNhbGVuZGFycycsCgkJCQlwaG90b3M6ICd3bC5waG90b3MnLAoJCQkJdmlkZW9zOiAnd2wucGhvdG9zJywKCQkJCWZyaWVuZHM6ICd3bC5jb250YWN0c19lbWFpbHMnLAoJCQkJZmlsZXM6ICd3bC5za3lkcml2ZScsCgkJCQlwdWJsaXNoOiAnd2wuc2hhcmUnLAoJCQkJcHVibGlzaF9maWxlczogJ3dsLnNreWRyaXZlX3VwZGF0ZScsCgkJCQljcmVhdGVfZXZlbnQ6ICd3bC5jYWxlbmRhcnNfdXBkYXRlLHdsLmV2ZW50c19jcmVhdGUnLAoJCQkJb2ZmbGluZV9hY2Nlc3M6ICd3bC5vZmZsaW5lX2FjY2VzcycKCQkJfSwKCgkJCS8vIEFQSSBiYXNlIFVSTAoJCQliYXNlOiAnaHR0cHM6Ly9hcGlzLmxpdmUubmV0L3Y1LjAvJywKCgkJCS8vIE1hcCBHRVQgcmVxdWVzdHMKCQkJZ2V0OiB7CgoJCQkJLy8gRnJpZW5kcwoJCQkJbWU6ICdtZScsCgkJCQknbWUvZnJpZW5kcyc6ICdtZS9mcmllbmRzJywKCQkJCSdtZS9mb2xsb3dpbmcnOiAnbWUvY29udGFjdHMnLAoJCQkJJ21lL2ZvbGxvd2Vycyc6ICdtZS9mcmllbmRzJywKCQkJCSdtZS9jb250YWN0cyc6ICdtZS9jb250YWN0cycsCgoJCQkJJ21lL2FsYnVtcyc6ICdtZS9hbGJ1bXMnLAoKCQkJCS8vIEluY2x1ZGUgdGhlIGRhdGFbaWRdIGluIHRoZSBwYXRoCgkJCQknbWUvYWxidW0nOiAnQHtpZH0vZmlsZXMnLAoJCQkJJ21lL3Bob3RvJzogJ0B7aWR9JywKCgkJCQkvLyBGaWxlcwoJCQkJJ21lL2ZpbGVzJzogJ0B7cGFyZW50fG1lL3NreWRyaXZlfS9maWxlcycsCgkJCQknbWUvZm9sZGVycyc6ICdAe2lkfG1lL3NreWRyaXZlfS9maWxlcycsCgkJCQknbWUvZm9sZGVyJzogJ0B7aWR8bWUvc2t5ZHJpdmV9L2ZpbGVzJwoJCQl9LAoKCQkJLy8gTWFwIFBPU1QgcmVxdWVzdHMKCQkJcG9zdDogewoJCQkJJ21lL2FsYnVtcyc6ICdtZS9hbGJ1bXMnLAoJCQkJJ21lL2FsYnVtJzogJ0B7aWR9L2ZpbGVzLycsCgoJCQkJJ21lL2ZvbGRlcnMnOiAnQHtpZHxtZS9za3lkcml2ZS99JywKCQkJCSdtZS9maWxlcyc6ICdAe3BhcmVudHxtZS9za3lkcml2ZX0vZmlsZXMnCgkJCX0sCgoJCQkvLyBNYXAgREVMRVRFIHJlcXVlc3RzCgkJCWRlbDogewoJCQkJLy8gSW5jbHVkZSB0aGUgZGF0YVtpZF0gaW4gdGhlIHBhdGgKCQkJCSdtZS9hbGJ1bSc6ICdAe2lkfScsCgkJCQknbWUvcGhvdG8nOiAnQHtpZH0nLAoJCQkJJ21lL2ZvbGRlcic6ICdAe2lkfScsCgkJCQknbWUvZmlsZXMnOiAnQHtpZH0nCgkJCX0sCgoJCQl3cmFwOiB7CgkJCQltZTogZm9ybWF0VXNlciwKCgkJCQknbWUvZnJpZW5kcyc6IGZvcm1hdEZyaWVuZHMsCgkJCQknbWUvY29udGFjdHMnOiBmb3JtYXRGcmllbmRzLAoJCQkJJ21lL2ZvbGxvd2Vycyc6IGZvcm1hdEZyaWVuZHMsCgkJCQknbWUvZm9sbG93aW5nJzogZm9ybWF0RnJpZW5kcywKCQkJCSdtZS9hbGJ1bXMnOiBmb3JtYXRBbGJ1bXMsCgkJCQknbWUvcGhvdG9zJzogZm9ybWF0RGVmYXVsdCwKCQkJCSdkZWZhdWx0JzogZm9ybWF0RGVmYXVsdAoJCQl9LAoKCQkJeGhyOiBmdW5jdGlvbihwKSB7CgkJCQlpZiAocC5tZXRob2QgIT09ICdnZXQnICYmIHAubWV0aG9kICE9PSAnZGVsZXRlJyAmJiAhaGVsbG8udXRpbHMuaGFzQmluYXJ5KHAuZGF0YSkpIHsKCgkJCQkJLy8gRG9lcyB0aGlzIGhhdmUgYSBkYXRhLXVyaSB0byB1cGxvYWQgYXMgYSBmaWxlPwoJCQkJCWlmICh0eXBlb2YgKHAuZGF0YS5maWxlKSA9PT0gJ3N0cmluZycpIHsKCQkJCQkJcC5kYXRhLmZpbGUgPSBoZWxsby51dGlscy50b0Jsb2IocC5kYXRhLmZpbGUpOwoJCQkJCX0KCQkJCQllbHNlIHsKCQkJCQkJcC5kYXRhID0gSlNPTi5zdHJpbmdpZnkocC5kYXRhKTsKCQkJCQkJcC5oZWFkZXJzID0gewoJCQkJCQkJJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJwoJCQkJCQl9OwoJCQkJCX0KCQkJCX0KCgkJCQlyZXR1cm4gdHJ1ZTsKCQkJfSwKCgkJCWpzb25wOiBmdW5jdGlvbihwKSB7CgkJCQlpZiAocC5tZXRob2QgIT09ICdnZXQnICYmICFoZWxsby51dGlscy5oYXNCaW5hcnkocC5kYXRhKSkgewoJCQkJCXAuZGF0YS5tZXRob2QgPSBwLm1ldGhvZDsKCQkJCQlwLm1ldGhvZCA9ICdnZXQnOwoJCQkJfQoJCQl9CgkJfQoJfSk7CgoJZnVuY3Rpb24gZm9ybWF0RGVmYXVsdChvKSB7CgkJaWYgKCdkYXRhJyBpbiBvKSB7CgkJCW8uZGF0YS5mb3JFYWNoKGZ1bmN0aW9uKGQpIHsKCQkJCWlmIChkLnBpY3R1cmUpIHsKCQkJCQlkLnRodW1ibmFpbCA9IGQucGljdHVyZTsKCQkJCX0KCgkJCQlpZiAoZC5pbWFnZXMpIHsKCQkJCQlkLnBpY3R1cmVzID0gZC5pbWFnZXMKCQkJCQkJLm1hcChmb3JtYXRJbWFnZSkKCQkJCQkJLnNvcnQoZnVuY3Rpb24oYSwgYikgewoJCQkJCQkJcmV0dXJuIGEud2lkdGggLSBiLndpZHRoOwoJCQkJCQl9KTsKCQkJCX0KCQkJfSk7CgkJfQoKCQlyZXR1cm4gbzsKCX0KCglmdW5jdGlvbiBmb3JtYXRJbWFnZShpbWFnZSkgewoJCXJldHVybiB7CgkJCXdpZHRoOiBpbWFnZS53aWR0aCwKCQkJaGVpZ2h0OiBpbWFnZS5oZWlnaHQsCgkJCXNvdXJjZTogaW1hZ2Uuc291cmNlCgkJfTsKCX0KCglmdW5jdGlvbiBmb3JtYXRBbGJ1bXMobykgewoJCWlmICgnZGF0YScgaW4gbykgewoJCQlvLmRhdGEuZm9yRWFjaChmdW5jdGlvbihkKSB7CgkJCQlkLnBob3RvcyA9IGQuZmlsZXMgPSAnaHR0cHM6Ly9hcGlzLmxpdmUubmV0L3Y1LjAvJyArIGQuaWQgKyAnL3Bob3Rvcyc7CgkJCX0pOwoJCX0KCgkJcmV0dXJuIG87Cgl9CgoJZnVuY3Rpb24gZm9ybWF0VXNlcihvLCBoZWFkZXJzLCByZXEpIHsKCQlpZiAoby5pZCkgewoJCQl2YXIgdG9rZW4gPSByZXEucXVlcnkuYWNjZXNzX3Rva2VuOwoJCQlpZiAoby5lbWFpbHMpIHsKCQkJCW8uZW1haWwgPSBvLmVtYWlscy5wcmVmZXJyZWQ7CgkJCX0KCgkJCS8vIElmIHRoaXMgaXMgbm90IGFuIG5vbi1uZXR3b3JrIGZyaWVuZAoJCQlpZiAoby5pc19mcmllbmQgIT09IGZhbHNlKSB7CgkJCQkvLyBVc2UgdGhlIGlkIG9mIHRoZSB1c2VyX2lkIGlmIGF2YWlsYWJsZQoJCQkJdmFyIGlkID0gKG8udXNlcl9pZCB8fCBvLmlkKTsKCQkJCW8udGh1bWJuYWlsID0gby5waWN0dXJlID0gJ2h0dHBzOi8vYXBpcy5saXZlLm5ldC92NS4wLycgKyBpZCArICcvcGljdHVyZT9hY2Nlc3NfdG9rZW49JyArIHRva2VuOwoJCQl9CgkJfQoKCQlyZXR1cm4gbzsKCX0KCglmdW5jdGlvbiBmb3JtYXRGcmllbmRzKG8sIGhlYWRlcnMsIHJlcSkgewoJCWlmICgnZGF0YScgaW4gbykgewoJCQlvLmRhdGEuZm9yRWFjaChmdW5jdGlvbihkKSB7CgkJCQlmb3JtYXRVc2VyKGQsIGhlYWRlcnMsIHJlcSk7CgkJCX0pOwoJCX0KCgkJcmV0dXJuIG87Cgl9Cgp9KShoZWxsbyk7CgooZnVuY3Rpb24oaGVsbG8pIHsKCgloZWxsby5pbml0KHsKCgkJeWFob286IHsKCgkJCS8vIEVuc3VyZSB0aGF0IHlvdSBkZWZpbmUgYW4gb2F1dGhfcHJveHkKCQkJb2F1dGg6IHsKCQkJCXZlcnNpb246ICcxLjBhJywKCQkJCWF1dGg6ICdodHRwczovL2FwaS5sb2dpbi55YWhvby5jb20vb2F1dGgvdjIvcmVxdWVzdF9hdXRoJywKCQkJCXJlcXVlc3Q6ICdodHRwczovL2FwaS5sb2dpbi55YWhvby5jb20vb2F1dGgvdjIvZ2V0X3JlcXVlc3RfdG9rZW4nLAoJCQkJdG9rZW46ICdodHRwczovL2FwaS5sb2dpbi55YWhvby5jb20vb2F1dGgvdjIvZ2V0X3Rva2VuJwoJCQl9LAoKCQkJLy8gTG9naW4gaGFuZGxlcgoJCQlsb2dpbjogZnVuY3Rpb24ocCkgewoJCQkJLy8gQ2hhbmdlIHRoZSBkZWZhdWx0IHBvcHVwIHdpbmRvdyB0byBiZSBhdCBsZWFzdCA1NjAKCQkJCS8vIFlhaG9vIGRvZXMgZHluYW1pY2FsbHkgY2hhbmdlIGl0IG9uIHRoZSBmbHkgZm9yIHRoZSBzaWduaW4gc2NyZWVuIChvbmx5LCB3aGF0IGlmIHlvdXIgYWxyZWFkeSBzaWduZWQgaW4pCgkJCQlwLm9wdGlvbnMucG9wdXAud2lkdGggPSA1NjA7CgoJCQkJLy8gWWFob28gdGhyb3dzIGFuIHBhcmFtZXRlciBlcnJvciBpZiBmb3Igd2hhdGV2ZXIgcmVhc29uIHRoZSBzdGF0ZS5zY29wZSBjb250YWlucyBhIGNvbW1hLCBzbyBsZXRzIHJlbW92ZSBzY29wZQoJCQkJdHJ5IHtkZWxldGUgcC5xcy5zdGF0ZS5zY29wZTt9CgkJCQljYXRjaCAoZSkge30KCQkJfSwKCgkJCWJhc2U6ICdodHRwczovL3NvY2lhbC55YWhvb2FwaXMuY29tL3YxLycsCgoJCQlnZXQ6IHsKCQkJCW1lOiB5cWwoJ3NlbGVjdCAqIGZyb20gc29jaWFsLnByb2ZpbGUoMCkgd2hlcmUgZ3VpZD1tZScpLAoJCQkJJ21lL2ZyaWVuZHMnOiB5cWwoJ3NlbGVjdCAqIGZyb20gc29jaWFsLmNvbnRhY3RzKDApIHdoZXJlIGd1aWQ9bWUnKSwKCQkJCSdtZS9mb2xsb3dpbmcnOiB5cWwoJ3NlbGVjdCAqIGZyb20gc29jaWFsLmNvbnRhY3RzKDApIHdoZXJlIGd1aWQ9bWUnKQoJCQl9LAoJCQl3cmFwOiB7CgkJCQltZTogZm9ybWF0VXNlciwKCgkJCQkvLyBDYW4ndCBnZXQgSURzCgkJCQkvLyBJdCBtaWdodCBiZSBiZXR0ZXIgdG8gbG9vcCB0aHJvdWdoIHRoZSBzb2NpYWwucmVsYXRpb25zaGlwIHRhYmxlIHdpdGggaGFzIHVuaXF1ZSBJRHMgb2YgdXNlcnMuCgkJCQknbWUvZnJpZW5kcyc6IGZvcm1hdEZyaWVuZHMsCgkJCQknbWUvZm9sbG93aW5nJzogZm9ybWF0RnJpZW5kcywKCQkJCSdkZWZhdWx0JzogcGFnaW5nCgkJCX0KCQl9Cgl9KTsKCgkvKgoJCS8vIEF1dG8tcmVmcmVzaCBmaXg6IGJ1ZyBpbiBZYWhvbyBjYW4ndCBnZXQgdGhpcyB0byB3b3JrIHdpdGggbm9kZS1vYXV0aC1zaGltCgkJbG9naW4gOiBmdW5jdGlvbihvKXsKCQkJLy8gSXMgdGhlIHVzZXIgYWxyZWFkeSBsb2dnZWQgaW4KCQkJdmFyIGF1dGggPSBoZWxsbygneWFob28nKS5nZXRBdXRoUmVzcG9uc2UoKTsKCgkJCS8vIElzIHRoaXMgYSByZWZyZXNoIHRva2VuPwoJCQlpZihvLm9wdGlvbnMuZGlzcGxheT09PSdub25lJyYmYXV0aCYmYXV0aC5hY2Nlc3NfdG9rZW4mJmF1dGgucmVmcmVzaF90b2tlbil7CgkJCQkvLyBBZGQgdGhlIG9sZCB0b2tlbiBhbmQgdGhlIHJlZnJlc2ggdG9rZW4sIGluY2x1ZGluZyBwYXRoIHRvIHRoZSBxdWVyeQoJCQkJLy8gU2VlIGh0dHA6Ly9kZXZlbG9wZXIueWFob28uY29tL29hdXRoL2d1aWRlL29hdXRoLXJlZnJlc2hhY2Nlc3N0b2tlbi5odG1sCgkJCQlvLnFzLmFjY2Vzc190b2tlbiA9IGF1dGguYWNjZXNzX3Rva2VuOwoJCQkJby5xcy5yZWZyZXNoX3Rva2VuID0gYXV0aC5yZWZyZXNoX3Rva2VuOwoJCQkJby5xcy50b2tlbl91cmwgPSAnaHR0cHM6Ly9hcGkubG9naW4ueWFob28uY29tL29hdXRoL3YyL2dldF90b2tlbic7CgkJCX0KCQl9LAoJKi8KCglmdW5jdGlvbiBmb3JtYXRFcnJvcihvKSB7CgkJaWYgKG8gJiYgJ21ldGEnIGluIG8gJiYgJ2Vycm9yX3R5cGUnIGluIG8ubWV0YSkgewoJCQlvLmVycm9yID0gewoJCQkJY29kZTogby5tZXRhLmVycm9yX3R5cGUsCgkJCQltZXNzYWdlOiBvLm1ldGEuZXJyb3JfbWVzc2FnZQoJCQl9OwoJCX0KCX0KCglmdW5jdGlvbiBmb3JtYXRVc2VyKG8pIHsKCgkJZm9ybWF0RXJyb3Iobyk7CgkJaWYgKG8ucXVlcnkgJiYgby5xdWVyeS5yZXN1bHRzICYmIG8ucXVlcnkucmVzdWx0cy5wcm9maWxlKSB7CgkJCW8gPSBvLnF1ZXJ5LnJlc3VsdHMucHJvZmlsZTsKCQkJby5pZCA9IG8uZ3VpZDsKCQkJby5sYXN0X25hbWUgPSBvLmZhbWlseU5hbWU7CgkJCW8uZmlyc3RfbmFtZSA9IG8uZ2l2ZW5OYW1lIHx8IG8ubmlja25hbWU7CgkJCXZhciBhID0gW107CgkJCWlmIChvLmZpcnN0X25hbWUpIHsKCQkJCWEucHVzaChvLmZpcnN0X25hbWUpOwoJCQl9CgoJCQlpZiAoby5sYXN0X25hbWUpIHsKCQkJCWEucHVzaChvLmxhc3RfbmFtZSk7CgkJCX0KCgkJCW8ubmFtZSA9IGEuam9pbignICcpOwoJCQlvLmVtYWlsID0gKG8uZW1haWxzICYmIG8uZW1haWxzWzBdKSA/IG8uZW1haWxzWzBdLmhhbmRsZSA6IG51bGw7CgkJCW8udGh1bWJuYWlsID0gby5pbWFnZSA/IG8uaW1hZ2UuaW1hZ2VVcmwgOiBudWxsOwoJCX0KCgkJcmV0dXJuIG87Cgl9CgoJZnVuY3Rpb24gZm9ybWF0RnJpZW5kcyhvLCBoZWFkZXJzLCByZXF1ZXN0KSB7CgkJZm9ybWF0RXJyb3Iobyk7CgkJcGFnaW5nKG8sIGhlYWRlcnMsIHJlcXVlc3QpOwoJCXZhciBjb250YWN0OwoJCXZhciBmaWVsZDsKCQlpZiAoby5xdWVyeSAmJiBvLnF1ZXJ5LnJlc3VsdHMgJiYgby5xdWVyeS5yZXN1bHRzLmNvbnRhY3QpIHsKCQkJby5kYXRhID0gby5xdWVyeS5yZXN1bHRzLmNvbnRhY3Q7CgkJCWRlbGV0ZSBvLnF1ZXJ5OwoKCQkJaWYgKCFBcnJheS5pc0FycmF5KG8uZGF0YSkpIHsKCQkJCW8uZGF0YSA9IFtvLmRhdGFdOwoJCQl9CgoJCQlvLmRhdGEuZm9yRWFjaChmb3JtYXRGcmllbmQpOwoJCX0KCgkJcmV0dXJuIG87Cgl9CgoJZnVuY3Rpb24gZm9ybWF0RnJpZW5kKGNvbnRhY3QpIHsKCQljb250YWN0LmlkID0gbnVsbDsKCgkJLy8gIzM2MjogUmVwb3J0cyBvZiByZXNwb25zZXMgcmV0dXJuaW5nIGEgc2luZ2xlIGl0ZW0sIHJhdGhlciB0aGFuIGFuIEFycmF5IG9mIGl0ZW1zLgoJCS8vIEZvcm1hdCB0aGUgY29udGFjdC5maWVsZHMgdG8gYmUgYW4gYXJyYXkuCgkJaWYgKGNvbnRhY3QuZmllbGRzICYmICEoY29udGFjdC5maWVsZHMgaW5zdGFuY2VvZiBBcnJheSkpIHsKCQkJY29udGFjdC5maWVsZHMgPSBbY29udGFjdC5maWVsZHNdOwoJCX0KCgkJKGNvbnRhY3QuZmllbGRzIHx8IFtdKS5mb3JFYWNoKGZ1bmN0aW9uKGZpZWxkKSB7CgkJCWlmIChmaWVsZC50eXBlID09PSAnZW1haWwnKSB7CgkJCQljb250YWN0LmVtYWlsID0gZmllbGQudmFsdWU7CgkJCX0KCgkJCWlmIChmaWVsZC50eXBlID09PSAnbmFtZScpIHsKCQkJCWNvbnRhY3QuZmlyc3RfbmFtZSA9IGZpZWxkLnZhbHVlLmdpdmVuTmFtZTsKCQkJCWNvbnRhY3QubGFzdF9uYW1lID0gZmllbGQudmFsdWUuZmFtaWx5TmFtZTsKCQkJCWNvbnRhY3QubmFtZSA9IGZpZWxkLnZhbHVlLmdpdmVuTmFtZSArICcgJyArIGZpZWxkLnZhbHVlLmZhbWlseU5hbWU7CgkJCX0KCgkJCWlmIChmaWVsZC50eXBlID09PSAneWFob29pZCcpIHsKCQkJCWNvbnRhY3QuaWQgPSBmaWVsZC52YWx1ZTsKCQkJfQoJCX0pOwoJfQoKCWZ1bmN0aW9uIHBhZ2luZyhyZXMsIGhlYWRlcnMsIHJlcXVlc3QpIHsKCgkJLy8gU2VlOiBodHRwOi8vZGV2ZWxvcGVyLnlhaG9vLmNvbS95cWwvZ3VpZGUvcGFnaW5nLmh0bWwjbG9jYWxfbGltaXRzCgkJaWYgKHJlcy5xdWVyeSAmJiByZXMucXVlcnkuY291bnQgJiYgcmVxdWVzdC5vcHRpb25zKSB7CgkJCXJlcy5wYWdpbmcgPSB7CgkJCQluZXh0OiAnP3N0YXJ0PScgKyAocmVzLnF1ZXJ5LmNvdW50ICsgKCtyZXF1ZXN0Lm9wdGlvbnMuc3RhcnQgfHwgMSkpCgkJCX07CgkJfQoKCQlyZXR1cm4gcmVzOwoJfQoKCWZ1bmN0aW9uIHlxbChxKSB7CgkJcmV0dXJuICdodHRwczovL3F1ZXJ5LnlhaG9vYXBpcy5jb20vdjEveXFsP3E9JyArIChxICsgJyBsaW1pdCBAe2xpbWl0fDEwMH0gb2Zmc2V0IEB7c3RhcnR8MH0nKS5yZXBsYWNlKC9ccy9nLCAnJTIwJykgKyAnJmZvcm1hdD1qc29uJzsKCX0KCn0pKGhlbGxvKTsKCi8vIFJlZ2lzdGVyIGFzIGFub255bW91cyBBTUQgbW9kdWxlCmlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHsKCWRlZmluZShmdW5jdGlvbigpIHsKCQlyZXR1cm4gaGVsbG87Cgl9KTsKfQoKLy8gQ29tbW9uSlMgbW9kdWxlIGZvciBicm93c2VyaWZ5CmlmICh0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0JyAmJiBtb2R1bGUuZXhwb3J0cykgewoJbW9kdWxlLmV4cG9ydHMgPSBoZWxsbzsKfQoKfSkuY2FsbCh0aGlzLHJlcXVpcmUoJ19wcm9jZXNzJykpCn0seyJfcHJvY2VzcyI6MTA4fV0sMTA4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy8gc2hpbSBmb3IgdXNpbmcgcHJvY2VzcyBpbiBicm93c2VyCgp2YXIgcHJvY2VzcyA9IG1vZHVsZS5leHBvcnRzID0ge307CnZhciBxdWV1ZSA9IFtdOwp2YXIgZHJhaW5pbmcgPSBmYWxzZTsKdmFyIGN1cnJlbnRRdWV1ZTsKdmFyIHF1ZXVlSW5kZXggPSAtMTsKCmZ1bmN0aW9uIGNsZWFuVXBOZXh0VGljaygpIHsKICAgIGRyYWluaW5nID0gZmFsc2U7CiAgICBpZiAoY3VycmVudFF1ZXVlLmxlbmd0aCkgewogICAgICAgIHF1ZXVlID0gY3VycmVudFF1ZXVlLmNvbmNhdChxdWV1ZSk7CiAgICB9IGVsc2UgewogICAgICAgIHF1ZXVlSW5kZXggPSAtMTsKICAgIH0KICAgIGlmIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgICBkcmFpblF1ZXVlKCk7CiAgICB9Cn0KCmZ1bmN0aW9uIGRyYWluUXVldWUoKSB7CiAgICBpZiAoZHJhaW5pbmcpIHsKICAgICAgICByZXR1cm47CiAgICB9CiAgICB2YXIgdGltZW91dCA9IHNldFRpbWVvdXQoY2xlYW5VcE5leHRUaWNrKTsKICAgIGRyYWluaW5nID0gdHJ1ZTsKCiAgICB2YXIgbGVuID0gcXVldWUubGVuZ3RoOwogICAgd2hpbGUobGVuKSB7CiAgICAgICAgY3VycmVudFF1ZXVlID0gcXVldWU7CiAgICAgICAgcXVldWUgPSBbXTsKICAgICAgICB3aGlsZSAoKytxdWV1ZUluZGV4IDwgbGVuKSB7CiAgICAgICAgICAgIGlmIChjdXJyZW50UXVldWUpIHsKICAgICAgICAgICAgICAgIGN1cnJlbnRRdWV1ZVtxdWV1ZUluZGV4XS5ydW4oKTsKICAgICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBxdWV1ZUluZGV4ID0gLTE7CiAgICAgICAgbGVuID0gcXVldWUubGVuZ3RoOwogICAgfQogICAgY3VycmVudFF1ZXVlID0gbnVsbDsKICAgIGRyYWluaW5nID0gZmFsc2U7CiAgICBjbGVhclRpbWVvdXQodGltZW91dCk7Cn0KCnByb2Nlc3MubmV4dFRpY2sgPSBmdW5jdGlvbiAoZnVuKSB7CiAgICB2YXIgYXJncyA9IG5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoIC0gMSk7CiAgICBpZiAoYXJndW1lbnRzLmxlbmd0aCA+IDEpIHsKICAgICAgICBmb3IgKHZhciBpID0gMTsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBhcmdzW2kgLSAxXSA9IGFyZ3VtZW50c1tpXTsKICAgICAgICB9CiAgICB9CiAgICBxdWV1ZS5wdXNoKG5ldyBJdGVtKGZ1biwgYXJncykpOwogICAgaWYgKHF1ZXVlLmxlbmd0aCA9PT0gMSAmJiAhZHJhaW5pbmcpIHsKICAgICAgICBzZXRUaW1lb3V0KGRyYWluUXVldWUsIDApOwogICAgfQp9OwoKLy8gdjggbGlrZXMgcHJlZGljdGlibGUgb2JqZWN0cwpmdW5jdGlvbiBJdGVtKGZ1biwgYXJyYXkpIHsKICAgIHRoaXMuZnVuID0gZnVuOwogICAgdGhpcy5hcnJheSA9IGFycmF5Owp9Ckl0ZW0ucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHsKICAgIHRoaXMuZnVuLmFwcGx5KG51bGwsIHRoaXMuYXJyYXkpOwp9Owpwcm9jZXNzLnRpdGxlID0gJ2Jyb3dzZXInOwpwcm9jZXNzLmJyb3dzZXIgPSB0cnVlOwpwcm9jZXNzLmVudiA9IHt9Owpwcm9jZXNzLmFyZ3YgPSBbXTsKcHJvY2Vzcy52ZXJzaW9uID0gJyc7IC8vIGVtcHR5IHN0cmluZyB0byBhdm9pZCByZWdleHAgaXNzdWVzCnByb2Nlc3MudmVyc2lvbnMgPSB7fTsKCmZ1bmN0aW9uIG5vb3AoKSB7fQoKcHJvY2Vzcy5vbiA9IG5vb3A7CnByb2Nlc3MuYWRkTGlzdGVuZXIgPSBub29wOwpwcm9jZXNzLm9uY2UgPSBub29wOwpwcm9jZXNzLm9mZiA9IG5vb3A7CnByb2Nlc3MucmVtb3ZlTGlzdGVuZXIgPSBub29wOwpwcm9jZXNzLnJlbW92ZUFsbExpc3RlbmVycyA9IG5vb3A7CnByb2Nlc3MuZW1pdCA9IG5vb3A7Cgpwcm9jZXNzLmJpbmRpbmcgPSBmdW5jdGlvbiAobmFtZSkgewogICAgdGhyb3cgbmV3IEVycm9yKCdwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZCcpOwp9OwoKcHJvY2Vzcy5jd2QgPSBmdW5jdGlvbiAoKSB7IHJldHVybiAnLycgfTsKcHJvY2Vzcy5jaGRpciA9IGZ1bmN0aW9uIChkaXIpIHsKICAgIHRocm93IG5ldyBFcnJvcigncHJvY2Vzcy5jaGRpciBpcyBub3Qgc3VwcG9ydGVkJyk7Cn07CnByb2Nlc3MudW1hc2sgPSBmdW5jdGlvbigpIHsgcmV0dXJuIDA7IH07Cgp9LHt9XSwxMDk6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewooZnVuY3Rpb24gKGdsb2JhbCl7Ci8vIFNlcnZpY2UgRnJhbWV3b3JrIAoKLy8gdmVyc2lvbjogMC4xLjAKCiFmdW5jdGlvbihlKXtpZigib2JqZWN0Ij09dHlwZW9mIGV4cG9ydHMmJiJ1bmRlZmluZWQiIT10eXBlb2YgbW9kdWxlKW1vZHVsZS5leHBvcnRzPWUoKTtlbHNlIGlmKCJmdW5jdGlvbiI9PXR5cGVvZiBkZWZpbmUmJmRlZmluZS5hbWQpZGVmaW5lKFtdLGUpO2Vsc2V7dmFyIHQ7dD0idW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdz93aW5kb3c6InVuZGVmaW5lZCIhPXR5cGVvZiBnbG9iYWw/Z2xvYmFsOiJ1bmRlZmluZWQiIT10eXBlb2Ygc2VsZj9zZWxmOnRoaXMsdC5zZXJ2aWNlRnJhbWV3b3JrPWUoKX19KGZ1bmN0aW9uKCl7dmFyIGU7cmV0dXJuIGZ1bmN0aW9uIHQoZSxyLG4pe2Z1bmN0aW9uIG8oYSxzKXtpZighclthXSl7aWYoIWVbYV0pe3ZhciB1PSJmdW5jdGlvbiI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFzJiZ1KXJldHVybiB1KGEsITApO2lmKGkpcmV0dXJuIGkoYSwhMCk7dmFyIGM9bmV3IEVycm9yKCJDYW5ub3QgZmluZCBtb2R1bGUgJyIrYSsiJyIpO3Rocm93IGMuY29kZT0iTU9EVUxFX05PVF9GT1VORCIsY312YXIgbD1yW2FdPXtleHBvcnRzOnt9fTtlW2FdWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKHQpe3ZhciByPWVbYV1bMV1bdF07cmV0dXJuIG8ocj9yOnQpfSxsLGwuZXhwb3J0cyx0LGUscixuKX1yZXR1cm4gclthXS5leHBvcnRzfWZvcih2YXIgaT0iZnVuY3Rpb24iPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZSxhPTA7YTxuLmxlbmd0aDthKyspbyhuW2FdKTtyZXR1cm4gb30oezE6W2Z1bmN0aW9uKGUsdCxyKXt0LmV4cG9ydHM9eyJkZWZhdWx0IjplKCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2NyZWF0ZSIpLF9fZXNNb2R1bGU6ITB9fSx7ImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvY3JlYXRlIjoyMn1dLDI6W2Z1bmN0aW9uKGUsdCxyKXt0LmV4cG9ydHM9eyJkZWZhdWx0IjplKCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2RlZmluZS1wcm9wZXJ0eSIpLF9fZXNNb2R1bGU6ITB9fSx7ImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZGVmaW5lLXByb3BlcnR5IjoyM31dLDM6W2Z1bmN0aW9uKGUsdCxyKXt0LmV4cG9ydHM9eyJkZWZhdWx0IjplKCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2ZyZWV6ZSIpLF9fZXNNb2R1bGU6ITB9fSx7ImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZnJlZXplIjoyNH1dLDQ6W2Z1bmN0aW9uKGUsdCxyKXt0LmV4cG9ydHM9eyJkZWZhdWx0IjplKCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2dldC1vd24tcHJvcGVydHktZGVzY3JpcHRvciIpLF9fZXNNb2R1bGU6ITB9fSx7ImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjoyNX1dLDU6W2Z1bmN0aW9uKGUsdCxyKXt0LmV4cG9ydHM9eyJkZWZhdWx0IjplKCJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2dldC1wcm90b3R5cGUtb2YiKSxfX2VzTW9kdWxlOiEwfX0seyJjb3JlLWpzL2xpYnJhcnkvZm4vb2JqZWN0L2dldC1wcm90b3R5cGUtb2YiOjI2fV0sNjpbZnVuY3Rpb24oZSx0LHIpe3QuZXhwb3J0cz17ImRlZmF1bHQiOmUoImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3Qva2V5cyIpLF9fZXNNb2R1bGU6ITB9fSx7ImNvcmUtanMvbGlicmFyeS9mbi9vYmplY3Qva2V5cyI6Mjd9XSw3OltmdW5jdGlvbihlLHQscil7dC5leHBvcnRzPXsiZGVmYXVsdCI6ZSgiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9zZXQtcHJvdG90eXBlLW9mIiksX19lc01vZHVsZTohMH19LHsiY29yZS1qcy9saWJyYXJ5L2ZuL29iamVjdC9zZXQtcHJvdG90eXBlLW9mIjoyOH1dLDg6W2Z1bmN0aW9uKGUsdCxyKXt0LmV4cG9ydHM9eyJkZWZhdWx0IjplKCJjb3JlLWpzL2xpYnJhcnkvZm4vcHJvbWlzZSIpLF9fZXNNb2R1bGU6ITB9fSx7ImNvcmUtanMvbGlicmFyeS9mbi9wcm9taXNlIjoyOX1dLDk6W2Z1bmN0aW9uKGUsdCxyKXt0LmV4cG9ydHM9eyJkZWZhdWx0IjplKCJjb3JlLWpzL2xpYnJhcnkvZm4vc3ltYm9sIiksX19lc01vZHVsZTohMH19LHsiY29yZS1qcy9saWJyYXJ5L2ZuL3N5bWJvbCI6MzB9XSwxMDpbZnVuY3Rpb24oZSx0LHIpe3QuZXhwb3J0cz17ImRlZmF1bHQiOmUoImNvcmUtanMvbGlicmFyeS9mbi9zeW1ib2wvaXRlcmF0b3IiKSxfX2VzTW9kdWxlOiEwfX0seyJjb3JlLWpzL2xpYnJhcnkvZm4vc3ltYm9sL2l0ZXJhdG9yIjozMX1dLDExOltmdW5jdGlvbihlLHQscil7dC5leHBvcnRzPWUoIi4vY2xhc3NDYWxsQ2hlY2suanMiKX0seyIuL2NsYXNzQ2FsbENoZWNrLmpzIjoxMn1dLDEyOltmdW5jdGlvbihlLHQscil7InVzZSBzdHJpY3QiO3IuX19lc01vZHVsZT0hMCxyWyJkZWZhdWx0Il09ZnVuY3Rpb24oZSx0KXtpZighKGUgaW5zdGFuY2VvZiB0KSl0aHJvdyBuZXcgVHlwZUVycm9yKCJDYW5ub3QgY2FsbCBhIGNsYXNzIGFzIGEgZnVuY3Rpb24iKX19LHt9XSwxMzpbZnVuY3Rpb24oZSx0LHIpe3QuZXhwb3J0cz1lKCIuL2NyZWF0ZUNsYXNzLmpzIil9LHsiLi9jcmVhdGVDbGFzcy5qcyI6MTR9XSwxNDpbZnVuY3Rpb24oZSx0LHIpeyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBuKGUpe3JldHVybiBlJiZlLl9fZXNNb2R1bGU/ZTp7ImRlZmF1bHQiOmV9fXIuX19lc01vZHVsZT0hMDt2YXIgbz1lKCIuLi9jb3JlLWpzL29iamVjdC9kZWZpbmUtcHJvcGVydHkiKSxpPW4obyk7clsiZGVmYXVsdCJdPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZShlLHQpe2Zvcih2YXIgcj0wO3I8dC5sZW5ndGg7cisrKXt2YXIgbj10W3JdO24uZW51bWVyYWJsZT1uLmVudW1lcmFibGV8fCExLG4uY29uZmlndXJhYmxlPSEwLCJ2YWx1ZSJpbiBuJiYobi53cml0YWJsZT0hMCksKDAsaVsiZGVmYXVsdCJdKShlLG4ua2V5LG4pfX1yZXR1cm4gZnVuY3Rpb24odCxyLG4pe3JldHVybiByJiZlKHQucHJvdG90eXBlLHIpLG4mJmUodCxuKSx0fX0oKX0seyIuLi9jb3JlLWpzL29iamVjdC9kZWZpbmUtcHJvcGVydHkiOjJ9XSwxNTpbZnVuY3Rpb24oZSx0LHIpeyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBuKGUpe3JldHVybiBlJiZlLl9fZXNNb2R1bGU/ZTp7ImRlZmF1bHQiOmV9fXIuX19lc01vZHVsZT0hMDt2YXIgbz1lKCIuLi9jb3JlLWpzL29iamVjdC9nZXQtcHJvdG90eXBlLW9mIiksaT1uKG8pLGE9ZSgiLi4vY29yZS1qcy9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIikscz1uKGEpO3JbImRlZmF1bHQiXT1mdW5jdGlvbiB1KGUsdCxyKXtudWxsPT09ZSYmKGU9RnVuY3Rpb24ucHJvdG90eXBlKTt2YXIgbj0oMCxzWyJkZWZhdWx0Il0pKGUsdCk7aWYodm9pZCAwPT09bil7dmFyIG89KDAsaVsiZGVmYXVsdCJdKShlKTtyZXR1cm4gbnVsbD09PW8/dm9pZCAwOnUobyx0LHIpfWlmKCJ2YWx1ZSJpbiBuKXJldHVybiBuLnZhbHVlO3ZhciBhPW4uZ2V0O2lmKHZvaWQgMCE9PWEpcmV0dXJuIGEuY2FsbChyKX19LHsiLi4vY29yZS1qcy9vYmplY3QvZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjo0LCIuLi9jb3JlLWpzL29iamVjdC9nZXQtcHJvdG90eXBlLW9mIjo1fV0sMTY6W2Z1bmN0aW9uKGUsdCxyKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbihlKXtyZXR1cm4gZSYmZS5fX2VzTW9kdWxlP2U6eyJkZWZhdWx0IjplfX1yLl9fZXNNb2R1bGU9ITA7dmFyIG89ZSgiLi4vY29yZS1qcy9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZiIpLGk9bihvKSxhPWUoIi4uL2NvcmUtanMvb2JqZWN0L2NyZWF0ZSIpLHM9bihhKSx1PWUoIi4uL2hlbHBlcnMvdHlwZW9mIiksYz1uKHUpO3JbImRlZmF1bHQiXT1mdW5jdGlvbihlLHQpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiB0JiZudWxsIT09dCl0aHJvdyBuZXcgVHlwZUVycm9yKCJTdXBlciBleHByZXNzaW9uIG11c3QgZWl0aGVyIGJlIG51bGwgb3IgYSBmdW5jdGlvbiwgbm90ICIrKCJ1bmRlZmluZWQiPT10eXBlb2YgdD8idW5kZWZpbmVkIjooMCxjWyJkZWZhdWx0Il0pKHQpKSk7ZS5wcm90b3R5cGU9KDAsc1siZGVmYXVsdCJdKSh0JiZ0LnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOmUsZW51bWVyYWJsZTohMSx3cml0YWJsZTohMCxjb25maWd1cmFibGU6ITB9fSksdCYmKGlbImRlZmF1bHQiXT8oMCxpWyJkZWZhdWx0Il0pKGUsdCk6ZS5fX3Byb3RvX189dCl9fSx7Ii4uL2NvcmUtanMvb2JqZWN0L2NyZWF0ZSI6MSwiLi4vY29yZS1qcy9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZiI6NywiLi4vaGVscGVycy90eXBlb2YiOjE5fV0sMTc6W2Z1bmN0aW9uKGUsdCxyKXt0LmV4cG9ydHM9ZSgiLi9pbnRlcm9wUmVxdWlyZURlZmF1bHQuanMiKX0seyIuL2ludGVyb3BSZXF1aXJlRGVmYXVsdC5qcyI6MTh9XSwxODpbZnVuY3Rpb24oZSx0LHIpeyJ1c2Ugc3RyaWN0IjtyLl9fZXNNb2R1bGU9ITAsclsiZGVmYXVsdCJdPWZ1bmN0aW9uKGUpe3JldHVybiBlJiZlLl9fZXNNb2R1bGU/ZTp7ImRlZmF1bHQiOmV9fX0se31dLDE5OltmdW5jdGlvbihlLHQscil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG4oZSl7cmV0dXJuIGUmJmUuX19lc01vZHVsZT9lOnsiZGVmYXVsdCI6ZX19dmFyIG89ImZ1bmN0aW9uIj09dHlwZW9mIF9TeW1ib2wmJiJzeW1ib2wiPT10eXBlb2YgX1N5bWJvbCRpdGVyYXRvcj9mdW5jdGlvbihlKXtyZXR1cm4gdHlwZW9mIGV9OmZ1bmN0aW9uKGUpe3JldHVybiBlJiYiZnVuY3Rpb24iPT10eXBlb2YgX1N5bWJvbCYmZS5jb25zdHJ1Y3Rvcj09PV9TeW1ib2w/InN5bWJvbCI6dHlwZW9mIGV9O3IuX19lc01vZHVsZT0hMDt2YXIgaT1lKCIuLi9jb3JlLWpzL3N5bWJvbC9pdGVyYXRvciIpLGE9bihpKSxzPWUoIi4uL2NvcmUtanMvc3ltYm9sIiksdT1uKHMpO3JbImRlZmF1bHQiXT0iZnVuY3Rpb24iPT10eXBlb2YgdVsiZGVmYXVsdCJdJiYic3ltYm9sIj09PW8oYVsiZGVmYXVsdCJdKT9mdW5jdGlvbihlKXtyZXR1cm4idW5kZWZpbmVkIj09dHlwZW9mIGU/InVuZGVmaW5lZCI6byhlKX06ZnVuY3Rpb24oZSl7cmV0dXJuIGUmJiJmdW5jdGlvbiI9PXR5cGVvZiB1WyJkZWZhdWx0Il0mJmUuY29uc3RydWN0b3I9PT11WyJkZWZhdWx0Il0/InN5bWJvbCI6InVuZGVmaW5lZCI9PXR5cGVvZiBlPyJ1bmRlZmluZWQiOm8oZSl9fSx7Ii4uL2NvcmUtanMvc3ltYm9sIjo5LCIuLi9jb3JlLWpzL3N5bWJvbC9pdGVyYXRvciI6MTB9XSwyMDpbZnVuY3Rpb24oZSx0LHIpeyhmdW5jdGlvbihyKXt2YXIgbj0ib2JqZWN0Ij09dHlwZW9mIHI/cjoib2JqZWN0Ij09dHlwZW9mIHdpbmRvdz93aW5kb3c6Im9iamVjdCI9PXR5cGVvZiBzZWxmP3NlbGY6dGhpcyxvPW4ucmVnZW5lcmF0b3JSdW50aW1lJiZPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhuKS5pbmRleE9mKCJyZWdlbmVyYXRvclJ1bnRpbWUiKT49MCxpPW8mJm4ucmVnZW5lcmF0b3JSdW50aW1lO2lmKG4ucmVnZW5lcmF0b3JSdW50aW1lPXZvaWQgMCx0LmV4cG9ydHM9ZSgiLi9ydW50aW1lIiksbyluLnJlZ2VuZXJhdG9yUnVudGltZT1pO2Vsc2UgdHJ5e2RlbGV0ZSBuLnJlZ2VuZXJhdG9yUnVudGltZX1jYXRjaChhKXtuLnJlZ2VuZXJhdG9yUnVudGltZT12b2lkIDB9dC5leHBvcnRzPXsiZGVmYXVsdCI6dC5leHBvcnRzLF9fZXNNb2R1bGU6ITB9fSkuY2FsbCh0aGlzLCJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsP2dsb2JhbDoidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGY/c2VsZjoidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdz93aW5kb3c6e30pfSx7Ii4vcnVudGltZSI6MjF9XSwyMTpbZnVuY3Rpb24oZSx0LHIpeyhmdW5jdGlvbihyLG4peyJ1c2Ugc3RyaWN0IjtmdW5jdGlvbiBvKGUpe3JldHVybiBlJiZlLl9fZXNNb2R1bGU/ZTp7ImRlZmF1bHQiOmV9fXZhciBpPWUoIi4uL2NvcmUtanMvcHJvbWlzZSIpLGE9byhpKSxzPWUoIi4uL2NvcmUtanMvb2JqZWN0L3NldC1wcm90b3R5cGUtb2YiKSx1PW8ocyksYz1lKCIuLi9jb3JlLWpzL29iamVjdC9jcmVhdGUiKSxsPW8oYyksZj1lKCIuLi9oZWxwZXJzL3R5cGVvZiIpLHA9byhmKSxoPWUoIi4uL2NvcmUtanMvc3ltYm9sL2l0ZXJhdG9yIiksZD1vKGgpLHk9ZSgiLi4vY29yZS1qcy9zeW1ib2wiKSxiPW8oeSk7IWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIG4oZSx0LHIsbil7dmFyIG89KDAsbFsiZGVmYXVsdCJdKSgodHx8aSkucHJvdG90eXBlKSxhPW5ldyBfKG58fFtdKTtyZXR1cm4gby5faW52b2tlPW0oZSxyLGEpLG99ZnVuY3Rpb24gbyhlLHQscil7dHJ5e3JldHVybnt0eXBlOiJub3JtYWwiLGFyZzplLmNhbGwodCxyKX19Y2F0Y2gobil7cmV0dXJue3R5cGU6InRocm93Iixhcmc6bn19fWZ1bmN0aW9uIGkoKXt9ZnVuY3Rpb24gcygpe31mdW5jdGlvbiBjKCl7fWZ1bmN0aW9uIGYoZSl7WyJuZXh0IiwidGhyb3ciLCJyZXR1cm4iXS5mb3JFYWNoKGZ1bmN0aW9uKHQpe2VbdF09ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuX2ludm9rZSh0LGUpfX0pfWZ1bmN0aW9uIGgoZSl7dGhpcy5hcmc9ZX1mdW5jdGlvbiB5KGUpe2Z1bmN0aW9uIHQodCxyKXt2YXIgbj1lW3RdKHIpLG89bi52YWx1ZTtyZXR1cm4gbyBpbnN0YW5jZW9mIGg/YVsiZGVmYXVsdCJdLnJlc29sdmUoby5hcmcpLnRoZW4oaSxzKTphWyJkZWZhdWx0Il0ucmVzb2x2ZShvKS50aGVuKGZ1bmN0aW9uKGUpe3JldHVybiBuLnZhbHVlPWUsbn0pfWZ1bmN0aW9uIG4oZSxyKXtmdW5jdGlvbiBuKCl7cmV0dXJuIHQoZSxyKX1yZXR1cm4gbz1vP28udGhlbihuLG4pOm5ldyBhWyJkZWZhdWx0Il0oZnVuY3Rpb24oZSl7ZShuKCkpfSl9Im9iamVjdCI9PT0oInVuZGVmaW5lZCI9PXR5cGVvZiByPyJ1bmRlZmluZWQiOigwLHBbImRlZmF1bHQiXSkocikpJiZyLmRvbWFpbiYmKHQ9ci5kb21haW4uYmluZCh0KSk7dmFyIG8saT10LmJpbmQoZSwibmV4dCIpLHM9dC5iaW5kKGUsInRocm93Iik7dC5iaW5kKGUsInJldHVybiIpO3RoaXMuX2ludm9rZT1ufWZ1bmN0aW9uIG0oZSx0LHIpe3ZhciBuPVM7cmV0dXJuIGZ1bmN0aW9uKGksYSl7aWYobj09PVIpdGhyb3cgbmV3IEVycm9yKCJHZW5lcmF0b3IgaXMgYWxyZWFkeSBydW5uaW5nIik7aWYobj09PXgpe2lmKCJ0aHJvdyI9PT1pKXRocm93IGE7cmV0dXJuIGooKX1mb3IoOzspe3ZhciBzPXIuZGVsZWdhdGU7aWYocyl7aWYoInJldHVybiI9PT1pfHwidGhyb3ciPT09aSYmcy5pdGVyYXRvcltpXT09PUUpe3IuZGVsZWdhdGU9bnVsbDt2YXIgdT1zLml0ZXJhdG9yWyJyZXR1cm4iXTtpZih1KXt2YXIgYz1vKHUscy5pdGVyYXRvcixhKTtpZigidGhyb3ciPT09Yy50eXBlKXtpPSJ0aHJvdyIsYT1jLmFyZztjb250aW51ZX19aWYoInJldHVybiI9PT1pKWNvbnRpbnVlfXZhciBjPW8ocy5pdGVyYXRvcltpXSxzLml0ZXJhdG9yLGEpO2lmKCJ0aHJvdyI9PT1jLnR5cGUpe3IuZGVsZWdhdGU9bnVsbCxpPSJ0aHJvdyIsYT1jLmFyZztjb250aW51ZX1pPSJuZXh0IixhPUU7dmFyIGw9Yy5hcmc7aWYoIWwuZG9uZSlyZXR1cm4gbj1NLGw7cltzLnJlc3VsdE5hbWVdPWwudmFsdWUsci5uZXh0PXMubmV4dExvYyxyLmRlbGVnYXRlPW51bGx9aWYoIm5leHQiPT09aSlyLl9zZW50PWEsbj09PU0/ci5zZW50PWE6ci5zZW50PUU7ZWxzZSBpZigidGhyb3ciPT09aSl7aWYobj09PVMpdGhyb3cgbj14LGE7ci5kaXNwYXRjaEV4Y2VwdGlvbihhKSYmKGk9Im5leHQiLGE9RSl9ZWxzZSJyZXR1cm4iPT09aSYmci5hYnJ1cHQoInJldHVybiIsYSk7bj1SO3ZhciBjPW8oZSx0LHIpO2lmKCJub3JtYWwiPT09Yy50eXBlKXtuPXIuZG9uZT94Ok07dmFyIGw9e3ZhbHVlOmMuYXJnLGRvbmU6ci5kb25lfTtpZihjLmFyZyE9PVQpcmV0dXJuIGw7ci5kZWxlZ2F0ZSYmIm5leHQiPT09aSYmKGE9RSl9ZWxzZSJ0aHJvdyI9PT1jLnR5cGUmJihuPXgsaT0idGhyb3ciLGE9Yy5hcmcpfX19ZnVuY3Rpb24gdihlKXt2YXIgdD17dHJ5TG9jOmVbMF19OzEgaW4gZSYmKHQuY2F0Y2hMb2M9ZVsxXSksMiBpbiBlJiYodC5maW5hbGx5TG9jPWVbMl0sdC5hZnRlckxvYz1lWzNdKSx0aGlzLnRyeUVudHJpZXMucHVzaCh0KX1mdW5jdGlvbiBnKGUpe3ZhciB0PWUuY29tcGxldGlvbnx8e307dC50eXBlPSJub3JtYWwiLGRlbGV0ZSB0LmFyZyxlLmNvbXBsZXRpb249dH1mdW5jdGlvbiBfKGUpe3RoaXMudHJ5RW50cmllcz1be3RyeUxvYzoicm9vdCJ9XSxlLmZvckVhY2godix0aGlzKSx0aGlzLnJlc2V0KCEwKX1mdW5jdGlvbiBPKGUpe2lmKGUpe3ZhciB0PWVba107aWYodClyZXR1cm4gdC5jYWxsKGUpO2lmKCJmdW5jdGlvbiI9PXR5cGVvZiBlLm5leHQpcmV0dXJuIGU7aWYoIWlzTmFOKGUubGVuZ3RoKSl7dmFyIHI9LTEsbj1mdW5jdGlvbiBvKCl7Zm9yKDsrK3I8ZS5sZW5ndGg7KWlmKHcuY2FsbChlLHIpKXJldHVybiBvLnZhbHVlPWVbcl0sby5kb25lPSExLG87cmV0dXJuIG8udmFsdWU9RSxvLmRvbmU9ITAsb307cmV0dXJuIG4ubmV4dD1ufX1yZXR1cm57bmV4dDpqfX1mdW5jdGlvbiBqKCl7cmV0dXJue3ZhbHVlOkUsZG9uZTohMH19dmFyIEUsdz1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LGs9ImZ1bmN0aW9uIj09dHlwZW9mIGJbImRlZmF1bHQiXSYmZFsiZGVmYXVsdCJdfHwiQEBpdGVyYXRvciIsJD0ib2JqZWN0Ij09PSgidW5kZWZpbmVkIj09dHlwZW9mIHQ/InVuZGVmaW5lZCI6KDAscFsiZGVmYXVsdCJdKSh0KSksUD1lLnJlZ2VuZXJhdG9yUnVudGltZTtpZihQKXJldHVybiB2b2lkKCQmJih0LmV4cG9ydHM9UCkpO1A9ZS5yZWdlbmVyYXRvclJ1bnRpbWU9JD90LmV4cG9ydHM6e30sUC53cmFwPW47dmFyIFM9InN1c3BlbmRlZFN0YXJ0IixNPSJzdXNwZW5kZWRZaWVsZCIsUj0iZXhlY3V0aW5nIix4PSJjb21wbGV0ZWQiLFQ9e30sQT1jLnByb3RvdHlwZT1pLnByb3RvdHlwZTtzLnByb3RvdHlwZT1BLmNvbnN0cnVjdG9yPWMsYy5jb25zdHJ1Y3Rvcj1zLHMuZGlzcGxheU5hbWU9IkdlbmVyYXRvckZ1bmN0aW9uIixQLmlzR2VuZXJhdG9yRnVuY3Rpb249ZnVuY3Rpb24oZSl7dmFyIHQ9ImZ1bmN0aW9uIj09dHlwZW9mIGUmJmUuY29uc3RydWN0b3I7cmV0dXJuIHQ/dD09PXN8fCJHZW5lcmF0b3JGdW5jdGlvbiI9PT0odC5kaXNwbGF5TmFtZXx8dC5uYW1lKTohMX0sUC5tYXJrPWZ1bmN0aW9uKGUpe3JldHVybiB1WyJkZWZhdWx0Il0/KDAsdVsiZGVmYXVsdCJdKShlLGMpOmUuX19wcm90b19fPWMsZS5wcm90b3R5cGU9KDAsbFsiZGVmYXVsdCJdKShBKSxlfSxQLmF3cmFwPWZ1bmN0aW9uKGUpe3JldHVybiBuZXcgaChlKX0sZih5LnByb3RvdHlwZSksUC5hc3luYz1mdW5jdGlvbihlLHQscixvKXt2YXIgaT1uZXcgeShuKGUsdCxyLG8pKTtyZXR1cm4gUC5pc0dlbmVyYXRvckZ1bmN0aW9uKHQpP2k6aS5uZXh0KCkudGhlbihmdW5jdGlvbihlKXtyZXR1cm4gZS5kb25lP2UudmFsdWU6aS5uZXh0KCl9KX0sZihBKSxBW2tdPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9LEEudG9TdHJpbmc9ZnVuY3Rpb24oKXtyZXR1cm4iW29iamVjdCBHZW5lcmF0b3JdIn0sUC5rZXlzPWZ1bmN0aW9uKGUpe3ZhciB0PVtdO2Zvcih2YXIgciBpbiBlKXQucHVzaChyKTtyZXR1cm4gdC5yZXZlcnNlKCksZnVuY3Rpb24gbigpe2Zvcig7dC5sZW5ndGg7KXt2YXIgcj10LnBvcCgpO2lmKHIgaW4gZSlyZXR1cm4gbi52YWx1ZT1yLG4uZG9uZT0hMSxufXJldHVybiBuLmRvbmU9ITAsbn19LFAudmFsdWVzPU8sXy5wcm90b3R5cGU9e2NvbnN0cnVjdG9yOl8scmVzZXQ6ZnVuY3Rpb24oZSl7aWYodGhpcy5wcmV2PTAsdGhpcy5uZXh0PTAsdGhpcy5zZW50PUUsdGhpcy5kb25lPSExLHRoaXMuZGVsZWdhdGU9bnVsbCx0aGlzLnRyeUVudHJpZXMuZm9yRWFjaChnKSwhZSlmb3IodmFyIHQgaW4gdGhpcykidCI9PT10LmNoYXJBdCgwKSYmdy5jYWxsKHRoaXMsdCkmJiFpc05hTigrdC5zbGljZSgxKSkmJih0aGlzW3RdPUUpfSxzdG9wOmZ1bmN0aW9uKCl7dGhpcy5kb25lPSEwO3ZhciBlPXRoaXMudHJ5RW50cmllc1swXSx0PWUuY29tcGxldGlvbjtpZigidGhyb3ciPT09dC50eXBlKXRocm93IHQuYXJnO3JldHVybiB0aGlzLnJ2YWx9LGRpc3BhdGNoRXhjZXB0aW9uOmZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQodCxuKXtyZXR1cm4gaS50eXBlPSJ0aHJvdyIsaS5hcmc9ZSxyLm5leHQ9dCwhIW59aWYodGhpcy5kb25lKXRocm93IGU7Zm9yKHZhciByPXRoaXMsbj10aGlzLnRyeUVudHJpZXMubGVuZ3RoLTE7bj49MDstLW4pe3ZhciBvPXRoaXMudHJ5RW50cmllc1tuXSxpPW8uY29tcGxldGlvbjtpZigicm9vdCI9PT1vLnRyeUxvYylyZXR1cm4gdCgiZW5kIik7aWYoby50cnlMb2M8PXRoaXMucHJldil7dmFyIGE9dy5jYWxsKG8sImNhdGNoTG9jIikscz13LmNhbGwobywiZmluYWxseUxvYyIpO2lmKGEmJnMpe2lmKHRoaXMucHJldjxvLmNhdGNoTG9jKXJldHVybiB0KG8uY2F0Y2hMb2MsITApO2lmKHRoaXMucHJldjxvLmZpbmFsbHlMb2MpcmV0dXJuIHQoby5maW5hbGx5TG9jKX1lbHNlIGlmKGEpe2lmKHRoaXMucHJldjxvLmNhdGNoTG9jKXJldHVybiB0KG8uY2F0Y2hMb2MsITApfWVsc2V7aWYoIXMpdGhyb3cgbmV3IEVycm9yKCJ0cnkgc3RhdGVtZW50IHdpdGhvdXQgY2F0Y2ggb3IgZmluYWxseSIpO2lmKHRoaXMucHJldjxvLmZpbmFsbHlMb2MpcmV0dXJuIHQoby5maW5hbGx5TG9jKX19fX0sYWJydXB0OmZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByPXRoaXMudHJ5RW50cmllcy5sZW5ndGgtMTtyPj0wOy0tcil7dmFyIG49dGhpcy50cnlFbnRyaWVzW3JdO2lmKG4udHJ5TG9jPD10aGlzLnByZXYmJncuY2FsbChuLCJmaW5hbGx5TG9jIikmJnRoaXMucHJldjxuLmZpbmFsbHlMb2Mpe3ZhciBvPW47YnJlYWt9fW8mJigiYnJlYWsiPT09ZXx8ImNvbnRpbnVlIj09PWUpJiZvLnRyeUxvYzw9dCYmdDw9by5maW5hbGx5TG9jJiYobz1udWxsKTt2YXIgaT1vP28uY29tcGxldGlvbjp7fTtyZXR1cm4gaS50eXBlPWUsaS5hcmc9dCxvP3RoaXMubmV4dD1vLmZpbmFsbHlMb2M6dGhpcy5jb21wbGV0ZShpKSxUfSxjb21wbGV0ZTpmdW5jdGlvbihlLHQpe2lmKCJ0aHJvdyI9PT1lLnR5cGUpdGhyb3cgZS5hcmc7ImJyZWFrIj09PWUudHlwZXx8ImNvbnRpbnVlIj09PWUudHlwZT90aGlzLm5leHQ9ZS5hcmc6InJldHVybiI9PT1lLnR5cGU/KHRoaXMucnZhbD1lLmFyZyx0aGlzLm5leHQ9ImVuZCIpOiJub3JtYWwiPT09ZS50eXBlJiZ0JiYodGhpcy5uZXh0PXQpfSxmaW5pc2g6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PXRoaXMudHJ5RW50cmllcy5sZW5ndGgtMTt0Pj0wOy0tdCl7dmFyIHI9dGhpcy50cnlFbnRyaWVzW3RdO2lmKHIuZmluYWxseUxvYz09PWUpcmV0dXJuIHRoaXMuY29tcGxldGUoci5jb21wbGV0aW9uLHIuYWZ0ZXJMb2MpLGcociksVH19LCJjYXRjaCI6ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PXRoaXMudHJ5RW50cmllcy5sZW5ndGgtMTt0Pj0wOy0tdCl7dmFyIHI9dGhpcy50cnlFbnRyaWVzW3RdO2lmKHIudHJ5TG9jPT09ZSl7dmFyIG49ci5jb21wbGV0aW9uO2lmKCJ0aHJvdyI9PT1uLnR5cGUpe3ZhciBvPW4uYXJnO2cocil9cmV0dXJuIG99fXRocm93IG5ldyBFcnJvcigiaWxsZWdhbCBjYXRjaCBhdHRlbXB0Iil9LGRlbGVnYXRlWWllbGQ6ZnVuY3Rpb24oZSx0LHIpe3JldHVybiB0aGlzLmRlbGVnYXRlPXtpdGVyYXRvcjpPKGUpLHJlc3VsdE5hbWU6dCxuZXh0TG9jOnJ9LFR9fX0oIm9iamVjdCI9PT0oInVuZGVmaW5lZCI9PXR5cGVvZiBuPyJ1bmRlZmluZWQiOigwLHBbImRlZmF1bHQiXSkobikpP246Im9iamVjdCI9PT0oInVuZGVmaW5lZCI9PXR5cGVvZiB3aW5kb3c/InVuZGVmaW5lZCI6KDAscFsiZGVmYXVsdCJdKSh3aW5kb3cpKT93aW5kb3c6Im9iamVjdCI9PT0oInVuZGVmaW5lZCI9PXR5cGVvZiBzZWxmPyJ1bmRlZmluZWQiOigwLHBbImRlZmF1bHQiXSkoc2VsZikpP3NlbGY6dm9pZCAwKX0pLmNhbGwodGhpcyxlKCJfcHJvY2VzcyIpLCJ1bmRlZmluZWQiIT10eXBlb2YgZ2xvYmFsP2dsb2JhbDoidW5kZWZpbmVkIiE9dHlwZW9mIHNlbGY/c2VsZjoidW5kZWZpbmVkIiE9dHlwZW9mIHdpbmRvdz93aW5kb3c6e30pfSx7Ii4uL2NvcmUtanMvb2JqZWN0L2NyZWF0ZSI6MSwiLi4vY29yZS1qcy9vYmplY3Qvc2V0LXByb3RvdHlwZS1vZiI6NywiLi4vY29yZS1qcy9wcm9taXNlIjo4LCIuLi9jb3JlLWpzL3N5bWJvbCI6OSwiLi4vY29yZS1qcy9zeW1ib2wvaXRlcmF0b3IiOjEwLCIuLi9oZWxwZXJzL3R5cGVvZiI6MTksX3Byb2Nlc3M6OTd9XSwyMjpbZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWUoIi4uLy4uL21vZHVsZXMvJCIpO3QuZXhwb3J0cz1mdW5jdGlvbihlLHQpe3JldHVybiBuLmNyZWF0ZShlLHQpfX0seyIuLi8uLi9tb2R1bGVzLyQiOjYyfV0sMjM6W2Z1bmN0aW9uKGUsdCxyKXt2YXIgbj1lKCIuLi8uLi9tb2R1bGVzLyQiKTt0LmV4cG9ydHM9ZnVuY3Rpb24oZSx0LHIpe3JldHVybiBuLnNldERlc2MoZSx0LHIpfX0seyIuLi8uLi9tb2R1bGVzLyQiOjYyfV0sMjQ6W2Z1bmN0aW9uKGUsdCxyKXtlKCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuZnJlZXplIiksdC5leHBvcnRzPWUoIi4uLy4uL21vZHVsZXMvJC5jb3JlIikuT2JqZWN0LmZyZWV6ZX0seyIuLi8uLi9tb2R1bGVzLyQuY29yZSI6MzcsIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5mcmVlemUiOjg3fV0sMjU6W2Z1bmN0aW9uKGUsdCxyKXt2YXIgbj1lKCIuLi8uLi9tb2R1bGVzLyQiKTtlKCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIiksdC5leHBvcnRzPWZ1bmN0aW9uKGUsdCl7cmV0dXJuIG4uZ2V0RGVzYyhlLHQpfX0seyIuLi8uLi9tb2R1bGVzLyQiOjYyLCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuZ2V0LW93bi1wcm9wZXJ0eS1kZXNjcmlwdG9yIjo4OH1dLDI2OltmdW5jdGlvbihlLHQscil7ZSgiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LmdldC1wcm90b3R5cGUtb2YiKSx0LmV4cG9ydHM9ZSgiLi4vLi4vbW9kdWxlcy8kLmNvcmUiKS5PYmplY3QuZ2V0UHJvdG90eXBlT2Z9LHsiLi4vLi4vbW9kdWxlcy8kLmNvcmUiOjM3LCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QuZ2V0LXByb3RvdHlwZS1vZiI6ODl9XSwyNzpbZnVuY3Rpb24oZSx0LHIpe2UoIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5rZXlzIiksdC5leHBvcnRzPWUoIi4uLy4uL21vZHVsZXMvJC5jb3JlIikuT2JqZWN0LmtleXN9LHsiLi4vLi4vbW9kdWxlcy8kLmNvcmUiOjM3LCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3Qua2V5cyI6OTB9XSwyODpbZnVuY3Rpb24oZSx0LHIpe2UoIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC5zZXQtcHJvdG90eXBlLW9mIiksdC5leHBvcnRzPWUoIi4uLy4uL21vZHVsZXMvJC5jb3JlIikuT2JqZWN0LnNldFByb3RvdHlwZU9mfSx7Ii4uLy4uL21vZHVsZXMvJC5jb3JlIjozNywiLi4vLi4vbW9kdWxlcy9lczYub2JqZWN0LnNldC1wcm90b3R5cGUtb2YiOjkxfV0sMjk6W2Z1bmN0aW9uKGUsdCxyKXtlKCIuLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIiksZSgiLi4vbW9kdWxlcy9lczYuc3RyaW5nLml0ZXJhdG9yIiksZSgiLi4vbW9kdWxlcy93ZWIuZG9tLml0ZXJhYmxlIiksZSgiLi4vbW9kdWxlcy9lczYucHJvbWlzZSIpLHQuZXhwb3J0cz1lKCIuLi9tb2R1bGVzLyQuY29yZSIpLlByb21pc2V9LHsiLi4vbW9kdWxlcy8kLmNvcmUiOjM3LCIuLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIjo5MiwiLi4vbW9kdWxlcy9lczYucHJvbWlzZSI6OTMsIi4uL21vZHVsZXMvZXM2LnN0cmluZy5pdGVyYXRvciI6OTQsIi4uL21vZHVsZXMvd2ViLmRvbS5pdGVyYWJsZSI6OTZ9XSwzMDpbZnVuY3Rpb24oZSx0LHIpe2UoIi4uLy4uL21vZHVsZXMvZXM2LnN5bWJvbCIpLGUoIi4uLy4uL21vZHVsZXMvZXM2Lm9iamVjdC50by1zdHJpbmciKSx0LmV4cG9ydHM9ZSgiLi4vLi4vbW9kdWxlcy8kLmNvcmUiKS5TeW1ib2x9LHsiLi4vLi4vbW9kdWxlcy8kLmNvcmUiOjM3LCIuLi8uLi9tb2R1bGVzL2VzNi5vYmplY3QudG8tc3RyaW5nIjo5MiwiLi4vLi4vbW9kdWxlcy9lczYuc3ltYm9sIjo5NX1dLDMxOltmdW5jdGlvbihlLHQscil7ZSgiLi4vLi4vbW9kdWxlcy9lczYuc3RyaW5nLml0ZXJhdG9yIiksZSgiLi4vLi4vbW9kdWxlcy93ZWIuZG9tLml0ZXJhYmxlIiksdC5leHBvcnRzPWUoIi4uLy4uL21vZHVsZXMvJC53a3MiKSgiaXRlcmF0b3IiKX0seyIuLi8uLi9tb2R1bGVzLyQud2tzIjo4NCwiLi4vLi4vbW9kdWxlcy9lczYuc3RyaW5nLml0ZXJhdG9yIjo5NCwiLi4vLi4vbW9kdWxlcy93ZWIuZG9tLml0ZXJhYmxlIjo5Nn1dLDMyOltmdW5jdGlvbihlLHQscil7dC5leHBvcnRzPWZ1bmN0aW9uKGUpe2lmKCJmdW5jdGlvbiIhPXR5cGVvZiBlKXRocm93IFR5cGVFcnJvcihlKyIgaXMgbm90IGEgZnVuY3Rpb24hIik7cmV0dXJuIGV9fSx7fV0sMzM6W2Z1bmN0aW9uKGUsdCxyKXt0LmV4cG9ydHM9ZnVuY3Rpb24oKXt9fSx7fV0sMzQ6W2Z1bmN0aW9uKGUsdCxyKXt2YXIgbj1lKCIuLyQuaXMtb2JqZWN0Iik7dC5leHBvcnRzPWZ1bmN0aW9uKGUpe2lmKCFuKGUpKXRocm93IFR5cGVFcnJvcihlKyIgaXMgbm90IGFuIG9iamVjdCEiKTtyZXR1cm4gZX19LHsiLi8kLmlzLW9iamVjdCI6NTV9XSwzNTpbZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWUoIi4vJC5jb2YiKSxvPWUoIi4vJC53a3MiKSgidG9TdHJpbmdUYWciKSxpPSJBcmd1bWVudHMiPT1uKGZ1bmN0aW9uKCl7cmV0dXJuIGFyZ3VtZW50c30oKSk7dC5leHBvcnRzPWZ1bmN0aW9uKGUpe3ZhciB0LHIsYTtyZXR1cm4gdm9pZCAwPT09ZT8iVW5kZWZpbmVkIjpudWxsPT09ZT8iTnVsbCI6InN0cmluZyI9PXR5cGVvZihyPSh0PU9iamVjdChlKSlbb10pP3I6aT9uKHQpOiJPYmplY3QiPT0oYT1uKHQpKSYmImZ1bmN0aW9uIj09dHlwZW9mIHQuY2FsbGVlPyJBcmd1bWVudHMiOmF9fSx7Ii4vJC5jb2YiOjM2LCIuLyQud2tzIjo4NH1dLDM2OltmdW5jdGlvbihlLHQscil7dmFyIG49e30udG9TdHJpbmc7dC5leHBvcnRzPWZ1bmN0aW9uKGUpe3JldHVybiBuLmNhbGwoZSkuc2xpY2UoOCwtMSl9fSx7fV0sMzc6W2Z1bmN0aW9uKGUsdCxyKXt2YXIgbj10LmV4cG9ydHM9e3ZlcnNpb246IjEuMi42In07Im51bWJlciI9PXR5cGVvZiBfX2UmJihfX2U9bil9LHt9XSwzODpbZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWUoIi4vJC5hLWZ1bmN0aW9uIik7dC5leHBvcnRzPWZ1bmN0aW9uKGUsdCxyKXtpZihuKGUpLHZvaWQgMD09PXQpcmV0dXJuIGU7c3dpdGNoKHIpe2Nhc2UgMTpyZXR1cm4gZnVuY3Rpb24ocil7cmV0dXJuIGUuY2FsbCh0LHIpfTtjYXNlIDI6cmV0dXJuIGZ1bmN0aW9uKHIsbil7cmV0dXJuIGUuY2FsbCh0LHIsbil9O2Nhc2UgMzpyZXR1cm4gZnVuY3Rpb24ocixuLG8pe3JldHVybiBlLmNhbGwodCxyLG4sbyl9fXJldHVybiBmdW5jdGlvbigpe3JldHVybiBlLmFwcGx5KHQsYXJndW1lbnRzKX19fSx7Ii4vJC5hLWZ1bmN0aW9uIjozMn1dLDM5OltmdW5jdGlvbihlLHQscil7dC5leHBvcnRzPWZ1bmN0aW9uKGUpe2lmKHZvaWQgMD09ZSl0aHJvdyBUeXBlRXJyb3IoIkNhbid0IGNhbGwgbWV0aG9kIG9uICAiK2UpO3JldHVybiBlfX0se31dLDQwOltmdW5jdGlvbihlLHQscil7dC5leHBvcnRzPSFlKCIuLyQuZmFpbHMiKShmdW5jdGlvbigpe3JldHVybiA3IT1PYmplY3QuZGVmaW5lUHJvcGVydHkoe30sImEiLHtnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gN319KS5hfSl9LHsiLi8kLmZhaWxzIjo0NH1dLDQxOltmdW5jdGlvbihlLHQscil7dmFyIG49ZSgiLi8kLmlzLW9iamVjdCIpLG89ZSgiLi8kLmdsb2JhbCIpLmRvY3VtZW50LGk9bihvKSYmbihvLmNyZWF0ZUVsZW1lbnQpO3QuZXhwb3J0cz1mdW5jdGlvbihlKXtyZXR1cm4gaT9vLmNyZWF0ZUVsZW1lbnQoZSk6e319fSx7Ii4vJC5nbG9iYWwiOjQ3LCIuLyQuaXMtb2JqZWN0Ijo1NX1dLDQyOltmdW5jdGlvbihlLHQscil7dmFyIG49ZSgiLi8kIik7dC5leHBvcnRzPWZ1bmN0aW9uKGUpe3ZhciB0PW4uZ2V0S2V5cyhlKSxyPW4uZ2V0U3ltYm9scztpZihyKWZvcih2YXIgbyxpPXIoZSksYT1uLmlzRW51bSxzPTA7aS5sZW5ndGg+czspYS5jYWxsKGUsbz1pW3MrK10pJiZ0LnB1c2gobyk7cmV0dXJuIHR9fSx7Ii4vJCI6NjJ9XSw0MzpbZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWUoIi4vJC5nbG9iYWwiKSxvPWUoIi4vJC5jb3JlIiksaT1lKCIuLyQuY3R4IiksYT0icHJvdG90eXBlIixzPWZ1bmN0aW9uKGUsdCxyKXt2YXIgdSxjLGwsZj1lJnMuRixwPWUmcy5HLGg9ZSZzLlMsZD1lJnMuUCx5PWUmcy5CLGI9ZSZzLlcsbT1wP286b1t0XXx8KG9bdF09e30pLHY9cD9uOmg/blt0XTooblt0XXx8e30pW2FdO3AmJihyPXQpO2Zvcih1IGluIHIpYz0hZiYmdiYmdSBpbiB2LGMmJnUgaW4gbXx8KGw9Yz92W3VdOnJbdV0sbVt1XT1wJiYiZnVuY3Rpb24iIT10eXBlb2Ygdlt1XT9yW3VdOnkmJmM/aShsLG4pOmImJnZbdV09PWw/ZnVuY3Rpb24oZSl7dmFyIHQ9ZnVuY3Rpb24odCl7cmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBlP25ldyBlKHQpOmUodCl9O3JldHVybiB0W2FdPWVbYV0sdH0obCk6ZCYmImZ1bmN0aW9uIj09dHlwZW9mIGw/aShGdW5jdGlvbi5jYWxsLGwpOmwsZCYmKChtW2FdfHwobVthXT17fSkpW3VdPWwpKX07cy5GPTEscy5HPTIscy5TPTQscy5QPTgscy5CPTE2LHMuVz0zMix0LmV4cG9ydHM9c30seyIuLyQuY29yZSI6MzcsIi4vJC5jdHgiOjM4LCIuLyQuZ2xvYmFsIjo0N31dLDQ0OltmdW5jdGlvbihlLHQscil7dC5leHBvcnRzPWZ1bmN0aW9uKGUpe3RyeXtyZXR1cm4hIWUoKX1jYXRjaCh0KXtyZXR1cm4hMH19fSx7fV0sNDU6W2Z1bmN0aW9uKGUsdCxyKXt2YXIgbj1lKCIuLyQuY3R4Iiksbz1lKCIuLyQuaXRlci1jYWxsIiksaT1lKCIuLyQuaXMtYXJyYXktaXRlciIpLGE9ZSgiLi8kLmFuLW9iamVjdCIpLHM9ZSgiLi8kLnRvLWxlbmd0aCIpLHU9ZSgiLi9jb3JlLmdldC1pdGVyYXRvci1tZXRob2QiKTt0LmV4cG9ydHM9ZnVuY3Rpb24oZSx0LHIsYyl7dmFyIGwsZixwLGg9dShlKSxkPW4ocixjLHQ/MjoxKSx5PTA7aWYoImZ1bmN0aW9uIiE9dHlwZW9mIGgpdGhyb3cgVHlwZUVycm9yKGUrIiBpcyBub3QgaXRlcmFibGUhIik7aWYoaShoKSlmb3IobD1zKGUubGVuZ3RoKTtsPnk7eSsrKXQ/ZChhKGY9ZVt5XSlbMF0sZlsxXSk6ZChlW3ldKTtlbHNlIGZvcihwPWguY2FsbChlKTshKGY9cC5uZXh0KCkpLmRvbmU7KW8ocCxkLGYudmFsdWUsdCl9fSx7Ii4vJC5hbi1vYmplY3QiOjM0LCIuLyQuY3R4IjozOCwiLi8kLmlzLWFycmF5LWl0ZXIiOjUzLCIuLyQuaXRlci1jYWxsIjo1NiwiLi8kLnRvLWxlbmd0aCI6ODEsIi4vY29yZS5nZXQtaXRlcmF0b3ItbWV0aG9kIjo4NX1dLDQ2OltmdW5jdGlvbihlLHQscil7dmFyIG49ZSgiLi8kLnRvLWlvYmplY3QiKSxvPWUoIi4vJCIpLmdldE5hbWVzLGk9e30udG9TdHJpbmcsYT0ib2JqZWN0Ij09dHlwZW9mIHdpbmRvdyYmT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXM/T2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMod2luZG93KTpbXSxzPWZ1bmN0aW9uKGUpe3RyeXtyZXR1cm4gbyhlKX1jYXRjaCh0KXtyZXR1cm4gYS5zbGljZSgpfX07dC5leHBvcnRzLmdldD1mdW5jdGlvbihlKXtyZXR1cm4gYSYmIltvYmplY3QgV2luZG93XSI9PWkuY2FsbChlKT9zKGUpOm8obihlKSl9fSx7Ii4vJCI6NjIsIi4vJC50by1pb2JqZWN0Ijo4MH1dLDQ3OltmdW5jdGlvbihlLHQscil7dmFyIG49dC5leHBvcnRzPSJ1bmRlZmluZWQiIT10eXBlb2Ygd2luZG93JiZ3aW5kb3cuTWF0aD09TWF0aD93aW5kb3c6InVuZGVmaW5lZCIhPXR5cGVvZiBzZWxmJiZzZWxmLk1hdGg9PU1hdGg/c2VsZjpGdW5jdGlvbigicmV0dXJuIHRoaXMiKSgpOyJudW1iZXIiPT10eXBlb2YgX19nJiYoX19nPW4pfSx7fV0sNDg6W2Z1bmN0aW9uKGUsdCxyKXt2YXIgbj17fS5oYXNPd25Qcm9wZXJ0eTt0LmV4cG9ydHM9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gbi5jYWxsKGUsdCl9fSx7fV0sNDk6W2Z1bmN0aW9uKGUsdCxyKXt2YXIgbj1lKCIuLyQiKSxvPWUoIi4vJC5wcm9wZXJ0eS1kZXNjIik7dC5leHBvcnRzPWUoIi4vJC5kZXNjcmlwdG9ycyIpP2Z1bmN0aW9uKGUsdCxyKXtyZXR1cm4gbi5zZXREZXNjKGUsdCxvKDEscikpfTpmdW5jdGlvbihlLHQscil7cmV0dXJuIGVbdF09cixlfX0seyIuLyQiOjYyLCIuLyQuZGVzY3JpcHRvcnMiOjQwLCIuLyQucHJvcGVydHktZGVzYyI6Njd9XSw1MDpbZnVuY3Rpb24oZSx0LHIpe3QuZXhwb3J0cz1lKCIuLyQuZ2xvYmFsIikuZG9jdW1lbnQmJmRvY3VtZW50LmRvY3VtZW50RWxlbWVudH0seyIuLyQuZ2xvYmFsIjo0N31dLDUxOltmdW5jdGlvbihlLHQscil7dC5leHBvcnRzPWZ1bmN0aW9uKGUsdCxyKXt2YXIgbj12b2lkIDA9PT1yO3N3aXRjaCh0Lmxlbmd0aCl7Y2FzZSAwOnJldHVybiBuP2UoKTplLmNhbGwocik7Y2FzZSAxOnJldHVybiBuP2UodFswXSk6ZS5jYWxsKHIsdFswXSk7Y2FzZSAyOnJldHVybiBuP2UodFswXSx0WzFdKTplLmNhbGwocix0WzBdLHRbMV0pO2Nhc2UgMzpyZXR1cm4gbj9lKHRbMF0sdFsxXSx0WzJdKTplLmNhbGwocix0WzBdLHRbMV0sdFsyXSk7Y2FzZSA0OnJldHVybiBuP2UodFswXSx0WzFdLHRbMl0sdFszXSk6ZS5jYWxsKHIsdFswXSx0WzFdLHRbMl0sdFszXSl9cmV0dXJuIGUuYXBwbHkocix0KX19LHt9XSw1MjpbZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWUoIi4vJC5jb2YiKTt0LmV4cG9ydHM9T2JqZWN0KCJ6IikucHJvcGVydHlJc0VudW1lcmFibGUoMCk/T2JqZWN0OmZ1bmN0aW9uKGUpe3JldHVybiJTdHJpbmciPT1uKGUpP2Uuc3BsaXQoIiIpOk9iamVjdChlKX19LHsiLi8kLmNvZiI6MzZ9XSw1MzpbZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWUoIi4vJC5pdGVyYXRvcnMiKSxvPWUoIi4vJC53a3MiKSgiaXRlcmF0b3IiKSxpPUFycmF5LnByb3RvdHlwZTt0LmV4cG9ydHM9ZnVuY3Rpb24oZSl7cmV0dXJuIHZvaWQgMCE9PWUmJihuLkFycmF5PT09ZXx8aVtvXT09PWUpfX0seyIuLyQuaXRlcmF0b3JzIjo2MSwiLi8kLndrcyI6ODR9XSw1NDpbZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWUoIi4vJC5jb2YiKTt0LmV4cG9ydHM9QXJyYXkuaXNBcnJheXx8ZnVuY3Rpb24oZSl7cmV0dXJuIkFycmF5Ij09bihlKX19LHsiLi8kLmNvZiI6MzZ9XSw1NTpbZnVuY3Rpb24oZSx0LHIpe3QuZXhwb3J0cz1mdW5jdGlvbihlKXtyZXR1cm4ib2JqZWN0Ij09dHlwZW9mIGU/bnVsbCE9PWU6ImZ1bmN0aW9uIj09dHlwZW9mIGV9fSx7fV0sNTY6W2Z1bmN0aW9uKGUsdCxyKXt2YXIgbj1lKCIuLyQuYW4tb2JqZWN0Iik7dC5leHBvcnRzPWZ1bmN0aW9uKGUsdCxyLG8pe3RyeXtyZXR1cm4gbz90KG4ocilbMF0sclsxXSk6dChyKX1jYXRjaChpKXt2YXIgYT1lWyJyZXR1cm4iXTt0aHJvdyB2b2lkIDAhPT1hJiZuKGEuY2FsbChlKSksaX19fSx7Ii4vJC5hbi1vYmplY3QiOjM0fV0sNTc6W2Z1bmN0aW9uKGUsdCxyKXsidXNlIHN0cmljdCI7dmFyIG49ZSgiLi8kIiksbz1lKCIuLyQucHJvcGVydHktZGVzYyIpLGk9ZSgiLi8kLnNldC10by1zdHJpbmctdGFnIiksYT17fTtlKCIuLyQuaGlkZSIpKGEsZSgiLi8kLndrcyIpKCJpdGVyYXRvciIpLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9KSx0LmV4cG9ydHM9ZnVuY3Rpb24oZSx0LHIpe2UucHJvdG90eXBlPW4uY3JlYXRlKGEse25leHQ6bygxLHIpfSksaShlLHQrIiBJdGVyYXRvciIpfX0seyIuLyQiOjYyLCIuLyQuaGlkZSI6NDksIi4vJC5wcm9wZXJ0eS1kZXNjIjo2NywiLi8kLnNldC10by1zdHJpbmctdGFnIjo3MywiLi8kLndrcyI6ODR9XSw1ODpbZnVuY3Rpb24oZSx0LHIpeyJ1c2Ugc3RyaWN0Ijt2YXIgbj1lKCIuLyQubGlicmFyeSIpLG89ZSgiLi8kLmV4cG9ydCIpLGk9ZSgiLi8kLnJlZGVmaW5lIiksYT1lKCIuLyQuaGlkZSIpLHM9ZSgiLi8kLmhhcyIpLHU9ZSgiLi8kLml0ZXJhdG9ycyIpLGM9ZSgiLi8kLml0ZXItY3JlYXRlIiksbD1lKCIuLyQuc2V0LXRvLXN0cmluZy10YWciKSxmPWUoIi4vJCIpLmdldFByb3RvLHA9ZSgiLi8kLndrcyIpKCJpdGVyYXRvciIpLGg9IShbXS5rZXlzJiYibmV4dCJpbltdLmtleXMoKSksZD0iQEBpdGVyYXRvciIseT0ia2V5cyIsYj0idmFsdWVzIixtPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9O3QuZXhwb3J0cz1mdW5jdGlvbihlLHQscix2LGcsXyxPKXtjKHIsdCx2KTt2YXIgaixFLHc9ZnVuY3Rpb24oZSl7aWYoIWgmJmUgaW4gUylyZXR1cm4gU1tlXTtzd2l0Y2goZSl7Y2FzZSB5OnJldHVybiBmdW5jdGlvbigpe3JldHVybiBuZXcgcih0aGlzLGUpfTtjYXNlIGI6cmV0dXJuIGZ1bmN0aW9uKCl7cmV0dXJuIG5ldyByKHRoaXMsZSl9fXJldHVybiBmdW5jdGlvbigpe3JldHVybiBuZXcgcih0aGlzLGUpfX0saz10KyIgSXRlcmF0b3IiLCQ9Zz09YixQPSExLFM9ZS5wcm90b3R5cGUsTT1TW3BdfHxTW2RdfHxnJiZTW2ddLFI9TXx8dyhnKTtpZihNKXt2YXIgeD1mKFIuY2FsbChuZXcgZSkpO2woeCxrLCEwKSwhbiYmcyhTLGQpJiZhKHgscCxtKSwkJiZNLm5hbWUhPT1iJiYoUD0hMCxSPWZ1bmN0aW9uKCl7cmV0dXJuIE0uY2FsbCh0aGlzKX0pfWlmKG4mJiFPfHwhaCYmIVAmJlNbcF18fGEoUyxwLFIpLHVbdF09Uix1W2tdPW0sZylpZihqPXt2YWx1ZXM6JD9SOncoYiksa2V5czpfP1I6dyh5KSxlbnRyaWVzOiQ/dygiZW50cmllcyIpOlJ9LE8pZm9yKEUgaW4gailFIGluIFN8fGkoUyxFLGpbRV0pO2Vsc2UgbyhvLlArby5GKihofHxQKSx0LGopO3JldHVybiBqfX0seyIuLyQiOjYyLCIuLyQuZXhwb3J0Ijo0MywiLi8kLmhhcyI6NDgsIi4vJC5oaWRlIjo0OSwiLi8kLml0ZXItY3JlYXRlIjo1NywiLi8kLml0ZXJhdG9ycyI6NjEsIi4vJC5saWJyYXJ5Ijo2NCwiLi8kLnJlZGVmaW5lIjo2OSwiLi8kLnNldC10by1zdHJpbmctdGFnIjo3MywiLi8kLndrcyI6ODR9XSw1OTpbZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWUoIi4vJC53a3MiKSgiaXRlcmF0b3IiKSxvPSExO3RyeXt2YXIgaT1bN11bbl0oKTtpWyJyZXR1cm4iXT1mdW5jdGlvbigpe289ITB9LEFycmF5LmZyb20oaSxmdW5jdGlvbigpe3Rocm93IDJ9KX1jYXRjaChhKXt9dC5leHBvcnRzPWZ1bmN0aW9uKGUsdCl7aWYoIXQmJiFvKXJldHVybiExO3ZhciByPSExO3RyeXt2YXIgaT1bN10sYT1pW25dKCk7YS5uZXh0PWZ1bmN0aW9uKCl7cj0hMH0saVtuXT1mdW5jdGlvbigpe3JldHVybiBhfSxlKGkpfWNhdGNoKHMpe31yZXR1cm4gcn19LHsiLi8kLndrcyI6ODR9XSw2MDpbZnVuY3Rpb24oZSx0LHIpe3QuZXhwb3J0cz1mdW5jdGlvbihlLHQpe3JldHVybnt2YWx1ZTp0LGRvbmU6ISFlfX19LHt9XSw2MTpbZnVuY3Rpb24oZSx0LHIpe3QuZXhwb3J0cz17fX0se31dLDYyOltmdW5jdGlvbihlLHQscil7dmFyIG49T2JqZWN0O3QuZXhwb3J0cz17Y3JlYXRlOm4uY3JlYXRlLGdldFByb3RvOm4uZ2V0UHJvdG90eXBlT2YsaXNFbnVtOnt9LnByb3BlcnR5SXNFbnVtZXJhYmxlLGdldERlc2M6bi5nZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3Isc2V0RGVzYzpuLmRlZmluZVByb3BlcnR5LHNldERlc2NzOm4uZGVmaW5lUHJvcGVydGllcyxnZXRLZXlzOm4ua2V5cyxnZXROYW1lczpuLmdldE93blByb3BlcnR5TmFtZXMsZ2V0U3ltYm9sczpuLmdldE93blByb3BlcnR5U3ltYm9scyxlYWNoOltdLmZvckVhY2h9fSx7fV0sNjM6W2Z1bmN0aW9uKGUsdCxyKXt2YXIgbj1lKCIuLyQiKSxvPWUoIi4vJC50by1pb2JqZWN0Iik7dC5leHBvcnRzPWZ1bmN0aW9uKGUsdCl7Zm9yKHZhciByLGk9byhlKSxhPW4uZ2V0S2V5cyhpKSxzPWEubGVuZ3RoLHU9MDtzPnU7KWlmKGlbcj1hW3UrK11dPT09dClyZXR1cm4gcn19LHsiLi8kIjo2MiwiLi8kLnRvLWlvYmplY3QiOjgwfV0sNjQ6W2Z1bmN0aW9uKGUsdCxyKXt0LmV4cG9ydHM9ITB9LHt9XSw2NTpbZnVuY3Rpb24oZSx0LHIpe3ZhciBuLG8saSxhPWUoIi4vJC5nbG9iYWwiKSxzPWUoIi4vJC50YXNrIikuc2V0LHU9YS5NdXRhdGlvbk9ic2VydmVyfHxhLldlYktpdE11dGF0aW9uT2JzZXJ2ZXIsYz1hLnByb2Nlc3MsbD1hLlByb21pc2UsZj0icHJvY2VzcyI9PWUoIi4vJC5jb2YiKShjKSxwPWZ1bmN0aW9uKCl7dmFyIGUsdCxyO2ZvcihmJiYoZT1jLmRvbWFpbikmJihjLmRvbWFpbj1udWxsLGUuZXhpdCgpKTtuOyl0PW4uZG9tYWluLHI9bi5mbix0JiZ0LmVudGVyKCkscigpLHQmJnQuZXhpdCgpLG49bi5uZXh0O289dm9pZCAwLGUmJmUuZW50ZXIoKX07aWYoZilpPWZ1bmN0aW9uKCl7Yy5uZXh0VGljayhwKX07ZWxzZSBpZih1KXt2YXIgaD0xLGQ9ZG9jdW1lbnQuY3JlYXRlVGV4dE5vZGUoIiIpO25ldyB1KHApLm9ic2VydmUoZCx7Y2hhcmFjdGVyRGF0YTohMH0pLGk9ZnVuY3Rpb24oKXtkLmRhdGE9aD0taH19ZWxzZSBpPWwmJmwucmVzb2x2ZT9mdW5jdGlvbigpe2wucmVzb2x2ZSgpLnRoZW4ocCl9OmZ1bmN0aW9uKCl7cy5jYWxsKGEscCl9O3QuZXhwb3J0cz1mdW5jdGlvbihlKXt2YXIgdD17Zm46ZSxuZXh0OnZvaWQgMCxkb21haW46ZiYmYy5kb21haW59O28mJihvLm5leHQ9dCksbnx8KG49dCxpKCkpLG89dH19LHsiLi8kLmNvZiI6MzYsIi4vJC5nbG9iYWwiOjQ3LCIuLyQudGFzayI6Nzh9XSw2NjpbZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWUoIi4vJC5leHBvcnQiKSxvPWUoIi4vJC5jb3JlIiksaT1lKCIuLyQuZmFpbHMiKTt0LmV4cG9ydHM9ZnVuY3Rpb24oZSx0KXt2YXIgcj0oby5PYmplY3R8fHt9KVtlXXx8T2JqZWN0W2VdLGE9e307YVtlXT10KHIpLG4obi5TK24uRippKGZ1bmN0aW9uKCl7cigxKX0pLCJPYmplY3QiLGEpfX0seyIuLyQuY29yZSI6MzcsIi4vJC5leHBvcnQiOjQzLCIuLyQuZmFpbHMiOjQ0fV0sNjc6W2Z1bmN0aW9uKGUsdCxyKXt0LmV4cG9ydHM9ZnVuY3Rpb24oZSx0KXtyZXR1cm57ZW51bWVyYWJsZTohKDEmZSksY29uZmlndXJhYmxlOiEoMiZlKSx3cml0YWJsZTohKDQmZSksdmFsdWU6dH19fSx7fV0sNjg6W2Z1bmN0aW9uKGUsdCxyKXt2YXIgbj1lKCIuLyQucmVkZWZpbmUiKTt0LmV4cG9ydHM9ZnVuY3Rpb24oZSx0KXtmb3IodmFyIHIgaW4gdCluKGUscix0W3JdKTtyZXR1cm4gZX19LHsiLi8kLnJlZGVmaW5lIjo2OX1dLDY5OltmdW5jdGlvbihlLHQscil7dC5leHBvcnRzPWUoIi4vJC5oaWRlIil9LHsiLi8kLmhpZGUiOjQ5fV0sNzA6W2Z1bmN0aW9uKGUsdCxyKXt0LmV4cG9ydHM9T2JqZWN0LmlzfHxmdW5jdGlvbihlLHQpe3JldHVybiBlPT09dD8wIT09ZXx8MS9lPT09MS90OmUhPWUmJnQhPXR9fSx7fV0sNzE6W2Z1bmN0aW9uKGUsdCxyKXt2YXIgbj1lKCIuLyQiKS5nZXREZXNjLG89ZSgiLi8kLmlzLW9iamVjdCIpLGk9ZSgiLi8kLmFuLW9iamVjdCIpLGE9ZnVuY3Rpb24oZSx0KXtpZihpKGUpLCFvKHQpJiZudWxsIT09dCl0aHJvdyBUeXBlRXJyb3IodCsiOiBjYW4ndCBzZXQgYXMgcHJvdG90eXBlISIpfTt0LmV4cG9ydHM9e3NldDpPYmplY3Quc2V0UHJvdG90eXBlT2Z8fCgiX19wcm90b19fImlue30/ZnVuY3Rpb24odCxyLG8pe3RyeXtvPWUoIi4vJC5jdHgiKShGdW5jdGlvbi5jYWxsLG4oT2JqZWN0LnByb3RvdHlwZSwiX19wcm90b19fIikuc2V0LDIpLG8odCxbXSkscj0hKHQgaW5zdGFuY2VvZiBBcnJheSl9Y2F0Y2goaSl7cj0hMH1yZXR1cm4gZnVuY3Rpb24oZSx0KXtyZXR1cm4gYShlLHQpLHI/ZS5fX3Byb3RvX189dDpvKGUsdCksZX19KHt9LCExKTp2b2lkIDApLGNoZWNrOmF9fSx7Ii4vJCI6NjIsIi4vJC5hbi1vYmplY3QiOjM0LCIuLyQuY3R4IjozOCwiLi8kLmlzLW9iamVjdCI6NTV9XSw3MjpbZnVuY3Rpb24oZSx0LHIpeyJ1c2Ugc3RyaWN0Ijt2YXIgbj1lKCIuLyQuY29yZSIpLG89ZSgiLi8kIiksaT1lKCIuLyQuZGVzY3JpcHRvcnMiKSxhPWUoIi4vJC53a3MiKSgic3BlY2llcyIpO3QuZXhwb3J0cz1mdW5jdGlvbihlKXt2YXIgdD1uW2VdO2kmJnQmJiF0W2FdJiZvLnNldERlc2ModCxhLHtjb25maWd1cmFibGU6ITAsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN9fSl9fSx7Ii4vJCI6NjIsIi4vJC5jb3JlIjozNywiLi8kLmRlc2NyaXB0b3JzIjo0MCwiLi8kLndrcyI6ODR9XSw3MzpbZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWUoIi4vJCIpLnNldERlc2Msbz1lKCIuLyQuaGFzIiksaT1lKCIuLyQud2tzIikoInRvU3RyaW5nVGFnIik7dC5leHBvcnRzPWZ1bmN0aW9uKGUsdCxyKXtlJiYhbyhlPXI/ZTplLnByb3RvdHlwZSxpKSYmbihlLGkse2NvbmZpZ3VyYWJsZTohMCx2YWx1ZTp0fSl9fSx7Ii4vJCI6NjIsIi4vJC5oYXMiOjQ4LCIuLyQud2tzIjo4NH1dLDc0OltmdW5jdGlvbihlLHQscil7dmFyIG49ZSgiLi8kLmdsb2JhbCIpLG89Il9fY29yZS1qc19zaGFyZWRfXyIsaT1uW29dfHwobltvXT17fSk7dC5leHBvcnRzPWZ1bmN0aW9uKGUpe3JldHVybiBpW2VdfHwoaVtlXT17fSl9fSx7Ii4vJC5nbG9iYWwiOjQ3fV0sNzU6W2Z1bmN0aW9uKGUsdCxyKXt2YXIgbj1lKCIuLyQuYW4tb2JqZWN0Iiksbz1lKCIuLyQuYS1mdW5jdGlvbiIpLGk9ZSgiLi8kLndrcyIpKCJzcGVjaWVzIik7dC5leHBvcnRzPWZ1bmN0aW9uKGUsdCl7dmFyIHIsYT1uKGUpLmNvbnN0cnVjdG9yO3JldHVybiB2b2lkIDA9PT1hfHx2b2lkIDA9PShyPW4oYSlbaV0pP3Q6byhyKX19LHsiLi8kLmEtZnVuY3Rpb24iOjMyLCIuLyQuYW4tb2JqZWN0IjozNCwiLi8kLndrcyI6ODR9XSw3NjpbZnVuY3Rpb24oZSx0LHIpe3QuZXhwb3J0cz1mdW5jdGlvbihlLHQscil7aWYoIShlIGluc3RhbmNlb2YgdCkpdGhyb3cgVHlwZUVycm9yKHIrIjogdXNlIHRoZSAnbmV3JyBvcGVyYXRvciEiKTtyZXR1cm4gZX19LHt9XSw3NzpbZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWUoIi4vJC50by1pbnRlZ2VyIiksbz1lKCIuLyQuZGVmaW5lZCIpO3QuZXhwb3J0cz1mdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCxyKXt2YXIgaSxhLHM9U3RyaW5nKG8odCkpLHU9bihyKSxjPXMubGVuZ3RoO3JldHVybiAwPnV8fHU+PWM/ZT8iIjp2b2lkIDA6KGk9cy5jaGFyQ29kZUF0KHUpLDU1Mjk2Pml8fGk+NTYzMTl8fHUrMT09PWN8fChhPXMuY2hhckNvZGVBdCh1KzEpKTw1NjMyMHx8YT41NzM0Mz9lP3MuY2hhckF0KHUpOmk6ZT9zLnNsaWNlKHUsdSsyKTooaS01NTI5Njw8MTApKyhhLTU2MzIwKSs2NTUzNil9fX0seyIuLyQuZGVmaW5lZCI6MzksIi4vJC50by1pbnRlZ2VyIjo3OX1dLDc4OltmdW5jdGlvbihlLHQscil7dmFyIG4sbyxpLGE9ZSgiLi8kLmN0eCIpLHM9ZSgiLi8kLmludm9rZSIpLHU9ZSgiLi8kLmh0bWwiKSxjPWUoIi4vJC5kb20tY3JlYXRlIiksbD1lKCIuLyQuZ2xvYmFsIiksZj1sLnByb2Nlc3MscD1sLnNldEltbWVkaWF0ZSxoPWwuY2xlYXJJbW1lZGlhdGUsZD1sLk1lc3NhZ2VDaGFubmVsLHk9MCxiPXt9LG09Im9ucmVhZHlzdGF0ZWNoYW5nZSIsdj1mdW5jdGlvbigpe3ZhciBlPSt0aGlzO2lmKGIuaGFzT3duUHJvcGVydHkoZSkpe3ZhciB0PWJbZV07ZGVsZXRlIGJbZV0sdCgpfX0sZz1mdW5jdGlvbihlKXt2LmNhbGwoZS5kYXRhKX07cCYmaHx8KHA9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PVtdLHI9MTthcmd1bWVudHMubGVuZ3RoPnI7KXQucHVzaChhcmd1bWVudHNbcisrXSk7cmV0dXJuIGJbKyt5XT1mdW5jdGlvbigpe3MoImZ1bmN0aW9uIj09dHlwZW9mIGU/ZTpGdW5jdGlvbihlKSx0KX0sbih5KSx5fSxoPWZ1bmN0aW9uKGUpe2RlbGV0ZSBiW2VdfSwicHJvY2VzcyI9PWUoIi4vJC5jb2YiKShmKT9uPWZ1bmN0aW9uKGUpe2YubmV4dFRpY2soYSh2LGUsMSkpfTpkPyhvPW5ldyBkLGk9by5wb3J0MixvLnBvcnQxLm9ubWVzc2FnZT1nLG49YShpLnBvc3RNZXNzYWdlLGksMSkpOmwuYWRkRXZlbnRMaXN0ZW5lciYmImZ1bmN0aW9uIj09dHlwZW9mIHBvc3RNZXNzYWdlJiYhbC5pbXBvcnRTY3JpcHRzPyhuPWZ1bmN0aW9uKGUpe2wucG9zdE1lc3NhZ2UoZSsiIiwiKiIpfSxsLmFkZEV2ZW50TGlzdGVuZXIoIm1lc3NhZ2UiLGcsITEpKTpuPW0gaW4gYygic2NyaXB0Iik/ZnVuY3Rpb24oZSl7dS5hcHBlbmRDaGlsZChjKCJzY3JpcHQiKSlbbV09ZnVuY3Rpb24oKXt1LnJlbW92ZUNoaWxkKHRoaXMpLHYuY2FsbChlKX19OmZ1bmN0aW9uKGUpe3NldFRpbWVvdXQoYSh2LGUsMSksMCl9KSx0LmV4cG9ydHM9e3NldDpwLGNsZWFyOmh9fSx7Ii4vJC5jb2YiOjM2LCIuLyQuY3R4IjozOCwiLi8kLmRvbS1jcmVhdGUiOjQxLCIuLyQuZ2xvYmFsIjo0NywiLi8kLmh0bWwiOjUwLCIuLyQuaW52b2tlIjo1MX1dLDc5OltmdW5jdGlvbihlLHQscil7dmFyIG49TWF0aC5jZWlsLG89TWF0aC5mbG9vcjt0LmV4cG9ydHM9ZnVuY3Rpb24oZSl7cmV0dXJuIGlzTmFOKGU9K2UpPzA6KGU+MD9vOm4pKGUpfX0se31dLDgwOltmdW5jdGlvbihlLHQscil7dmFyIG49ZSgiLi8kLmlvYmplY3QiKSxvPWUoIi4vJC5kZWZpbmVkIik7dC5leHBvcnRzPWZ1bmN0aW9uKGUpe3JldHVybiBuKG8oZSkpfX0seyIuLyQuZGVmaW5lZCI6MzksIi4vJC5pb2JqZWN0Ijo1Mn1dLDgxOltmdW5jdGlvbihlLHQscil7dmFyIG49ZSgiLi8kLnRvLWludGVnZXIiKSxvPU1hdGgubWluO3QuZXhwb3J0cz1mdW5jdGlvbihlKXtyZXR1cm4gZT4wP28obihlKSw5MDA3MTk5MjU0NzQwOTkxKTowfX0seyIuLyQudG8taW50ZWdlciI6Nzl9XSw4MjpbZnVuY3Rpb24oZSx0LHIpe3ZhciBuPWUoIi4vJC5kZWZpbmVkIik7dC5leHBvcnRzPWZ1bmN0aW9uKGUpe3JldHVybiBPYmplY3QobihlKSl9fSx7Ii4vJC5kZWZpbmVkIjozOX1dLDgzOltmdW5jdGlvbihlLHQscil7dmFyIG49MCxvPU1hdGgucmFuZG9tKCk7dC5leHBvcnRzPWZ1bmN0aW9uKGUpe3JldHVybiJTeW1ib2woIi5jb25jYXQodm9pZCAwPT09ZT8iIjplLCIpXyIsKCsrbitvKS50b1N0cmluZygzNikpfX0se31dLDg0OltmdW5jdGlvbihlLHQscil7dmFyIG49ZSgiLi8kLnNoYXJlZCIpKCJ3a3MiKSxvPWUoIi4vJC51aWQiKSxpPWUoIi4vJC5nbG9iYWwiKS5TeW1ib2w7dC5leHBvcnRzPWZ1bmN0aW9uKGUpe3JldHVybiBuW2VdfHwobltlXT1pJiZpW2VdfHwoaXx8bykoIlN5bWJvbC4iK2UpKX19LHsiLi8kLmdsb2JhbCI6NDcsIi4vJC5zaGFyZWQiOjc0LCIuLyQudWlkIjo4M31dLDg1OltmdW5jdGlvbihlLHQscil7dmFyIG49ZSgiLi8kLmNsYXNzb2YiKSxvPWUoIi4vJC53a3MiKSgiaXRlcmF0b3IiKSxpPWUoIi4vJC5pdGVyYXRvcnMiKTt0LmV4cG9ydHM9ZSgiLi8kLmNvcmUiKS5nZXRJdGVyYXRvck1ldGhvZD1mdW5jdGlvbihlKXtyZXR1cm4gdm9pZCAwIT1lP2Vbb118fGVbIkBAaXRlcmF0b3IiXXx8aVtuKGUpXTp2b2lkIDB9fSx7Ii4vJC5jbGFzc29mIjozNSwiLi8kLmNvcmUiOjM3LCIuLyQuaXRlcmF0b3JzIjo2MSwiLi8kLndrcyI6ODR9XSw4NjpbZnVuY3Rpb24oZSx0LHIpeyJ1c2Ugc3RyaWN0Ijt2YXIgbj1lKCIuLyQuYWRkLXRvLXVuc2NvcGFibGVzIiksbz1lKCIuLyQuaXRlci1zdGVwIiksaT1lKCIuLyQuaXRlcmF0b3JzIiksYT1lKCIuLyQudG8taW9iamVjdCIpO3QuZXhwb3J0cz1lKCIuLyQuaXRlci1kZWZpbmUiKShBcnJheSwiQXJyYXkiLGZ1bmN0aW9uKGUsdCl7dGhpcy5fdD1hKGUpLHRoaXMuX2k9MCx0aGlzLl9rPXR9LGZ1bmN0aW9uKCl7dmFyIGU9dGhpcy5fdCx0PXRoaXMuX2sscj10aGlzLl9pKys7cmV0dXJuIWV8fHI+PWUubGVuZ3RoPyh0aGlzLl90PXZvaWQgMCxvKDEpKToia2V5cyI9PXQ/bygwLHIpOiJ2YWx1ZXMiPT10P28oMCxlW3JdKTpvKDAsW3IsZVtyXV0pfSwidmFsdWVzIiksaS5Bcmd1bWVudHM9aS5BcnJheSxuKCJrZXlzIiksbigidmFsdWVzIiksbigiZW50cmllcyIpfSx7Ii4vJC5hZGQtdG8tdW5zY29wYWJsZXMiOjMzLCIuLyQuaXRlci1kZWZpbmUiOjU4LCIuLyQuaXRlci1zdGVwIjo2MCwiLi8kLml0ZXJhdG9ycyI6NjEsIi4vJC50by1pb2JqZWN0Ijo4MH1dLDg3OltmdW5jdGlvbihlLHQscil7dmFyIG49ZSgiLi8kLmlzLW9iamVjdCIpO2UoIi4vJC5vYmplY3Qtc2FwIikoImZyZWV6ZSIsZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKHQpe3JldHVybiBlJiZuKHQpP2UodCk6dH19KX0seyIuLyQuaXMtb2JqZWN0Ijo1NSwiLi8kLm9iamVjdC1zYXAiOjY2fV0sODg6W2Z1bmN0aW9uKGUsdCxyKXt2YXIgbj1lKCIuLyQudG8taW9iamVjdCIpO2UoIi4vJC5vYmplY3Qtc2FwIikoImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsZnVuY3Rpb24oZSl7cmV0dXJuIGZ1bmN0aW9uKHQscil7cmV0dXJuIGUobih0KSxyKX19KX0seyIuLyQub2JqZWN0LXNhcCI6NjYsIi4vJC50by1pb2JqZWN0Ijo4MH1dLDg5OltmdW5jdGlvbihlLHQscil7dmFyIG49ZSgiLi8kLnRvLW9iamVjdCIpO2UoIi4vJC5vYmplY3Qtc2FwIikoImdldFByb3RvdHlwZU9mIixmdW5jdGlvbihlKXtyZXR1cm4gZnVuY3Rpb24odCl7cmV0dXJuIGUobih0KSl9fSl9LHsiLi8kLm9iamVjdC1zYXAiOjY2LCIuLyQudG8tb2JqZWN0Ijo4Mn1dLDkwOltmdW5jdGlvbihlLHQscil7dmFyIG49ZSgiLi8kLnRvLW9iamVjdCIpO2UoIi4vJC5vYmplY3Qtc2FwIikoImtleXMiLGZ1bmN0aW9uKGUpe3JldHVybiBmdW5jdGlvbih0KXtyZXR1cm4gZShuKHQpKX19KX0seyIuLyQub2JqZWN0LXNhcCI6NjYsIi4vJC50by1vYmplY3QiOjgyfV0sOTE6W2Z1bmN0aW9uKGUsdCxyKXt2YXIgbj1lKCIuLyQuZXhwb3J0Iik7bihuLlMsIk9iamVjdCIse3NldFByb3RvdHlwZU9mOmUoIi4vJC5zZXQtcHJvdG8iKS5zZXR9KX0seyIuLyQuZXhwb3J0Ijo0MywiLi8kLnNldC1wcm90byI6NzF9XSw5MjpbZnVuY3Rpb24oZSx0LHIpe30se31dLDkzOltmdW5jdGlvbihlLHQscil7InVzZSBzdHJpY3QiO3ZhciBuLG89ZSgiLi8kIiksaT1lKCIuLyQubGlicmFyeSIpLGE9ZSgiLi8kLmdsb2JhbCIpLHM9ZSgiLi8kLmN0eCIpLHU9ZSgiLi8kLmNsYXNzb2YiKSxjPWUoIi4vJC5leHBvcnQiKSxsPWUoIi4vJC5pcy1vYmplY3QiKSxmPWUoIi4vJC5hbi1vYmplY3QiKSxwPWUoIi4vJC5hLWZ1bmN0aW9uIiksaD1lKCIuLyQuc3RyaWN0LW5ldyIpLGQ9ZSgiLi8kLmZvci1vZiIpLHk9ZSgiLi8kLnNldC1wcm90byIpLnNldCxiPWUoIi4vJC5zYW1lLXZhbHVlIiksbT1lKCIuLyQud2tzIikoInNwZWNpZXMiKSx2PWUoIi4vJC5zcGVjaWVzLWNvbnN0cnVjdG9yIiksZz1lKCIuLyQubWljcm90YXNrIiksXz0iUHJvbWlzZSIsTz1hLnByb2Nlc3Msaj0icHJvY2VzcyI9PXUoTyksRT1hW19dLHc9ZnVuY3Rpb24oZSl7dmFyIHQ9bmV3IEUoZnVuY3Rpb24oKXt9KTtyZXR1cm4gZSYmKHQuY29uc3RydWN0b3I9T2JqZWN0KSxFLnJlc29sdmUodCk9PT10fSxrPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gdChlKXt2YXIgcj1uZXcgRShlKTtyZXR1cm4geShyLHQucHJvdG90eXBlKSxyfXZhciByPSExO3RyeXtpZihyPUUmJkUucmVzb2x2ZSYmdygpLHkodCxFKSx0LnByb3RvdHlwZT1vLmNyZWF0ZShFLnByb3RvdHlwZSx7Y29uc3RydWN0b3I6e3ZhbHVlOnR9fSksdC5yZXNvbHZlKDUpLnRoZW4oZnVuY3Rpb24oKXt9KWluc3RhbmNlb2YgdHx8KHI9ITEpLHImJmUoIi4vJC5kZXNjcmlwdG9ycyIpKXt2YXIgbj0hMTtFLnJlc29sdmUoby5zZXREZXNjKHt9LCJ0aGVuIix7Z2V0OmZ1bmN0aW9uKCl7bj0hMH19KSkscj1ufX1jYXRjaChpKXtyPSExfXJldHVybiByfSgpLCQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gaSYmZT09PUUmJnQ9PT1uPyEwOmIoZSx0KX0sUD1mdW5jdGlvbihlKXt2YXIgdD1mKGUpW21dO3JldHVybiB2b2lkIDAhPXQ/dDplfSxTPWZ1bmN0aW9uKGUpe3ZhciB0O3JldHVybiBsKGUpJiYiZnVuY3Rpb24iPT10eXBlb2YodD1lLnRoZW4pP3Q6ITF9LE09ZnVuY3Rpb24oZSl7dmFyIHQscjt0aGlzLnByb21pc2U9bmV3IGUoZnVuY3Rpb24oZSxuKXtpZih2b2lkIDAhPT10fHx2b2lkIDAhPT1yKXRocm93IFR5cGVFcnJvcigiQmFkIFByb21pc2UgY29uc3RydWN0b3IiKTt0PWUscj1ufSksdGhpcy5yZXNvbHZlPXAodCksdGhpcy5yZWplY3Q9cChyKX0sUj1mdW5jdGlvbihlKXt0cnl7ZSgpfWNhdGNoKHQpe3JldHVybntlcnJvcjp0fX19LHg9ZnVuY3Rpb24oZSx0KXtpZighZS5uKXtlLm49ITA7dmFyIHI9ZS5jO2coZnVuY3Rpb24oKXtmb3IodmFyIG49ZS52LG89MT09ZS5zLGk9MCxzPWZ1bmN0aW9uKHQpe3ZhciByLGksYT1vP3Qub2s6dC5mYWlsLHM9dC5yZXNvbHZlLHU9dC5yZWplY3Q7dHJ5e2E/KG98fChlLmg9ITApLHI9YT09PSEwP246YShuKSxyPT09dC5wcm9taXNlP3UoVHlwZUVycm9yKCJQcm9taXNlLWNoYWluIGN5Y2xlIikpOihpPVMocikpP2kuY2FsbChyLHMsdSk6cyhyKSk6dShuKX1jYXRjaChjKXt1KGMpfX07ci5sZW5ndGg+aTspcyhyW2krK10pO3IubGVuZ3RoPTAsZS5uPSExLHQmJnNldFRpbWVvdXQoZnVuY3Rpb24oKXt2YXIgdCxyLG89ZS5wO1QobykmJihqP08uZW1pdCgidW5oYW5kbGVkUmVqZWN0aW9uIixuLG8pOih0PWEub251bmhhbmRsZWRyZWplY3Rpb24pP3Qoe3Byb21pc2U6byxyZWFzb246bn0pOihyPWEuY29uc29sZSkmJnIuZXJyb3ImJnIuZXJyb3IoIlVuaGFuZGxlZCBwcm9taXNlIHJlamVjdGlvbiIsbikpLGUuYT12b2lkIDB9LDEpfSl9fSxUPWZ1bmN0aW9uKGUpe3ZhciB0LHI9ZS5fZCxuPXIuYXx8ci5jLG89MDtpZihyLmgpcmV0dXJuITE7Zm9yKDtuLmxlbmd0aD5vOylpZih0PW5bbysrXSx0LmZhaWx8fCFUKHQucHJvbWlzZSkpcmV0dXJuITE7cmV0dXJuITB9LEE9ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpczt0LmR8fCh0LmQ9ITAsdD10LnJ8fHQsdC52PWUsdC5zPTIsdC5hPXQuYy5zbGljZSgpLHgodCwhMCkpfSxOPWZ1bmN0aW9uKGUpe3ZhciB0LHI9dGhpcztpZighci5kKXtyLmQ9ITAscj1yLnJ8fHI7dHJ5e2lmKHIucD09PWUpdGhyb3cgVHlwZUVycm9yKCJQcm9taXNlIGNhbid0IGJlIHJlc29sdmVkIGl0c2VsZiIpOyh0PVMoZSkpP2coZnVuY3Rpb24oKXt2YXIgbj17cjpyLGQ6ITF9O3RyeXt0LmNhbGwoZSxzKE4sbiwxKSxzKEEsbiwxKSl9Y2F0Y2gobyl7QS5jYWxsKG4sbyl9fSk6KHIudj1lLHIucz0xLHgociwhMSkpfWNhdGNoKG4pe0EuY2FsbCh7cjpyLGQ6ITF9LG4pfX19O2t8fChFPWZ1bmN0aW9uKGUpe3AoZSk7dmFyIHQ9dGhpcy5fZD17cDpoKHRoaXMsRSxfKSxjOltdLGE6dm9pZCAwLHM6MCxkOiExLHY6dm9pZCAwLGg6ITEsbjohMX07dHJ5e2UocyhOLHQsMSkscyhBLHQsMSkpfWNhdGNoKHIpe0EuY2FsbCh0LHIpfX0sZSgiLi8kLnJlZGVmaW5lLWFsbCIpKEUucHJvdG90eXBlLHt0aGVuOmZ1bmN0aW9uKGUsdCl7dmFyIHI9bmV3IE0odih0aGlzLEUpKSxuPXIucHJvbWlzZSxvPXRoaXMuX2Q7cmV0dXJuIHIub2s9ImZ1bmN0aW9uIj09dHlwZW9mIGU/ZTohMCxyLmZhaWw9ImZ1bmN0aW9uIj09dHlwZW9mIHQmJnQsby5jLnB1c2gociksby5hJiZvLmEucHVzaChyKSxvLnMmJngobywhMSksbn0sImNhdGNoIjpmdW5jdGlvbihlKXtyZXR1cm4gdGhpcy50aGVuKHZvaWQgMCxlKX19KSksYyhjLkcrYy5XK2MuRiohayx7UHJvbWlzZTpFfSksZSgiLi8kLnNldC10by1zdHJpbmctdGFnIikoRSxfKSxlKCIuLyQuc2V0LXNwZWNpZXMiKShfKSxuPWUoIi4vJC5jb3JlIilbX10sYyhjLlMrYy5GKiFrLF8se3JlamVjdDpmdW5jdGlvbihlKXt2YXIgdD1uZXcgTSh0aGlzKSxyPXQucmVqZWN0O3JldHVybiByKGUpLHQucHJvbWlzZX19KSxjKGMuUytjLkYqKCFrfHx3KCEwKSksXyx7cmVzb2x2ZTpmdW5jdGlvbihlKXtpZihlIGluc3RhbmNlb2YgRSYmJChlLmNvbnN0cnVjdG9yLHRoaXMpKXJldHVybiBlO3ZhciB0PW5ldyBNKHRoaXMpLHI9dC5yZXNvbHZlO3JldHVybiByKGUpLHQucHJvbWlzZX19KSxjKGMuUytjLkYqIShrJiZlKCIuLyQuaXRlci1kZXRlY3QiKShmdW5jdGlvbihlKXtFLmFsbChlKVsiY2F0Y2giXShmdW5jdGlvbigpe30pfSkpLF8se2FsbDpmdW5jdGlvbihlKXt2YXIgdD1QKHRoaXMpLHI9bmV3IE0odCksbj1yLnJlc29sdmUsaT1yLnJlamVjdCxhPVtdLHM9UihmdW5jdGlvbigpe2QoZSwhMSxhLnB1c2gsYSk7dmFyIHI9YS5sZW5ndGgscz1BcnJheShyKTtyP28uZWFjaC5jYWxsKGEsZnVuY3Rpb24oZSxvKXt2YXIgYT0hMTt0LnJlc29sdmUoZSkudGhlbihmdW5jdGlvbihlKXthfHwoYT0hMCxzW29dPWUsLS1yfHxuKHMpKX0saSl9KTpuKHMpfSk7cmV0dXJuIHMmJmkocy5lcnJvciksci5wcm9taXNlfSxyYWNlOmZ1bmN0aW9uKGUpe3ZhciB0PVAodGhpcykscj1uZXcgTSh0KSxuPXIucmVqZWN0LG89UihmdW5jdGlvbigpe2QoZSwhMSxmdW5jdGlvbihlKXt0LnJlc29sdmUoZSkudGhlbihyLnJlc29sdmUsbil9KX0pO3JldHVybiBvJiZuKG8uZXJyb3IpLHIucHJvbWlzZX19KX0seyIuLyQiOjYyLCIuLyQuYS1mdW5jdGlvbiI6MzIsCiIuLyQuYW4tb2JqZWN0IjozNCwiLi8kLmNsYXNzb2YiOjM1LCIuLyQuY29yZSI6MzcsIi4vJC5jdHgiOjM4LCIuLyQuZGVzY3JpcHRvcnMiOjQwLCIuLyQuZXhwb3J0Ijo0MywiLi8kLmZvci1vZiI6NDUsIi4vJC5nbG9iYWwiOjQ3LCIuLyQuaXMtb2JqZWN0Ijo1NSwiLi8kLml0ZXItZGV0ZWN0Ijo1OSwiLi8kLmxpYnJhcnkiOjY0LCIuLyQubWljcm90YXNrIjo2NSwiLi8kLnJlZGVmaW5lLWFsbCI6NjgsIi4vJC5zYW1lLXZhbHVlIjo3MCwiLi8kLnNldC1wcm90byI6NzEsIi4vJC5zZXQtc3BlY2llcyI6NzIsIi4vJC5zZXQtdG8tc3RyaW5nLXRhZyI6NzMsIi4vJC5zcGVjaWVzLWNvbnN0cnVjdG9yIjo3NSwiLi8kLnN0cmljdC1uZXciOjc2LCIuLyQud2tzIjo4NH1dLDk0OltmdW5jdGlvbihlLHQscil7InVzZSBzdHJpY3QiO3ZhciBuPWUoIi4vJC5zdHJpbmctYXQiKSghMCk7ZSgiLi8kLml0ZXItZGVmaW5lIikoU3RyaW5nLCJTdHJpbmciLGZ1bmN0aW9uKGUpe3RoaXMuX3Q9U3RyaW5nKGUpLHRoaXMuX2k9MH0sZnVuY3Rpb24oKXt2YXIgZSx0PXRoaXMuX3Qscj10aGlzLl9pO3JldHVybiByPj10Lmxlbmd0aD97dmFsdWU6dm9pZCAwLGRvbmU6ITB9OihlPW4odCxyKSx0aGlzLl9pKz1lLmxlbmd0aCx7dmFsdWU6ZSxkb25lOiExfSl9KX0seyIuLyQuaXRlci1kZWZpbmUiOjU4LCIuLyQuc3RyaW5nLWF0Ijo3N31dLDk1OltmdW5jdGlvbihlLHQscil7InVzZSBzdHJpY3QiO3ZhciBuPWUoIi4vJCIpLG89ZSgiLi8kLmdsb2JhbCIpLGk9ZSgiLi8kLmhhcyIpLGE9ZSgiLi8kLmRlc2NyaXB0b3JzIikscz1lKCIuLyQuZXhwb3J0IiksdT1lKCIuLyQucmVkZWZpbmUiKSxjPWUoIi4vJC5mYWlscyIpLGw9ZSgiLi8kLnNoYXJlZCIpLGY9ZSgiLi8kLnNldC10by1zdHJpbmctdGFnIikscD1lKCIuLyQudWlkIiksaD1lKCIuLyQud2tzIiksZD1lKCIuLyQua2V5b2YiKSx5PWUoIi4vJC5nZXQtbmFtZXMiKSxiPWUoIi4vJC5lbnVtLWtleXMiKSxtPWUoIi4vJC5pcy1hcnJheSIpLHY9ZSgiLi8kLmFuLW9iamVjdCIpLGc9ZSgiLi8kLnRvLWlvYmplY3QiKSxfPWUoIi4vJC5wcm9wZXJ0eS1kZXNjIiksTz1uLmdldERlc2Msaj1uLnNldERlc2MsRT1uLmNyZWF0ZSx3PXkuZ2V0LGs9by5TeW1ib2wsJD1vLkpTT04sUD0kJiYkLnN0cmluZ2lmeSxTPSExLE09aCgiX2hpZGRlbiIpLFI9bi5pc0VudW0seD1sKCJzeW1ib2wtcmVnaXN0cnkiKSxUPWwoInN5bWJvbHMiKSxBPSJmdW5jdGlvbiI9PXR5cGVvZiBrLE49T2JqZWN0LnByb3RvdHlwZSxDPWEmJmMoZnVuY3Rpb24oKXtyZXR1cm4gNyE9RShqKHt9LCJhIix7Z2V0OmZ1bmN0aW9uKCl7cmV0dXJuIGoodGhpcywiYSIse3ZhbHVlOjd9KS5hfX0pKS5hfSk/ZnVuY3Rpb24oZSx0LHIpe3ZhciBuPU8oTix0KTtuJiZkZWxldGUgTlt0XSxqKGUsdCxyKSxuJiZlIT09TiYmaihOLHQsbil9OmosST1mdW5jdGlvbihlKXt2YXIgdD1UW2VdPUUoay5wcm90b3R5cGUpO3JldHVybiB0Ll9rPWUsYSYmUyYmQyhOLGUse2NvbmZpZ3VyYWJsZTohMCxzZXQ6ZnVuY3Rpb24odCl7aSh0aGlzLE0pJiZpKHRoaXNbTV0sZSkmJih0aGlzW01dW2VdPSExKSxDKHRoaXMsZSxfKDEsdCkpfX0pLHR9LEQ9ZnVuY3Rpb24oZSl7cmV0dXJuInN5bWJvbCI9PXR5cGVvZiBlfSxVPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gciYmaShULHQpPyhyLmVudW1lcmFibGU/KGkoZSxNKSYmZVtNXVt0XSYmKGVbTV1bdF09ITEpLHI9RShyLHtlbnVtZXJhYmxlOl8oMCwhMSl9KSk6KGkoZSxNKXx8aihlLE0sXygxLHt9KSksZVtNXVt0XT0hMCksQyhlLHQscikpOmooZSx0LHIpfSxMPWZ1bmN0aW9uKGUsdCl7dihlKTtmb3IodmFyIHIsbj1iKHQ9Zyh0KSksbz0wLGk9bi5sZW5ndGg7aT5vOylVKGUscj1uW28rK10sdFtyXSk7cmV0dXJuIGV9LEY9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gdm9pZCAwPT09dD9FKGUpOkwoRShlKSx0KX0sQj1mdW5jdGlvbihlKXt2YXIgdD1SLmNhbGwodGhpcyxlKTtyZXR1cm4gdHx8IWkodGhpcyxlKXx8IWkoVCxlKXx8aSh0aGlzLE0pJiZ0aGlzW01dW2VdP3Q6ITB9LEg9ZnVuY3Rpb24oZSx0KXt2YXIgcj1PKGU9ZyhlKSx0KTtyZXR1cm4hcnx8IWkoVCx0KXx8aShlLE0pJiZlW01dW3RdfHwoci5lbnVtZXJhYmxlPSEwKSxyfSxxPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdCxyPXcoZyhlKSksbj1bXSxvPTA7ci5sZW5ndGg+bzspaShULHQ9cltvKytdKXx8dD09TXx8bi5wdXNoKHQpO3JldHVybiBufSxZPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdCxyPXcoZyhlKSksbj1bXSxvPTA7ci5sZW5ndGg+bzspaShULHQ9cltvKytdKSYmbi5wdXNoKFRbdF0pO3JldHVybiBufSxHPWZ1bmN0aW9uKGUpe2lmKHZvaWQgMCE9PWUmJiFEKGUpKXtmb3IodmFyIHQscixuPVtlXSxvPTEsaT1hcmd1bWVudHM7aS5sZW5ndGg+bzspbi5wdXNoKGlbbysrXSk7cmV0dXJuIHQ9blsxXSwiZnVuY3Rpb24iPT10eXBlb2YgdCYmKHI9dCksKHJ8fCFtKHQpKSYmKHQ9ZnVuY3Rpb24oZSx0KXtyZXR1cm4gciYmKHQ9ci5jYWxsKHRoaXMsZSx0KSksRCh0KT92b2lkIDA6dH0pLG5bMV09dCxQLmFwcGx5KCQsbil9fSxLPWMoZnVuY3Rpb24oKXt2YXIgZT1rKCk7cmV0dXJuIltudWxsXSIhPVAoW2VdKXx8Int9IiE9UCh7YTplfSl8fCJ7fSIhPVAoT2JqZWN0KGUpKX0pO0F8fChrPWZ1bmN0aW9uKCl7aWYoRCh0aGlzKSl0aHJvdyBUeXBlRXJyb3IoIlN5bWJvbCBpcyBub3QgYSBjb25zdHJ1Y3RvciIpO3JldHVybiBJKHAoYXJndW1lbnRzLmxlbmd0aD4wP2FyZ3VtZW50c1swXTp2b2lkIDApKX0sdShrLnByb3RvdHlwZSwidG9TdHJpbmciLGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2t9KSxEPWZ1bmN0aW9uKGUpe3JldHVybiBlIGluc3RhbmNlb2Yga30sbi5jcmVhdGU9RixuLmlzRW51bT1CLG4uZ2V0RGVzYz1ILG4uc2V0RGVzYz1VLG4uc2V0RGVzY3M9TCxuLmdldE5hbWVzPXkuZ2V0PXEsbi5nZXRTeW1ib2xzPVksYSYmIWUoIi4vJC5saWJyYXJ5IikmJnUoTiwicHJvcGVydHlJc0VudW1lcmFibGUiLEIsITApKTt2YXIgVj17ImZvciI6ZnVuY3Rpb24oZSl7cmV0dXJuIGkoeCxlKz0iIik/eFtlXTp4W2VdPWsoZSl9LGtleUZvcjpmdW5jdGlvbihlKXtyZXR1cm4gZCh4LGUpfSx1c2VTZXR0ZXI6ZnVuY3Rpb24oKXtTPSEwfSx1c2VTaW1wbGU6ZnVuY3Rpb24oKXtTPSExfX07bi5lYWNoLmNhbGwoImhhc0luc3RhbmNlLGlzQ29uY2F0U3ByZWFkYWJsZSxpdGVyYXRvcixtYXRjaCxyZXBsYWNlLHNlYXJjaCxzcGVjaWVzLHNwbGl0LHRvUHJpbWl0aXZlLHRvU3RyaW5nVGFnLHVuc2NvcGFibGVzIi5zcGxpdCgiLCIpLGZ1bmN0aW9uKGUpe3ZhciB0PWgoZSk7VltlXT1BP3Q6SSh0KX0pLFM9ITAscyhzLkcrcy5XLHtTeW1ib2w6a30pLHMocy5TLCJTeW1ib2wiLFYpLHMocy5TK3MuRiohQSwiT2JqZWN0Iix7Y3JlYXRlOkYsZGVmaW5lUHJvcGVydHk6VSxkZWZpbmVQcm9wZXJ0aWVzOkwsZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yOkgsZ2V0T3duUHJvcGVydHlOYW1lczpxLGdldE93blByb3BlcnR5U3ltYm9sczpZfSksJCYmcyhzLlMrcy5GKighQXx8SyksIkpTT04iLHtzdHJpbmdpZnk6R30pLGYoaywiU3ltYm9sIiksZihNYXRoLCJNYXRoIiwhMCksZihvLkpTT04sIkpTT04iLCEwKX0seyIuLyQiOjYyLCIuLyQuYW4tb2JqZWN0IjozNCwiLi8kLmRlc2NyaXB0b3JzIjo0MCwiLi8kLmVudW0ta2V5cyI6NDIsIi4vJC5leHBvcnQiOjQzLCIuLyQuZmFpbHMiOjQ0LCIuLyQuZ2V0LW5hbWVzIjo0NiwiLi8kLmdsb2JhbCI6NDcsIi4vJC5oYXMiOjQ4LCIuLyQuaXMtYXJyYXkiOjU0LCIuLyQua2V5b2YiOjYzLCIuLyQubGlicmFyeSI6NjQsIi4vJC5wcm9wZXJ0eS1kZXNjIjo2NywiLi8kLnJlZGVmaW5lIjo2OSwiLi8kLnNldC10by1zdHJpbmctdGFnIjo3MywiLi8kLnNoYXJlZCI6NzQsIi4vJC50by1pb2JqZWN0Ijo4MCwiLi8kLnVpZCI6ODMsIi4vJC53a3MiOjg0fV0sOTY6W2Z1bmN0aW9uKGUsdCxyKXtlKCIuL2VzNi5hcnJheS5pdGVyYXRvciIpO3ZhciBuPWUoIi4vJC5pdGVyYXRvcnMiKTtuLk5vZGVMaXN0PW4uSFRNTENvbGxlY3Rpb249bi5BcnJheX0seyIuLyQuaXRlcmF0b3JzIjo2MSwiLi9lczYuYXJyYXkuaXRlcmF0b3IiOjg2fV0sOTc6W2Z1bmN0aW9uKGUsdCxyKXtmdW5jdGlvbiBuKCl7bD0hMSxzLmxlbmd0aD9jPXMuY29uY2F0KGMpOmY9LTEsYy5sZW5ndGgmJm8oKX1mdW5jdGlvbiBvKCl7aWYoIWwpe3ZhciBlPXNldFRpbWVvdXQobik7bD0hMDtmb3IodmFyIHQ9Yy5sZW5ndGg7dDspe2ZvcihzPWMsYz1bXTsrK2Y8dDspcyYmc1tmXS5ydW4oKTtmPS0xLHQ9Yy5sZW5ndGh9cz1udWxsLGw9ITEsY2xlYXJUaW1lb3V0KGUpfX1mdW5jdGlvbiBpKGUsdCl7dGhpcy5mdW49ZSx0aGlzLmFycmF5PXR9ZnVuY3Rpb24gYSgpe312YXIgcyx1PXQuZXhwb3J0cz17fSxjPVtdLGw9ITEsZj0tMTt1Lm5leHRUaWNrPWZ1bmN0aW9uKGUpe3ZhciB0PW5ldyBBcnJheShhcmd1bWVudHMubGVuZ3RoLTEpO2lmKGFyZ3VtZW50cy5sZW5ndGg+MSlmb3IodmFyIHI9MTtyPGFyZ3VtZW50cy5sZW5ndGg7cisrKXRbci0xXT1hcmd1bWVudHNbcl07Yy5wdXNoKG5ldyBpKGUsdCkpLDEhPT1jLmxlbmd0aHx8bHx8c2V0VGltZW91dChvLDApfSxpLnByb3RvdHlwZS5ydW49ZnVuY3Rpb24oKXt0aGlzLmZ1bi5hcHBseShudWxsLHRoaXMuYXJyYXkpfSx1LnRpdGxlPSJicm93c2VyIix1LmJyb3dzZXI9ITAsdS5lbnY9e30sdS5hcmd2PVtdLHUudmVyc2lvbj0iIix1LnZlcnNpb25zPXt9LHUub249YSx1LmFkZExpc3RlbmVyPWEsdS5vbmNlPWEsdS5vZmY9YSx1LnJlbW92ZUxpc3RlbmVyPWEsdS5yZW1vdmVBbGxMaXN0ZW5lcnM9YSx1LmVtaXQ9YSx1LmJpbmRpbmc9ZnVuY3Rpb24oZSl7dGhyb3cgbmV3IEVycm9yKCJwcm9jZXNzLmJpbmRpbmcgaXMgbm90IHN1cHBvcnRlZCIpfSx1LmN3ZD1mdW5jdGlvbigpe3JldHVybiIvIn0sdS5jaGRpcj1mdW5jdGlvbihlKXt0aHJvdyBuZXcgRXJyb3IoInByb2Nlc3MuY2hkaXIgaXMgbm90IHN1cHBvcnRlZCIpfSx1LnVtYXNrPWZ1bmN0aW9uKCl7cmV0dXJuIDB9fSx7fV0sOTg6W2Z1bmN0aW9uKHQscixuKXshZnVuY3Rpb24odCxuKXsiZnVuY3Rpb24iPT10eXBlb2YgZSYmZS5hbWQ/ZShbXSxuKToidW5kZWZpbmVkIiE9dHlwZW9mIHImJnIuZXhwb3J0cz9yLmV4cG9ydHM9bigpOnQudHY0PW4oKX0odGhpcyxmdW5jdGlvbigpe2Z1bmN0aW9uIGUoZSl7cmV0dXJuIGVuY29kZVVSSShlKS5yZXBsYWNlKC8lMjVbMC05XVswLTldL2csZnVuY3Rpb24oZSl7cmV0dXJuIiUiK2Uuc3Vic3RyaW5nKDMpfSl9ZnVuY3Rpb24gdCh0KXt2YXIgcj0iIjtwW3QuY2hhckF0KDApXSYmKHI9dC5jaGFyQXQoMCksdD10LnN1YnN0cmluZygxKSk7dmFyIG49IiIsbz0iIixpPSEwLGE9ITEscz0hMTsiKyI9PT1yP2k9ITE6Ii4iPT09cj8obz0iLiIsbj0iLiIpOiIvIj09PXI/KG89Ii8iLG49Ii8iKToiIyI9PT1yPyhvPSIjIixpPSExKToiOyI9PT1yPyhvPSI7IixuPSI7IixhPSEwLHM9ITApOiI/Ij09PXI/KG89Ij8iLG49IiYiLGE9ITApOiImIj09PXImJihvPSImIixuPSImIixhPSEwKTtmb3IodmFyIHU9W10sYz10LnNwbGl0KCIsIiksbD1bXSxmPXt9LGQ9MDtkPGMubGVuZ3RoO2QrKyl7dmFyIHk9Y1tkXSxiPW51bGw7aWYoLTEhPT15LmluZGV4T2YoIjoiKSl7dmFyIG09eS5zcGxpdCgiOiIpO3k9bVswXSxiPXBhcnNlSW50KG1bMV0sMTApfWZvcih2YXIgdj17fTtoW3kuY2hhckF0KHkubGVuZ3RoLTEpXTspdlt5LmNoYXJBdCh5Lmxlbmd0aC0xKV09ITAseT15LnN1YnN0cmluZygwLHkubGVuZ3RoLTEpO3ZhciBnPXt0cnVuY2F0ZTpiLG5hbWU6eSxzdWZmaWNlczp2fTtsLnB1c2goZyksZlt5XT1nLHUucHVzaCh5KX12YXIgXz1mdW5jdGlvbih0KXtmb3IodmFyIHI9IiIsdT0wLGM9MDtjPGwubGVuZ3RoO2MrKyl7dmFyIGY9bFtjXSxwPXQoZi5uYW1lKTtpZihudWxsPT09cHx8dm9pZCAwPT09cHx8QXJyYXkuaXNBcnJheShwKSYmMD09PXAubGVuZ3RofHwib2JqZWN0Ij09dHlwZW9mIHAmJjA9PT1PYmplY3Qua2V5cyhwKS5sZW5ndGgpdSsrO2Vsc2UgaWYocis9Yz09PXU/bzpufHwiLCIsQXJyYXkuaXNBcnJheShwKSl7YSYmKHIrPWYubmFtZSsiPSIpO2Zvcih2YXIgaD0wO2g8cC5sZW5ndGg7aCsrKWg+MCYmKHIrPWYuc3VmZmljZXNbIioiXT9ufHwiLCI6IiwiLGYuc3VmZmljZXNbIioiXSYmYSYmKHIrPWYubmFtZSsiPSIpKSxyKz1pP2VuY29kZVVSSUNvbXBvbmVudChwW2hdKS5yZXBsYWNlKC8hL2csIiUyMSIpOmUocFtoXSl9ZWxzZSBpZigib2JqZWN0Ij09dHlwZW9mIHApe2EmJiFmLnN1ZmZpY2VzWyIqIl0mJihyKz1mLm5hbWUrIj0iKTt2YXIgZD0hMDtmb3IodmFyIHkgaW4gcClkfHwocis9Zi5zdWZmaWNlc1siKiJdP258fCIsIjoiLCIpLGQ9ITEscis9aT9lbmNvZGVVUklDb21wb25lbnQoeSkucmVwbGFjZSgvIS9nLCIlMjEiKTplKHkpLHIrPWYuc3VmZmljZXNbIioiXT8iPSI6IiwiLHIrPWk/ZW5jb2RlVVJJQ29tcG9uZW50KHBbeV0pLnJlcGxhY2UoLyEvZywiJTIxIik6ZShwW3ldKX1lbHNlIGEmJihyKz1mLm5hbWUscyYmIiI9PT1wfHwocis9Ij0iKSksbnVsbCE9Zi50cnVuY2F0ZSYmKHA9cC5zdWJzdHJpbmcoMCxmLnRydW5jYXRlKSkscis9aT9lbmNvZGVVUklDb21wb25lbnQocCkucmVwbGFjZSgvIS9nLCIlMjEiKTplKHApfXJldHVybiByfTtyZXR1cm4gXy52YXJOYW1lcz11LHtwcmVmaXg6byxzdWJzdGl0dXRpb246X319ZnVuY3Rpb24gcihlKXtpZighKHRoaXMgaW5zdGFuY2VvZiByKSlyZXR1cm4gbmV3IHIoZSk7Zm9yKHZhciBuPWUuc3BsaXQoInsiKSxvPVtuLnNoaWZ0KCldLGk9W10sYT1bXSxzPVtdO24ubGVuZ3RoPjA7KXt2YXIgdT1uLnNoaWZ0KCksYz11LnNwbGl0KCJ9IilbMF0sbD11LnN1YnN0cmluZyhjLmxlbmd0aCsxKSxmPXQoYyk7YS5wdXNoKGYuc3Vic3RpdHV0aW9uKSxpLnB1c2goZi5wcmVmaXgpLG8ucHVzaChsKSxzPXMuY29uY2F0KGYuc3Vic3RpdHV0aW9uLnZhck5hbWVzKX10aGlzLmZpbGw9ZnVuY3Rpb24oZSl7Zm9yKHZhciB0PW9bMF0scj0wO3I8YS5sZW5ndGg7cisrKXt2YXIgbj1hW3JdO3QrPW4oZSksdCs9b1tyKzFdfXJldHVybiB0fSx0aGlzLnZhck5hbWVzPXMsdGhpcy50ZW1wbGF0ZT1lfWZ1bmN0aW9uIG4oZSx0KXtpZihlPT09dClyZXR1cm4hMDtpZihlJiZ0JiYib2JqZWN0Ij09dHlwZW9mIGUmJiJvYmplY3QiPT10eXBlb2YgdCl7aWYoQXJyYXkuaXNBcnJheShlKSE9PUFycmF5LmlzQXJyYXkodCkpcmV0dXJuITE7aWYoQXJyYXkuaXNBcnJheShlKSl7aWYoZS5sZW5ndGghPT10Lmxlbmd0aClyZXR1cm4hMTtmb3IodmFyIHI9MDtyPGUubGVuZ3RoO3IrKylpZighbihlW3JdLHRbcl0pKXJldHVybiExfWVsc2V7dmFyIG87Zm9yKG8gaW4gZSlpZih2b2lkIDA9PT10W29dJiZ2b2lkIDAhPT1lW29dKXJldHVybiExO2ZvcihvIGluIHQpaWYodm9pZCAwPT09ZVtvXSYmdm9pZCAwIT09dFtvXSlyZXR1cm4hMTtmb3IobyBpbiBlKWlmKCFuKGVbb10sdFtvXSkpcmV0dXJuITF9cmV0dXJuITB9cmV0dXJuITF9ZnVuY3Rpb24gbyhlKXt2YXIgdD1TdHJpbmcoZSkucmVwbGFjZSgvXlxzK3xccyskL2csIiIpLm1hdGNoKC9eKFteOlwvPyNdKzopPyhcL1wvKD86W146QF0qKD86OlteOkBdKik/QCk/KChbXjpcLz8jXSopKD86OihcZCopKT8pKT8oW14/I10qKShcP1teI10qKT8oI1tcc1xTXSopPy8pO3JldHVybiB0P3tocmVmOnRbMF18fCIiLHByb3RvY29sOnRbMV18fCIiLGF1dGhvcml0eTp0WzJdfHwiIixob3N0OnRbM118fCIiLGhvc3RuYW1lOnRbNF18fCIiLHBvcnQ6dFs1XXx8IiIscGF0aG5hbWU6dFs2XXx8IiIsc2VhcmNoOnRbN118fCIiLGhhc2g6dFs4XXx8IiJ9Om51bGx9ZnVuY3Rpb24gaShlLHQpe2Z1bmN0aW9uIHIoZSl7dmFyIHQ9W107cmV0dXJuIGUucmVwbGFjZSgvXihcLlwuPyhcL3wkKSkrLywiIikucmVwbGFjZSgvXC8oXC4oXC98JCkpKy9nLCIvIikucmVwbGFjZSgvXC9cLlwuJC8sIi8uLi8iKS5yZXBsYWNlKC9cLz9bXlwvXSovZyxmdW5jdGlvbihlKXsiLy4uIj09PWU/dC5wb3AoKTp0LnB1c2goZSl9KSx0LmpvaW4oIiIpLnJlcGxhY2UoL15cLy8sIi8iPT09ZS5jaGFyQXQoMCk/Ii8iOiIiKX1yZXR1cm4gdD1vKHR8fCIiKSxlPW8oZXx8IiIpLHQmJmU/KHQucHJvdG9jb2x8fGUucHJvdG9jb2wpKyh0LnByb3RvY29sfHx0LmF1dGhvcml0eT90LmF1dGhvcml0eTplLmF1dGhvcml0eSkrcih0LnByb3RvY29sfHx0LmF1dGhvcml0eXx8Ii8iPT09dC5wYXRobmFtZS5jaGFyQXQoMCk/dC5wYXRobmFtZTp0LnBhdGhuYW1lPyhlLmF1dGhvcml0eSYmIWUucGF0aG5hbWU/Ii8iOiIiKStlLnBhdGhuYW1lLnNsaWNlKDAsZS5wYXRobmFtZS5sYXN0SW5kZXhPZigiLyIpKzEpK3QucGF0aG5hbWU6ZS5wYXRobmFtZSkrKHQucHJvdG9jb2x8fHQuYXV0aG9yaXR5fHx0LnBhdGhuYW1lP3Quc2VhcmNoOnQuc2VhcmNofHxlLnNlYXJjaCkrdC5oYXNoOm51bGx9ZnVuY3Rpb24gYShlKXtyZXR1cm4gZS5zcGxpdCgiIyIpWzBdfWZ1bmN0aW9uIHMoZSx0KXtpZihlJiYib2JqZWN0Ij09dHlwZW9mIGUpaWYodm9pZCAwPT09dD90PWUuaWQ6InN0cmluZyI9PXR5cGVvZiBlLmlkJiYodD1pKHQsZS5pZCksZS5pZD10KSxBcnJheS5pc0FycmF5KGUpKWZvcih2YXIgcj0wO3I8ZS5sZW5ndGg7cisrKXMoZVtyXSx0KTtlbHNleyJzdHJpbmciPT10eXBlb2YgZS4kcmVmJiYoZS4kcmVmPWkodCxlLiRyZWYpKTtmb3IodmFyIG4gaW4gZSkiZW51bSIhPT1uJiZzKGVbbl0sdCl9fWZ1bmN0aW9uIHUoZSl7ZT1lfHwiZW4iO3ZhciB0PU9bZV07cmV0dXJuIGZ1bmN0aW9uKGUpe3ZhciByPXRbZS5jb2RlXXx8X1tlLmNvZGVdO2lmKCJzdHJpbmciIT10eXBlb2YgcilyZXR1cm4iVW5rbm93biBlcnJvciBjb2RlICIrZS5jb2RlKyI6ICIrSlNPTi5zdHJpbmdpZnkoZS5tZXNzYWdlUGFyYW1zKTt2YXIgbj1lLnBhcmFtcztyZXR1cm4gci5yZXBsYWNlKC9ceyhbXnt9XSopXH0vZyxmdW5jdGlvbihlLHQpe3ZhciByPW5bdF07cmV0dXJuInN0cmluZyI9PXR5cGVvZiByfHwibnVtYmVyIj09dHlwZW9mIHI/cjplfSl9fWZ1bmN0aW9uIGMoZSx0LHIsbixvKXtpZihFcnJvci5jYWxsKHRoaXMpLHZvaWQgMD09PWUpdGhyb3cgbmV3IEVycm9yKCJObyBlcnJvciBjb2RlIHN1cHBsaWVkOiAiK24pO3RoaXMubWVzc2FnZT0iIix0aGlzLnBhcmFtcz10LHRoaXMuY29kZT1lLHRoaXMuZGF0YVBhdGg9cnx8IiIsdGhpcy5zY2hlbWFQYXRoPW58fCIiLHRoaXMuc3ViRXJyb3JzPW98fG51bGw7dmFyIGk9bmV3IEVycm9yKHRoaXMubWVzc2FnZSk7aWYodGhpcy5zdGFjaz1pLnN0YWNrfHxpLnN0YWNrdHJhY2UsIXRoaXMuc3RhY2spdHJ5e3Rocm93IGl9Y2F0Y2goaSl7dGhpcy5zdGFjaz1pLnN0YWNrfHxpLnN0YWNrdHJhY2V9fWZ1bmN0aW9uIGwoZSx0KXtpZih0LnN1YnN0cmluZygwLGUubGVuZ3RoKT09PWUpe3ZhciByPXQuc3Vic3RyaW5nKGUubGVuZ3RoKTtpZih0Lmxlbmd0aD4wJiYiLyI9PT10LmNoYXJBdChlLmxlbmd0aC0xKXx8IiMiPT09ci5jaGFyQXQoMCl8fCI/Ij09PXIuY2hhckF0KDApKXJldHVybiEwfXJldHVybiExfWZ1bmN0aW9uIGYoZSl7dmFyIHQscixuPW5ldyBkLG89e3NldEVycm9yUmVwb3J0ZXI6ZnVuY3Rpb24oZSl7cmV0dXJuInN0cmluZyI9PXR5cGVvZiBlP3RoaXMubGFuZ3VhZ2UoZSk6KHI9ZSwhMCl9LGFkZEZvcm1hdDpmdW5jdGlvbigpe24uYWRkRm9ybWF0LmFwcGx5KG4sYXJndW1lbnRzKX0sbGFuZ3VhZ2U6ZnVuY3Rpb24oZSl7cmV0dXJuIGU/KE9bZV18fChlPWUuc3BsaXQoIi0iKVswXSksT1tlXT8odD1lLGUpOiExKTp0fSxhZGRMYW5ndWFnZTpmdW5jdGlvbihlLHQpe3ZhciByO2ZvcihyIGluIG0pdFtyXSYmIXRbbVtyXV0mJih0W21bcl1dPXRbcl0pO3ZhciBuPWUuc3BsaXQoIi0iKVswXTtpZihPW25dKXtPW2VdPU9iamVjdC5jcmVhdGUoT1tuXSk7Zm9yKHIgaW4gdCkidW5kZWZpbmVkIj09dHlwZW9mIE9bbl1bcl0mJihPW25dW3JdPXRbcl0pLE9bZV1bcl09dFtyXX1lbHNlIE9bZV09dCxPW25dPXQ7cmV0dXJuIHRoaXN9LGZyZXNoQXBpOmZ1bmN0aW9uKGUpe3ZhciB0PWYoKTtyZXR1cm4gZSYmdC5sYW5ndWFnZShlKSx0fSx2YWxpZGF0ZTpmdW5jdGlvbihlLG8saSxhKXt2YXIgcz11KHQpLGM9cj9mdW5jdGlvbihlLHQsbil7cmV0dXJuIHIoZSx0LG4pfHxzKGUsdCxuKX06cyxsPW5ldyBkKG4sITEsYyxpLGEpOyJzdHJpbmciPT10eXBlb2YgbyYmKG89eyRyZWY6b30pLGwuYWRkU2NoZW1hKCIiLG8pO3ZhciBmPWwudmFsaWRhdGVBbGwoZSxvLG51bGwsbnVsbCwiIik7cmV0dXJuIWYmJmEmJihmPWwuYmFuVW5rbm93blByb3BlcnRpZXMoZSxvKSksdGhpcy5lcnJvcj1mLHRoaXMubWlzc2luZz1sLm1pc3NpbmcsdGhpcy52YWxpZD1udWxsPT09Zix0aGlzLnZhbGlkfSx2YWxpZGF0ZVJlc3VsdDpmdW5jdGlvbigpe3ZhciBlPXt9O3JldHVybiB0aGlzLnZhbGlkYXRlLmFwcGx5KGUsYXJndW1lbnRzKSxlfSx2YWxpZGF0ZU11bHRpcGxlOmZ1bmN0aW9uKGUsbyxpLGEpe3ZhciBzPXUodCksYz1yP2Z1bmN0aW9uKGUsdCxuKXtyZXR1cm4gcihlLHQsbil8fHMoZSx0LG4pfTpzLGw9bmV3IGQobiwhMCxjLGksYSk7InN0cmluZyI9PXR5cGVvZiBvJiYobz17JHJlZjpvfSksbC5hZGRTY2hlbWEoIiIsbyksbC52YWxpZGF0ZUFsbChlLG8sbnVsbCxudWxsLCIiKSxhJiZsLmJhblVua25vd25Qcm9wZXJ0aWVzKGUsbyk7dmFyIGY9e307cmV0dXJuIGYuZXJyb3JzPWwuZXJyb3JzLGYubWlzc2luZz1sLm1pc3NpbmcsZi52YWxpZD0wPT09Zi5lcnJvcnMubGVuZ3RoLGZ9LGFkZFNjaGVtYTpmdW5jdGlvbigpe3JldHVybiBuLmFkZFNjaGVtYS5hcHBseShuLGFyZ3VtZW50cyl9LGdldFNjaGVtYTpmdW5jdGlvbigpe3JldHVybiBuLmdldFNjaGVtYS5hcHBseShuLGFyZ3VtZW50cyl9LGdldFNjaGVtYU1hcDpmdW5jdGlvbigpe3JldHVybiBuLmdldFNjaGVtYU1hcC5hcHBseShuLGFyZ3VtZW50cyl9LGdldFNjaGVtYVVyaXM6ZnVuY3Rpb24oKXtyZXR1cm4gbi5nZXRTY2hlbWFVcmlzLmFwcGx5KG4sYXJndW1lbnRzKX0sZ2V0TWlzc2luZ1VyaXM6ZnVuY3Rpb24oKXtyZXR1cm4gbi5nZXRNaXNzaW5nVXJpcy5hcHBseShuLGFyZ3VtZW50cyl9LGRyb3BTY2hlbWFzOmZ1bmN0aW9uKCl7bi5kcm9wU2NoZW1hcy5hcHBseShuLGFyZ3VtZW50cyl9LGRlZmluZUtleXdvcmQ6ZnVuY3Rpb24oKXtuLmRlZmluZUtleXdvcmQuYXBwbHkobixhcmd1bWVudHMpfSxkZWZpbmVFcnJvcjpmdW5jdGlvbihlLHQscil7aWYoInN0cmluZyIhPXR5cGVvZiBlfHwhL15bQS1aXSsoX1tBLVpdKykqJC8udGVzdChlKSl0aHJvdyBuZXcgRXJyb3IoIkNvZGUgbmFtZSBtdXN0IGJlIGEgc3RyaW5nIGluIFVQUEVSX0NBU0VfV0lUSF9VTkRFUlNDT1JFUyIpO2lmKCJudW1iZXIiIT10eXBlb2YgdHx8dCUxIT09MHx8MWU0PnQpdGhyb3cgbmV3IEVycm9yKCJDb2RlIG51bWJlciBtdXN0IGJlIGFuIGludGVnZXIgPiAxMDAwMCIpO2lmKCJ1bmRlZmluZWQiIT10eXBlb2YgbVtlXSl0aHJvdyBuZXcgRXJyb3IoIkVycm9yIGFscmVhZHkgZGVmaW5lZDogIitlKyIgYXMgIittW2VdKTtpZigidW5kZWZpbmVkIiE9dHlwZW9mIHZbdF0pdGhyb3cgbmV3IEVycm9yKCJFcnJvciBjb2RlIGFscmVhZHkgdXNlZDogIit2W3RdKyIgYXMgIit0KTttW2VdPXQsdlt0XT1lLF9bZV09X1t0XT1yO2Zvcih2YXIgbiBpbiBPKXt2YXIgbz1PW25dO29bZV0mJihvW3RdPW9bdF18fG9bZV0pfX0scmVzZXQ6ZnVuY3Rpb24oKXtuLnJlc2V0KCksdGhpcy5lcnJvcj1udWxsLHRoaXMubWlzc2luZz1bXSx0aGlzLnZhbGlkPSEwfSxtaXNzaW5nOltdLGVycm9yOm51bGwsdmFsaWQ6ITAsbm9ybVNjaGVtYTpzLHJlc29sdmVVcmw6aSxnZXREb2N1bWVudFVyaTphLGVycm9yQ29kZXM6bX07cmV0dXJuIG8ubGFuZ3VhZ2UoZXx8ImVuIiksb31PYmplY3Qua2V5c3x8KE9iamVjdC5rZXlzPWZ1bmN0aW9uKCl7dmFyIGU9T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSx0PSF7dG9TdHJpbmc6bnVsbH0ucHJvcGVydHlJc0VudW1lcmFibGUoInRvU3RyaW5nIikscj1bInRvU3RyaW5nIiwidG9Mb2NhbGVTdHJpbmciLCJ2YWx1ZU9mIiwiaGFzT3duUHJvcGVydHkiLCJpc1Byb3RvdHlwZU9mIiwicHJvcGVydHlJc0VudW1lcmFibGUiLCJjb25zdHJ1Y3RvciJdLG49ci5sZW5ndGg7cmV0dXJuIGZ1bmN0aW9uKG8pe2lmKCJvYmplY3QiIT10eXBlb2YgbyYmImZ1bmN0aW9uIiE9dHlwZW9mIG98fG51bGw9PT1vKXRocm93IG5ldyBUeXBlRXJyb3IoIk9iamVjdC5rZXlzIGNhbGxlZCBvbiBub24tb2JqZWN0Iik7dmFyIGk9W107Zm9yKHZhciBhIGluIG8pZS5jYWxsKG8sYSkmJmkucHVzaChhKTtpZih0KWZvcih2YXIgcz0wO24+cztzKyspZS5jYWxsKG8scltzXSkmJmkucHVzaChyW3NdKTtyZXR1cm4gaX19KCkpLE9iamVjdC5jcmVhdGV8fChPYmplY3QuY3JlYXRlPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe31yZXR1cm4gZnVuY3Rpb24odCl7aWYoMSE9PWFyZ3VtZW50cy5sZW5ndGgpdGhyb3cgbmV3IEVycm9yKCJPYmplY3QuY3JlYXRlIGltcGxlbWVudGF0aW9uIG9ubHkgYWNjZXB0cyBvbmUgcGFyYW1ldGVyLiIpO3JldHVybiBlLnByb3RvdHlwZT10LG5ldyBlfX0oKSksQXJyYXkuaXNBcnJheXx8KEFycmF5LmlzQXJyYXk9ZnVuY3Rpb24oZSl7cmV0dXJuIltvYmplY3QgQXJyYXldIj09PU9iamVjdC5wcm90b3R5cGUudG9TdHJpbmcuY2FsbChlKX0pLEFycmF5LnByb3RvdHlwZS5pbmRleE9mfHwoQXJyYXkucHJvdG90eXBlLmluZGV4T2Y9ZnVuY3Rpb24oZSl7aWYobnVsbD09PXRoaXMpdGhyb3cgbmV3IFR5cGVFcnJvcjt2YXIgdD1PYmplY3QodGhpcykscj10Lmxlbmd0aD4+PjA7aWYoMD09PXIpcmV0dXJuLTE7dmFyIG49MDtpZihhcmd1bWVudHMubGVuZ3RoPjEmJihuPU51bWJlcihhcmd1bWVudHNbMV0pLG4hPT1uP249MDowIT09biYmbiE9PTEvMCYmbiE9PS0oMS8wKSYmKG49KG4+MHx8LTEpKk1hdGguZmxvb3IoTWF0aC5hYnMobikpKSksbj49cilyZXR1cm4tMTtmb3IodmFyIG89bj49MD9uOk1hdGgubWF4KHItTWF0aC5hYnMobiksMCk7cj5vO28rKylpZihvIGluIHQmJnRbb109PT1lKXJldHVybiBvO3JldHVybi0xfSksT2JqZWN0LmlzRnJvemVufHwoT2JqZWN0LmlzRnJvemVuPWZ1bmN0aW9uKGUpe2Zvcih2YXIgdD0idHY0X3Rlc3RfZnJvemVuX2tleSI7ZS5oYXNPd25Qcm9wZXJ0eSh0KTspdCs9TWF0aC5yYW5kb20oKTt0cnl7cmV0dXJuIGVbdF09ITAsZGVsZXRlIGVbdF0sITF9Y2F0Y2gocil7cmV0dXJuITB9fSk7dmFyIHA9eyIrIjohMCwiIyI6ITAsIi4iOiEwLCIvIjohMCwiOyI6ITAsIj8iOiEwLCImIjohMH0saD17IioiOiEwfTtyLnByb3RvdHlwZT17dG9TdHJpbmc6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy50ZW1wbGF0ZX0sZmlsbEZyb21PYmplY3Q6ZnVuY3Rpb24oZSl7cmV0dXJuIHRoaXMuZmlsbChmdW5jdGlvbih0KXtyZXR1cm4gZVt0XX0pfX07dmFyIGQ9ZnVuY3Rpb24oZSx0LHIsbixvKXtpZih0aGlzLm1pc3Npbmc9W10sdGhpcy5taXNzaW5nTWFwPXt9LHRoaXMuZm9ybWF0VmFsaWRhdG9ycz1lP09iamVjdC5jcmVhdGUoZS5mb3JtYXRWYWxpZGF0b3JzKTp7fSx0aGlzLnNjaGVtYXM9ZT9PYmplY3QuY3JlYXRlKGUuc2NoZW1hcyk6e30sdGhpcy5jb2xsZWN0TXVsdGlwbGU9dCx0aGlzLmVycm9ycz1bXSx0aGlzLmhhbmRsZUVycm9yPXQ/dGhpcy5jb2xsZWN0RXJyb3I6dGhpcy5yZXR1cm5FcnJvcixuJiYodGhpcy5jaGVja1JlY3Vyc2l2ZT0hMCx0aGlzLnNjYW5uZWQ9W10sdGhpcy5zY2FubmVkRnJvemVuPVtdLHRoaXMuc2Nhbm5lZEZyb3plblNjaGVtYXM9W10sdGhpcy5zY2FubmVkRnJvemVuVmFsaWRhdGlvbkVycm9ycz1bXSx0aGlzLnZhbGlkYXRlZFNjaGVtYXNLZXk9InR2NF92YWxpZGF0aW9uX2lkIix0aGlzLnZhbGlkYXRpb25FcnJvcnNLZXk9InR2NF92YWxpZGF0aW9uX2Vycm9yc19pZCIpLG8mJih0aGlzLnRyYWNrVW5rbm93blByb3BlcnRpZXM9ITAsdGhpcy5rbm93blByb3BlcnR5UGF0aHM9e30sdGhpcy51bmtub3duUHJvcGVydHlQYXRocz17fSksdGhpcy5lcnJvclJlcG9ydGVyPXJ8fHUoImVuIiksInN0cmluZyI9PXR5cGVvZiB0aGlzLmVycm9yUmVwb3J0ZXIpdGhyb3cgbmV3IEVycm9yKCJkZWJ1ZyIpO2lmKHRoaXMuZGVmaW5lZEtleXdvcmRzPXt9LGUpZm9yKHZhciBpIGluIGUuZGVmaW5lZEtleXdvcmRzKXRoaXMuZGVmaW5lZEtleXdvcmRzW2ldPWUuZGVmaW5lZEtleXdvcmRzW2ldLnNsaWNlKDApfTtkLnByb3RvdHlwZS5kZWZpbmVLZXl3b3JkPWZ1bmN0aW9uKGUsdCl7dGhpcy5kZWZpbmVkS2V5d29yZHNbZV09dGhpcy5kZWZpbmVkS2V5d29yZHNbZV18fFtdLHRoaXMuZGVmaW5lZEtleXdvcmRzW2VdLnB1c2godCl9LGQucHJvdG90eXBlLmNyZWF0ZUVycm9yPWZ1bmN0aW9uKGUsdCxyLG4sbyxpLGEpe3ZhciBzPW5ldyBjKGUsdCxyLG4sbyk7cmV0dXJuIHMubWVzc2FnZT10aGlzLmVycm9yUmVwb3J0ZXIocyxpLGEpLHN9LGQucHJvdG90eXBlLnJldHVybkVycm9yPWZ1bmN0aW9uKGUpe3JldHVybiBlfSxkLnByb3RvdHlwZS5jb2xsZWN0RXJyb3I9ZnVuY3Rpb24oZSl7cmV0dXJuIGUmJnRoaXMuZXJyb3JzLnB1c2goZSksbnVsbH0sZC5wcm90b3R5cGUucHJlZml4RXJyb3JzPWZ1bmN0aW9uKGUsdCxyKXtmb3IodmFyIG49ZTtuPHRoaXMuZXJyb3JzLmxlbmd0aDtuKyspdGhpcy5lcnJvcnNbbl09dGhpcy5lcnJvcnNbbl0ucHJlZml4V2l0aCh0LHIpO3JldHVybiB0aGlzfSxkLnByb3RvdHlwZS5iYW5Vbmtub3duUHJvcGVydGllcz1mdW5jdGlvbihlLHQpe2Zvcih2YXIgciBpbiB0aGlzLnVua25vd25Qcm9wZXJ0eVBhdGhzKXt2YXIgbj10aGlzLmNyZWF0ZUVycm9yKG0uVU5LTk9XTl9QUk9QRVJUWSx7cGF0aDpyfSxyLCIiLG51bGwsZSx0KSxvPXRoaXMuaGFuZGxlRXJyb3Iobik7aWYobylyZXR1cm4gb31yZXR1cm4gbnVsbH0sZC5wcm90b3R5cGUuYWRkRm9ybWF0PWZ1bmN0aW9uKGUsdCl7aWYoIm9iamVjdCI9PXR5cGVvZiBlKXtmb3IodmFyIHIgaW4gZSl0aGlzLmFkZEZvcm1hdChyLGVbcl0pO3JldHVybiB0aGlzfXRoaXMuZm9ybWF0VmFsaWRhdG9yc1tlXT10fSxkLnByb3RvdHlwZS5yZXNvbHZlUmVmcz1mdW5jdGlvbihlLHQpe2lmKHZvaWQgMCE9PWUuJHJlZil7aWYodD10fHx7fSx0W2UuJHJlZl0pcmV0dXJuIHRoaXMuY3JlYXRlRXJyb3IobS5DSVJDVUxBUl9SRUZFUkVOQ0Use3VybHM6T2JqZWN0LmtleXModCkuam9pbigiLCAiKX0sIiIsIiIsbnVsbCx2b2lkIDAsZSk7dFtlLiRyZWZdPSEwLGU9dGhpcy5nZXRTY2hlbWEoZS4kcmVmLHQpfXJldHVybiBlfSxkLnByb3RvdHlwZS5nZXRTY2hlbWE9ZnVuY3Rpb24oZSx0KXt2YXIgcjtpZih2b2lkIDAhPT10aGlzLnNjaGVtYXNbZV0pcmV0dXJuIHI9dGhpcy5zY2hlbWFzW2VdLHRoaXMucmVzb2x2ZVJlZnMocix0KTt2YXIgbj1lLG89IiI7aWYoLTEhPT1lLmluZGV4T2YoIiMiKSYmKG89ZS5zdWJzdHJpbmcoZS5pbmRleE9mKCIjIikrMSksbj1lLnN1YnN0cmluZygwLGUuaW5kZXhPZigiIyIpKSksIm9iamVjdCI9PXR5cGVvZiB0aGlzLnNjaGVtYXNbbl0pe3I9dGhpcy5zY2hlbWFzW25dO3ZhciBpPWRlY29kZVVSSUNvbXBvbmVudChvKTtpZigiIj09PWkpcmV0dXJuIHRoaXMucmVzb2x2ZVJlZnMocix0KTtpZigiLyIhPT1pLmNoYXJBdCgwKSlyZXR1cm47Zm9yKHZhciBhPWkuc3BsaXQoIi8iKS5zbGljZSgxKSxzPTA7czxhLmxlbmd0aDtzKyspe3ZhciB1PWFbc10ucmVwbGFjZSgvfjEvZywiLyIpLnJlcGxhY2UoL34wL2csIn4iKTtpZih2b2lkIDA9PT1yW3VdKXtyPXZvaWQgMDticmVha31yPXJbdV19aWYodm9pZCAwIT09cilyZXR1cm4gdGhpcy5yZXNvbHZlUmVmcyhyLHQpfXZvaWQgMD09PXRoaXMubWlzc2luZ1tuXSYmKHRoaXMubWlzc2luZy5wdXNoKG4pLHRoaXMubWlzc2luZ1tuXT1uLHRoaXMubWlzc2luZ01hcFtuXT1uKX0sZC5wcm90b3R5cGUuc2VhcmNoU2NoZW1hcz1mdW5jdGlvbihlLHQpe2lmKEFycmF5LmlzQXJyYXkoZSkpZm9yKHZhciByPTA7cjxlLmxlbmd0aDtyKyspdGhpcy5zZWFyY2hTY2hlbWFzKGVbcl0sdCk7ZWxzZSBpZihlJiYib2JqZWN0Ij09dHlwZW9mIGUpeyJzdHJpbmciPT10eXBlb2YgZS5pZCYmbCh0LGUuaWQpJiZ2b2lkIDA9PT10aGlzLnNjaGVtYXNbZS5pZF0mJih0aGlzLnNjaGVtYXNbZS5pZF09ZSk7Zm9yKHZhciBuIGluIGUpaWYoImVudW0iIT09bilpZigib2JqZWN0Ij09dHlwZW9mIGVbbl0pdGhpcy5zZWFyY2hTY2hlbWFzKGVbbl0sdCk7ZWxzZSBpZigiJHJlZiI9PT1uKXt2YXIgbz1hKGVbbl0pO28mJnZvaWQgMD09PXRoaXMuc2NoZW1hc1tvXSYmdm9pZCAwPT09dGhpcy5taXNzaW5nTWFwW29dJiYodGhpcy5taXNzaW5nTWFwW29dPW8pfX19LGQucHJvdG90eXBlLmFkZFNjaGVtYT1mdW5jdGlvbihlLHQpe2lmKCJzdHJpbmciIT10eXBlb2YgZXx8InVuZGVmaW5lZCI9PXR5cGVvZiB0KXtpZigib2JqZWN0IiE9dHlwZW9mIGV8fCJzdHJpbmciIT10eXBlb2YgZS5pZClyZXR1cm47dD1lLGU9dC5pZH1lPT09YShlKSsiIyImJihlPWEoZSkpLHRoaXMuc2NoZW1hc1tlXT10LGRlbGV0ZSB0aGlzLm1pc3NpbmdNYXBbZV0scyh0LGUpLHRoaXMuc2VhcmNoU2NoZW1hcyh0LGUpfSxkLnByb3RvdHlwZS5nZXRTY2hlbWFNYXA9ZnVuY3Rpb24oKXt2YXIgZT17fTtmb3IodmFyIHQgaW4gdGhpcy5zY2hlbWFzKWVbdF09dGhpcy5zY2hlbWFzW3RdO3JldHVybiBlfSxkLnByb3RvdHlwZS5nZXRTY2hlbWFVcmlzPWZ1bmN0aW9uKGUpe3ZhciB0PVtdO2Zvcih2YXIgciBpbiB0aGlzLnNjaGVtYXMpKCFlfHxlLnRlc3QocikpJiZ0LnB1c2gocik7cmV0dXJuIHR9LGQucHJvdG90eXBlLmdldE1pc3NpbmdVcmlzPWZ1bmN0aW9uKGUpe3ZhciB0PVtdO2Zvcih2YXIgciBpbiB0aGlzLm1pc3NpbmdNYXApKCFlfHxlLnRlc3QocikpJiZ0LnB1c2gocik7cmV0dXJuIHR9LGQucHJvdG90eXBlLmRyb3BTY2hlbWFzPWZ1bmN0aW9uKCl7dGhpcy5zY2hlbWFzPXt9LHRoaXMucmVzZXQoKX0sZC5wcm90b3R5cGUucmVzZXQ9ZnVuY3Rpb24oKXt0aGlzLm1pc3Npbmc9W10sdGhpcy5taXNzaW5nTWFwPXt9LHRoaXMuZXJyb3JzPVtdfSxkLnByb3RvdHlwZS52YWxpZGF0ZUFsbD1mdW5jdGlvbihlLHQscixuLG8pe3ZhciBpO2lmKHQ9dGhpcy5yZXNvbHZlUmVmcyh0KSwhdClyZXR1cm4gbnVsbDtpZih0IGluc3RhbmNlb2YgYylyZXR1cm4gdGhpcy5lcnJvcnMucHVzaCh0KSx0O3ZhciBhLHM9dGhpcy5lcnJvcnMubGVuZ3RoLHU9bnVsbCxsPW51bGw7aWYodGhpcy5jaGVja1JlY3Vyc2l2ZSYmZSYmIm9iamVjdCI9PXR5cGVvZiBlKXtpZihpPSF0aGlzLnNjYW5uZWQubGVuZ3RoLGVbdGhpcy52YWxpZGF0ZWRTY2hlbWFzS2V5XSl7dmFyIGY9ZVt0aGlzLnZhbGlkYXRlZFNjaGVtYXNLZXldLmluZGV4T2YodCk7aWYoLTEhPT1mKXJldHVybiB0aGlzLmVycm9ycz10aGlzLmVycm9ycy5jb25jYXQoZVt0aGlzLnZhbGlkYXRpb25FcnJvcnNLZXldW2ZdKSxudWxsfWlmKE9iamVjdC5pc0Zyb3plbihlKSYmKGE9dGhpcy5zY2FubmVkRnJvemVuLmluZGV4T2YoZSksLTEhPT1hKSl7dmFyIHA9dGhpcy5zY2FubmVkRnJvemVuU2NoZW1hc1thXS5pbmRleE9mKHQpO2lmKC0xIT09cClyZXR1cm4gdGhpcy5lcnJvcnM9dGhpcy5lcnJvcnMuY29uY2F0KHRoaXMuc2Nhbm5lZEZyb3plblZhbGlkYXRpb25FcnJvcnNbYV1bcF0pLG51bGx9aWYodGhpcy5zY2FubmVkLnB1c2goZSksT2JqZWN0LmlzRnJvemVuKGUpKS0xPT09YSYmKGE9dGhpcy5zY2FubmVkRnJvemVuLmxlbmd0aCx0aGlzLnNjYW5uZWRGcm96ZW4ucHVzaChlKSx0aGlzLnNjYW5uZWRGcm96ZW5TY2hlbWFzLnB1c2goW10pKSx1PXRoaXMuc2Nhbm5lZEZyb3plblNjaGVtYXNbYV0ubGVuZ3RoLHRoaXMuc2Nhbm5lZEZyb3plblNjaGVtYXNbYV1bdV09dCx0aGlzLnNjYW5uZWRGcm96ZW5WYWxpZGF0aW9uRXJyb3JzW2FdW3VdPVtdO2Vsc2V7aWYoIWVbdGhpcy52YWxpZGF0ZWRTY2hlbWFzS2V5XSl0cnl7T2JqZWN0LmRlZmluZVByb3BlcnR5KGUsdGhpcy52YWxpZGF0ZWRTY2hlbWFzS2V5LHt2YWx1ZTpbXSxjb25maWd1cmFibGU6ITB9KSxPYmplY3QuZGVmaW5lUHJvcGVydHkoZSx0aGlzLnZhbGlkYXRpb25FcnJvcnNLZXkse3ZhbHVlOltdLGNvbmZpZ3VyYWJsZTohMH0pfWNhdGNoKGgpe2VbdGhpcy52YWxpZGF0ZWRTY2hlbWFzS2V5XT1bXSxlW3RoaXMudmFsaWRhdGlvbkVycm9yc0tleV09W119bD1lW3RoaXMudmFsaWRhdGVkU2NoZW1hc0tleV0ubGVuZ3RoLGVbdGhpcy52YWxpZGF0ZWRTY2hlbWFzS2V5XVtsXT10LGVbdGhpcy52YWxpZGF0aW9uRXJyb3JzS2V5XVtsXT1bXX19dmFyIGQ9dGhpcy5lcnJvcnMubGVuZ3RoLHk9dGhpcy52YWxpZGF0ZUJhc2ljKGUsdCxvKXx8dGhpcy52YWxpZGF0ZU51bWVyaWMoZSx0LG8pfHx0aGlzLnZhbGlkYXRlU3RyaW5nKGUsdCxvKXx8dGhpcy52YWxpZGF0ZUFycmF5KGUsdCxvKXx8dGhpcy52YWxpZGF0ZU9iamVjdChlLHQsbyl8fHRoaXMudmFsaWRhdGVDb21iaW5hdGlvbnMoZSx0LG8pfHx0aGlzLnZhbGlkYXRlSHlwZXJtZWRpYShlLHQsbyl8fHRoaXMudmFsaWRhdGVGb3JtYXQoZSx0LG8pfHx0aGlzLnZhbGlkYXRlRGVmaW5lZEtleXdvcmRzKGUsdCxvKXx8bnVsbDtpZihpKXtmb3IoO3RoaXMuc2Nhbm5lZC5sZW5ndGg7KXt2YXIgYj10aGlzLnNjYW5uZWQucG9wKCk7ZGVsZXRlIGJbdGhpcy52YWxpZGF0ZWRTY2hlbWFzS2V5XX10aGlzLnNjYW5uZWRGcm96ZW49W10sdGhpcy5zY2FubmVkRnJvemVuU2NoZW1hcz1bXX1pZih5fHxkIT09dGhpcy5lcnJvcnMubGVuZ3RoKWZvcig7ciYmci5sZW5ndGh8fG4mJm4ubGVuZ3RoOyl7dmFyIG09ciYmci5sZW5ndGg/IiIrci5wb3AoKTpudWxsLHY9biYmbi5sZW5ndGg/IiIrbi5wb3AoKTpudWxsO3kmJih5PXkucHJlZml4V2l0aChtLHYpKSx0aGlzLnByZWZpeEVycm9ycyhkLG0sdil9cmV0dXJuIG51bGwhPT11P3RoaXMuc2Nhbm5lZEZyb3plblZhbGlkYXRpb25FcnJvcnNbYV1bdV09dGhpcy5lcnJvcnMuc2xpY2Uocyk6bnVsbCE9PWwmJihlW3RoaXMudmFsaWRhdGlvbkVycm9yc0tleV1bbF09dGhpcy5lcnJvcnMuc2xpY2UocykpLHRoaXMuaGFuZGxlRXJyb3IoeSl9LGQucHJvdG90eXBlLnZhbGlkYXRlRm9ybWF0PWZ1bmN0aW9uKGUsdCl7aWYoInN0cmluZyIhPXR5cGVvZiB0LmZvcm1hdHx8IXRoaXMuZm9ybWF0VmFsaWRhdG9yc1t0LmZvcm1hdF0pcmV0dXJuIG51bGw7dmFyIHI9dGhpcy5mb3JtYXRWYWxpZGF0b3JzW3QuZm9ybWF0XS5jYWxsKG51bGwsZSx0KTtyZXR1cm4ic3RyaW5nIj09dHlwZW9mIHJ8fCJudW1iZXIiPT10eXBlb2Ygcj90aGlzLmNyZWF0ZUVycm9yKG0uRk9STUFUX0NVU1RPTSx7bWVzc2FnZTpyfSwiIiwiL2Zvcm1hdCIsbnVsbCxlLHQpOnImJiJvYmplY3QiPT10eXBlb2Ygcj90aGlzLmNyZWF0ZUVycm9yKG0uRk9STUFUX0NVU1RPTSx7bWVzc2FnZTpyLm1lc3NhZ2V8fCI/In0sci5kYXRhUGF0aHx8IiIsci5zY2hlbWFQYXRofHwiL2Zvcm1hdCIsbnVsbCxlLHQpOm51bGx9LGQucHJvdG90eXBlLnZhbGlkYXRlRGVmaW5lZEtleXdvcmRzPWZ1bmN0aW9uKGUsdCxyKXtmb3IodmFyIG4gaW4gdGhpcy5kZWZpbmVkS2V5d29yZHMpaWYoInVuZGVmaW5lZCIhPXR5cGVvZiB0W25dKWZvcih2YXIgbz10aGlzLmRlZmluZWRLZXl3b3Jkc1tuXSxpPTA7aTxvLmxlbmd0aDtpKyspe3ZhciBhPW9baV0scz1hKGUsdFtuXSx0LHIpO2lmKCJzdHJpbmciPT10eXBlb2Ygc3x8Im51bWJlciI9PXR5cGVvZiBzKXJldHVybiB0aGlzLmNyZWF0ZUVycm9yKG0uS0VZV09SRF9DVVNUT00se2tleTpuLG1lc3NhZ2U6c30sIiIsIiIsbnVsbCxlLHQpLnByZWZpeFdpdGgobnVsbCxuKTtpZihzJiYib2JqZWN0Ij09dHlwZW9mIHMpe3ZhciB1PXMuY29kZTtpZigic3RyaW5nIj09dHlwZW9mIHUpe2lmKCFtW3VdKXRocm93IG5ldyBFcnJvcigiVW5kZWZpbmVkIGVycm9yIGNvZGUgKHVzZSBkZWZpbmVFcnJvcik6ICIrdSk7dT1tW3VdfWVsc2UibnVtYmVyIiE9dHlwZW9mIHUmJih1PW0uS0VZV09SRF9DVVNUT00pO3ZhciBjPSJvYmplY3QiPT10eXBlb2Ygcy5tZXNzYWdlP3MubWVzc2FnZTp7a2V5Om4sbWVzc2FnZTpzLm1lc3NhZ2V8fCI/In0sbD1zLnNjaGVtYVBhdGh8fCIvIituLnJlcGxhY2UoL34vZywifjAiKS5yZXBsYWNlKC9cLy9nLCJ+MSIpO3JldHVybiB0aGlzLmNyZWF0ZUVycm9yKHUsYyxzLmRhdGFQYXRofHxudWxsLGwsbnVsbCxlLHQpfX1yZXR1cm4gbnVsbH0sZC5wcm90b3R5cGUudmFsaWRhdGVCYXNpYz1mdW5jdGlvbihlLHQscil7dmFyIG47cmV0dXJuKG49dGhpcy52YWxpZGF0ZVR5cGUoZSx0LHIpKT9uLnByZWZpeFdpdGgobnVsbCwidHlwZSIpOihuPXRoaXMudmFsaWRhdGVFbnVtKGUsdCxyKSk/bi5wcmVmaXhXaXRoKG51bGwsInR5cGUiKTpudWxsfSxkLnByb3RvdHlwZS52YWxpZGF0ZVR5cGU9ZnVuY3Rpb24oZSx0KXtpZih2b2lkIDA9PT10LnR5cGUpcmV0dXJuIG51bGw7dmFyIHI9dHlwZW9mIGU7bnVsbD09PWU/cj0ibnVsbCI6QXJyYXkuaXNBcnJheShlKSYmKHI9ImFycmF5Iik7dmFyIG49dC50eXBlO0FycmF5LmlzQXJyYXkobil8fChuPVtuXSk7Zm9yKHZhciBvPTA7bzxuLmxlbmd0aDtvKyspe3ZhciBpPW5bb107aWYoaT09PXJ8fCJpbnRlZ2VyIj09PWkmJiJudW1iZXIiPT09ciYmZSUxPT09MClyZXR1cm4gbnVsbH1yZXR1cm4gdGhpcy5jcmVhdGVFcnJvcihtLklOVkFMSURfVFlQRSx7dHlwZTpyLGV4cGVjdGVkOm4uam9pbigiLyIpfSwiIiwiIixudWxsLGUsdCl9LGQucHJvdG90eXBlLnZhbGlkYXRlRW51bT1mdW5jdGlvbihlLHQpe2lmKHZvaWQgMD09PXRbImVudW0iXSlyZXR1cm4gbnVsbDtmb3IodmFyIHI9MDtyPHRbImVudW0iXS5sZW5ndGg7cisrKXt2YXIgbz10WyJlbnVtIl1bcl07aWYobihlLG8pKXJldHVybiBudWxsfXJldHVybiB0aGlzLmNyZWF0ZUVycm9yKG0uRU5VTV9NSVNNQVRDSCx7dmFsdWU6InVuZGVmaW5lZCIhPXR5cGVvZiBKU09OP0pTT04uc3RyaW5naWZ5KGUpOmV9LCIiLCIiLG51bGwsZSx0KX0sZC5wcm90b3R5cGUudmFsaWRhdGVOdW1lcmljPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gdGhpcy52YWxpZGF0ZU11bHRpcGxlT2YoZSx0LHIpfHx0aGlzLnZhbGlkYXRlTWluTWF4KGUsdCxyKXx8dGhpcy52YWxpZGF0ZU5hTihlLHQscil8fG51bGx9O3ZhciB5PU1hdGgucG93KDIsLTUxKSxiPTEteTtkLnByb3RvdHlwZS52YWxpZGF0ZU11bHRpcGxlT2Y9ZnVuY3Rpb24oZSx0KXt2YXIgcj10Lm11bHRpcGxlT2Z8fHQuZGl2aXNpYmxlQnk7aWYodm9pZCAwPT09cilyZXR1cm4gbnVsbDtpZigibnVtYmVyIj09dHlwZW9mIGUpe3ZhciBuPWUvciUxO2lmKG4+PXkmJmI+bilyZXR1cm4gdGhpcy5jcmVhdGVFcnJvcihtLk5VTUJFUl9NVUxUSVBMRV9PRix7dmFsdWU6ZSxtdWx0aXBsZU9mOnJ9LCIiLCIiLG51bGwsZSx0KX1yZXR1cm4gbnVsbH0sZC5wcm90b3R5cGUudmFsaWRhdGVNaW5NYXg9ZnVuY3Rpb24oZSx0KXtpZigibnVtYmVyIiE9dHlwZW9mIGUpcmV0dXJuIG51bGw7aWYodm9pZCAwIT09dC5taW5pbXVtKXtpZihlPHQubWluaW11bSlyZXR1cm4gdGhpcy5jcmVhdGVFcnJvcihtLk5VTUJFUl9NSU5JTVVNLHt2YWx1ZTplLG1pbmltdW06dC5taW5pbXVtfSwiIiwiL21pbmltdW0iLG51bGwsZSx0KTtpZih0LmV4Y2x1c2l2ZU1pbmltdW0mJmU9PT10Lm1pbmltdW0pcmV0dXJuIHRoaXMuY3JlYXRlRXJyb3IobS5OVU1CRVJfTUlOSU1VTV9FWENMVVNJVkUse3ZhbHVlOmUsbWluaW11bTp0Lm1pbmltdW19LCIiLCIvZXhjbHVzaXZlTWluaW11bSIsbnVsbCxlLHQpfWlmKHZvaWQgMCE9PXQubWF4aW11bSl7aWYoZT50Lm1heGltdW0pcmV0dXJuIHRoaXMuY3JlYXRlRXJyb3IobS5OVU1CRVJfTUFYSU1VTSx7dmFsdWU6ZSxtYXhpbXVtOnQubWF4aW11bX0sIiIsIi9tYXhpbXVtIixudWxsLGUsdCk7aWYodC5leGNsdXNpdmVNYXhpbXVtJiZlPT09dC5tYXhpbXVtKXJldHVybiB0aGlzLmNyZWF0ZUVycm9yKG0uTlVNQkVSX01BWElNVU1fRVhDTFVTSVZFLHt2YWx1ZTplLG1heGltdW06dC5tYXhpbXVtfSwiIiwiL2V4Y2x1c2l2ZU1heGltdW0iLG51bGwsZSx0KX1yZXR1cm4gbnVsbH0sZC5wcm90b3R5cGUudmFsaWRhdGVOYU49ZnVuY3Rpb24oZSx0KXtyZXR1cm4ibnVtYmVyIiE9dHlwZW9mIGU/bnVsbDppc05hTihlKT09PSEwfHxlPT09MS8wfHxlPT09LSgxLzApP3RoaXMuY3JlYXRlRXJyb3IobS5OVU1CRVJfTk9UX0FfTlVNQkVSLHt2YWx1ZTplfSwiIiwiL3R5cGUiLG51bGwsZSx0KTpudWxsfSxkLnByb3RvdHlwZS52YWxpZGF0ZVN0cmluZz1mdW5jdGlvbihlLHQscil7cmV0dXJuIHRoaXMudmFsaWRhdGVTdHJpbmdMZW5ndGgoZSx0LHIpfHx0aGlzLnZhbGlkYXRlU3RyaW5nUGF0dGVybihlLHQscil8fG51bGx9LGQucHJvdG90eXBlLnZhbGlkYXRlU3RyaW5nTGVuZ3RoPWZ1bmN0aW9uKGUsdCl7cmV0dXJuInN0cmluZyIhPXR5cGVvZiBlP251bGw6dm9pZCAwIT09dC5taW5MZW5ndGgmJmUubGVuZ3RoPHQubWluTGVuZ3RoP3RoaXMuY3JlYXRlRXJyb3IobS5TVFJJTkdfTEVOR1RIX1NIT1JULHtsZW5ndGg6ZS5sZW5ndGgsbWluaW11bTp0Lm1pbkxlbmd0aH0sIiIsIi9taW5MZW5ndGgiLG51bGwsZSx0KTp2b2lkIDAhPT10Lm1heExlbmd0aCYmZS5sZW5ndGg+dC5tYXhMZW5ndGg/dGhpcy5jcmVhdGVFcnJvcihtLlNUUklOR19MRU5HVEhfTE9ORyx7bGVuZ3RoOmUubGVuZ3RoLG1heGltdW06dC5tYXhMZW5ndGh9LCIiLCIvbWF4TGVuZ3RoIixudWxsLGUsdCk6bnVsbH0sZC5wcm90b3R5cGUudmFsaWRhdGVTdHJpbmdQYXR0ZXJuPWZ1bmN0aW9uKGUsdCl7aWYoInN0cmluZyIhPXR5cGVvZiBlfHwic3RyaW5nIiE9dHlwZW9mIHQucGF0dGVybiYmISh0LnBhdHRlcm4gaW5zdGFuY2VvZiBSZWdFeHApKXJldHVybiBudWxsO3ZhciByO2lmKHQucGF0dGVybiBpbnN0YW5jZW9mIFJlZ0V4cClyPXQucGF0dGVybjtlbHNle3ZhciBuLG89IiIsaT10LnBhdHRlcm4ubWF0Y2goL15cLyguKylcLyhbaW1nXSopJC8pO2k/KG49aVsxXSxvPWlbMl0pOm49dC5wYXR0ZXJuLHI9bmV3IFJlZ0V4cChuLG8pfXJldHVybiByLnRlc3QoZSk/bnVsbDp0aGlzLmNyZWF0ZUVycm9yKG0uU1RSSU5HX1BBVFRFUk4se3BhdHRlcm46dC5wYXR0ZXJufSwiIiwiL3BhdHRlcm4iLG51bGwsZSx0KX0sZC5wcm90b3R5cGUudmFsaWRhdGVBcnJheT1mdW5jdGlvbihlLHQscil7cmV0dXJuIEFycmF5LmlzQXJyYXkoZSk/dGhpcy52YWxpZGF0ZUFycmF5TGVuZ3RoKGUsdCxyKXx8dGhpcy52YWxpZGF0ZUFycmF5VW5pcXVlSXRlbXMoZSx0LHIpfHx0aGlzLnZhbGlkYXRlQXJyYXlJdGVtcyhlLHQscil8fG51bGw6bnVsbH0sZC5wcm90b3R5cGUudmFsaWRhdGVBcnJheUxlbmd0aD1mdW5jdGlvbihlLHQpe3ZhciByO3JldHVybiB2b2lkIDAhPT10Lm1pbkl0ZW1zJiZlLmxlbmd0aDx0Lm1pbkl0ZW1zJiYocj10aGlzLmNyZWF0ZUVycm9yKG0uQVJSQVlfTEVOR1RIX1NIT1JULHtsZW5ndGg6ZS5sZW5ndGgsbWluaW11bTp0Lm1pbkl0ZW1zfSwiIiwiL21pbkl0ZW1zIixudWxsLGUsdCksdGhpcy5oYW5kbGVFcnJvcihyKSk/cjp2b2lkIDAhPT10Lm1heEl0ZW1zJiZlLmxlbmd0aD50Lm1heEl0ZW1zJiYocj10aGlzLmNyZWF0ZUVycm9yKG0uQVJSQVlfTEVOR1RIX0xPTkcse2xlbmd0aDplLmxlbmd0aCxtYXhpbXVtOnQubWF4SXRlbXN9LCIiLCIvbWF4SXRlbXMiLG51bGwsZSx0KSx0aGlzLmhhbmRsZUVycm9yKHIpKT9yOm51bGx9LGQucHJvdG90eXBlLnZhbGlkYXRlQXJyYXlVbmlxdWVJdGVtcz1mdW5jdGlvbihlLHQpe2lmKHQudW5pcXVlSXRlbXMpZm9yKHZhciByPTA7cjxlLmxlbmd0aDtyKyspZm9yKHZhciBvPXIrMTtvPGUubGVuZ3RoO28rKylpZihuKGVbcl0sZVtvXSkpe3ZhciBpPXRoaXMuY3JlYXRlRXJyb3IobS5BUlJBWV9VTklRVUUse21hdGNoMTpyLG1hdGNoMjpvfSwiIiwiL3VuaXF1ZUl0ZW1zIixudWxsLGUsdCk7aWYodGhpcy5oYW5kbGVFcnJvcihpKSlyZXR1cm4gaX1yZXR1cm4gbnVsbH0sZC5wcm90b3R5cGUudmFsaWRhdGVBcnJheUl0ZW1zPWZ1bmN0aW9uKGUsdCxyKXtpZih2b2lkIDA9PT10Lml0ZW1zKXJldHVybiBudWxsO3ZhciBuLG87aWYoQXJyYXkuaXNBcnJheSh0Lml0ZW1zKSl7Zm9yKG89MDtvPGUubGVuZ3RoO28rKylpZihvPHQuaXRlbXMubGVuZ3RoKXtpZihuPXRoaXMudmFsaWRhdGVBbGwoZVtvXSx0Lml0ZW1zW29dLFtvXSxbIml0ZW1zIixvXSxyKyIvIitvKSlyZXR1cm4gbn1lbHNlIGlmKHZvaWQgMCE9PXQuYWRkaXRpb25hbEl0ZW1zKWlmKCJib29sZWFuIj09dHlwZW9mIHQuYWRkaXRpb25hbEl0ZW1zKXtpZighdC5hZGRpdGlvbmFsSXRlbXMmJihuPXRoaXMuY3JlYXRlRXJyb3IobS5BUlJBWV9BRERJVElPTkFMX0lURU1TLHt9LCIvIitvLCIvYWRkaXRpb25hbEl0ZW1zIixudWxsLGUsdCksdGhpcy5oYW5kbGVFcnJvcihuKSkpcmV0dXJuIG59ZWxzZSBpZihuPXRoaXMudmFsaWRhdGVBbGwoZVtvXSx0LmFkZGl0aW9uYWxJdGVtcyxbb10sWyJhZGRpdGlvbmFsSXRlbXMiXSxyKyIvIitvKSlyZXR1cm4gbn1lbHNlIGZvcihvPTA7bzxlLmxlbmd0aDtvKyspaWYobj10aGlzLnZhbGlkYXRlQWxsKGVbb10sdC5pdGVtcyxbb10sWyJpdGVtcyJdLHIrIi8iK28pKXJldHVybiBuO3JldHVybiBudWxsfSxkLnByb3RvdHlwZS52YWxpZGF0ZU9iamVjdD1mdW5jdGlvbihlLHQscil7cmV0dXJuIm9iamVjdCIhPXR5cGVvZiBlfHxudWxsPT09ZXx8QXJyYXkuaXNBcnJheShlKT9udWxsOnRoaXMudmFsaWRhdGVPYmplY3RNaW5NYXhQcm9wZXJ0aWVzKGUsdCxyKXx8dGhpcy52YWxpZGF0ZU9iamVjdFJlcXVpcmVkUHJvcGVydGllcyhlLHQscil8fHRoaXMudmFsaWRhdGVPYmplY3RQcm9wZXJ0aWVzKGUsdCxyKXx8dGhpcy52YWxpZGF0ZU9iamVjdERlcGVuZGVuY2llcyhlLHQscil8fG51bGx9LGQucHJvdG90eXBlLnZhbGlkYXRlT2JqZWN0TWluTWF4UHJvcGVydGllcz1mdW5jdGlvbihlLHQpe3ZhciByLG49T2JqZWN0LmtleXMoZSk7cmV0dXJuIHZvaWQgMCE9PXQubWluUHJvcGVydGllcyYmbi5sZW5ndGg8dC5taW5Qcm9wZXJ0aWVzJiYocj10aGlzLmNyZWF0ZUVycm9yKG0uT0JKRUNUX1BST1BFUlRJRVNfTUlOSU1VTSx7cHJvcGVydHlDb3VudDpuLmxlbmd0aCxtaW5pbXVtOnQubWluUHJvcGVydGllc30sIiIsIi9taW5Qcm9wZXJ0aWVzIixudWxsLGUsdCksdGhpcy5oYW5kbGVFcnJvcihyKSk/cjp2b2lkIDAhPT10Lm1heFByb3BlcnRpZXMmJm4ubGVuZ3RoPnQubWF4UHJvcGVydGllcyYmKHI9dGhpcy5jcmVhdGVFcnJvcihtLk9CSkVDVF9QUk9QRVJUSUVTX01BWElNVU0se3Byb3BlcnR5Q291bnQ6bi5sZW5ndGgsbWF4aW11bTp0Lm1heFByb3BlcnRpZXN9LCIiLCIvbWF4UHJvcGVydGllcyIsbnVsbCxlLHQpLHRoaXMuaGFuZGxlRXJyb3IocikpP3I6bnVsbH0sZC5wcm90b3R5cGUudmFsaWRhdGVPYmplY3RSZXF1aXJlZFByb3BlcnRpZXM9ZnVuY3Rpb24oZSx0KXtpZih2b2lkIDAhPT10LnJlcXVpcmVkKWZvcih2YXIgcj0wO3I8dC5yZXF1aXJlZC5sZW5ndGg7cisrKXt2YXIgbj10LnJlcXVpcmVkW3JdO2lmKHZvaWQgMD09PWVbbl0pe3ZhciBvPXRoaXMuY3JlYXRlRXJyb3IobS5PQkpFQ1RfUkVRVUlSRUQse2tleTpufSwiIiwiL3JlcXVpcmVkLyIrcixudWxsLGUsdCk7aWYodGhpcy5oYW5kbGVFcnJvcihvKSlyZXR1cm4gb319cmV0dXJuIG51bGx9LGQucHJvdG90eXBlLnZhbGlkYXRlT2JqZWN0UHJvcGVydGllcz1mdW5jdGlvbihlLHQscil7dmFyIG47Zm9yKHZhciBvIGluIGUpe3ZhciBpPXIrIi8iK28ucmVwbGFjZSgvfi9nLCJ+MCIpLnJlcGxhY2UoL1wvL2csIn4xIiksYT0hMTtpZih2b2lkIDAhPT10LnByb3BlcnRpZXMmJnZvaWQgMCE9PXQucHJvcGVydGllc1tvXSYmKGE9ITAsbj10aGlzLnZhbGlkYXRlQWxsKGVbb10sdC5wcm9wZXJ0aWVzW29dLFtvXSxbInByb3BlcnRpZXMiLG9dLGkpKSlyZXR1cm4gbjtpZih2b2lkIDAhPT10LnBhdHRlcm5Qcm9wZXJ0aWVzKWZvcih2YXIgcyBpbiB0LnBhdHRlcm5Qcm9wZXJ0aWVzKXt2YXIgdT1uZXcgUmVnRXhwKHMpO2lmKHUudGVzdChvKSYmKGE9ITAsbj10aGlzLnZhbGlkYXRlQWxsKGVbb10sdC5wYXR0ZXJuUHJvcGVydGllc1tzXSxbb10sWyJwYXR0ZXJuUHJvcGVydGllcyIsc10saSkpKXJldHVybiBufWlmKGEpdGhpcy50cmFja1Vua25vd25Qcm9wZXJ0aWVzJiYodGhpcy5rbm93blByb3BlcnR5UGF0aHNbaV09ITAsZGVsZXRlIHRoaXMudW5rbm93blByb3BlcnR5UGF0aHNbaV0pO2Vsc2UgaWYodm9pZCAwIT09dC5hZGRpdGlvbmFsUHJvcGVydGllcyl7aWYodGhpcy50cmFja1Vua25vd25Qcm9wZXJ0aWVzJiYodGhpcy5rbm93blByb3BlcnR5UGF0aHNbaV09ITAsZGVsZXRlIHRoaXMudW5rbm93blByb3BlcnR5UGF0aHNbaV0pLCJib29sZWFuIj09dHlwZW9mIHQuYWRkaXRpb25hbFByb3BlcnRpZXMpe2lmKCF0LmFkZGl0aW9uYWxQcm9wZXJ0aWVzJiYobj10aGlzLmNyZWF0ZUVycm9yKG0uT0JKRUNUX0FERElUSU9OQUxfUFJPUEVSVElFUyx7a2V5Om99LCIiLCIvYWRkaXRpb25hbFByb3BlcnRpZXMiLG51bGwsZSx0KS5wcmVmaXhXaXRoKG8sbnVsbCksdGhpcy5oYW5kbGVFcnJvcihuKSkpcmV0dXJuIG59ZWxzZSBpZihuPXRoaXMudmFsaWRhdGVBbGwoZVtvXSx0LmFkZGl0aW9uYWxQcm9wZXJ0aWVzLFtvXSxbImFkZGl0aW9uYWxQcm9wZXJ0aWVzIl0saSkpcmV0dXJuIG59ZWxzZSB0aGlzLnRyYWNrVW5rbm93blByb3BlcnRpZXMmJiF0aGlzLmtub3duUHJvcGVydHlQYXRoc1tpXSYmKHRoaXMudW5rbm93blByb3BlcnR5UGF0aHNbaV09ITApfXJldHVybiBudWxsfSxkLnByb3RvdHlwZS52YWxpZGF0ZU9iamVjdERlcGVuZGVuY2llcz1mdW5jdGlvbihlLHQscil7dmFyIG47aWYodm9pZCAwIT09dC5kZXBlbmRlbmNpZXMpZm9yKHZhciBvIGluIHQuZGVwZW5kZW5jaWVzKWlmKHZvaWQgMCE9PWVbb10pe3ZhciBpPXQuZGVwZW5kZW5jaWVzW29dO2lmKCJzdHJpbmciPT10eXBlb2YgaSl7aWYodm9pZCAwPT09ZVtpXSYmKG49dGhpcy5jcmVhdGVFcnJvcihtLk9CSkVDVF9ERVBFTkRFTkNZX0tFWSx7a2V5Om8sbWlzc2luZzppfSwiIiwiIixudWxsLGUsdCkucHJlZml4V2l0aChudWxsLG8pLnByZWZpeFdpdGgobnVsbCwiZGVwZW5kZW5jaWVzIiksdGhpcy5oYW5kbGVFcnJvcihuKSkpcmV0dXJuIG59ZWxzZSBpZihBcnJheS5pc0FycmF5KGkpKWZvcih2YXIgYT0wO2E8aS5sZW5ndGg7YSsrKXt2YXIgcz1pW2FdO2lmKHZvaWQgMD09PWVbc10mJihuPXRoaXMuY3JlYXRlRXJyb3IobS5PQkpFQ1RfREVQRU5ERU5DWV9LRVkse2tleTpvLG1pc3Npbmc6c30sIiIsIi8iK2EsbnVsbCxlLHQpLnByZWZpeFdpdGgobnVsbCxvKS5wcmVmaXhXaXRoKG51bGwsImRlcGVuZGVuY2llcyIpLHRoaXMuaGFuZGxlRXJyb3IobikpKXJldHVybiBufWVsc2UgaWYobj10aGlzLnZhbGlkYXRlQWxsKGUsaSxbXSxbImRlcGVuZGVuY2llcyIsb10scikpcmV0dXJuIG59cmV0dXJuIG51bGx9LGQucHJvdG90eXBlLnZhbGlkYXRlQ29tYmluYXRpb25zPWZ1bmN0aW9uKGUsdCxyKXtyZXR1cm4gdGhpcy52YWxpZGF0ZUFsbE9mKGUsdCxyKXx8dGhpcy52YWxpZGF0ZUFueU9mKGUsdCxyKXx8dGhpcy52YWxpZGF0ZU9uZU9mKGUsdCxyKXx8dGhpcy52YWxpZGF0ZU5vdChlLHQscil8fG51bGx9LGQucHJvdG90eXBlLnZhbGlkYXRlQWxsT2Y9ZnVuY3Rpb24oZSx0LHIpe2lmKHZvaWQgMD09PXQuYWxsT2YpcmV0dXJuIG51bGw7Zm9yKHZhciBuLG89MDtvPHQuYWxsT2YubGVuZ3RoO28rKyl7dmFyIGk9dC5hbGxPZltvXTtpZihuPXRoaXMudmFsaWRhdGVBbGwoZSxpLFtdLFsiYWxsT2YiLG9dLHIpKXJldHVybiBufXJldHVybiBudWxsfSxkLnByb3RvdHlwZS52YWxpZGF0ZUFueU9mPWZ1bmN0aW9uKGUsdCxyKXtpZih2b2lkIDA9PT10LmFueU9mKXJldHVybiBudWxsO3ZhciBuLG8saT1bXSxhPXRoaXMuZXJyb3JzLmxlbmd0aDt0aGlzLnRyYWNrVW5rbm93blByb3BlcnRpZXMmJihuPXRoaXMudW5rbm93blByb3BlcnR5UGF0aHMsbz10aGlzLmtub3duUHJvcGVydHlQYXRocyk7Zm9yKHZhciBzPSEwLHU9MDt1PHQuYW55T2YubGVuZ3RoO3UrKyl7dGhpcy50cmFja1Vua25vd25Qcm9wZXJ0aWVzJiYodGhpcy51bmtub3duUHJvcGVydHlQYXRocz17fSx0aGlzLmtub3duUHJvcGVydHlQYXRocz17fSk7dmFyIGM9dC5hbnlPZlt1XSxsPXRoaXMuZXJyb3JzLmxlbmd0aCxmPXRoaXMudmFsaWRhdGVBbGwoZSxjLFtdLFsiYW55T2YiLHVdLHIpO2lmKG51bGw9PT1mJiZsPT09dGhpcy5lcnJvcnMubGVuZ3RoKXtpZih0aGlzLmVycm9ycz10aGlzLmVycm9ycy5zbGljZSgwLGEpLHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcyl7Zm9yKHZhciBwIGluIHRoaXMua25vd25Qcm9wZXJ0eVBhdGhzKW9bcF09ITAsZGVsZXRlIG5bcF07Zm9yKHZhciBoIGluIHRoaXMudW5rbm93blByb3BlcnR5UGF0aHMpb1toXXx8KG5baF09ITApO3M9ITE7Y29udGludWV9cmV0dXJuIG51bGx9ZiYmaS5wdXNoKGYucHJlZml4V2l0aChudWxsLCIiK3UpLnByZWZpeFdpdGgobnVsbCwiYW55T2YiKSl9cmV0dXJuIHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcyYmKHRoaXMudW5rbm93blByb3BlcnR5UGF0aHM9bix0aGlzLmtub3duUHJvcGVydHlQYXRocz1vKSxzPyhpPWkuY29uY2F0KHRoaXMuZXJyb3JzLnNsaWNlKGEpKSx0aGlzLmVycm9ycz10aGlzLmVycm9ycy5zbGljZSgwLGEpLHRoaXMuY3JlYXRlRXJyb3IobS5BTllfT0ZfTUlTU0lORyx7fSwiIiwiL2FueU9mIixpLGUsdCkpOnZvaWQgMH0sZC5wcm90b3R5cGUudmFsaWRhdGVPbmVPZj1mdW5jdGlvbihlLHQscil7aWYodm9pZCAwPT09dC5vbmVPZilyZXR1cm4gbnVsbDt2YXIgbixvLGk9bnVsbCxhPVtdLHM9dGhpcy5lcnJvcnMubGVuZ3RoO3RoaXMudHJhY2tVbmtub3duUHJvcGVydGllcyYmKG49dGhpcy51bmtub3duUHJvcGVydHlQYXRocyxvPXRoaXMua25vd25Qcm9wZXJ0eVBhdGhzKTtmb3IodmFyIHU9MDt1PHQub25lT2YubGVuZ3RoO3UrKyl7dGhpcy50cmFja1Vua25vd25Qcm9wZXJ0aWVzJiYodGhpcy51bmtub3duUHJvcGVydHlQYXRocz17fSx0aGlzLmtub3duUHJvcGVydHlQYXRocz17fSk7dmFyIGM9dC5vbmVPZlt1XSxsPXRoaXMuZXJyb3JzLmxlbmd0aCxmPXRoaXMudmFsaWRhdGVBbGwoZSxjLFtdLFsib25lT2YiLHVdLHIpO2lmKG51bGw9PT1mJiZsPT09dGhpcy5lcnJvcnMubGVuZ3RoKXtpZihudWxsIT09aSlyZXR1cm4gdGhpcy5lcnJvcnM9dGhpcy5lcnJvcnMuc2xpY2UoMCxzKSx0aGlzLmNyZWF0ZUVycm9yKG0uT05FX09GX01VTFRJUExFLHtpbmRleDE6aSxpbmRleDI6dX0sIiIsIi9vbmVPZiIsbnVsbCxlLHQpO2lmKGk9dSx0aGlzLnRyYWNrVW5rbm93blByb3BlcnRpZXMpe2Zvcih2YXIgcCBpbiB0aGlzLmtub3duUHJvcGVydHlQYXRocylvW3BdPSEwLGRlbGV0ZSBuW3BdO2Zvcih2YXIgaCBpbiB0aGlzLnVua25vd25Qcm9wZXJ0eVBhdGhzKW9baF18fChuW2hdPSEwKX19ZWxzZSBmJiZhLnB1c2goZil9cmV0dXJuIHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcyYmKHRoaXMudW5rbm93blByb3BlcnR5UGF0aHM9bix0aGlzLmtub3duUHJvcGVydHlQYXRocz1vKSxudWxsPT09aT8oYT1hLmNvbmNhdCh0aGlzLmVycm9ycy5zbGljZShzKSksdGhpcy5lcnJvcnM9dGhpcy5lcnJvcnMuc2xpY2UoMCxzKSx0aGlzLmNyZWF0ZUVycm9yKG0uT05FX09GX01JU1NJTkcse30sIiIsIi9vbmVPZiIsYSxlLHQpKToodGhpcy5lcnJvcnM9dGhpcy5lcnJvcnMuc2xpY2UoMCxzKSxudWxsKX0sZC5wcm90b3R5cGUudmFsaWRhdGVOb3Q9ZnVuY3Rpb24oZSx0LHIpe2lmKHZvaWQgMD09PXQubm90KXJldHVybiBudWxsO3ZhciBuLG8saT10aGlzLmVycm9ycy5sZW5ndGg7dGhpcy50cmFja1Vua25vd25Qcm9wZXJ0aWVzJiYobj10aGlzLnVua25vd25Qcm9wZXJ0eVBhdGhzLG89dGhpcy5rbm93blByb3BlcnR5UGF0aHMsdGhpcy51bmtub3duUHJvcGVydHlQYXRocz17fSx0aGlzLmtub3duUHJvcGVydHlQYXRocz17fSk7dmFyIGE9dGhpcy52YWxpZGF0ZUFsbChlLHQubm90LG51bGwsbnVsbCxyKSxzPXRoaXMuZXJyb3JzLnNsaWNlKGkpO3JldHVybiB0aGlzLmVycm9ycz10aGlzLmVycm9ycy5zbGljZSgwLGkpLHRoaXMudHJhY2tVbmtub3duUHJvcGVydGllcyYmKHRoaXMudW5rbm93blByb3BlcnR5UGF0aHM9bix0aGlzLmtub3duUHJvcGVydHlQYXRocz1vKSxudWxsPT09YSYmMD09PXMubGVuZ3RoP3RoaXMuY3JlYXRlRXJyb3IobS5OT1RfUEFTU0VELHt9LCIiLCIvbm90IixudWxsLGUsdCk6bnVsbH0sZC5wcm90b3R5cGUudmFsaWRhdGVIeXBlcm1lZGlhPWZ1bmN0aW9uKGUsdCxuKXtpZighdC5saW5rcylyZXR1cm4gbnVsbDtmb3IodmFyIG8saT0wO2k8dC5saW5rcy5sZW5ndGg7aSsrKXt2YXIgYT10LmxpbmtzW2ldO2lmKCJkZXNjcmliZWRieSI9PT1hLnJlbCl7Zm9yKHZhciBzPW5ldyByKGEuaHJlZiksdT0hMCxjPTA7YzxzLnZhck5hbWVzLmxlbmd0aDtjKyspaWYoIShzLnZhck5hbWVzW2NdaW4gZSkpe3U9ITE7YnJlYWt9aWYodSl7dmFyIGw9cy5maWxsRnJvbU9iamVjdChlKSxmPXskcmVmOmx9O2lmKG89dGhpcy52YWxpZGF0ZUFsbChlLGYsW10sWyJsaW5rcyIsaV0sbikpcmV0dXJuIG99fX19O3ZhciBtPXtJTlZBTElEX1RZUEU6MCxFTlVNX01JU01BVENIOjEsQU5ZX09GX01JU1NJTkc6MTAsT05FX09GX01JU1NJTkc6MTEsT05FX09GX01VTFRJUExFOjEyLE5PVF9QQVNTRUQ6MTMsTlVNQkVSX01VTFRJUExFX09GOjEwMCxOVU1CRVJfTUlOSU1VTToxMDEsTlVNQkVSX01JTklNVU1fRVhDTFVTSVZFOjEwMixOVU1CRVJfTUFYSU1VTToxMDMsTlVNQkVSX01BWElNVU1fRVhDTFVTSVZFOjEwNCxOVU1CRVJfTk9UX0FfTlVNQkVSOjEwNSxTVFJJTkdfTEVOR1RIX1NIT1JUOjIwMCxTVFJJTkdfTEVOR1RIX0xPTkc6MjAxLFNUUklOR19QQVRURVJOOjIwMixPQkpFQ1RfUFJPUEVSVElFU19NSU5JTVVNOjMwMCxPQkpFQ1RfUFJPUEVSVElFU19NQVhJTVVNOjMwMSxPQkpFQ1RfUkVRVUlSRUQ6MzAyLE9CSkVDVF9BRERJVElPTkFMX1BST1BFUlRJRVM6MzAzLE9CSkVDVF9ERVBFTkRFTkNZX0tFWTozMDQsQVJSQVlfTEVOR1RIX1NIT1JUOjQwMCxBUlJBWV9MRU5HVEhfTE9ORzo0MDEsQVJSQVlfVU5JUVVFOjQwMixBUlJBWV9BRERJVElPTkFMX0lURU1TOjQwMyxGT1JNQVRfQ1VTVE9NOjUwMCxLRVlXT1JEX0NVU1RPTTo1MDEsQ0lSQ1VMQVJfUkVGRVJFTkNFOjYwMCxVTktOT1dOX1BST1BFUlRZOjFlM30sdj17fTtmb3IodmFyIGcgaW4gbSl2W21bZ11dPWc7dmFyIF89e0lOVkFMSURfVFlQRToiSW52YWxpZCB0eXBlOiB7dHlwZX0gKGV4cGVjdGVkIHtleHBlY3RlZH0pIixFTlVNX01JU01BVENIOiJObyBlbnVtIG1hdGNoIGZvcjoge3ZhbHVlfSIsQU5ZX09GX01JU1NJTkc6J0RhdGEgZG9lcyBub3QgbWF0Y2ggYW55IHNjaGVtYXMgZnJvbSAiYW55T2YiJyxPTkVfT0ZfTUlTU0lORzonRGF0YSBkb2VzIG5vdCBtYXRjaCBhbnkgc2NoZW1hcyBmcm9tICJvbmVPZiInLE9ORV9PRl9NVUxUSVBMRTonRGF0YSBpcyB2YWxpZCBhZ2FpbnN0IG1vcmUgdGhhbiBvbmUgc2NoZW1hIGZyb20gIm9uZU9mIjogaW5kaWNlcyB7aW5kZXgxfSBhbmQge2luZGV4Mn0nLE5PVF9QQVNTRUQ6J0RhdGEgbWF0Y2hlcyBzY2hlbWEgZnJvbSAibm90IicsTlVNQkVSX01VTFRJUExFX09GOiJWYWx1ZSB7dmFsdWV9IGlzIG5vdCBhIG11bHRpcGxlIG9mIHttdWx0aXBsZU9mfSIsTlVNQkVSX01JTklNVU06IlZhbHVlIHt2YWx1ZX0gaXMgbGVzcyB0aGFuIG1pbmltdW0ge21pbmltdW19IixOVU1CRVJfTUlOSU1VTV9FWENMVVNJVkU6IlZhbHVlIHt2YWx1ZX0gaXMgZXF1YWwgdG8gZXhjbHVzaXZlIG1pbmltdW0ge21pbmltdW19IixOVU1CRVJfTUFYSU1VTToiVmFsdWUge3ZhbHVlfSBpcyBncmVhdGVyIHRoYW4gbWF4aW11bSB7bWF4aW11bX0iLApOVU1CRVJfTUFYSU1VTV9FWENMVVNJVkU6IlZhbHVlIHt2YWx1ZX0gaXMgZXF1YWwgdG8gZXhjbHVzaXZlIG1heGltdW0ge21heGltdW19IixOVU1CRVJfTk9UX0FfTlVNQkVSOiJWYWx1ZSB7dmFsdWV9IGlzIG5vdCBhIHZhbGlkIG51bWJlciIsU1RSSU5HX0xFTkdUSF9TSE9SVDoiU3RyaW5nIGlzIHRvbyBzaG9ydCAoe2xlbmd0aH0gY2hhcnMpLCBtaW5pbXVtIHttaW5pbXVtfSIsU1RSSU5HX0xFTkdUSF9MT05HOiJTdHJpbmcgaXMgdG9vIGxvbmcgKHtsZW5ndGh9IGNoYXJzKSwgbWF4aW11bSB7bWF4aW11bX0iLFNUUklOR19QQVRURVJOOiJTdHJpbmcgZG9lcyBub3QgbWF0Y2ggcGF0dGVybjoge3BhdHRlcm59IixPQkpFQ1RfUFJPUEVSVElFU19NSU5JTVVNOiJUb28gZmV3IHByb3BlcnRpZXMgZGVmaW5lZCAoe3Byb3BlcnR5Q291bnR9KSwgbWluaW11bSB7bWluaW11bX0iLE9CSkVDVF9QUk9QRVJUSUVTX01BWElNVU06IlRvbyBtYW55IHByb3BlcnRpZXMgZGVmaW5lZCAoe3Byb3BlcnR5Q291bnR9KSwgbWF4aW11bSB7bWF4aW11bX0iLE9CSkVDVF9SRVFVSVJFRDoiTWlzc2luZyByZXF1aXJlZCBwcm9wZXJ0eToge2tleX0iLE9CSkVDVF9BRERJVElPTkFMX1BST1BFUlRJRVM6IkFkZGl0aW9uYWwgcHJvcGVydGllcyBub3QgYWxsb3dlZCIsT0JKRUNUX0RFUEVOREVOQ1lfS0VZOiJEZXBlbmRlbmN5IGZhaWxlZCAtIGtleSBtdXN0IGV4aXN0OiB7bWlzc2luZ30gKGR1ZSB0byBrZXk6IHtrZXl9KSIsQVJSQVlfTEVOR1RIX1NIT1JUOiJBcnJheSBpcyB0b28gc2hvcnQgKHtsZW5ndGh9KSwgbWluaW11bSB7bWluaW11bX0iLEFSUkFZX0xFTkdUSF9MT05HOiJBcnJheSBpcyB0b28gbG9uZyAoe2xlbmd0aH0pLCBtYXhpbXVtIHttYXhpbXVtfSIsQVJSQVlfVU5JUVVFOiJBcnJheSBpdGVtcyBhcmUgbm90IHVuaXF1ZSAoaW5kaWNlcyB7bWF0Y2gxfSBhbmQge21hdGNoMn0pIixBUlJBWV9BRERJVElPTkFMX0lURU1TOiJBZGRpdGlvbmFsIGl0ZW1zIG5vdCBhbGxvd2VkIixGT1JNQVRfQ1VTVE9NOiJGb3JtYXQgdmFsaWRhdGlvbiBmYWlsZWQgKHttZXNzYWdlfSkiLEtFWVdPUkRfQ1VTVE9NOiJLZXl3b3JkIGZhaWxlZDoge2tleX0gKHttZXNzYWdlfSkiLENJUkNVTEFSX1JFRkVSRU5DRToiQ2lyY3VsYXIgJHJlZnM6IHt1cmxzfSIsVU5LTk9XTl9QUk9QRVJUWToiVW5rbm93biBwcm9wZXJ0eSAobm90IGluIHNjaGVtYSkifTtjLnByb3RvdHlwZT1PYmplY3QuY3JlYXRlKEVycm9yLnByb3RvdHlwZSksYy5wcm90b3R5cGUuY29uc3RydWN0b3I9YyxjLnByb3RvdHlwZS5uYW1lPSJWYWxpZGF0aW9uRXJyb3IiLGMucHJvdG90eXBlLnByZWZpeFdpdGg9ZnVuY3Rpb24oZSx0KXtpZihudWxsIT09ZSYmKGU9ZS5yZXBsYWNlKC9+L2csIn4wIikucmVwbGFjZSgvXC8vZywifjEiKSx0aGlzLmRhdGFQYXRoPSIvIitlK3RoaXMuZGF0YVBhdGgpLG51bGwhPT10JiYodD10LnJlcGxhY2UoL34vZywifjAiKS5yZXBsYWNlKC9cLy9nLCJ+MSIpLHRoaXMuc2NoZW1hUGF0aD0iLyIrdCt0aGlzLnNjaGVtYVBhdGgpLG51bGwhPT10aGlzLnN1YkVycm9ycylmb3IodmFyIHI9MDtyPHRoaXMuc3ViRXJyb3JzLmxlbmd0aDtyKyspdGhpcy5zdWJFcnJvcnNbcl0ucHJlZml4V2l0aChlLHQpO3JldHVybiB0aGlzfTt2YXIgTz17fSxqPWYoKTtyZXR1cm4gai5hZGRMYW5ndWFnZSgiZW4tZ2IiLF8pLGoudHY0PWosan0pfSx7fV0sOTk6W2Z1bmN0aW9uKGUsdCxyKXsidXNlIHN0cmljdCI7dmFyIG49ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyIpWyJkZWZhdWx0Il0sbz1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayIpWyJkZWZhdWx0Il07T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBpPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSh0LHIsbixpLGEscyl7byh0aGlzLGUpLHRoaXMuX2d1aWQ9dCx0aGlzLl90eXBlPXIsdGhpcy5fb2JqZWN0TmFtZT1uLHRoaXMuX2Rlc2NyaXB0aW9uPWksdGhpcy5fbGFuZ3VhZ2U9YSx0aGlzLl9zb3VyY2VQYWNrYWdlVVJMPXMsdGhpcy5fc2lnbmF0dXJlPW51bGwsdGhpcy5fc291cmNlUGFja2FnZT1udWxsfXJldHVybiBuKGUsW3trZXk6Imd1aWQiLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9ndWlkfSxzZXQ6ZnVuY3Rpb24oZSl7ZSYmKHRoaXMuX2d1aWQ9ZSl9fSx7a2V5OiJ0eXBlIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fdHlwZX0sc2V0OmZ1bmN0aW9uKGUpe2UmJih0aGlzLl90eXBlPWUpfX0se2tleToib2JqZWN0TmFtZSIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX29iamVjdE5hbWV9LHNldDpmdW5jdGlvbihlKXtlJiYodGhpcy5fb2JqZWN0TmFtZT1lKX19LHtrZXk6ImRlc2NyaXB0aW9uIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZGVzY3JpcHRpb259LHNldDpmdW5jdGlvbihlKXtlJiYodGhpcy5fZGVzY3JpcHRpb249ZSl9fSx7a2V5OiJsYW5ndWFnZSIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2xhbmd1YWdlfSxzZXQ6ZnVuY3Rpb24oZSl7ZSYmKHRoaXMuX2xhbmd1YWdlPWUpfX0se2tleToic2lnbmF0dXJlIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fc2lnbmF0dXJlfSxzZXQ6ZnVuY3Rpb24oZSl7ZSYmKHRoaXMuX3NpZ25hdHVyZT1lKX19LHtrZXk6InNvdXJjZVBhY2thZ2UiLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zb3VyY2VQYWNrYWdlfSxzZXQ6ZnVuY3Rpb24oZSl7ZSYmKHRoaXMuX3NvdXJjZVBhY2thZ2U9ZSl9fSx7a2V5OiJzb3VyY2VQYWNrYWdlVVJMIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fc291cmNlUGFja2FnZVVSTH0sc2V0OmZ1bmN0aW9uKGUpe2UmJih0aGlzLl9zb3VyY2VQYWNrYWdlVVJMPWUpfX1dKSxlfSgpLGE9e0hZUEVSVFk6Imh5cGVydHkiLFBST1RPU1RVQjoicHJvdG9zdHViIixIWVBFUlRZX1JVTlRJTUU6Imh5cGVydHlfcnVudGltZSIsSFlQRVJUWV9JTlRFUkNFUFRPUjoiaHlwZXJ0eV9pbnNwZWN0b3IiLEhZUEVSVFlfREFUQV9PQkpFQ1Q6Imh5cGVydHlfZGF0YV9vYmplY3QiLFBPTElDWV9FTkZPUkNFUjoicG9saWN5X2VuZm9yY2VyIixEQVRBX1NDSEVNQToiZGF0YV9zY2hlbWEifTtyLkNhdGFsb2d1ZU9iamVjdFR5cGU9YTt2YXIgcz17SkFWQVNDUklQVF9FQ01BNjoiamF2YXNjcmlwdF9lY21hNiIsSkFWQVNDUklQVF9FQ01BNToiamF2YXNjcmlwdF9lY21hNSIsSlNPTl9TQ0hFTUFfVjQ6Impzb25fc2NoZW1hX3Y0IixQWVRIT046InB5dGhvbiIsVFlQRVNDUklQVDoidHlwZXNjcmlwdCJ9O3IuRGF0YU9iamVjdFNvdXJjZUxhbmd1YWdlPXMsclsiZGVmYXVsdCJdPWl9LHsiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjExLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxM31dLDEwMDpbZnVuY3Rpb24oZSx0LHIpeyJ1c2Ugc3RyaWN0Ijt2YXIgbj1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0IilbImRlZmF1bHQiXSxvPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cyIpWyJkZWZhdWx0Il0saT1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIilbImRlZmF1bHQiXSxhPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIilbImRlZmF1bHQiXSxzPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCIpWyJkZWZhdWx0Il07T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciB1PWUoIi4uL3JlVEhJTktPYmplY3QvUmV0aGlua09iamVjdCIpLGM9cyh1KSxsPWUoIi4vQ2F0YWxvZ3VlRGF0YU9iamVjdCIpLGY9cyhsKSxwPWUoIi4vU291cmNlUGFja2FnZSIpLGg9cyhwKSxkPWUoIi4vSHlwZXJ0eURlc2NyaXB0b3IiKSx5PXMoZCksYj1lKCIuL1Byb3RvY29sU3R1YkRlc2NyaXB0b3IiKSxtPXMoYiksdj1lKCIuL0h5cGVydHlSdW50aW1lRGVzY3JpcHRvciIpLGc9cyh2KSxfPWUoIi4vUG9saWN5RW5mb3JjZXJEZXNjcmlwdG9yIiksTz1zKF8pLGo9ZSgiLi9EYXRhT2JqZWN0U2NoZW1hIiksRT1zKGopLHc9ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlLHIpe2EodGhpcyx0KSxuKE9iamVjdC5nZXRQcm90b3R5cGVPZih0LnByb3RvdHlwZSksImNvbnN0cnVjdG9yIix0aGlzKS5jYWxsKHRoaXMsZSxyKX1yZXR1cm4gbyh0LGUpLGkodCxbe2tleToiY3JlYXRlQ2F0YWxvZ3VlRGF0YU9iamVjdCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsbixvLGkpe2lmKCJ1bmRlZmluZWQiPT10eXBlb2YgZXx8InVuZGVmaW5lZCI9PXR5cGVvZiB0fHwidW5kZWZpbmVkIj09dHlwZW9mIHJ8fCJ1bmRlZmluZWQiPT10eXBlb2Ygbnx8InVuZGVmaW5lZCI9PXR5cGVvZiBvfHwidW5kZWZpbmVkIj09dHlwZW9mIGkpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHBhcmFtZXRlcnMhIik7cmV0dXJuIG5ldyBmWyJkZWZhdWx0Il0oZSx0LHIsbixvLGkpfX0se2tleToiY3JlYXRlSHlwZXJ0eURlc2NyaXB0b3JPYmplY3QiLHZhbHVlOmZ1bmN0aW9uKGUsdCxyLG4sbyxpLGEpe2lmKCJ1bmRlZmluZWQiPT10eXBlb2YgZXx8InVuZGVmaW5lZCI9PXR5cGVvZiB0fHwidW5kZWZpbmVkIj09dHlwZW9mIHJ8fCJ1bmRlZmluZWQiPT10eXBlb2Ygbnx8InVuZGVmaW5lZCI9PXR5cGVvZiBvfHwidW5kZWZpbmVkIj09dHlwZW9mIGl8fCJ1bmRlZmluZWQiPT10eXBlb2YgYSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgcGFyYW1ldGVycyEiKTtyZXR1cm4gbmV3IHlbImRlZmF1bHQiXShlLGwuQ2F0YWxvZ3VlT2JqZWN0VHlwZS5IWVBFUlRZLHQscixuLG8saSxhKX19LHtrZXk6ImNyZWF0ZVByb3RvU3R1YkRlc2NyaXB0b3JPYmplY3QiLHZhbHVlOmZ1bmN0aW9uKGUsdCxyLG4sbyxpLGEscyl7aWYoInVuZGVmaW5lZCI9PXR5cGVvZiBlfHwidW5kZWZpbmVkIj09dHlwZW9mIHR8fCJ1bmRlZmluZWQiPT10eXBlb2Ygcnx8InVuZGVmaW5lZCI9PXR5cGVvZiBufHwidW5kZWZpbmVkIj09dHlwZW9mIG98fCJ1bmRlZmluZWQiPT10eXBlb2YgaXx8InVuZGVmaW5lZCI9PXR5cGVvZiBhfHwidW5kZWZpbmVkIj09dHlwZW9mIHMpdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHBhcmFtZXRlcnMhIik7cmV0dXJuIG5ldyBtWyJkZWZhdWx0Il0oZSxsLkNhdGFsb2d1ZU9iamVjdFR5cGUuUFJPVE9TVFVCLHQscixuLG8saSxhLHMpfX0se2tleToiY3JlYXRlSHlwZXJ0eVJ1bnRpbWVEZXNjcmlwdG9yT2JqZWN0Iix2YWx1ZTpmdW5jdGlvbihlLHQscixuLG8saSxhLHMpe2lmKCJ1bmRlZmluZWQiPT10eXBlb2YgZXx8InVuZGVmaW5lZCI9PXR5cGVvZiB0fHwidW5kZWZpbmVkIj09dHlwZW9mIHJ8fCJ1bmRlZmluZWQiPT10eXBlb2Ygbnx8InVuZGVmaW5lZCI9PXR5cGVvZiBvfHwidW5kZWZpbmVkIj09dHlwZW9mIGl8fCJ1bmRlZmluZWQiPT10eXBlb2YgYXx8InVuZGVmaW5lZCI9PXR5cGVvZiBzKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCBwYXJhbWV0ZXJzISIpO3JldHVybiBuZXcgZ1siZGVmYXVsdCJdKGUsbC5DYXRhbG9ndWVPYmplY3RUeXBlLkhZUEVSVFlfUlVOVElNRSx0LHIsbixvLGksYSxzKX19LHtrZXk6ImNyZWF0ZVBvbGljeUVuZm9yY2VyRGVzY3JpcHRvck9iamVjdCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsbixvLGksYSl7aWYoInVuZGVmaW5lZCI9PXR5cGVvZiBlfHwidW5kZWZpbmVkIj09dHlwZW9mIHR8fCJ1bmRlZmluZWQiPT10eXBlb2Ygcnx8InVuZGVmaW5lZCI9PXR5cGVvZiBufHwidW5kZWZpbmVkIj09dHlwZW9mIG98fCJ1bmRlZmluZWQiPT10eXBlb2YgaXx8InVuZGVmaW5lZCI9PXR5cGVvZiBhKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCBwYXJhbWV0ZXJzISIpO3JldHVybiBuZXcgT1siZGVmYXVsdCJdKGUsbC5DYXRhbG9ndWVPYmplY3RUeXBlLlBPTElDWV9FTkZPUkNFUix0LHIsbixvLGksYSl9fSx7a2V5OiJjcmVhdGVEYXRhT2JqZWN0U2NoZW1hIix2YWx1ZTpmdW5jdGlvbihlLHQscixuLG8pe2lmKCJ1bmRlZmluZWQiPT10eXBlb2YgZXx8InVuZGVmaW5lZCI9PXR5cGVvZiB0fHwidW5kZWZpbmVkIj09dHlwZW9mIHJ8fCJ1bmRlZmluZWQiPT10eXBlb2Ygbnx8InVuZGVmaW5lZCI9PXR5cGVvZiBvKXRocm93IG5ldyBFcnJvcigiSW52YWxpZCBwYXJhbWV0ZXJzISIpO3JldHVybiBuZXcgRVsiZGVmYXVsdCJdKGUsbC5DYXRhbG9ndWVPYmplY3RUeXBlLkRBVEFfU0NIRU1BLHQscixuLG8pfX0se2tleToiY3JlYXRlU291cmNlUGFja2FnZSIsdmFsdWU6ZnVuY3Rpb24oZSx0KXtpZigidW5kZWZpbmVkIj09dHlwZW9mIHR8fCJ1bmRlZmluZWQiPT10eXBlb2YgZSl0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgcGFyYW1ldGVycyEiKTtyZXR1cm4gbmV3IGhbImRlZmF1bHQiXShlLHQpfX1dKSx0fShjWyJkZWZhdWx0Il0pO3JbImRlZmF1bHQiXT13LHQuZXhwb3J0cz1yWyJkZWZhdWx0Il19LHsiLi4vcmVUSElOS09iamVjdC9SZXRoaW5rT2JqZWN0IjoxMTAsIi4vQ2F0YWxvZ3VlRGF0YU9iamVjdCI6OTksIi4vRGF0YU9iamVjdFNjaGVtYSI6MTAxLCIuL0h5cGVydHlEZXNjcmlwdG9yIjoxMDIsIi4vSHlwZXJ0eVJ1bnRpbWVEZXNjcmlwdG9yIjoxMDMsIi4vUG9saWN5RW5mb3JjZXJEZXNjcmlwdG9yIjoxMDQsIi4vUHJvdG9jb2xTdHViRGVzY3JpcHRvciI6MTA1LCIuL1NvdXJjZVBhY2thZ2UiOjEwNiwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjExLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxMywiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCI6MTUsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cyI6MTYsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCI6MTd9XSwxMDE6W2Z1bmN0aW9uKGUsdCxyKXsidXNlIHN0cmljdCI7dmFyIG49ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCIpWyJkZWZhdWx0Il0sbz1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiKVsiZGVmYXVsdCJdLGk9ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siKVsiZGVmYXVsdCJdLGE9ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IilbImRlZmF1bHQiXTtPYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIHM9ZSgiLi9DYXRhbG9ndWVEYXRhT2JqZWN0IiksdT1hKHMpLGM9ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlLHIsbyxhLHMsdSl7aSh0aGlzLHQpLG4oT2JqZWN0LmdldFByb3RvdHlwZU9mKHQucHJvdG90eXBlKSwiY29uc3RydWN0b3IiLHRoaXMpLmNhbGwodGhpcyxlLHIsbyxhLHMsdSl9cmV0dXJuIG8odCxlKSx0fSh1WyJkZWZhdWx0Il0pLGw9ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlLHIsbyxhLHMsdSl7aSh0aGlzLHQpLG4oT2JqZWN0LmdldFByb3RvdHlwZU9mKHQucHJvdG90eXBlKSwiY29uc3RydWN0b3IiLHRoaXMpLmNhbGwodGhpcyxlLHIsbyxhLHMsdSl9cmV0dXJuIG8odCxlKSx0fShjKTtyLk1lc3NhZ2VEYXRhT2JqZWN0U2NoZW1hPWw7dmFyIGY9ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlLHIsbyxhLHMsdSxjKXtpKHRoaXMsdCksbihPYmplY3QuZ2V0UHJvdG90eXBlT2YodC5wcm90b3R5cGUpLCJjb25zdHJ1Y3RvciIsdGhpcykuY2FsbCh0aGlzLGUscixvLGEscyx1KSx0aGlzLl9hY2Nlc3NDb250cm9sUG9saWN5PWN9cmV0dXJuIG8odCxlKSx0fShjKTtyLkh5cGVydHlEYXRhT2JqZWN0U2NoZW1hPWY7dmFyIHA9ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlLHIsbyxhLHMsdSxjKXtpKHRoaXMsdCksbihPYmplY3QuZ2V0UHJvdG90eXBlT2YodC5wcm90b3R5cGUpLCJjb25zdHJ1Y3RvciIsdGhpcykuY2FsbCh0aGlzLGUscixvLGEscyx1LGMpfXJldHVybiBvKHQsZSksdH0oZik7ci5Db21tdW5pY2F0aW9uRGF0YU9iamVjdFNjaGVtYT1wO3ZhciBoPWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQoZSxyLG8sYSxzLHUsYyl7aSh0aGlzLHQpLG4oT2JqZWN0LmdldFByb3RvdHlwZU9mKHQucHJvdG90eXBlKSwiY29uc3RydWN0b3IiLHRoaXMpLmNhbGwodGhpcyxlLHIsbyxhLHMsdSxjKX1yZXR1cm4gbyh0LGUpLHR9KGYpO3IuQ29ubmVjdGlvbkRhdGFPYmplY3RTY2hlbWE9aDt2YXIgZD1mdW5jdGlvbihlKXtmdW5jdGlvbiB0KGUscixvLGEscyx1LGMpe2kodGhpcyx0KSxuKE9iamVjdC5nZXRQcm90b3R5cGVPZih0LnByb3RvdHlwZSksImNvbnN0cnVjdG9yIix0aGlzKS5jYWxsKHRoaXMsZSxyLG8sYSxzLHUsYyl9cmV0dXJuIG8odCxlKSx0fShmKTtyLklkZW50aWZ5RGF0YU9iamVjdFNjaGVtYT1kO3ZhciB5PWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQoZSxyLG8sYSxzLHUsYyl7aSh0aGlzLHQpLG4oT2JqZWN0LmdldFByb3RvdHlwZU9mKHQucHJvdG90eXBlKSwiY29uc3RydWN0b3IiLHRoaXMpLmNhbGwodGhpcyxlLHIsbyxhLHMsdSxjKX1yZXR1cm4gbyh0LGUpLHR9KGYpO3IuQ29udGV4dERhdGFPYmplY3RTY2hlbWE9eSxyWyJkZWZhdWx0Il09Y30seyIuL0NhdGFsb2d1ZURhdGFPYmplY3QiOjk5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6MTEsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQiOjE1LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiOjE2LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQiOjE3fV0sMTAyOltmdW5jdGlvbihlLHQscil7InVzZSBzdHJpY3QiO3ZhciBuPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQiKVsiZGVmYXVsdCJdLG89ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIilbImRlZmF1bHQiXSxpPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiKVsiZGVmYXVsdCJdLGE9ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siKVsiZGVmYXVsdCJdLHM9ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IilbImRlZmF1bHQiXTtPYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIHU9ZSgiLi9DYXRhbG9ndWVEYXRhT2JqZWN0IiksYz1zKHUpLGw9ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlLHIsbyxpLHMsdSxjLGwpe2EodGhpcyx0KSxuKE9iamVjdC5nZXRQcm90b3R5cGVPZih0LnByb3RvdHlwZSksImNvbnN0cnVjdG9yIix0aGlzKS5jYWxsKHRoaXMsZSxyLG8saSxzLHUpLHRoaXMuX2NvbmZpZ3VyYXRpb249e30sdGhpcy5fY29uc3RyYWludHM9e30sdGhpcy5fcG9saWNpZXM9e30sdGhpcy5fbWVzc2FnZVNjaGVtYT1udWxsLHRoaXMuX2h5cGVydHlUeXBlPWMsdGhpcy5fZGF0YU9iamVjdHM9bH1yZXR1cm4gbyh0LGUpLGkodCxbe2tleToiaHlwZXJ0eVR5cGUiLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9oeXBlcnR5VHlwZX0sc2V0OmZ1bmN0aW9uKGUpe2UmJih0aGlzLl9oeXBlcnR5VHlwZT1lKX19LHtrZXk6ImRhdGFPYmplY3RzIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZGF0YU9iamVjdHN9LHNldDpmdW5jdGlvbihlKXtlJiYodGhpcy5fZGF0YU9iamVjdHM9ZSl9fSx7a2V5OiJjb25maWd1cmF0aW9uIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fY29uZmlndXJhdGlvbn0sc2V0OmZ1bmN0aW9uKGUpe2UmJih0aGlzLl9jb25maWd1cmF0aW9uPWUpfX0se2tleToiY29uc3RyYWludHMiLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9jb25zdHJhaW50c30sc2V0OmZ1bmN0aW9uKGUpe2UmJih0aGlzLl9jb25zdHJhaW50cz1lKX19LHtrZXk6Im1lc3NhZ2VTY2hlbWEiLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9tZXNzYWdlU2NoZW1hfSxzZXQ6ZnVuY3Rpb24oZSl7ZSYmKHRoaXMuX21lc3NhZ2VTY2hlbWE9ZSl9fSx7a2V5OiJwb2xpY2llcyIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3BvbGljaWVzfSxzZXQ6ZnVuY3Rpb24oZSl7ZSYmKHRoaXMuX3BvbGljaWVzPWUpfX1dKSx0fShjWyJkZWZhdWx0Il0pLGY9e307ci5SdW50aW1lSHlwZXJ0eUNhcGFiaWxpdHlUeXBlPWY7dmFyIHA9e0NPTU1VTklDQVRPUjoiY29tbXVuaWNhdG9yIixJREVOVElUWToiaWRlbnRpdHkiLENPTlRFWFQ6ImNvbnRleHQifTtyLkh5cGVydHlUeXBlPXAsclsiZGVmYXVsdCJdPWx9LHsiLi9DYXRhbG9ndWVEYXRhT2JqZWN0Ijo5OSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjExLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxMywiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCI6MTUsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cyI6MTYsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCI6MTd9XSwxMDM6W2Z1bmN0aW9uKGUsdCxyKXsidXNlIHN0cmljdCI7dmFyIG49ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCIpWyJkZWZhdWx0Il0sbz1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiKVsiZGVmYXVsdCJdLGk9ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyIpWyJkZWZhdWx0Il0sYT1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayIpWyJkZWZhdWx0Il0scz1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQiKVsiZGVmYXVsdCJdO09iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt2YXIgdT1lKCIuL0NhdGFsb2d1ZURhdGFPYmplY3QiKSxjPXModSksbD1mdW5jdGlvbihlKXtmdW5jdGlvbiB0KGUscixvLGkscyx1LGMsbCxmKXthKHRoaXMsdCksbihPYmplY3QuZ2V0UHJvdG90eXBlT2YodC5wcm90b3R5cGUpLCJjb25zdHJ1Y3RvciIsdGhpcykuY2FsbCh0aGlzLGUscixvLGkscyx1KSx0aGlzLl9ydW50aW1lVHlwZT1jLGw/dGhpcy5faHlwZXJ0eUNhcGFiaWxpdGllcz1sOnRoaXMuX2h5cGVydHlDYXBhYmlsaXRpZXM9e30sZj90aGlzLl9wcm90b2NvbENhcGFiaWxpdGllcz1mOnRoaXMuX3Byb3RvY29sQ2FwYWJpbGl0aWVzPXt9fXJldHVybiBvKHQsZSksaSh0LFt7a2V5OiJydW50aW1lVHlwZSIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3J1bnRpbWVUeXBlfSxzZXQ6ZnVuY3Rpb24oZSl7ZSYmKHRoaXMuX3J1bnRpbWVUeXBlPWUpfX0se2tleToiaHlwZXJ0eUNhcGFiaWxpdGllcyIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2h5cGVydHlDYXBhYmlsaXRpZXN9LHNldDpmdW5jdGlvbihlKXtlJiYodGhpcy5faHlwZXJ0eUNhcGFiaWxpdGllcz1lKX19LHtrZXk6InByb3RvY29sQ2FwYWJpbGl0aWVzIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5faHlwZXJ0eUNhcGFiaWxpdGllc30sc2V0OmZ1bmN0aW9uKGUpe2UmJih0aGlzLl9wcm90b2NvbENhcGFiaWxpdGllcz1lKX19XSksdH0oY1siZGVmYXVsdCJdKSxmPXtCUk9XU0VSOiJicm93c2VyIixTVEFOREFMT05FOiJzdGFuZGFsb25lIixTRVJWRVI6InNlcnZlciIsR0FURVdBWToiZ2F0ZXdheSJ9O3IuUnVudGltZVR5cGU9Zjt2YXIgcD17TUlDOiJtaWMiLENBTUVSQToiY2FtZXJhIixTRU5TT1I6InNlbnNvciIsV0VCUlRDOiJ3ZWJydGMiLE9SVEM6Im9ydGMifTtyLlJ1bnRpbWVIeXBlcnR5Q2FwYWJpbGl0eVR5cGU9cDt2YXIgaD17SFRUUDoiaHR0cCIsSFRUUFM6Imh0dHBzIixXUzoid3MiLFdTUzoid3NzIixDT0FQOiJjb2FwIixEQVRBQ0hBTkVMOiJkYXRhY2hhbm5lbCJ9O3IuUnVudGltZVByb3RvY29sQ2FwYWJpbGl0eVR5cGU9aCxyWyJkZWZhdWx0Il09bH0seyIuL0NhdGFsb2d1ZURhdGFPYmplY3QiOjk5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6MTEsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjEzLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0IjoxNSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjoxNiwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IjoxN31dLDEwNDpbZnVuY3Rpb24oZSx0LHIpeyJ1c2Ugc3RyaWN0Ijt2YXIgbj1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0IilbImRlZmF1bHQiXSxvPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cyIpWyJkZWZhdWx0Il0saT1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIilbImRlZmF1bHQiXSxhPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIilbImRlZmF1bHQiXSxzPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCIpWyJkZWZhdWx0Il07T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciB1PWUoIi4vQ2F0YWxvZ3VlRGF0YU9iamVjdCIpLGM9cyh1KSxsPWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQoZSxyLG8saSxzLHUsYyxsKXthKHRoaXMsdCksbihPYmplY3QuZ2V0UHJvdG90eXBlT2YodC5wcm90b3R5cGUpLCJjb25zdHJ1Y3RvciIsdGhpcykuY2FsbCh0aGlzLGUscixvLGkscyx1KSx0aGlzLl9jb25maWd1cmF0aW9uPWMsdGhpcy5fcG9saWNpZXM9bH1yZXR1cm4gbyh0LGUpLGkodCxbe2tleToiY29uZmlndXJhdGlvbiIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2NvbmZpZ3VyYXRpb259LHNldDpmdW5jdGlvbihlKXt0aGlzLl9jb25maWd1cmF0aW9uPWV9fSx7a2V5OiJwb2xpY2llcyIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3BvbGljaWVzfSxzZXQ6ZnVuY3Rpb24oZSl7dGhpcy5fcG9saWNpZXM9ZX19XSksdH0oY1siZGVmYXVsdCJdKTtyWyJkZWZhdWx0Il09bCx0LmV4cG9ydHM9clsiZGVmYXVsdCJdfSx7Ii4vQ2F0YWxvZ3VlRGF0YU9iamVjdCI6OTksImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIjoxMSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyI6MTMsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQiOjE1LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiOjE2LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQiOjE3fV0sMTA1OltmdW5jdGlvbihlLHQscil7InVzZSBzdHJpY3QiO3ZhciBuPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQiKVsiZGVmYXVsdCJdLG89ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIilbImRlZmF1bHQiXSxpPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiKVsiZGVmYXVsdCJdLGE9ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siKVsiZGVmYXVsdCJdLHM9ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IilbImRlZmF1bHQiXTtPYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIHU9ZSgiLi9DYXRhbG9ndWVEYXRhT2JqZWN0IiksYz1zKHUpLGw9ZSgiLi9IeXBlcnR5UnVudGltZURlc2NyaXB0b3IiKSxmPShzKGwpLGZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQoZSxyLG8saSxzLHUsYyxsLGYpe2EodGhpcyx0KSxuKE9iamVjdC5nZXRQcm90b3R5cGVPZih0LnByb3RvdHlwZSksImNvbnN0cnVjdG9yIix0aGlzKS5jYWxsKHRoaXMsZSxyLG8saSxzLHUpLHRoaXMuX21lc3NhZ2VTY2hlbWFzPWMsbD90aGlzLl9jb25maWd1cmF0aW9uPWw6dGhpcy5fY29uZmlndXJhdGlvbj17fSxmP3RoaXMuX2NvbnN0cmFpbnRzPWY6dGhpcy5fY29uc3RyYWludHM9e319cmV0dXJuIG8odCxlKSxpKHQsW3trZXk6Im1lc3NhZ2VTY2hlbWFzIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fbWVzc2FnZVNjaGVtYXN9LHNldDpmdW5jdGlvbihlKXtlJiYodGhpcy5fbWVzc2FnZVNjaGVtYXM9ZSl9fSx7a2V5OiJjb25zdHJhaW50cyIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2NvbnN0cmFpbnRzfSxzZXQ6ZnVuY3Rpb24oZSl7ZSYmKHRoaXMuX2NvbnN0cmFpbnRzPWUpfX0se2tleToiY29uZmlndXJhdGlvbiIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX2NvbmZpZ3VyYXRpb259LHNldDpmdW5jdGlvbihlKXtlJiYodGhpcy5fY29uZmlndXJhdGlvbj1lKX19XSksdH0oY1siZGVmYXVsdCJdKSk7clsiZGVmYXVsdCJdPWYsdC5leHBvcnRzPXJbImRlZmF1bHQiXX0seyIuL0NhdGFsb2d1ZURhdGFPYmplY3QiOjk5LCIuL0h5cGVydHlSdW50aW1lRGVzY3JpcHRvciI6MTAzLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6MTEsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjEzLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0IjoxNSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjoxNiwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IjoxN31dLDEwNjpbZnVuY3Rpb24oZSx0LHIpeyJ1c2Ugc3RyaWN0Ijt2YXIgbj1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIilbImRlZmF1bHQiXSxvPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIilbImRlZmF1bHQiXTtPYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIGk9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQscil7byh0aGlzLGUpLHRoaXMuX3NvdXJjZUNvZGU9cix0aGlzLl9zb3VyY2VDb2RlQ2xhc3NuYW1lPXQsdGhpcy5fZW5jb2Rpbmc9bnVsbCx0aGlzLl9zaWduYXR1cmU9bnVsbH1yZXR1cm4gbihlLFt7a2V5OiJzb3VyY2VDb2RlIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fc291cmNlQ29kZX0sc2V0OmZ1bmN0aW9uKGUpe2UmJih0aGlzLl9zb3VyY2VDb2RlPWUpfX0se2tleToic291cmNlQ29kZUNsYXNzbmFtZSIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3NvdXJjZUNvZGVDbGFzc25hbWV9LHNldDpmdW5jdGlvbihlKXtlJiYodGhpcy5fc291cmNlQ29kZUNsYXNzbmFtZT1lKX19LHtrZXk6ImVuY29kaW5nIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZW5jb2Rpbmd9LHNldDpmdW5jdGlvbihlKXtlJiYodGhpcy5fZW5jb2Rpbmc9ZSl9fSx7a2V5OiJzaWduYXR1cmUiLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zaWduYXR1cmV9LHNldDpmdW5jdGlvbihlKXtlJiYodGhpcy5fc2lnbmF0dXJlPWUpfX1dKSxlfSgpO3JbImRlZmF1bHQiXT1pLHQuZXhwb3J0cz1yWyJkZWZhdWx0Il19LHsiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjExLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxM31dLDEwNzpbZnVuY3Rpb24oZSx0LHIpeyJ1c2Ugc3RyaWN0Ijt2YXIgbj1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIilbImRlZmF1bHQiXSxvPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIilbImRlZmF1bHQiXTtPYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIGk9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQscixuLGksYSl7byh0aGlzLGUpLHRoaXMuaWQ9dCx0aGlzLmZyb209cix0aGlzLnRvPW4sdGhpcy50eXBlPWksdGhpcy5ib2R5PWF9cmV0dXJuIG4oZSxbe2tleToiYXNzZXJ0SWRlbnRpdHkiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7aWYoIWV8fCF0KXRocm93IG5ldyBFcnJvcigibWVzc2FnZSwgdG9rZW4gdG8gYmUgcmVtb3ZlZCwgYW5kIGFzc2VydGVkSWRlbnRpdHkgbXVzdCBiZSBwcm92aWRlZCIpO3ZhciByPXRoaXMuYm9keTtyZXR1cm4gci5pZFRva2VuPW51bGwsci5hc3NlcnRlZElkZW50aXR5PXQsdGhpcy5ib2R5PXIsdGhpc319LHtrZXk6ImFkZElkVG9rZW4iLHZhbHVlOmZ1bmN0aW9uKGUpe2lmKCFlKXRocm93IG5ldyBFcnJvcigibWVzc2FnZSwgdG9rZW4gdG8gYmUgYWRkZWQsIG11c3QgYmUgcHJvdmlkZWQiKTt2YXIgdD10aGlzLmJvZHk7cmV0dXJuIHQuaWRUb2tlbj1lLHRoaXMuYm9keT10LHRoaXN9fSx7a2V5OiJhZGRBY2Nlc3NUb2tlbiIsdmFsdWU6ZnVuY3Rpb24oZSl7aWYoIWUpdGhyb3cgbmV3IEVycm9yKCJtZXNzYWdlLCB0b2tlbiB0byBiZSBhZGRlZCwgbXVzdCBiZSBwcm92aWRlZCIpO3ZhciB0PXRoaXMuYm9keTtyZXR1cm4gdC5hY2Nlc3NUb2tlbj1lLHRoaXMuYm9keT10LHRoaXN9fV0pLGV9KCk7ci5NZXNzYWdlPWk7dmFyIGE9e0NSRUFURToiY3JlYXRlIixSRUFEOiJyZWFkIixVUERBVEU6InVwZGF0ZSIsREVMRVRFOiJkZWxldGUiLFNVQlNDUklCRToic3Vic2NyaWJlIixVTlNVQlNDUklCRToidW5zdWJzY3JpYmUiLFJFU1BPTlNFOiJyZXNwb25zZSIsRk9SV0FSRDoiZm9yd2FyZCJ9O3IuTWVzc2FnZVR5cGU9YSxyWyJkZWZhdWx0Il09aX0seyJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6MTEsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjEzfV0sMTA4OltmdW5jdGlvbihlLHQscil7InVzZSBzdHJpY3QiO2Z1bmN0aW9uIG4oZSl7dmFyIHQ9cyhlKS5yZWR1Y2UoZnVuY3Rpb24odCxyKXtyZXR1cm4gdFtlW3JdXT1yLHR9LHt9KTtyZXR1cm4gdShzKGUpLnJlZHVjZShmdW5jdGlvbih0LHIpe3JldHVybiB0W3JdPWVbcl0sdH0sZnVuY3Rpb24oZSl7cmV0dXJuIHRbZV19KSl9dmFyIG89ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siKVsiZGVmYXVsdCJdLGk9ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCIpWyJkZWZhdWx0Il0sYT1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiKVsiZGVmYXVsdCJdLHM9ZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzIilbImRlZmF1bHQiXSx1PWUoImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3QvZnJlZXplIilbImRlZmF1bHQiXTtPYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSksci5FbnVtPW47dmFyIGM9ZnVuY3Rpb24gdihlLHQscixuLGkpe28odGhpcyx2KSx0aGlzLmlkVG9rZW49ZSx0aGlzLmFjY2Vzc1Rva2VuPXQsdGhpcy5yZXNvdXJjZT1yLHRoaXMuc2NoZW1hPW4sdGhpcy5hc3NlcnRlZElkZW50aXR5PWl9O3IuTWVzc2FnZUJvZHk9Yzt2YXIgbD1mdW5jdGlvbihlKXtmdW5jdGlvbiB0KGUscixuLGEscyx1LGMpe2lmKG8odGhpcyx0KSwhZSl0aHJvdyBuZXcgRXJyb3IoIlRoZSB2YWx1ZSBwYXJhbWV0ZXIgaXMgbnVsbCIpO2koT2JqZWN0LmdldFByb3RvdHlwZU9mKHQucHJvdG90eXBlKSwiY29uc3RydWN0b3IiLHRoaXMpLmNhbGwodGhpcyxuLGEscyx1LGMsdSxjKSx0aGlzLnZhbHVlPWUsciYmKHRoaXMucG9saWN5PXIpfXJldHVybiBhKHQsZSksdH0oYyk7ci5DcmVhdGVNZXNzYWdlQm9keT1sO3ZhciBmPWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQoZSxyLG4sYSxzLHUsYyxsKXtvKHRoaXMsdCksaShPYmplY3QuZ2V0UHJvdG90eXBlT2YodC5wcm90b3R5cGUpLCJjb25zdHJ1Y3RvciIsdGhpcykuY2FsbCh0aGlzLGUscixuLGEscyksdSYmKHRoaXMuYXR0cmlidXRlPXUpLGMmJih0aGlzLmNyaXRlcmlhU3ludGF4PWMpLGwmJih0aGlzLmNyaXRlcmlhPWwpfXJldHVybiBhKHQsZSksdH0oYyk7ci5SZWFkTWVzc2FnZUJvZHk9Zjt2YXIgcD1mdW5jdGlvbihlKXtmdW5jdGlvbiB0KGUscixuLGEscyx1KXtvKHRoaXMsdCksaShPYmplY3QuZ2V0UHJvdG90eXBlT2YodC5wcm90b3R5cGUpLCJjb25zdHJ1Y3RvciIsdGhpcykuY2FsbCh0aGlzLGUscixuLGEscyksdSYmKHRoaXMuYXR0cmlidXRlPXUpfXJldHVybiBhKHQsZSksdH0oYyk7ci5EZWxldGVNZXNzYWdlQm9keT1wO3ZhciBoPWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQoZSxyLG4sYSxzLHUsYyl7byh0aGlzLHQpLGkoT2JqZWN0LmdldFByb3RvdHlwZU9mKHQucHJvdG90eXBlKSwiY29uc3RydWN0b3IiLHRoaXMpLmNhbGwodGhpcyxlLHIsbixhLHMpLHRoaXMuYXR0cmlidXRlPXUsdGhpcy52YWx1ZT1jfXJldHVybiBhKHQsZSksdH0oYyk7ci5VcGRhdGVNZXNzYWdlQm9keT1oO3ZhciBkPWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQoZSxyLG4sYSxzLHUpe28odGhpcyx0KSxpKE9iamVjdC5nZXRQcm90b3R5cGVPZih0LnByb3RvdHlwZSksImNvbnN0cnVjdG9yIix0aGlzKS5jYWxsKHRoaXMsZSxyLG4sYSxzKSx0aGlzLm1lc3NhZ2U9dX1yZXR1cm4gYSh0LGUpLHR9KGMpO3IuRm9yd2FyZE1lc3NhZ2VCb2R5PWQ7dmFyIHk9ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlLHIsbixhLHMpe28odGhpcyx0KSxpKE9iamVjdC5nZXRQcm90b3R5cGVPZih0LnByb3RvdHlwZSksImNvbnN0cnVjdG9yIix0aGlzKS5jYWxsKHRoaXMsZSxyLG4pLGEmJih0aGlzLmNvZGU9YSx0aGlzLmRlc2NyaXB0aW9uPW1bYV0pLHMmJih0aGlzLnZhbHVlPXMpfXJldHVybiBhKHQsZSksdH0oYyk7ci5SZXNwb25zZU1lc3NhZ2VCb2R5PXk7dmFyIGI9bih7MTAwOiIxMDAiLDEwMToiMTAxIiwyMDA6IjIwMCIsMjAxOiIyMDEiLDIwMjoiMjAyIiwyMDM6IjIwMyIsMjA0OiIyMDQiLDIwNToiMjA1IiwyMDY6IjIwNiIsMzAwOiIzMDAiLDMwMToiMzAxIiwzMDI6IjMwMiIsMzAzOiIzMDMiLDMwNDoiMzA0IiwzMDU6IjMwNSIsMzA3OiIzMDciLDQwMDoiNDAwIiw0MDE6IjQwMSIsNDAyOiI0MDIiLDQwMzoiNDAzIiw0MDQ6IjQwNCIsNDA1OiI0MDUiLDQwNjoiNDA2Iiw0MDc6IjQwNyIsNDA4OiI0MDgiLDQwOToiNDA5Iiw0MTA6IjQxMCIsNDExOiI0MTEiLDQxMjoiNDEyIiw0MTM6IjQxMyIsNDE0OiI0MTQiLDQxNToiNDE1Iiw0MTY6IjQxNiIsNDE3OiI0MTciLDQyNjoiNDI2Iiw1MDA6IjUwMCIsNTAxOiI1MDEiLDUwMjoiNTAyIiw1MDM6IjUwMyIsNTA0OiI1MDQiLDUwNToiNTA1In0pO3IuUkVTUE9OU0VfQ09ERT1iO3ZhciBtPW4oezEwMDoiQ29udGludWUiLDEwMToiU3dpdGNoaW5nIFByb3RvY29scyIsMjAwOiJPSyIsMjAxOiJDcmVhdGVkIiwyMDI6IkFjY2VwdGVkIiwyMDM6Ik5vbi1BdXRob3JpdGF0aXZlIEluZm9ybWF0aW9uIiwyMDQ6Ik5vIENvbnRlbnQiLDIwNToiUmVzZXQgQ29udGVudCIsMjA2OiJQYXJ0aWFsIENvbnRlbnQiLDMwMDoiTXVsdGlwbGUgQ2hvaWNlcyIsMzAxOiJNb3ZlZCBQZXJtYW5lbnRseSIsMzAyOiJGb3VuZCIsMzAzOiJTZWUgT3RoZXIiLDMwNDoiTm90IE1vZGlmaWVkIiwzMDU6IlVzZSBQcm94eSIsMzA3OiJUZW1wb3JhcnkgUmVkaXJlY3QiLDQwMDoiQmFkIFJlcXVlc3QiLDQwMToiVW5hdXRob3JpemVkIiw0MDI6IlBheW1lbnQgUmVxdWlyZWQiLDQwMzoiRm9yYmlkZGVuIiw0MDQ6Ik5vdCBGb3VuZCIsNDA1OiJNZXRob2QgTm90IEFsbG93ZWQiLDQwNjoiTm90IEFjY2VwdGFibGUiLDQwNzoiUHJveHkgQXV0aGVudGljYXRpb24gUmVxdWlyZWQiLDQwODoiUmVxdWVzdCBUaW1lb3V0Iiw0MDk6IkNvbmZsaWN0Iiw0MTA6IkdvbmUiLDQxMToiTGVuZ3RoIFJlcXVpcmVkIiw0MTI6IlByZWNvbmRpdGlvbiBGYWlsZWQiLDQxMzoiUGF5bG9hZCBUb28gTGFyZ2UiLDQxNDoiUmVxdWVzdC1VUkkgVG9vIExvbmciLDQxNToiVW5zdXBwb3J0ZWQgTWVkaWEgVHlwZSIsNDE2OiJSYW5nZSBOb3QgU2F0aXNmaWFibGUiLDQxNzoiRXhwZWN0YXRpb24gRmFpbGVkIiw0MjY6IlVwZ3JhZGUgUmVxdWlyZWQiLDUwMDoiSW50ZXJuYWwgU2VydmVyIEVycm9yIiw1MDE6Ik5vdCBJbXBsZW1lbnRlZCIsNTAyOiJCYWQgR2F0ZXdheSIsNTAzOiJTZXJ2aWNlIFVuYXZhaWxhYmxlIiw1MDQ6IkdhdGV3YXkgVGltZS1vdXQiLDUwNToiSFRUUCBWZXJzaW9uIE5vdCBTdXBwb3J0ZWQifSk7ci5SRUFTT05fUEhSQVNFPW0sclsiZGVmYXVsdCJdPWN9LHsiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9mcmVlemUiOjMsImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qva2V5cyI6NiwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjExLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0IjoxNSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjoxNn1dLDEwOTpbZnVuY3Rpb24oZSx0LHIpeyJ1c2Ugc3RyaWN0Ijt2YXIgbj1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0IilbImRlZmF1bHQiXSxvPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cyIpWyJkZWZhdWx0Il0saT1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIilbImRlZmF1bHQiXSxhPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIilbImRlZmF1bHQiXSxzPWUoImJhYmVsLXJ1bnRpbWUvcmVnZW5lcmF0b3IiKVsiZGVmYXVsdCJdLHU9ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IilbImRlZmF1bHQiXTtPYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIGM9ZSgiLi4vcmVUSElOS09iamVjdC9SZXRoaW5rT2JqZWN0LmpzIiksbD11KGMpLGY9ZSgiLi9NZXNzYWdlLmpzIikscD11KGYpLGg9ZSgiLi9NZXNzYWdlQm9keS5qcyIpLGQ9ZnVuY3Rpb24oZSl7ZnVuY3Rpb24gdChlLHIpe2EodGhpcyx0KSxuKE9iamVjdC5nZXRQcm90b3R5cGVPZih0LnByb3RvdHlwZSksImNvbnN0cnVjdG9yIix0aGlzKS5jYWxsKHRoaXMsZSxyKSx0aGlzLm15R2VuZXJhdG9yPShuZXcgeSkuaWRNYWtlcigpfXJldHVybiBvKHQsZSksaSh0LFt7a2V5OiJ2YWxpZGF0ZSIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIG4oT2JqZWN0LmdldFByb3RvdHlwZU9mKHQucHJvdG90eXBlKSwidmFsaWRhdGUiLHRoaXMpLmNhbGwodGhpcyxlKX19LHtrZXk6ImNyZWF0ZUNyZWF0ZU1lc3NhZ2VSZXF1ZXN0Iix2YWx1ZTpmdW5jdGlvbihlLHQscixuKXtpZighZXx8IXR8fCFyKXRocm93IG5ldyBFcnJvcigiZnJvbSwgdG8sIGFuZCB2YWx1ZSBvZiBvYmplY3QgdG8gYmUgY3JlYXRlZCBNVVNUIGJlIHNwZWNpZmllZCIpO3ZhciBvPXRoaXMubXlHZW5lcmF0b3IubmV4dCgpLnZhbHVlLGk9bmV3IGguQ3JlYXRlTWVzc2FnZUJvZHkocixuLG51bGwsbnVsbCxudWxsLG51bGwsbnVsbCksYT1uZXcgcFsiZGVmYXVsdCJdKG8sZSx0LGYuTWVzc2FnZVR5cGUuQ1JFQVRFLGkpO3JldHVybiBhfX0se2tleToiY3JlYXRlRm9yd2FyZE1lc3NhZ2VSZXF1ZXN0Iix2YWx1ZTpmdW5jdGlvbihlLHQscil7aWYoIWV8fCF0fHwhcil0aHJvdyBuZXcgRXJyb3IoImZyb20sIHRvLCBhbmQgbWVzc2FnZSB0byBmb3J3YXJkIE1VU1QgYmUgc3BlY2lmaWVkIik7dmFyIG49dGhpcy5teUdlbmVyYXRvci5uZXh0KCkudmFsdWUsbz1uZXcgaC5Gb3J3YXJkTWVzc2FnZUJvZHkobnVsbCxudWxsLG51bGwsbnVsbCxudWxsLHIpLGk9bmV3IHBbImRlZmF1bHQiXShuLGUsdCxmLk1lc3NhZ2VUeXBlLkZPUldBUkQsbyk7cmV0dXJuIGl9fSx7a2V5OiJjcmVhdGVEZWxldGVNZXNzYWdlUmVxdWVzdCIsdmFsdWU6ZnVuY3Rpb24oZSx0LHIsbil7aWYoIWV8fCF0KXRocm93IG5ldyBFcnJvcigiZnJvbSBhbmQgdG8gcGFyYW1ldGVycyBNVVNUIGJlIHNwZWNpZmllZCIpO3ZhciBvPXRoaXMubXlHZW5lcmF0b3IubmV4dCgpLnZhbHVlLGk9bmV3IGguRGVsZXRlTWVzc2FnZUJvZHkobnVsbCxudWxsLHIsbixudWxsLG51bGwpLGE9bmV3IHBbImRlZmF1bHQiXShvLGUsdCxmLk1lc3NhZ2VUeXBlLkRFTEVURSxpKTtyZXR1cm4gYX19LHtrZXk6ImNyZWF0ZVVwZGF0ZU1lc3NhZ2VSZXF1ZXN0Iix2YWx1ZTpmdW5jdGlvbihlLHQscixuLG8pe2lmKCFlfHwhdHx8IXIpdGhyb3cgbmV3IEVycm9yKCJmcm9tLCBhbmQgdG8gYW5kIHZhbHVlIE1VU1QgYmUgc3BlY2lmaWVkIik7dmFyIGk9dGhpcy5teUdlbmVyYXRvci5uZXh0KCkudmFsdWUsYT1uZXcgaC5VcGRhdGVNZXNzYWdlQm9keShudWxsLG51bGwsbixudWxsLG51bGwsbyxyKSxzPW5ldyBwWyJkZWZhdWx0Il0oaSxlLHQsZi5NZXNzYWdlVHlwZS5VUERBVEUsYSk7cmV0dXJuIHN9fSx7a2V5OiJjcmVhdGVSZWFkTWVzc2FnZVJlcXVlc3QiLHZhbHVlOmZ1bmN0aW9uKGUsdCxyLG4pe2lmKCFlfHwhdHx8IXIpdGhyb3cgbmV3IEVycm9yKCJmcm9tLCB0byBhbmQgdGhlIHJlc291cmNlIHRvIHJlYWQgZnJvbSBNVVNUIGJlIHNwZWNpZmllZCIpO3ZhciBvPXRoaXMubXlHZW5lcmF0b3IubmV4dCgpLnZhbHVlLGk9bmV3IGguUmVhZE1lc3NhZ2VCb2R5KG51bGwsbnVsbCxyLG51bGwsbnVsbCxuLG51bGwsbnVsbCksYT1uZXcgcFsiZGVmYXVsdCJdKG8sZSx0LGYuTWVzc2FnZVR5cGUuUkVBRCxpKTtyZXR1cm4gYX19LHtrZXk6ImNyZWF0ZVN1YnNjcmliZU1lc3NhZ2VSZXF1ZXN0Iix2YWx1ZTpmdW5jdGlvbihlLHQscil7aWYoIWV8fCF0fHwhcil0aHJvdyBuZXcgRXJyb3IoImZyb20sIHRvIGFuZCB0aGUgcmVzb3VyY2UgdG8gc3Vic2NyaWJlIHRvIE1VU1QgYmUgc3BlY2lmaWVkIik7dmFyIG49dGhpcy5teUdlbmVyYXRvci5uZXh0KCkudmFsdWUsbz1uZXcgaC5NZXNzYWdlQm9keShudWxsLG51bGwscixudWxsLG51bGwpLGk9bmV3IHBbImRlZmF1bHQiXShuLGUsdCxmLk1lc3NhZ2VUeXBlLlNVQlNDUklCRSxvKTtyZXR1cm4gaX19LHtrZXk6ImNyZWF0ZVVuc3Vic2NyaWJlTWVzc2FnZVJlcXVlc3QiLHZhbHVlOmZ1bmN0aW9uKGUsdCxyKXtpZighZXx8IXR8fCFyKXRocm93IG5ldyBFcnJvcigiZnJvbSwgdG8gYW5kIHRoZSByZXNvdXJjZSB0byBzdWJzY3JpYmUgdG8gTVVTVCBiZSBzcGVjaWZpZWQiKTt2YXIgbj10aGlzLm15R2VuZXJhdG9yLm5leHQoKS52YWx1ZSxvPW5ldyBoLk1lc3NhZ2VCb2R5KG51bGwsbnVsbCxyLG51bGwsbnVsbCksaT1uZXcgcFsiZGVmYXVsdCJdKG4sZSx0LGYuTWVzc2FnZVR5cGUuVU5TVUJTQ1JJQkUsbyk7cmV0dXJuIGl9fSx7a2V5OiJjcmVhdGVNZXNzYWdlUmVzcG9uc2UiLHZhbHVlOmZ1bmN0aW9uKGUsdCxyLG4pe2lmKCF0KXRocm93IG5ldyBFcnJvcigicmVzcG9uc2UgQ29kZSBNVVNUIGJlIHNwZWNpZmllZCIpO3ZhciBvPW5ldyBoLlJlc3BvbnNlTWVzc2FnZUJvZHkobnVsbCxudWxsLG51bGwsdCxyLG4pO3JldHVybiBuZXcgcFsiZGVmYXVsdCJdKGUuaWQsZS50byxlLmZyb20sZi5NZXNzYWdlVHlwZS5SRVNQT05TRSxvKX19LHtrZXk6ImdlbmVyYXRlTWVzc2FnZVJlc3BvbnNlIix2YWx1ZTpmdW5jdGlvbihlLHQscil7aWYoIWV8fCF0KXRocm93IG5ldyBFcnJvcigibWVzc2FnZSBhbmQgcmVzcG9uc2UgY29kZSBNVVNUIGJlIHNwZWNpZmllZCIpO3ZhciBuPWUuYm9keSxvPW4uaWRUb2tlbixpPW4uYWNjZXNzVG9rZW4sYT1uLnJlc291cmNlLHM9bmV3IGguUmVzcG9uc2VNZXNzYWdlQm9keShvLGksYSx0LHIpLHU9dGhpcy5teUdlbmVyYXRvci5uZXh0KCkudmFsdWU7cmV0dXJuIG5ldyBwWyJkZWZhdWx0Il0odSxlLnRvLGUuZnJvbSxmLk1lc3NhZ2VUeXBlLlJFU1BPTlNFLHMpfX1dKSx0fShsWyJkZWZhdWx0Il0pLHk9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKCl7YSh0aGlzLGUpfXJldHVybiBpKGUsW3trZXk6ImlkTWFrZXIiLHZhbHVlOnMubWFyayhmdW5jdGlvbiB0KCl7dmFyIGU7cmV0dXJuIHMud3JhcChmdW5jdGlvbih0KXtmb3IoOzspc3dpdGNoKHQucHJldj10Lm5leHQpe2Nhc2UgMDplPTE7Y2FzZSAxOmlmKCEoMWU1PmUpKXt0Lm5leHQ9NjticmVha31yZXR1cm4gdC5uZXh0PTQsZSsrO2Nhc2UgNDp0Lm5leHQ9MTticmVhaztjYXNlIDY6Y2FzZSJlbmQiOnJldHVybiB0LnN0b3AoKX19LHQsdGhpcyl9KX1dKSxlfSgpO3IuSWRHZW5lcmF0b3I9eSxyWyJkZWZhdWx0Il09ZH0seyIuLi9yZVRISU5LT2JqZWN0L1JldGhpbmtPYmplY3QuanMiOjExMCwiLi9NZXNzYWdlLmpzIjoxMDcsIi4vTWVzc2FnZUJvZHkuanMiOjEwOCwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjExLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxMywiYmFiZWwtcnVudGltZS9oZWxwZXJzL2dldCI6MTUsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cyI6MTYsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCI6MTcsImJhYmVsLXJ1bnRpbWUvcmVnZW5lcmF0b3IiOjIwfV0sMTEwOltmdW5jdGlvbihlLHQscil7InVzZSBzdHJpY3QiO3ZhciBuPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiKVsiZGVmYXVsdCJdLG89ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siKVsiZGVmYXVsdCJdLGk9ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IilbImRlZmF1bHQiXTtPYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIGE9ZSgidHY0Iikscz1pKGEpLHU9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQscil7byh0aGlzLGUpO3RoaXMudmFsaWRhdGlvbj10LHRoaXMuc2NoZW1hPXJ9cmV0dXJuIG4oZSxbe2tleToidmFsaWRhdGUiLHZhbHVlOmZ1bmN0aW9uKGUpe3JldHVybiB0aGlzLnNjaGVtYT9zWyJkZWZhdWx0Il0udmFsaWRhdGUoZSx0aGlzLnNjaGVtYSk6ITF9fV0pLGV9KCk7ci5SZXRoaW5rT2JqZWN0PXUsclsiZGVmYXVsdCJdPXV9LHsiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjExLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxMywiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IjoxNyx0djQ6OTh9XSwxMTE6W2Z1bmN0aW9uKGUsdCxyKXsidXNlIHN0cmljdCI7dmFyIG49ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IilbImRlZmF1bHQiXTtPYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIG89ZSgiLi9jYXRhbG9ndWUtZmFjdG9yeS9DYXRhbG9ndWVEYXRhT2JqZWN0RmFjdG9yeSIpLGk9bihvKSxhPWUoIi4vbWVzc2FnZS1mYWN0b3J5L01lc3NhZ2VGYWN0b3J5Iikscz1uKGEpLHU9ZSgiLi9zeW5jaGVyL1N5bmNoZXIiKSxjPW4odSksbD1lKCIuL3N5bmNoZXIvRGF0YU9iamVjdFJlcG9ydGVyIiksZj1uKGwpLHA9ZSgiLi9zeW5jaGVyL0RhdGFPYmplY3RPYnNlcnZlciIpLGg9bihwKSxkPWUoIi4vY2F0YWxvZ3VlLWZhY3RvcnkvSHlwZXJ0eURlc2NyaXB0b3IiKSx5PW4oZCksYj1lKCIuL2NhdGFsb2d1ZS1mYWN0b3J5L1Byb3RvY29sU3R1YkRlc2NyaXB0b3IiKSxtPW4oYiksdj1lKCIuL2NhdGFsb2d1ZS1mYWN0b3J5L1NvdXJjZVBhY2thZ2UiKSxnPW4odik7ci5DYXRhbG9ndWVGYWN0b3J5PWlbImRlZmF1bHQiXSxyLk1lc3NhZ2VGYWN0b3J5PXNbImRlZmF1bHQiXSxyLlN5bmNoZXI9Y1siZGVmYXVsdCJdLHIuRGF0YU9iamVjdFJlcG9ydGVyPWZbImRlZmF1bHQiXSxyLkRhdGFPYmplY3RPYnNlcnZlcj1oWyJkZWZhdWx0Il0sci5IeXBlcnR5RGVzY3JpcHRvcj15WyJkZWZhdWx0Il0sci5Qcm90b2NvbFN0dWJEZXNjcmlwdG9yPW1bImRlZmF1bHQiXSxyLlNvdXJjZVBhY2thZ2U9Z1siZGVmYXVsdCJdfSx7Ii4vY2F0YWxvZ3VlLWZhY3RvcnkvQ2F0YWxvZ3VlRGF0YU9iamVjdEZhY3RvcnkiOjEwMCwiLi9jYXRhbG9ndWUtZmFjdG9yeS9IeXBlcnR5RGVzY3JpcHRvciI6MTAyLCIuL2NhdGFsb2d1ZS1mYWN0b3J5L1Byb3RvY29sU3R1YkRlc2NyaXB0b3IiOjEwNSwiLi9jYXRhbG9ndWUtZmFjdG9yeS9Tb3VyY2VQYWNrYWdlIjoxMDYsIi4vbWVzc2FnZS1mYWN0b3J5L01lc3NhZ2VGYWN0b3J5IjoxMDksIi4vc3luY2hlci9EYXRhT2JqZWN0T2JzZXJ2ZXIiOjExNCwiLi9zeW5jaGVyL0RhdGFPYmplY3RSZXBvcnRlciI6MTE1LCIuL3N5bmNoZXIvU3luY2hlciI6MTE4LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQiOjE3fV0sMTEyOltmdW5jdGlvbihlLHQscil7InVzZSBzdHJpY3QiO3ZhciBuPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiKVsiZGVmYXVsdCJdLG89ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siKVsiZGVmYXVsdCJdLGk9ZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UiKVsiZGVmYXVsdCJdLGE9ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IilbImRlZmF1bHQiXTtPYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIHM9ZSgiLi9TeW5jT2JqZWN0IiksdT1hKHMpLGM9ZSgiLi9EYXRhT2JqZWN0Q2hpbGQiKSxsPWEoYyksZj1lKCIuLi91dGlscy91dGlscy5qcyIpLHA9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQscixuLGksYSxzLGMpe3ZhciBsPXRoaXM7byh0aGlzLGUpO3ZhciBmPXRoaXM7Zi5fdmVyc2lvbj0wLGYuX293bmVyPXQsZi5fdXJsPXIsZi5fc2NoZW1hPW4sZi5fYnVzPWksZi5fc3RhdHVzPWEsZi5fc3luY09iaj1uZXcgdVsiZGVmYXVsdCJdKHMpLGYuX2NoaWxkSWQ9MCxmLl9jaGlsZHJlbj17fTt2YXIgcD1yKyIvY2hpbGRyZW4vIjtjJiZjLmZvckVhY2goZnVuY3Rpb24oZSl7dmFyIHQ9cCtlO2kuYWRkTGlzdGVuZXIodCxmdW5jdGlvbihlKXtpZihlLmZyb20hPT1sLl9vd25lcilzd2l0Y2goZS50eXBlKXtjYXNlImNyZWF0ZSI6Zi5fb25DaGlsZHJlbkNyZWF0ZShlKTticmVhaztjYXNlImRlbGV0ZSI6Y29uc29sZS5sb2coZSk7YnJlYWs7ZGVmYXVsdDpmLl9jaGFuZ2VDaGlsZHJlbihlKX19KX0pfXJldHVybiBuKGUsW3trZXk6InBhdXNlIix2YWx1ZTpmdW5jdGlvbigpe3Rocm93Ik5vdCBpbXBsZW1lbnRlZCJ9fSx7a2V5OiJyZXN1bWUiLHZhbHVlOmZ1bmN0aW9uKCl7dGhyb3ciTm90IGltcGxlbWVudGVkIn19LHtrZXk6InN0b3AiLHZhbHVlOmZ1bmN0aW9uKCl7dGhyb3ciTm90IGltcGxlbWVudGVkIn19LHtrZXk6InJlbGVhc2UiLHZhbHVlOmZ1bmN0aW9uKCl7fX0se2tleToiYWRkQ2hpbGRyZW4iLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9dGhpcztyLl9jaGlsZElkKys7dmFyIG49ci5fb3duZXIrIiMiK3IuX2NoaWxkSWQsbz1yLl91cmwrIi9jaGlsZHJlbi8iK2UsYT17dHlwZToiY3JlYXRlIixmcm9tOnIuX293bmVyLHRvOm8sYm9keTp7cmVzb3VyY2U6bix2YWx1ZTp0fX07cmV0dXJuIG5ldyBpKGZ1bmN0aW9uKGUpe3ZhciBpPXIuX2J1cy5wb3N0TWVzc2FnZShhKTtjb25zb2xlLmxvZygiY3JlYXRlLXJlcG9ydGVyLWNoaWxkKCAiK3IuX293bmVyKyIgKTogIixhKTt2YXIgcz1uZXcgbFsiZGVmYXVsdCJdKHIuX293bmVyLG4saSxyLl9idXMsdCk7cy5vbkNoYW5nZShmdW5jdGlvbihlKXtyLl9vbkNoYW5nZShlLHtwYXRoOm8sY2hpbGRJZDpufSl9KSxyLl9jaGlsZHJlbltuXT1zLGUocyl9KX19LHtrZXk6Im9uQWRkQ2hpbGRyZW4iLHZhbHVlOmZ1bmN0aW9uKGUpe3RoaXMuX29uQWRkQ2hpbGRyZW5IYW5kbGVyPWV9fSx7a2V5OiJfb25DaGlsZHJlbkNyZWF0ZSIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcyxyPWUuYm9keS5yZXNvdXJjZTtjb25zb2xlLmxvZygiY3JlYXRlLW9ic2VydmVyLWNoaWxkKCAiK3QuX293bmVyKyIgKTogIixlKTt2YXIgbj1uZXcgbFsiZGVmYXVsdCJdKGUuZnJvbSxyLDAsdC5fYnVzLGUuYm9keS52YWx1ZSk7dC5fY2hpbGRyZW5bcl09bixzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7dC5fYnVzLnBvc3RNZXNzYWdlKHtpZDplLmlkLHR5cGU6InJlc3BvbnNlIixmcm9tOmUudG8sdG86ZS5mcm9tLGJvZHk6e2NvZGU6MjAwLHNvdXJjZTp0Ll9vd25lcn19KX0pO3ZhciBvPXt0eXBlOmUudHlwZSxmcm9tOmUuZnJvbSx1cmw6ZS50byx2YWx1ZTplLmJvZHkudmFsdWUsY2hpbGRJZDpyfTt0Ll9vbkFkZENoaWxkcmVuSGFuZGxlciYmdC5fb25BZGRDaGlsZHJlbkhhbmRsZXIobyl9fSx7a2V5OiJfb25DaGFuZ2UiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9dGhpcztpZihyLl92ZXJzaW9uKyssIm9uIj09PXIuX3N0YXR1cyl7dmFyIG49e3R5cGU6ZS5jVHlwZSxmcm9tOnIuX293bmVyLHRvOnIuX3VybCxib2R5Ont2ZXJzaW9uOnIuX3ZlcnNpb24sb1R5cGU6ZS5vVHlwZSxhdHRyaWI6ZS5maWVsZCx2YWx1ZTplLmRhdGF9fTt0JiYobi50bz10LnBhdGgsbi5ib2R5LmNoaWxkSWQ9dC5jaGlsZElkKSxyLl9idXMucG9zdE1lc3NhZ2Uobil9fX0se2tleToiX2NoYW5nZU9iamVjdCIsdmFsdWU6ZnVuY3Rpb24oZSx0KXt2YXIgcj10aGlzO2lmKHIuX3ZlcnNpb24rMT09PXQuYm9keS52ZXJzaW9uKXtyLl92ZXJzaW9uKys7dmFyIG49dC5ib2R5LmF0dHJpYixvPSgwLGYuZGVlcENsb25lKSh0LmJvZHkudmFsdWUpLGk9ZS5maW5kQmVmb3JlKG4pO2lmKHQudHlwZT09PXMuQ2hhbmdlVHlwZS5VUERBVEUpaS5vYmpbaS5sYXN0XT1vO2Vsc2UgaWYodC50eXBlPT09cy5DaGFuZ2VUeXBlLkFERClpZih0LmJvZHkub1R5cGU9PT1zLk9iamVjdFR5cGUuT0JKRUNUKWkub2JqW2kubGFzdF09bztlbHNle3ZhciBhPWkub2JqLHU9aS5sYXN0O0FycmF5LnByb3RvdHlwZS5zcGxpY2UuYXBwbHkoYSxbdSwwXS5jb25jYXQobykpfWVsc2UgaWYodC5ib2R5Lm9UeXBlPT09cy5PYmplY3RUeXBlLk9CSkVDVClkZWxldGUgaS5vYmpbaS5sYXN0XTtlbHNle3ZhciBhPWkub2JqLHU9aS5sYXN0O2Euc3BsaWNlKHUsbyl9fWVsc2UgY29uc29sZS5sb2coIlVOU1lOQ0hST05JWkVEIFZFUlNJT046IChkYXRhID0+ICIrci5fdmVyc2lvbisiLCBtc2cgPT4gIit0LmJvZHkudmVyc2lvbisiKSIpfX0se2tleToiX2NoYW5nZUNoaWxkcmVuIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzO2NvbnNvbGUubG9nKCJDaGFuZ2UgY2hpbGRyZW46ICIsdC5fb3duZXIsZSk7dmFyIHI9ZS5ib2R5LmNoaWxkSWQsbj10Ll9jaGlsZHJlbltyXTtuP3QuX2NoYW5nZU9iamVjdChuLl9zeW5jT2JqLGUpOmNvbnNvbGUubG9nKCJObyBjaGlsZHJlbiBmb3VuZCBmb3I6ICIscil9fSx7a2V5OiJ1cmwiLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl91cmx9fSx7a2V5OiJzY2hlbWEiLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zY2hlbWF9fSx7a2V5OiJzdGF0dXMiLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9zdGF0dXN9fSx7a2V5OiJkYXRhIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fc3luY09iai5kYXRhfX0se2tleToiY2hpbGRyZW4iLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9jaGlsZHJlbn19XSksZX0oKTtyWyJkZWZhdWx0Il09cCx0LmV4cG9ydHM9clsiZGVmYXVsdCJdfSx7Ii4uL3V0aWxzL3V0aWxzLmpzIjoxMTksIi4vRGF0YU9iamVjdENoaWxkIjoxMTMsIi4vU3luY09iamVjdCI6MTE3LCJiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZSI6OCwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjExLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxMywiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IjoxN31dLDExMzpbZnVuY3Rpb24oZSx0LHIpeyJ1c2Ugc3RyaWN0Ijt2YXIgbj1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIilbImRlZmF1bHQiXSxvPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIilbImRlZmF1bHQiXSxpPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCIpWyJkZWZhdWx0Il07T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBhPWUoIi4vU3luY09iamVjdCIpLHM9aShhKSx1PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSh0LHIsbixpLGEpe28odGhpcyxlKTt2YXIgdT10aGlzO3UuX293bmVyPXQsdS5fY2hpbGRJZD1yLHUuX2J1cz1pLHUuX3N5bmNPYmo9bmV3IHNbImRlZmF1bHQiXShhKSxpLmFkZExpc3RlbmVyKHQsZnVuY3Rpb24oZSl7InJlc3BvbnNlIj09PWUudHlwZSYmZS5pZD09PW4mJihjb25zb2xlLmxvZygiRGF0YU9iamVjdENoaWxkLm9uUmVzcG9uc2U6IixlKSx1Ll9vblJlc3BvbnNlKGUpKX0pfXJldHVybiBuKGUsW3trZXk6Im9uQ2hhbmdlIix2YWx1ZTpmdW5jdGlvbihlKXt0aGlzLl9zeW5jT2JqLm9ic2VydmUoZnVuY3Rpb24odCl7ZSh0KX0pfX0se2tleToib25SZXNwb25zZSIsdmFsdWU6ZnVuY3Rpb24oZSl7dGhpcy5fb25SZXNwb25zZUhhbmRsZXI9ZX19LHtrZXk6Il9vblJlc3BvbnNlIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLHI9e3R5cGU6ZS50eXBlLHVybDplLmJvZHkuc291cmNlLGNvZGU6ZS5ib2R5LmNvZGV9O3QuX29uUmVzcG9uc2VIYW5kbGVyJiZ0Ll9vblJlc3BvbnNlSGFuZGxlcihyKX19LHtrZXk6ImNoaWxkSWQiLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9jaGlsZElkfX0se2tleToiZGF0YSIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX3N5bmNPYmouZGF0YX19XSksZX0oKTtyWyJkZWZhdWx0Il09dSx0LmV4cG9ydHM9clsiZGVmYXVsdCJdfSx7Ii4vU3luY09iamVjdCI6MTE3LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6MTEsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjEzLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQiOjE3fV0sMTE0OltmdW5jdGlvbihlLHQscil7InVzZSBzdHJpY3QiO3ZhciBuPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQiKVsiZGVmYXVsdCJdLG89ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIilbImRlZmF1bHQiXSxpPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiKVsiZGVmYXVsdCJdLGE9ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siKVsiZGVmYXVsdCJdLHM9ZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzIilbImRlZmF1bHQiXSx1PWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCIpWyJkZWZhdWx0Il07T2JqZWN0LmRlZmluZVByb3BlcnR5KHIsIl9fZXNNb2R1bGUiLHt2YWx1ZTohMH0pO3ZhciBjPWUoIi4vRGF0YU9iamVjdCIpLGw9dShjKSxmPXtBTlk6ImFueSIsU1RBUlQ6InN0YXJ0IixFWEFDVDoiZXhhY3QifSxwPWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQoZSxyLG8saSxzLHUsYyxsKXthKHRoaXMsdCksbihPYmplY3QuZ2V0UHJvdG90eXBlT2YodC5wcm90b3R5cGUpLCJjb25zdHJ1Y3RvciIsdGhpcykuY2FsbCh0aGlzLGUscixvLGkscyx1LGMpO3ZhciBmPXRoaXM7Zi5fdmVyc2lvbj1sLGkuYWRkTGlzdGVuZXIocixmdW5jdGlvbihlKXtjb25zb2xlLmxvZygiRGF0YU9iamVjdE9ic2VydmVyLSIrcisiLVJDVjogIixlKSxmLl9jaGFuZ2VPYmplY3QoZi5fc3luY09iaixlKX0pLGYuX3N5bmNPYmoub2JzZXJ2ZShmdW5jdGlvbihlKXtmLl9vbkZpbHRlcihlKX0pLGYuX2ZpbHRlcnM9e319cmV0dXJuIG8odCxlKSxpKHQsW3trZXk6Im9uQ2hhbmdlIix2YWx1ZTpmdW5jdGlvbihlLHQpe3ZhciByPWUsbj17dHlwZTpmLkVYQUNULGNhbGxiYWNrOnR9LG89ZS5pbmRleE9mKCIqIik7bz09PWUubGVuZ3RoLTEmJigwPT09bz9uLnR5cGU9Zi5BTlk6KG4udHlwZT1mLlNUQVJULHI9ZS5zdWJzdHIoMCxlLmxlbmd0aC0xKSkpLHRoaXMuX2ZpbHRlcnNbcl09bn19LHtrZXk6Il9vbkZpbHRlciIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcztzKHQuX2ZpbHRlcnMpLmZvckVhY2goZnVuY3Rpb24ocil7dmFyIG49dC5fZmlsdGVyc1tyXTtuLnR5cGU9PT1mLkFOWT9uLmNhbGxiYWNrKGUpOm4udHlwZT09PWYuU1RBUlQ/MD09PWUuZmllbGQuaW5kZXhPZihyKSYmbi5jYWxsYmFjayhlKTpuLnR5cGU9PT1mLkVYQUNUJiZlLmZpZWxkPT09ciYmbi5jYWxsYmFjayhlKX0pfX1dKSx0fShsWyJkZWZhdWx0Il0pO3JbImRlZmF1bHQiXT1wLHQuZXhwb3J0cz1yWyJkZWZhdWx0Il19LHsiLi9EYXRhT2JqZWN0IjoxMTIsImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9vYmplY3Qva2V5cyI6NiwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjExLAoiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyI6MTMsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQiOjE1LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiOjE2LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQiOjE3fV0sMTE1OltmdW5jdGlvbihlLHQscil7InVzZSBzdHJpY3QiO3ZhciBuPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQiKVsiZGVmYXVsdCJdLG89ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIilbImRlZmF1bHQiXSxpPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiKVsiZGVmYXVsdCJdLGE9ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siKVsiZGVmYXVsdCJdLHM9ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IilbImRlZmF1bHQiXTtPYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIHU9ZSgiLi9EYXRhT2JqZWN0IiksYz1zKHUpLGw9ZSgiLi4vdXRpbHMvdXRpbHMuanMiKSxmPWZ1bmN0aW9uKGUpe2Z1bmN0aW9uIHQoZSxyLG8saSxzLHUsYyl7YSh0aGlzLHQpLG4oT2JqZWN0LmdldFByb3RvdHlwZU9mKHQucHJvdG90eXBlKSwiY29uc3RydWN0b3IiLHRoaXMpLmNhbGwodGhpcyxlLHIsbyxpLHMsdSxjKTt2YXIgbD10aGlzO2kuYWRkTGlzdGVuZXIoZSxmdW5jdGlvbihlKXsicmVzcG9uc2UiPT09ZS50eXBlJiZlLmJvZHkuc291cmNlPT09ciYmbC5fb25SZXNwb25zZShlKX0pLGwuX3N5bmNPYmoub2JzZXJ2ZShmdW5jdGlvbihlKXtjb25zb2xlLmxvZygiRGF0YU9iamVjdFJlcG9ydGVyLSIrcisiLVNFTkQ6ICIsZSksbC5fb25DaGFuZ2UoZSl9KSxsLl9zdWJzY3JpcHRpb25zPXt9fXJldHVybiBvKHQsZSksaSh0LFt7a2V5OiJvblN1YnNjcmlwdGlvbiIsdmFsdWU6ZnVuY3Rpb24oZSl7dGhpcy5fb25TdWJzY3JpcHRpb25IYW5kbGVyPWV9fSx7a2V5OiJvblJlc3BvbnNlIix2YWx1ZTpmdW5jdGlvbihlKXt0aGlzLl9vblJlc3BvbnNlSGFuZGxlcj1lfX0se2tleToiX29uRm9yd2FyZCIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcztzd2l0Y2goY29uc29sZS5sb2coIkRhdGFPYmplY3RSZXBvcnRlci1SQ1Y6ICIsZSksZS5ib2R5LnR5cGUpe2Nhc2Uic3Vic2NyaWJlIjp0Ll9vblN1YnNjcmliZShlKTticmVhaztjYXNlInVuc3Vic2NyaWJlIjp0Ll9vblVuU3Vic2NyaWJlKGUpfX19LHtrZXk6Il9vblN1YnNjcmliZSIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcyxyPWUuYm9keS5mcm9tLG49e3R5cGU6ZS5ib2R5LnR5cGUsdXJsOnIsYWNjZXB0OmZ1bmN0aW9uKCl7dmFyIG49e3VybDpyLHN0YXR1czoib24ifTtyZXR1cm4gdC5fc3Vic2NyaXB0aW9uc1tyXT1uLHQuX2J1cy5wb3N0TWVzc2FnZSh7aWQ6ZS5pZCx0eXBlOiJyZXNwb25zZSIsZnJvbTplLnRvLHRvOmUuZnJvbSxib2R5Ontjb2RlOjIwMCxzY2hlbWE6dC5fc2NoZW1hLHZlcnNpb246dC5fdmVyc2lvbix2YWx1ZTooMCxsLmRlZXBDbG9uZSkodC5kYXRhKX19KSxufSxyZWplY3Q6ZnVuY3Rpb24ocil7dC5fYnVzLnBvc3RNZXNzYWdlKHtpZDplLmlkLHR5cGU6InJlc3BvbnNlIixmcm9tOmUudG8sdG86ZS5mcm9tLGJvZHk6e2NvZGU6NDAzLGRlc2M6cn19KX19O3QuX29uU3Vic2NyaXB0aW9uSGFuZGxlciYmdC5fb25TdWJzY3JpcHRpb25IYW5kbGVyKG4pfX0se2tleToiX29uVW5TdWJzY3JpYmUiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMscj1lLmJvZHkuZnJvbSxuPXQuX3N1YnNjcmlwdGlvbnNbcl07ZGVsZXRlIHQuX3N1YnNjcmlwdGlvbnNbcl07dmFyIG89e3R5cGU6ZS5ib2R5LnR5cGUsdXJsOnIsb2JqZWN0Om59O3QuX29uU3Vic2NyaXB0aW9uSGFuZGxlciYmdC5fb25TdWJzY3JpcHRpb25IYW5kbGVyKG8pfX0se2tleToiX29uUmVzcG9uc2UiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMscj17dHlwZTplLnR5cGUsdXJsOmUuZnJvbSxjb2RlOmUuYm9keS5jb2RlfTt0Ll9vblJlc3BvbnNlSGFuZGxlciYmdC5fb25SZXNwb25zZUhhbmRsZXIocil9fSx7a2V5OiJzdWJzY3JpcHRpb25zIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fc3Vic2NyaXB0aW9uc319XSksdH0oY1siZGVmYXVsdCJdKTtyWyJkZWZhdWx0Il09Zix0LmV4cG9ydHM9clsiZGVmYXVsdCJdfSx7Ii4uL3V0aWxzL3V0aWxzLmpzIjoxMTksIi4vRGF0YU9iamVjdCI6MTEyLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6MTEsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjEzLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0IjoxNSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjoxNiwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IjoxN31dLDExNjpbZnVuY3Rpb24oZSx0LHIpeyJ1c2Ugc3RyaWN0Ijt2YXIgbj1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIilbImRlZmF1bHQiXSxvPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIilbImRlZmF1bHQiXTtPYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIGk9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQscixuLGkpe28odGhpcyxlKTt2YXIgYT10aGlzO2EuX2NoYW5nZXM9W10sYS5fY2hpbGRyZW49aSxhLl9jaGlsZHJlbkxpc3RlbmVycz1bXSxhLl9saXN0ZW5lcj1uLmFkZExpc3RlbmVyKHIsZnVuY3Rpb24oZSl7Y29uc29sZS5sb2coIkRhdGFQcm92aXNpb25hbC0iK3IrIi1SQ1Y6ICIsZSksYS5fY2hhbmdlcy5wdXNoKGUpfSl9cmV0dXJuIG4oZSxbe2tleToiYXBwbHkiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXM7dC5fY2hhbmdlcy5mb3JFYWNoKGZ1bmN0aW9uKHQpe2UuX2NoYW5nZU9iamVjdChlLl9zeW5jT2JqLHQpfSl9fSx7a2V5OiJyZWxlYXNlIix2YWx1ZTpmdW5jdGlvbigpe3RoaXMuX2xpc3RlbmVyLnJlbW92ZSgpfX0se2tleToiY2hpbGRyZW4iLGdldDpmdW5jdGlvbigpe3JldHVybiB0aGlzLl9jaGlsZHJlbn19XSksZX0oKTtyWyJkZWZhdWx0Il09aSx0LmV4cG9ydHM9clsiZGVmYXVsdCJdfSx7ImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIjoxMSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyI6MTN9XSwxMTc6W2Z1bmN0aW9uKGUsdCxyKXsidXNlIHN0cmljdCI7dmFyIG49ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyIpWyJkZWZhdWx0Il0sbz1lKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayIpWyJkZWZhdWx0Il0saT1lKCJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2tleXMiKVsiZGVmYXVsdCJdO09iamVjdC5kZWZpbmVQcm9wZXJ0eShyLCJfX2VzTW9kdWxlIix7dmFsdWU6ITB9KTt2YXIgYT1lKCIuLi91dGlscy91dGlscy5qcyIpLHM9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQpe28odGhpcyxlKTt2YXIgcj10aGlzO3IuX29ic2VydmVycz1bXSxyLl9maWx0ZXJzPXt9LHQ/ci5fZGF0YT0oMCxhLmRlZXBDbG9uZSkodCk6ci5fZGF0YT17fSxyLl9pbnRlcm5hbE9ic2VydmUobmV3IHUsci5fZGF0YSl9cmV0dXJuIG4oZSxbe2tleToib2JzZXJ2ZSIsdmFsdWU6ZnVuY3Rpb24oZSl7dGhpcy5fb2JzZXJ2ZXJzLnB1c2goZSl9fSx7a2V5OiJmaW5kIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD1lLnNwbGl0KCIuIik7cmV0dXJuIHRoaXMuX2ZpbmRXaXRoU3BsaXQodCl9fSx7a2V5OiJmaW5kQmVmb3JlIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD17fSxyPWUuc3BsaXQoIi4iKTtyZXR1cm4gdC5sYXN0PXIucG9wKCksdC5vYmo9dGhpcy5fZmluZFdpdGhTcGxpdChyKSx0fX0se2tleToiX2ZpbmRXaXRoU3BsaXQiLHZhbHVlOmZ1bmN0aW9uKGUpe3ZhciB0PXRoaXMuX2RhdGE7cmV0dXJuIGUuZm9yRWFjaChmdW5jdGlvbihlKXt0PXRbZV19KSx0fX0se2tleToiX2ZpcmVFdmVudCIsdmFsdWU6ZnVuY3Rpb24oZSl7dGhpcy5fb2JzZXJ2ZXJzLmZvckVhY2goZnVuY3Rpb24odCl7dChlKX0pfX0se2tleToiX2lzT2JzZXJ2YWJsZSIsdmFsdWU6ZnVuY3Rpb24oZSl7cmV0dXJuIGUuY29uc3RydWN0b3I9PT1PYmplY3R8fGUuY29uc3RydWN0b3I9PT1BcnJheT8hMDohMX19LHtrZXk6Il9pbnRlcm5hbE9ic2VydmUiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9dGhpcztpZihyLl9pc09ic2VydmFibGUodCkpe3ZhciBuPWZ1bmN0aW9uKHQpe3IuX29uQ2hhbmdlcyhlLHQpfTtpZih0LmNvbnN0cnVjdG9yPT09T2JqZWN0KXtPYmplY3Qub2JzZXJ2ZSh0LG4pO2Zvcih2YXIgbyBpbiB0KXIuX2lzT2JzZXJ2YWJsZSh0W29dKSYmci5faW50ZXJuYWxPYnNlcnZlKGVbIm5ldyJdKG8pLHRbb10pfWVsc2UgaWYodC5jb25zdHJ1Y3Rvcj09PUFycmF5KXtBcnJheS5vYnNlcnZlKHQsbik7Zm9yKHZhciBvIGluIHQpaWYoci5faXNPYnNlcnZhYmxlKHRbb10pKXt2YXIgaT1lWyJuZXciXShuZXcgYyh0W29dLG8pKTtyLl9pbnRlcm5hbE9ic2VydmUoaSx0W29dKX19fX19LHtrZXk6Il9vbkNoYW5nZXMiLHZhbHVlOmZ1bmN0aW9uKGUsdCl7dmFyIHI9dGhpcztmb3IodmFyIG4gaW4gdCl7dmFyIG89dFtuXS5vYmplY3QsaT12b2lkIDA7aWYoby5jb25zdHJ1Y3Rvcj09PU9iamVjdCYmKGk9Zi5PQkpFQ1QpLG8uY29uc3RydWN0b3I9PT1BcnJheSYmKGk9Zi5BUlJBWSksInNwbGljZSI9PT10W25dLnR5cGUpIWZ1bmN0aW9uKCl7dmFyIHM9dFtuXS5pbmRleCx1PWVbIm5ldyJdKCIiK3MpLGY9dS50b1N0cmluZygpLHA9dFtuXS5yZW1vdmVkLmxlbmd0aDtpZigwIT09cCl7dmFyIGg9dFtuXS5yZW1vdmVkO2guZm9yRWFjaChmdW5jdGlvbih0LG4pe3IuX2lzT2JzZXJ2YWJsZSh0KSYmZS5yZW1vdmVJbmRleChzK24pfSksci5fZmlyZUV2ZW50KHtjVHlwZTpsLlJFTU9WRSxvVHlwZTppLGZpZWxkOmYsZGF0YTpwfSl9dmFyIGQ9dFtuXS5hZGRlZENvdW50O2lmKDAhPT1kKXt2YXIgeT1vLnNsaWNlKHMscytkKTt5LmZvckVhY2goZnVuY3Rpb24odCxuKXtpZihyLl9pc09ic2VydmFibGUodCkpe3ZhciBvPWVbIm5ldyJdKG5ldyBjKHQscytuKSk7ci5faW50ZXJuYWxPYnNlcnZlKG8sdCl9fSksci5fZmlyZUV2ZW50KHtjVHlwZTpsLkFERCxvVHlwZTppLGZpZWxkOmYsZGF0YTooMCxhLmRlZXBDbG9uZSkoeSl9KX1zIT09by5sZW5ndGgtMSYmZS5yZUluZGV4RnJvbShvKX0oKTtlbHNle3ZhciBzPWVbIm5ldyJdKHRbbl0ubmFtZSksdT1zLnRvU3RyaW5nKCk7aWYoLTEhPT11LmluZGV4T2YoIlN5bWJvbCIpKWNvbnRpbnVlO3ZhciBwPW9bdFtuXS5uYW1lXTsidXBkYXRlIj09PXRbbl0udHlwZSYmdGhpcy5fZmlyZUV2ZW50KHtjVHlwZTpsLlVQREFURSxvVHlwZTppLGZpZWxkOnUsZGF0YTooMCxhLmRlZXBDbG9uZSkocCl9KSwiYWRkIj09PXRbbl0udHlwZSYmKHRoaXMuX2ludGVybmFsT2JzZXJ2ZShzLHApLHRoaXMuX2ZpcmVFdmVudCh7Y1R5cGU6bC5BREQsb1R5cGU6aSxmaWVsZDp1LGRhdGE6KDAsYS5kZWVwQ2xvbmUpKHApfSkpLCJkZWxldGUiPT09dFtuXS50eXBlJiZ0aGlzLl9maXJlRXZlbnQoe2NUeXBlOmwuUkVNT1ZFLG9UeXBlOmksZmllbGQ6dX0pfX19fSx7a2V5OiJkYXRhIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fZGF0YX19XSksZX0oKSx1PWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSgpe28odGhpcyxlKSx0aGlzLl9wYXRoPVtdLHRoaXMuX29ic2VydmFibGVzPXt9fXJldHVybiBuKGUsW3trZXk6InJlbW92ZUluZGV4Iix2YWx1ZTpmdW5jdGlvbihlKXtkZWxldGUgdGhpcy5fb2JzZXJ2YWJsZXNbZV19fSx7a2V5OiJyZUluZGV4RnJvbSIsdmFsdWU6ZnVuY3Rpb24oZSl7dmFyIHQ9dGhpcztpKHRoaXMuX29ic2VydmFibGVzKS5mb3JFYWNoKGZ1bmN0aW9uKHIpe3ZhciBuPXQuX29ic2VydmFibGVzW3JdLG89ZS5pbmRleE9mKG4ub2JqKTtuLmlkeCE9byYmKG4uaWR4PW8sZGVsZXRlIHQuX29ic2VydmFibGVzW3JdLHQuX29ic2VydmFibGVzW29dPW4pfSl9fSx7a2V5OiJuZXciLHZhbHVlOmZ1bmN0aW9uKGUpe2UuY29uc3RydWN0b3I9PWMmJih0aGlzLl9vYnNlcnZhYmxlc1tlLmlkeF09ZSk7dmFyIHQ9dGhpcy5jbG9uZSgpO3JldHVybiB0Ll9wYXRoLnB1c2goZSksdH19LHtrZXk6ImNsb25lIix2YWx1ZTpmdW5jdGlvbigpe3ZhciB0PW5ldyBlO3JldHVybiB0aGlzLl9wYXRoLmZvckVhY2goZnVuY3Rpb24oZSl7dC5fcGF0aC5wdXNoKGUpfSksdH19LHtrZXk6InRvU3RyaW5nIix2YWx1ZTpmdW5jdGlvbigpe3ZhciBlPSIiO3JldHVybiB0aGlzLl9wYXRoLmZvckVhY2goZnVuY3Rpb24odCxyKXswPT09cj9lPXQudG9TdHJpbmcoKTplKz0iLiIrdC50b1N0cmluZygpfSksZX19XSksZX0oKSxjPWZ1bmN0aW9uKCl7ZnVuY3Rpb24gZSh0LHIpe28odGhpcyxlKSx0aGlzLm9iaj10LHRoaXMuaWR4PXJ9cmV0dXJuIG4oZSxbe2tleToidG9TdHJpbmciLHZhbHVlOmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuaWR4LnRvU3RyaW5nKCl9fV0pLGV9KCksbD17VVBEQVRFOiJ1cGRhdGUiLEFERDoiYWRkIixSRU1PVkU6InJlbW92ZSJ9O3IuQ2hhbmdlVHlwZT1sO3ZhciBmPXtPQkpFQ1Q6Im9iamVjdCIsQVJSQVk6ImFycmF5In07ci5PYmplY3RUeXBlPWYsclsiZGVmYXVsdCJdPXN9LHsiLi4vdXRpbHMvdXRpbHMuanMiOjExOSwiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzIjo2LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6MTEsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjEzfV0sMTE4OltmdW5jdGlvbihlLHQscil7InVzZSBzdHJpY3QiO3ZhciBuPWUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiKVsiZGVmYXVsdCJdLG89ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siKVsiZGVmYXVsdCJdLGk9ZSgiYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UiKVsiZGVmYXVsdCJdLGE9ZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IilbImRlZmF1bHQiXTtPYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSk7dmFyIHM9ZSgiLi9EYXRhT2JqZWN0UmVwb3J0ZXIiKSx1PWEocyksYz1lKCIuL0RhdGFPYmplY3RPYnNlcnZlciIpLGw9YShjKSxmPWUoIi4vRGF0YVByb3Zpc2lvbmFsIikscD1hKGYpLGg9ZnVuY3Rpb24oKXtmdW5jdGlvbiBlKHQscixuKXtvKHRoaXMsZSk7dmFyIGk9dGhpcztpLl9vd25lcj10LGkuX2J1cz1yLGkuX3N1YlVSTD1uLnJ1bnRpbWVVUkwrIi9zbSIsaS5fcmVwb3J0ZXJzPXt9LGkuX29ic2VydmVycz17fSxpLl9wcm92aXNpb25hbHM9e30sci5hZGRMaXN0ZW5lcih0LGZ1bmN0aW9uKGUpe3N3aXRjaChjb25zb2xlLmxvZygiU3luY2hlci1SQ1Y6ICIsZSksZS50eXBlKXtjYXNlImZvcndhcmQiOmkuX29uRm9yd2FyZChlKTticmVhaztjYXNlImNyZWF0ZSI6aS5fb25SZW1vdGVDcmVhdGUoZSl9fSl9cmV0dXJuIG4oZSxbe2tleToiY3JlYXRlIix2YWx1ZTpmdW5jdGlvbihlLHQscil7dmFyIG49dGhpcyxvPXt0eXBlOiJjcmVhdGUiLGZyb206bi5fb3duZXIsdG86bi5fc3ViVVJMLGJvZHk6e3NjaGVtYTplLHZhbHVlOnIsYXV0aG9yaXNlOnR9fTtyZXR1cm4gbmV3IGkoZnVuY3Rpb24odCxpKXtuLl9idXMucG9zdE1lc3NhZ2UobyxmdW5jdGlvbihvKXtpZihjb25zb2xlLmxvZygiY3JlYXRlLXJlc3BvbnNlOiAiLG8pLDIwMD09PW8uYm9keS5jb2RlKXt2YXIgYT1vLmJvZHkucmVzb3VyY2Uscz1uZXcgdVsiZGVmYXVsdCJdKG4uX293bmVyLGEsZSxuLl9idXMsIm9uIixyLG8uYm9keS5jaGlsZHJlbik7bi5fcmVwb3J0ZXJzW2FdPXMsdChzKX1lbHNlIGkoby5ib2R5LmRlc2MpfSl9KX19LHtrZXk6InN1YnNjcmliZSIsdmFsdWU6ZnVuY3Rpb24oZSx0KXt2YXIgcj10aGlzLG49e3R5cGU6InN1YnNjcmliZSIsZnJvbTpyLl9vd25lcix0bzpyLl9zdWJVUkwsYm9keTp7c2NoZW1hOmUscmVzb3VyY2U6dH19O3JldHVybiBuZXcgaShmdW5jdGlvbihvLGkpe3IuX2J1cy5wb3N0TWVzc2FnZShuLGZ1bmN0aW9uKG4pe2NvbnNvbGUubG9nKCJzdWJzY3JpYmUtcmVzcG9uc2U6ICIsbik7dmFyIGE9ci5fcHJvdmlzaW9uYWxzW3RdO2lmKGRlbGV0ZSByLl9wcm92aXNpb25hbHNbdF0sYSYmYS5yZWxlYXNlKCksbi5ib2R5LmNvZGU8MjAwKWE9bmV3IHBbImRlZmF1bHQiXShyLl9vd25lcix0LHIuX2J1cyxuLmJvZHkuY2hpbGRyZW5SZXNvdXJjZXMpLHIuX3Byb3Zpc2lvbmFsc1t0XT1hO2Vsc2UgaWYoMjAwPT09bi5ib2R5LmNvZGUpe3ZhciBzPW5ldyBsWyJkZWZhdWx0Il0oci5fb3duZXIsdCxlLHIuX2J1cywib24iLG4uYm9keS52YWx1ZSxhLmNoaWxkcmVuLG4uYm9keS52ZXJzaW9uKTtvKHMpLGEuYXBwbHkocyl9ZWxzZSBpKG4uYm9keS5kZXNjKX0pfSl9fSx7a2V5OiJvbk5vdGlmaWNhdGlvbiIsdmFsdWU6ZnVuY3Rpb24oZSl7dGhpcy5fb25Ob3RpZmljYXRpb25IYW5kbGVyPWV9fSx7a2V5OiJfb25Gb3J3YXJkIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLHI9dC5fcmVwb3J0ZXJzW2UuYm9keS50b107ci5fb25Gb3J3YXJkKGUpfX0se2tleToiX29uUmVtb3RlQ3JlYXRlIix2YWx1ZTpmdW5jdGlvbihlKXt2YXIgdD10aGlzLHI9e3R5cGU6ZS50eXBlLGZyb206ZS5mcm9tLHVybDplLmJvZHkucmVzb3VyY2Usc2NoZW1hOmUuYm9keS5zY2hlbWEsdmFsdWU6ZS5ib2R5LnZhbHVlLGlkZW50aXR5OmUuYm9keS5pZFRva2VuLGFjazpmdW5jdGlvbihyKXt2YXIgbj0yMDA7ciYmKG49ciksdC5fYnVzLnBvc3RNZXNzYWdlKHtpZDplLmlkLHR5cGU6InJlc3BvbnNlIixmcm9tOmUudG8sdG86ZS5mcm9tLGJvZHk6e2NvZGU6bixzb3VyY2U6ZS5ib2R5LnJlc291cmNlfX0pfX07dC5fb25Ob3RpZmljYXRpb25IYW5kbGVyJiZ0Ll9vbk5vdGlmaWNhdGlvbkhhbmRsZXIocil9fSx7a2V5OiJvd25lciIsZ2V0OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuX293bmVyfX0se2tleToicmVwb3J0ZXJzIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fcmVwb3J0ZXJzfX0se2tleToib2JzZXJ2ZXJzIixnZXQ6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5fb2JzZXJ2ZXJzfX1dKSxlfSgpO3JbImRlZmF1bHQiXT1oLHQuZXhwb3J0cz1yWyJkZWZhdWx0Il19LHsiLi9EYXRhT2JqZWN0T2JzZXJ2ZXIiOjExNCwiLi9EYXRhT2JqZWN0UmVwb3J0ZXIiOjExNSwiLi9EYXRhUHJvdmlzaW9uYWwiOjExNiwiYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UiOjgsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIjoxMSwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyI6MTMsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCI6MTd9XSwxMTk6W2Z1bmN0aW9uKGUsdCxyKXsidXNlIHN0cmljdCI7ZnVuY3Rpb24gbihlKXt2YXIgdD0vKFthLXpBLVotXSopOlwvXC8oPzpcLik/KFstYS16QS1aMC05QDolLl9cK34jPV17MiwyNTZ9KShbLWEtekEtWjAtOUA6JS5fXCt+Iz1cL10qKS9naSxyPSIkMSwkMiwkMyIsbj1lLnJlcGxhY2UodCxyKS5zcGxpdCgiLCIpLG89e3R5cGU6blswXSxkb21haW46blsxXSxpZGVudGl0eTpuWzJdfTtyZXR1cm4gb31mdW5jdGlvbiBvKGUpe3JldHVybiBlP0pTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkoZSkpOnZvaWQgMH1PYmplY3QuZGVmaW5lUHJvcGVydHkociwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSksci5kaXZpZGVVUkw9bixyLmRlZXBDbG9uZT1vfSx7fV19LHt9LFsxMTFdKSgxMTEpfSk7Cn0pLmNhbGwodGhpcyx0eXBlb2YgZ2xvYmFsICE9PSAidW5kZWZpbmVkIiA/IGdsb2JhbCA6IHR5cGVvZiBzZWxmICE9PSAidW5kZWZpbmVkIiA/IHNlbGYgOiB0eXBlb2Ygd2luZG93ICE9PSAidW5kZWZpbmVkIiA/IHdpbmRvdyA6IHt9KQp9LHt9XSwxMTA6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovKioKKiBAYXV0aG9yIG1pY2FlbHBlZHJvc2FAZ21haWwuY29tCiogTWluaW1hbCBpbnRlcmZhY2UgYW5kIGltcGxlbWVudGF0aW9uIHRvIHNlbmQgYW5kIHJlY2VpdmUgbWVzc2FnZXMuIEl0IGNhbiBiZSByZXVzZWQgaW4gbWFueSB0eXBlIG9mIGNvbXBvbmVudHMuCiogQ29tcG9uZW50cyB0aGF0IG5lZWQgYSBtZXNzYWdlIHN5c3RlbSBzaG91bGQgcmVjZWl2ZSB0aGlzIGNsYXNzIGFzIGEgZGVwZW5kZW5jeSBvciBleHRlbmQgaXQuCiogRXh0ZW5zaW9ucyBzaG91bGQgaW1wbGVtZW50IHRoZSBmb2xsb3dpbmcgcHJpdmF0ZSBtZXRob2RzOiBfb25Qb3N0TWVzc2FnZSBhbmQgX3JlZ2lzdGVyRXh0ZXJuYWxMaXN0ZW5lcgoqLwondXNlIHN0cmljdCc7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcycpWydkZWZhdWx0J107Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2snKVsnZGVmYXVsdCddOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIEJ1cyA9IChmdW5jdGlvbiAoKSB7CiAgLyogcHJpdmF0ZQogIF9tc2dJZDogbnVtYmVyOwogIF9zdWJzY3JpcHRpb25zOiA8dXJsOiBNc2dMaXN0ZW5lcltdPgogICBfcmVzcG9uc2VUaW1lT3V0OiBudW1iZXIKICBfcmVzcG9uc2VDYWxsYmFja3M6IDx1cmwraWQ6IChtc2cpID0+IHZvaWQ+CiAgICovCgogIGZ1bmN0aW9uIEJ1cygpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBCdXMpOwoKICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICBfdGhpcy5fbXNnSWQgPSAwOwogICAgX3RoaXMuX3N1YnNjcmlwdGlvbnMgPSB7fTsKCiAgICBfdGhpcy5fcmVzcG9uc2VUaW1lT3V0ID0gNTAwMDsgLy9kZWZhdWx0IHRvIDNzCiAgICBfdGhpcy5fcmVzcG9uc2VDYWxsYmFja3MgPSB7fTsKCiAgICBfdGhpcy5fcmVnaXN0ZXJFeHRlcm5hbExpc3RlbmVyKCk7CiAgfQoKICAvKioKICAqIFJlZ2lzdGVyIGxpc3RlbmVyIHRvIHJlY2VpdmUgbWVzc2FnZSB3aGVuICJtc2cudG8gPT09IHVybCIuCiAgKiBTcGVjaWFsIHVybCAiKiIgZm9yIGRlZmF1bHQgbGlzdGVuZXIgaXMgYWNjZXB0ZWQgdG8gaW50ZXJjZXB0IGFsbCBtZXNzYWdlcy4KICAqIEBwYXJhbSB7VVJMfSB1cmwgQWRkcmVzcyB0byBpbnRlcmNlcHQsIHRoYSBpcyBpbiB0aGUgbWVzc2FnZSAidG8iCiAgKiBAcGFyYW0ge0xpc3RlbmVyfSBsaXN0ZW5lciBsaXN0ZW5lcgogICogQHJldHVybiB7TXNnTGlzdGVuZXJ9IGluc3RhbmNlIG9mIE1zZ0xpc3RlbmVyCiAgKi8KCiAgX2NyZWF0ZUNsYXNzKEJ1cywgW3sKICAgIGtleTogJ2FkZExpc3RlbmVyJywKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRMaXN0ZW5lcih1cmwsIGxpc3RlbmVyKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICB2YXIgaXRlbSA9IG5ldyBNc2dMaXN0ZW5lcihfdGhpcy5fc3Vic2NyaXB0aW9ucywgdXJsLCBsaXN0ZW5lcik7CiAgICAgIHZhciBpdGVtTGlzdCA9IF90aGlzLl9zdWJzY3JpcHRpb25zW3VybF07CiAgICAgIGlmICghaXRlbUxpc3QpIHsKICAgICAgICBpdGVtTGlzdCA9IFtdOwogICAgICAgIF90aGlzLl9zdWJzY3JpcHRpb25zW3VybF0gPSBpdGVtTGlzdDsKICAgICAgfQoKICAgICAgaXRlbUxpc3QucHVzaChpdGVtKTsKICAgICAgcmV0dXJuIGl0ZW07CiAgICB9CgogICAgLyoqCiAgICAgKiBNYW51YWxseSBhZGQgYSByZXNwb25zZSBsaXN0ZW5lci4gT25seSBvbmUgbGlzdGVuZXIgcGVyIG1lc3NhZ2UgSUQgc2hvdWxkIGV4aXN0LgogICAgICogQVRFTlRJT04sIHRoZXJlIGlzIG5vIHRpbWVvdXQgZm9yIHRoaXMgbGlzdGVuZXIuCiAgICAgKiBUaGUgbGlzdGVuZXIgc2hvdWxkIGJlIHJlbW92ZWQgd2l0aCBhIHJlbW92ZVJlc3BvbnNlTGlzdGVuZXIsIGZhaWxpbmcgdG8gZG8gdGhpcyB3aWxsIHJlc3VsdCBpbiBhIHVucmVsZWFzZWQgbWVtb3J5IHByb2JsZW0uCiAgICAgKiBAcGFyYW0ge1VSTH0gdXJsIE9yaWdpbiBhZGRyZXNzIG9mIHRoZSBtZXNzYWdlIHNlbnQsICJtc2cuZnJvbSIuCiAgICAgKiBAcGFyYW0ge251bWJlcn0gbXNnSWQgTWVzc2FnZSBJRCB0aGF0IGlzIHJldHVybmVkIGZyb20gdGhlIHBvc3RNZXNzYWdlLgogICAgICogQHBhcmFtIHtGdW5jdGlvbn0gcmVzcG9uc2VMaXN0ZW5lciBDYWxsYmFjayBmdW5jdGlvbiBmb3IgdGhlIHJlc3BvbnNlCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdhZGRSZXNwb25zZUxpc3RlbmVyJywKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRSZXNwb25zZUxpc3RlbmVyKHVybCwgbXNnSWQsIHJlc3BvbnNlTGlzdGVuZXIpIHsKICAgICAgdGhpcy5fcmVzcG9uc2VDYWxsYmFja3NbdXJsICsgbXNnSWRdID0gcmVzcG9uc2VMaXN0ZW5lcjsKICAgIH0KCiAgICAvKioKICAgICAqIFJlbW92ZSB0aGUgcmVzcG9uc2UgbGlzdGVuZXIuCiAgICAgKiBAcGFyYW0ge1VSTH0gdXJsIE9yaWdpbiBhZGRyZXNzIG9mIHRoZSBtZXNzYWdlIHNlbnQsICJtc2cuZnJvbSIuCiAgICAgKiBAcGFyYW0ge251bWJlcn0gbXNnSWQgIE1lc3NhZ2UgSUQgdGhhdCBpcyByZXR1cm5lZCBmcm9tIHRoZSBwb3N0TWVzc2FnZQogICAgICovCiAgfSwgewogICAga2V5OiAncmVtb3ZlUmVzcG9uc2VMaXN0ZW5lcicsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlUmVzcG9uc2VMaXN0ZW5lcih1cmwsIG1zZ0lkKSB7CiAgICAgIGRlbGV0ZSB0aGlzLl9yZXNwb25zZUNhbGxiYWNrc1t1cmwgKyBtc2dJZF07CiAgICB9CgogICAgLyoqCiAgICAgKiBSZW1vdmUgYWxsIGV4aXN0ZW50IGxpc3RlbmVycyBmb3IgdGhlIFVSTAogICAgICogQHBhcmFtICB7VVJMfSB1cmwgQWRkcmVzcyByZWdpc3RlcmVkCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdyZW1vdmVBbGxMaXN0ZW5lcnNPZicsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlQWxsTGlzdGVuZXJzT2YodXJsKSB7CiAgICAgIGRlbGV0ZSB0aGlzLl9zdWJzY3JpcHRpb25zW3VybF07CiAgICB9CgogICAgLyoqCiAgICAgKiBIZWxwZXIgbWV0aG9kIHRvIGJpbmQgbGlzdGVuZXJzIChpbiBib3RoIGRpcmVjdGlvbnMpIGludG8gb3RoZXIgTWluaUJ1cyB0YXJnZXQuCiAgICAgKiBAcGFyYW0gIHtVUkx9IG91dFVybCBPdXRib3VuZCBVUkwsIHJlZ2lzdGVyIGxpc3RlbmVyIGZvciB1cmwgaW4gZGlyZWN0aW9uICJ0aGlzIC0+IHRhcmdldCIKICAgICAqIEBwYXJhbSAge1VSTH0gaW5VcmwgSW5ib3VuZCBVUkwsIHJlZ2lzdGVyIGxpc3RlbmVyIGZvciB1cmwgaW4gZGlyZWN0aW9uICJ0YXJnZXQgLT4gdGhpcyIKICAgICAqIEBwYXJhbSAge01pbmlCdXN9IHRhcmdldCBUaGUgb3RoZXIgdGFyZ2V0IE1pbmlCdXMKICAgICAqIEByZXR1cm4ge0JvdW5kfSBhbiBvYmplY3QgdGhhdCBjb250YWlucyB0aGUgcHJvcGVydGllcyBbdGhpc0xpc3RlbmVyLCB0YXJnZXRMaXN0ZW5lcl0gYW5kIHRoZSB1bmJpbmQgbWV0aG9kLgogICAgICovCiAgfSwgewogICAga2V5OiAnYmluZCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gYmluZChvdXRVcmwsIGluVXJsLCB0YXJnZXQpIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIHRoaXNMaXN0biA9IF90aGlzLmFkZExpc3RlbmVyKG91dFVybCwgZnVuY3Rpb24gKG1zZykgewogICAgICAgIHRhcmdldC5wb3N0TWVzc2FnZShtc2cpOwogICAgICB9KTsKCiAgICAgIHZhciB0YXJnZXRMaXN0biA9IHRhcmdldC5hZGRMaXN0ZW5lcihpblVybCwgZnVuY3Rpb24gKG1zZykgewogICAgICAgIF90aGlzLnBvc3RNZXNzYWdlKG1zZyk7CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIHsKICAgICAgICB0aGlzTGlzdGVuZXI6IHRoaXNMaXN0biwKICAgICAgICB0YXJnZXRMaXN0ZW5lcjogdGFyZ2V0TGlzdG4sCiAgICAgICAgdW5iaW5kOiBmdW5jdGlvbiB1bmJpbmQoKSB7CiAgICAgICAgICBfdGhpczIudGhpc0xpc3RlbmVyLnJlbW92ZSgpOwogICAgICAgICAgX3RoaXMyLnRhcmdldExpc3RlbmVyLnJlbW92ZSgpOwogICAgICAgIH0KICAgICAgfTsKICAgIH0KCiAgICAvL3B1Ymxpc2ggb24gZGVmYXVsdCBsaXN0ZW5lcnMKICB9LCB7CiAgICBrZXk6ICdfcHVibGlzaE9uRGVmYXVsdCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gX3B1Ymxpc2hPbkRlZmF1bHQobXNnKSB7CiAgICAgIC8vaXMgdGhlcmUgYW55ICIqIiAoZGVmYXVsdCkgbGlzdGVuZXJzPwogICAgICB2YXIgaXRlbUxpc3QgPSB0aGlzLl9zdWJzY3JpcHRpb25zWycqJ107CiAgICAgIGlmIChpdGVtTGlzdCkgewogICAgICAgIHRoaXMuX3B1Ymxpc2hPbihpdGVtTGlzdCwgbXNnKTsKICAgICAgfQogICAgfQoKICAgIC8vcHVibGlzaCBvbiBhIHN1YnNjcmlwdGlvbiBsaXN0LgogIH0sIHsKICAgIGtleTogJ19wdWJsaXNoT24nLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9wdWJsaXNoT24oaXRlbUxpc3QsIG1zZykgewogICAgICBpdGVtTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChzdWIpIHsKICAgICAgICBzdWIuX2NhbGxiYWNrKG1zZyk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ19yZXNwb25zZUNhbGxiYWNrJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfcmVzcG9uc2VDYWxsYmFjayhpbk1zZywgcmVzcG9uc2VDYWxsYmFjaykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgLy9hdXRvbWF0aWMgbWFuYWdlbWVudCBvZiByZXNwb25zZSBoYW5kbGVycwogICAgICBpZiAocmVzcG9uc2VDYWxsYmFjaykgewogICAgICAgIChmdW5jdGlvbiAoKSB7CiAgICAgICAgICB2YXIgcmVzcG9uc2VJZCA9IGluTXNnLmZyb20gKyBpbk1zZy5pZDsKICAgICAgICAgIF90aGlzLl9yZXNwb25zZUNhbGxiYWNrc1tyZXNwb25zZUlkXSA9IHJlc3BvbnNlQ2FsbGJhY2s7CgogICAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciByZXNwb25zZUZ1biA9IF90aGlzLl9yZXNwb25zZUNhbGxiYWNrc1tyZXNwb25zZUlkXTsKICAgICAgICAgICAgZGVsZXRlIF90aGlzLl9yZXNwb25zZUNhbGxiYWNrc1tyZXNwb25zZUlkXTsKCiAgICAgICAgICAgIGlmIChyZXNwb25zZUZ1bikgewogICAgICAgICAgICAgIHZhciBlcnJvck1zZyA9IHsKICAgICAgICAgICAgICAgIGlkOiBpbk1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywKICAgICAgICAgICAgICAgIGJvZHk6IHsgY29kZTogNDA4LCBkZXNjOiAnUmVzcG9uc2UgdGltZW91dCEnLCB2YWx1ZTogaW5Nc2cgfQogICAgICAgICAgICAgIH07CgogICAgICAgICAgICAgIHJlc3BvbnNlRnVuKGVycm9yTXNnKTsKICAgICAgICAgICAgfQogICAgICAgICAgfSwgX3RoaXMuX3Jlc3BvbnNlVGltZU91dCk7CiAgICAgICAgfSkoKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19vblJlc3BvbnNlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25SZXNwb25zZShtc2cpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmIChtc2cudHlwZSA9PT0gJ3Jlc3BvbnNlJykgewogICAgICAgIHZhciByZXNwb25zZUlkID0gbXNnLnRvICsgbXNnLmlkOwogICAgICAgIHZhciByZXNwb25zZUZ1biA9IF90aGlzLl9yZXNwb25zZUNhbGxiYWNrc1tyZXNwb25zZUlkXTsKCiAgICAgICAgLy9pZiBpdCdzIGEgcHJvdmlzaW9uYWwgcmVzcG9uc2UsIGRvbid0IGRlbGV0ZSByZXNwb25zZSBsaXN0ZW5lcgogICAgICAgIGlmIChtc2cuYm9keS5jb2RlID49IDIwMCkgewogICAgICAgICAgZGVsZXRlIF90aGlzLl9yZXNwb25zZUNhbGxiYWNrc1tyZXNwb25zZUlkXTsKICAgICAgICB9CgogICAgICAgIGlmIChyZXNwb25zZUZ1bikgewogICAgICAgICAgcmVzcG9uc2VGdW4obXNnKTsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQoKICAgIC8vcmVjZWl2ZSBtZXNzYWdlcyBmcm9tIGV4dGVybmFsIGludGVyZmFjZQogIH0sIHsKICAgIGtleTogJ19vbk1lc3NhZ2UnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vbk1lc3NhZ2UobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoIV90aGlzLl9vblJlc3BvbnNlKG1zZykpIHsKICAgICAgICB2YXIgaXRlbUxpc3QgPSBfdGhpcy5fc3Vic2NyaXB0aW9uc1ttc2cudG9dOwogICAgICAgIGlmIChpdGVtTGlzdCkgewogICAgICAgICAgX3RoaXMuX3B1Ymxpc2hPbihpdGVtTGlzdCwgbXNnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMuX3B1Ymxpc2hPbkRlZmF1bHQobXNnKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfZ2VuSWQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9nZW5JZChpbk1zZykgewogICAgICAvL1RPRE86IGhvdyBkbyB3ZSBtYW5hZ2UgbWVzc2FnZSBJRCdzPyBTaG91bGQgaXQgYmUgYSBnbG9iYWwgcnVudGltZSBjb3VudGVyLCBvciBwZXIgVVJMIGFkZHJlc3M/CiAgICAgIC8vR2xvYmFsIGNvdW50ZXIgd2lsbCBub3Qgd29yaywgYmVjYXVzZSB0aGVyZSB3aWxsIGJlIG11bHRpcGxlIE1pbmlCdXMgaW5zdGFuY2VzIQogICAgICAvL1BlciBVUkwsIGNhbiBiZSBhIGxvdCBvZiBkYXRhIHRvIG1haW50YWluIQogICAgICAvL01heWJlIGEgY291bnRlciBwZXIgTWluaUJ1cyBpbnN0YW5jZS4gVGhpcyBpcyB0aGUgYXNzdW1lZCBzb2x1dGlvbiBmb3Igbm93LgogICAgICBpZiAoIWluTXNnLmlkIHx8IGluTXNnLmlkID09PSAwKSB7CiAgICAgICAgdGhpcy5fbXNnSWQrKzsKICAgICAgICBpbk1zZy5pZCA9IHRoaXMuX21zZ0lkOwogICAgICB9CiAgICB9CgogICAgLyoqCiAgICAqIFNlbmQgbWVzc2FnZXMgdG8gbG9jYWwgbGlzdGVuZXJzLCBvciBpZiBub3QgZXhpc3RzIHRvIGV4dGVybmFsIGxpc3RlbmVycy4KICAgICogSXQncyBoYXMgYW4gb3B0aW9uYWwgbWVjaGFuaXNtIGZvciBhdXRvbWF0aWMgbWFuYWdlbWVudCBvZiByZXNwb25zZSBoYW5kbGVycy4KICAgICogVGhlIHJlc3BvbnNlIGhhbmRsZXIgd2lsbCBiZSB1bnJlZ2lzdGVyZWQgYWZ0ZXIgcmVjZWl2aW5nIHRoZSByZXNwb25zZSwgb3IgYWZ0ZXIgcmVzcG9uc2UgdGltZW91dCAoZGVmYXVsdCB0byAzcykuCiAgICAqIEBwYXJhbSAge01lc3NhZ2V9IG1zZyBNZXNzYWdlIHRvIHNlbmQuIE1lc3NhZ2UgSUQgaXMgYXV0b21hdGljYWxseSBhZGRlZCB0byB0aGUgbWVzc2FnZS4KICAgICogQHBhcmFtICB7RnVuY3Rpb259IHJlc3BvbnNlQ2FsbGJhY2sgT3B0aW9uYWwgcGFyYW1ldGVyLCBpZiB0aGUgZGV2ZWxvcGVyIHdoYXQncyBhdXRvbWF0aWMgcmVzcG9uc2UgbWFuYWdlbWVudC4KICAgICogQHJldHVybiB7bnVtYmVyfSBSZXR1cm5zIHRoZSBtZXNzYWdlIElELCBpbiBjYXNlIGl0IHNob3VsZCBiZSBuZWVkZWQgZm9yIG1hbnVhbCBtYW5hZ2VtZW50IG9mIHRoZSByZXNwb25zZSBoYW5kbGVyLgogICAgKi8KICB9LCB7CiAgICBrZXk6ICdwb3N0TWVzc2FnZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gcG9zdE1lc3NhZ2UoaW5Nc2csIHJlc3BvbnNlQ2FsbGJhY2spIHt9CgogICAgLyoqCiAgICAgKiBOb3QgcHVibGljIGF2YWlsYWJsZSwgdXNlZCBieSB0aGUgY2xhc3MgZXh0ZW5zaW9uIGltcGxlbWVudGF0aW9uLCB0byBwcm9jZXNzIG1lc3NhZ2VzIGZyb20gdGhlIHB1YmxpYyAicG9zdE1lc3NhZ2UiIHdpdGhvdXQgYSByZWdpc3RlcmVkIGxpc3RlbmVyLgogICAgICogVXNlZCB0byBzZW5kIHRoZSBtZXNzYWdlIHRvIGFuIGV4dGVybmFsIGludGVyZmFjZSwgbGlrZSBhIFdlYldvcmtlciwgSUZyYW1lLCBldGMuCiAgICAgKiBAcGFyYW0gIHtNZXNzYWdlLk1lc3NhZ2V9IG1zZyBNZXNzYWdlCiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdfb25Qb3N0TWVzc2FnZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uUG9zdE1lc3NhZ2UobXNnKSB7fSAvKmltcGxlbWVudGF0aW9uIHdpbGwgc2VuZCBtZXNzYWdlIHRvIGV4dGVybmFsIHN5c3RlbSovCgogICAgLyoqCiAgICAgKiBOb3QgcHVibGljIGF2YWlsYWJsZSwgdXNlZCBieSB0aGUgY2xhc3MgZXh0ZW5zaW9uIGltcGxlbWVudGF0aW9uLCB0byBwcm9jZXNzIGFsbCBtZXNzYWdlcyB0aGF0IGVudGVyIHRoZSBNaW5pQnVzIGZyb20gYW4gZXh0ZXJuYWwgaW50ZXJmYWNlLCBsaWtlIGEgV2ViV29ya2VyLCBJRnJhbWUsIGV0Yy4KICAgICAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCBvbmUgdGltZSBpbiB0aGUgY29uc3RydWN0b3IgdG8gcmVnaXN0ZXIgZXh0ZXJuYWwgbGlzdGVuZXJzLgogICAgICogVGhlIGltcGxlbWVudGF0aW9uIHdpbGwgcHJvYmFibHkgY2FsbCB0aGUgIl9vbk1lc3NhZ2UiIG1ldGhvZCB0byBwdWJsaXNoIGluIHRoZSBsb2NhbCBsaXN0ZW5lcnMuCiAgICAgKiBETyBOT1QgY2FsbCAicG9zdE1lc3NhZ2UiLCB0aGVyZSBpcyBhIGRhbmdlciB0aGF0IHRoZSBtZXNzYWdlIGVudGVycyBpbiBhIGN5Y2xlIQogICAgICovCgogIH0sIHsKICAgIGtleTogJ19yZWdpc3RlckV4dGVybmFsTGlzdGVuZXInLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9yZWdpc3RlckV4dGVybmFsTGlzdGVuZXIoKSB7LyppbXBsZW1lbnRhdGlvbiB3aWxsIHJlZ2lzdGVyIGV4dGVybmFsIGxpc3RlbmVyIGFuZCBjYWxsICJ0aGlzLl9vbk1lc3NhZ2UobXNnKSIgKi99CiAgfV0pOwoKICByZXR1cm4gQnVzOwp9KSgpOwoKdmFyIE1zZ0xpc3RlbmVyID0gKGZ1bmN0aW9uICgpIHsKICAvKiBwcml2YXRlCiAgX3N1YnNjcmlwdGlvbnM6IDxzdHJpbmc6IE1zZ0xpc3RlbmVyW10+OwogIF91cmw6IHN0cmluZzsKICBfY2FsbGJhY2s6IChtc2cpID0+IHZvaWQ7CiAgKi8KCiAgZnVuY3Rpb24gTXNnTGlzdGVuZXIoc3Vic2NyaXB0aW9ucywgdXJsLCBjYWxsYmFjaykgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIE1zZ0xpc3RlbmVyKTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF90aGlzLl9zdWJzY3JpcHRpb25zID0gc3Vic2NyaXB0aW9uczsKICAgIF90aGlzLl91cmwgPSB1cmw7CiAgICBfdGhpcy5fY2FsbGJhY2sgPSBjYWxsYmFjazsKICB9CgogIF9jcmVhdGVDbGFzcyhNc2dMaXN0ZW5lciwgW3sKICAgIGtleTogJ3JlbW92ZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVtb3ZlKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIHN1YnMgPSBfdGhpcy5fc3Vic2NyaXB0aW9uc1tfdGhpcy5fdXJsXTsKICAgICAgaWYgKHN1YnMpIHsKICAgICAgICB2YXIgaW5kZXggPSBzdWJzLmluZGV4T2YoX3RoaXMpOwogICAgICAgIHN1YnMuc3BsaWNlKGluZGV4LCAxKTsKCiAgICAgICAgLy9pZiB0aGVyZSBhcmUgbm8gbGlzdGVuZXJzLCByZW1vdmUgdGhlIHN1YnNjcmlwdGlvbiBlbnRpcmVseS4KICAgICAgICBpZiAoc3Vicy5sZW5ndGggPT09IDApIHsKICAgICAgICAgIGRlbGV0ZSBfdGhpcy5fc3Vic2NyaXB0aW9uc1tfdGhpcy5fdXJsXTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICd1cmwnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl91cmw7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gTXNnTGlzdGVuZXI7Cn0pKCk7CgpleHBvcnRzWydkZWZhdWx0J10gPSBCdXM7Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7ImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIjoxMywiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyI6MTV9XSwxMTE6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgX2dldCA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQnKVsnZGVmYXVsdCddOwoKdmFyIF9pbmhlcml0cyA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9pbmhlcml0cycpWydkZWZhdWx0J107Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcycpWydkZWZhdWx0J107Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2snKVsnZGVmYXVsdCddOwoKdmFyIF9NYXAgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2NvcmUtanMvbWFwJylbJ2RlZmF1bHQnXTsKCnZhciBfUHJvbWlzZSA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlJylbJ2RlZmF1bHQnXTsKCnZhciBfU2V0ID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9jb3JlLWpzL3NldCcpWydkZWZhdWx0J107Cgp2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCcpWydkZWZhdWx0J107CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX0J1czIgPSByZXF1aXJlKCcuL0J1cycpOwoKdmFyIF9CdXMzID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfQnVzMik7Cgp2YXIgX1BpcGVsaW5lID0gcmVxdWlyZSgnLi9QaXBlbGluZScpOwoKdmFyIF9QaXBlbGluZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9QaXBlbGluZSk7CgovKioKKiBNZXNzYWdlIEJVUyBJbnRlcmZhY2UgaXMgYW4gZXh0ZW5zaW9uIG9mIHRoZSBNaW5pQnVzCiogSXQgZG9lc24ndCBzdXBwb3J0IHRoZSBkZWZhdWx0ICcqJyBsaXN0ZW5lciwgaW5zdGVhZCBpdCB1c2VzIHRoZSByZWdpc3RyeS5yZXNvbHZlKC4uKQoqLwoKdmFyIE1lc3NhZ2VCdXMgPSAoZnVuY3Rpb24gKF9CdXMpIHsKICBfaW5oZXJpdHMoTWVzc2FnZUJ1cywgX0J1cyk7CgogIC8qIHByaXZhdGUKICBfcmVnaXN0cnk6IFJlZ2lzdHJ5CiAgX2ZvcndhcmRzOiB7IDxmcm9tLXVybD46IHsgZmw6IE1zZ0xpc3RlbmVyLCBzYW5kYm94VG9VcmxzOiBNYXAoU2FuZGJveCwgW3RvLXVybF0pLCB1cmxUb1NhbmRib3g6IHsgdG8tdXJsOiBTYW5kYm94IH0gfSB9CiAgIF9waXBlbGluZTogUGlwZWxpbmUKICAqLwoKICAvL1RPRE86IGZ1dHVyZSBvcHRpbWl6YXRpb24KICAvLzEuIG1lc3NhZ2UgYmF0Y2ggcHJvY2Vzc2luZyB3aXRoIHNldEludGVydmFsCiAgLy8yLiByZXNvbHZlIGRlZmF1bHQgZ2F0ZXdheS9wcm90b3N0dWIgd2l0aCByZWdpc3Rlci5yZXNvbHZlCgogIGZ1bmN0aW9uIE1lc3NhZ2VCdXMocmVnaXN0cnkpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBNZXNzYWdlQnVzKTsKCiAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihNZXNzYWdlQnVzLnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcyk7CiAgICB0aGlzLl9yZWdpc3RyeSA9IHJlZ2lzdHJ5OwogICAgdGhpcy5fZm9yd2FyZHMgPSB7fTsKCiAgICB0aGlzLl9waXBlbGluZSA9IG5ldyBfUGlwZWxpbmUyWydkZWZhdWx0J10oZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgIGNvbnNvbGUubG9nKCdQSVBFTElORS1FUlJPUjogJywgSlNPTi5zdHJpbmdpZnkoZXJyb3IpKTsKICAgIH0pOwogIH0KCiAgX2NyZWF0ZUNsYXNzKE1lc3NhZ2VCdXMsIFt7CiAgICBrZXk6ICdwb3N0TWVzc2FnZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gcG9zdE1lc3NhZ2UoaW5Nc2csIHJlc3BvbnNlQ2FsbGJhY2spIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIF90aGlzLl9nZW5JZChpbk1zZyk7CgogICAgICBfdGhpcy5fcGlwZWxpbmUucHJvY2Vzcyhpbk1zZywgZnVuY3Rpb24gKG1zZykgewoKICAgICAgICBfdGhpcy5fcmVzcG9uc2VDYWxsYmFjayhpbk1zZywgcmVzcG9uc2VDYWxsYmFjayk7CgogICAgICAgIGlmICghX3RoaXMuX29uUmVzcG9uc2UobXNnKSkgewogICAgICAgICAgdmFyIGl0ZW1MaXN0ID0gX3RoaXMuX3N1YnNjcmlwdGlvbnNbbXNnLnRvXTsKICAgICAgICAgIGlmIChpdGVtTGlzdCkgewogICAgICAgICAgICAvL2RvIG5vdCBwdWJsaXNoIG9uIGRlZmF1bHQgYWRkcmVzcywgYmVjYXVzZSBvZiBsb29wYmFjayBjeWNsZQogICAgICAgICAgICBfdGhpcy5fcHVibGlzaE9uKGl0ZW1MaXN0LCBtc2cpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgLy9pZiB0aGVyZSBpcyBubyBsaXN0ZW5lciwgc2VuZCB0byBleHRlcm5hbCBpbnRlcmZhY2UKICAgICAgICAgICAgX3RoaXMuX29uUG9zdE1lc3NhZ2UobXNnKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0pOwoKICAgICAgcmV0dXJuIGluTXNnLmlkOwogICAgfQogIH0sIHsKICAgIGtleTogJ2FkZEZvcndhcmQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGFkZEZvcndhcmQoZnJvbSwgdG8pIHsKICAgICAgdmFyIF90aGlzMiA9IHRoaXM7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgLy92ZXJpZnkgaWYgZm9yd2FyZCBleGlzdAogICAgICB2YXIgY29uZiA9IF90aGlzLl9mb3J3YXJkc1tmcm9tXTsKICAgICAgaWYgKCFjb25mKSB7CiAgICAgICAgdmFyIGZvcndhcmRMaXN0ZW5lciA9IF90aGlzLmFkZExpc3RlbmVyKGZyb20sIGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICAgIGNvbmYuc2FuZGJveFRvVXJscy5mb3JFYWNoKGZ1bmN0aW9uICh1cmxzLCBzYW5kYm94KSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdNQi1GT1JXQVJEOiAoICcgKyBmcm9tICsgJyB0byAnICsgdXJscy5zaXplICsgJyBkZXN0aW5hdGlvbnMpJyk7CiAgICAgICAgICAgIHVybHMuZm9yRWFjaChmdW5jdGlvbiAodmFsdWUpIHsKICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU0VORC1UTzogJywgdmFsdWUpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHNhbmRib3gucG9zdE1lc3NhZ2UobXNnKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pOwoKICAgICAgICBjb25mID0gewogICAgICAgICAgZnJvbTogZnJvbSwKICAgICAgICAgIGZsOiBmb3J3YXJkTGlzdGVuZXIsCiAgICAgICAgICBzYW5kYm94VG9VcmxzOiBuZXcgX01hcCgpLAogICAgICAgICAgdXJsVG9TYW5kYm94OiBuZXcgX01hcCgpLAoKICAgICAgICAgIC8vcmVtb3ZlIGZvcndhcmQgZGV0aW5hdGlvbgogICAgICAgICAgcmVtb3ZlOiBmdW5jdGlvbiByZW1vdmUodXJsKSB7CiAgICAgICAgICAgIHZhciBzYW5kYm94ID0gX3RoaXMyLnVybFRvU2FuZGJveC5nZXQodXJsKTsKICAgICAgICAgICAgaWYgKHNhbmRib3gpIHsKICAgICAgICAgICAgICBfdGhpczIudXJsVG9TYW5kYm94WydkZWxldGUnXSh1cmwpOwogICAgICAgICAgICAgIF90aGlzMi5zYW5kYm94VG9VcmxzLmdldChzYW5kYm94KVsnZGVsZXRlJ10odXJsKTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH07CgogICAgICAgIF90aGlzLl9mb3J3YXJkc1tmcm9tXSA9IGNvbmY7CiAgICAgIH0KCiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICAvL2FkZCBmb3J3YXJkIGRldGluYXRpb24KICAgICAgICBfdGhpczIuX3JlZ2lzdHJ5LmdldFNhbmRib3godG8pLnRoZW4oZnVuY3Rpb24gKHNhbmRib3gpIHsKICAgICAgICAgIHZhciB1cmxzID0gY29uZi5zYW5kYm94VG9VcmxzLmdldChzYW5kYm94KTsKICAgICAgICAgIGlmICghdXJscykgewogICAgICAgICAgICB1cmxzID0gbmV3IF9TZXQoKTsKICAgICAgICAgICAgY29uZi5zYW5kYm94VG9VcmxzLnNldChzYW5kYm94LCB1cmxzKTsKICAgICAgICAgIH0KCiAgICAgICAgICB1cmxzLmFkZCh0byk7CiAgICAgICAgICBjb25mLnVybFRvU2FuZGJveC5zZXQodG8sIHNhbmRib3gpOwoKICAgICAgICAgIHJlc29sdmUoY29uZik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ19wdWJsaXNoJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfcHVibGlzaCh1cmwsIG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIGl0ZW1MaXN0ID0gX3RoaXMuX3N1YnNjcmlwdGlvbnNbdXJsXTsKICAgICAgaWYgKGl0ZW1MaXN0KSB7CiAgICAgICAgX3RoaXMuX3B1Ymxpc2hPbihpdGVtTGlzdCwgbXNnKTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19vblBvc3RNZXNzYWdlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25Qb3N0TWVzc2FnZShtc2cpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIC8vcmVzb2x2ZSBleHRlcm5hbCBwcm90b3N0dWIuLi4KICAgICAgX3RoaXMuX3JlZ2lzdHJ5LnJlc29sdmUobXNnLnRvKS50aGVuKGZ1bmN0aW9uIChyb3V0ZSkgewogICAgICAgIF90aGlzLl9wdWJsaXNoKHJvdXRlLCBtc2cpOwogICAgICB9KVsnY2F0Y2gnXShmdW5jdGlvbiAoZSkgewogICAgICAgIGNvbnNvbGUubG9nKCdSRVNPTFZFLUVSUk9SOiAnLCBlKTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAncGlwZWxpbmUnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9waXBlbGluZTsKICAgIH0KICB9XSk7CgogIHJldHVybiBNZXNzYWdlQnVzOwp9KShfQnVzM1snZGVmYXVsdCddKTsKCmV4cG9ydHNbJ2RlZmF1bHQnXSA9IE1lc3NhZ2VCdXM7Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7Ii4vQnVzIjoxMTAsIi4vUGlwZWxpbmUiOjExMiwiYmFiZWwtcnVudGltZS9jb3JlLWpzL21hcCI6MSwiYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UiOjksImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9zZXQiOjEwLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6MTMsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjE1LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0IjoxNywiYmFiZWwtcnVudGltZS9oZWxwZXJzL2luaGVyaXRzIjoxOCwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IjoxOX1dLDExMjpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Ci8qKgoqIEBhdXRob3IgbWljYWVscGVkcm9zYUBnbWFpbC5jb20KKiBQaXBlbGluZQoqIFNlcXVlbmNpYWwgcHJvY2Vzc29yIG9mIG1ldGhvZHMuIFNpbWlsYXIgdG8gaG93IFNlcXVlbnRpYWwgUHJvbWlzZSdzIHdvcmssIGJ1dCBiZXR0ZXIgZml0IGZvciBtZXNzYWdlIHByb2Nlc3NpbmcuCiovCiJ1c2Ugc3RyaWN0IjsKCnZhciBfY3JlYXRlQ2xhc3MgPSByZXF1aXJlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIilbImRlZmF1bHQiXTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayIpWyJkZWZhdWx0Il07CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgIl9fZXNNb2R1bGUiLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgUGlwZWxpbmUgPSAoZnVuY3Rpb24gKCkgewogIC8qIHB1YmxpYwogICAgaGFuZGxlcnM6ICgoUGlwZUNvbnRleHQpID0+IHZvaWQpW10KICAgIG9uRmFpbDogKGVycm9yKSA9PiB2b2lkCiAgKi8KCiAgZnVuY3Rpb24gUGlwZWxpbmUoX29uRmFpbCkgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBpcGVsaW5lKTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgIF90aGlzLmhhbmRsZXJzID0gW107CiAgICBfdGhpcy5vbkZhaWwgPSBfb25GYWlsOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFBpcGVsaW5lLCBbewogICAga2V5OiAicHJvY2VzcyIsCiAgICB2YWx1ZTogZnVuY3Rpb24gcHJvY2Vzcyhtc2csIG9uRGVsaXZlcikgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgaWYgKF90aGlzLmhhbmRsZXJzLmxlbmd0aCA+IDApIHsKICAgICAgICB2YXIgaXRlciA9IG5ldyBJdGVyYXRvcihfdGhpcy5oYW5kbGVycyk7CiAgICAgICAgaXRlci5uZXh0KG5ldyBQaXBlQ29udGV4dChfdGhpcywgaXRlciwgbXNnLCBvbkRlbGl2ZXIpKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBvbkRlbGl2ZXIobXNnKTsKICAgICAgfQogICAgfQogIH1dKTsKCiAgcmV0dXJuIFBpcGVsaW5lOwp9KSgpOwoKdmFyIFBpcGVDb250ZXh0ID0gKGZ1bmN0aW9uICgpIHsKICAvKiBwcml2YXRlCiAgICBfaW5TdG9wOiBib29sZWFuCiAgICAgX3BpcGVsaW5lOiBQaXBlbGluZQogICAgX2l0ZXI6IEl0ZXJhdG9yCiAgICBfbXNnOiBNZXNzYWdlCiAgKi8KCiAgZnVuY3Rpb24gUGlwZUNvbnRleHQocGlwZWxpbmUsIGl0ZXIsIG1zZywgb25EZWxpdmVyKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUGlwZUNvbnRleHQpOwoKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgX3RoaXMuX2luU3RvcCA9IGZhbHNlOwoKICAgIF90aGlzLl9waXBlbGluZSA9IHBpcGVsaW5lOwogICAgX3RoaXMuX2l0ZXIgPSBpdGVyOwogICAgX3RoaXMuX21zZyA9IG1zZzsKICAgIF90aGlzLl9vbkRlbGl2ZXIgPSBvbkRlbGl2ZXI7CiAgfQoKICBfY3JlYXRlQ2xhc3MoUGlwZUNvbnRleHQsIFt7CiAgICBrZXk6ICJuZXh0IiwKICAgIHZhbHVlOiBmdW5jdGlvbiBuZXh0KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgaWYgKCFfdGhpcy5faW5TdG9wKSB7CiAgICAgICAgaWYgKF90aGlzLl9pdGVyLmhhc05leHQpIHsKICAgICAgICAgIF90aGlzLl9pdGVyLm5leHQoX3RoaXMpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBfdGhpcy5fb25EZWxpdmVyKF90aGlzLl9tc2cpOwogICAgICAgIH0KICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImRlbGl2ZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRlbGl2ZXIoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIGlmICghX3RoaXMuX2luU3RvcCkgewogICAgICAgIF90aGlzLl9pblN0b3AgPSB0cnVlOwogICAgICAgIF90aGlzLl9vbkRlbGl2ZXIoX3RoaXMuX21zZyk7CiAgICAgIH0KICAgIH0KICB9LCB7CiAgICBrZXk6ICJmYWlsIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBmYWlsKGVycm9yKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoIV90aGlzLl9pblN0b3ApIHsKICAgICAgICBfdGhpcy5faW5TdG9wID0gdHJ1ZTsKICAgICAgICBpZiAoX3RoaXMuX3BpcGVsaW5lLm9uRmFpbCkgewogICAgICAgICAgX3RoaXMuX3BpcGVsaW5lLm9uRmFpbChlcnJvcik7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAicGlwZWxpbmUiLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9waXBlbGluZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJtc2ciLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl9tc2c7CiAgICB9LAogICAgc2V0OiBmdW5jdGlvbiBzZXQoaW5Nc2cpIHsKICAgICAgdGhpcy5fbXNnID0gaW5Nc2c7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gUGlwZUNvbnRleHQ7Cn0pKCk7Cgp2YXIgSXRlcmF0b3IgPSAoZnVuY3Rpb24gKCkgewogIC8qIHByaXZhdGUKICAgIF9pbmRleDogbnVtYmVyCiAgICBfYXJyYXk6IFtdCiAgKi8KCiAgZnVuY3Rpb24gSXRlcmF0b3IoYXJyYXkpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBJdGVyYXRvcik7CgogICAgdGhpcy5faW5kZXggPSAtMTsKICAgIHRoaXMuX2FycmF5ID0gYXJyYXk7CiAgfQoKICBfY3JlYXRlQ2xhc3MoSXRlcmF0b3IsIFt7CiAgICBrZXk6ICJoYXNOZXh0IiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5faW5kZXggPCB0aGlzLl9hcnJheS5sZW5ndGggLSAxOwogICAgfQogIH0sIHsKICAgIGtleTogIm5leHQiLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHRoaXMuX2luZGV4Kys7CiAgICAgIHJldHVybiB0aGlzLl9hcnJheVt0aGlzLl9pbmRleF07CiAgICB9CiAgfV0pOwoKICByZXR1cm4gSXRlcmF0b3I7Cn0pKCk7CgpleHBvcnRzWyJkZWZhdWx0Il0gPSBQaXBlbGluZTsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07Cgp9LHsiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjEzLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxNX1dLDExMzpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBfY3JlYXRlQ2xhc3MgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzJylbJ2RlZmF1bHQnXTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjaycpWydkZWZhdWx0J107Cgp2YXIgX1Byb21pc2UgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZScpWydkZWZhdWx0J107Cgp2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCcpWydkZWZhdWx0J107CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX2hlbGxvanMgPSByZXF1aXJlKCdoZWxsb2pzJyk7Cgp2YXIgX2hlbGxvanMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfaGVsbG9qcyk7CgovKioKKgoqIFRoZSBJZGVudGl0eSBNb2R1bGUgKElkIE1vZHVsZSkgaXMgdGhlIGNvbXBvbmVudCByZXNwb25zaWJsZSBmb3IgaGFuZGxpbmcgdGhlCiogdXNlciBpZGVudGl0eSBhbmQgdGhlIGFzc29jaWF0aW9uIG9mIHRoaXMgaWRlbnRpdHkgd2l0aCB0aGUgSHlwZXJ0eSBpbnN0YW5jZXMsCiogaW4gb3JkZXIgdG8gbWFrZSBIeXBlcnR5IGluc3RhbmNlcyBpZGVudGlmaWFibGUuIFRoZSBpZGVudGl0eSBpbiB0aGUgcmVUSElOSyBwcm9qZWN0CiogaXMgbm90IGZpeGVkIHRvIGEgdW5pcXVlIElkZW50aXR5IFNlcnZpY2UgUHJvdmlkZXIsIGJ1dCBvYnRhaW5lZCB0aHJvdWdoIHNldmVyYWwKKiBkaWZmZXJlbnQgSWRlbnRpdHkgc291cmNlcy4gV2l0aCB0aGlzIGFwcHJvYWNoLCB0aGUgSWQgTW9kdWxlIHByb3ZpZGVzIHRvIHRoZSB1c2VyIHRoZQoqIG9wdGlvbiB0byBjaG9vc2UgdGhlIHByZWZlcnJlZCBtZXRob2QgZm9yIGF1dGhlbnRpY2F0aW9uLgoqIFRoaXMgbW9kdWxlIHdpbGwgdGh1cyBhYmxlIHRvIHN1cHBvcnQgbXVsdGlwbGUgSWRlbnRpdHkgYWNxdWlzaXRpb24gbWV0aG9kcywKKiBzdWNoIGFzIE9wZW5JRCBjb25uZWN0IDEuMCwgS2VyYmVyb3MgU3lzdGVtLCBvciBhdXRoZW50aWNhdGlvbiB0aHJvdWdoIHNtYXJ0IGNhcmRzLgoqIEZvciBleGFtcGxlLCBhIHVzZXIgd2l0aCBhIEdvb2dsZSBhY2NvdW50IGNhbiB1c2UgdGhlIEdvb2dsZSBhcyBhbiBJZGVudGl0eSBQcm92aWRlciB0byBwcm92aWRlIElkZW50aXR5IFRva2VucywKKiAgd2hpY2ggY2FuIGJlIHVzZWQgYnkgdGhlIElkZW50aXR5IE1vZHVsZSB0byBhc3NvY2lhdGUgaXQgd2l0aCBhIEh5cGVydHkgaW5zdGFuY2UuCioKKiBUaGUgSWRlbnRpdHkgTW9kdWxlIHVzZXMgYSBub2RlIHBhY2thZ2UsIHRoZSBIZWxsb0pTLCB3aGljaCBpcyBhIGNsaWVudC1zaWRlIEphdmFTY3JpcHQgQVBJIGZvciBhdXRoZW50aWNhdGlvbgoqIHRoYXQgZmFjaWxpdGF0ZXMgdGhlIHJlcXVlc3RzIGZvciB0aGUgT3BlbklEIGNvbm5lY3QgcHJvdG9jb2wuIFRoaXMgbWV0aG9kIGFsbG93cyBmb3Igc29tZSBhYnN0cmFjdGlvbgoqIHdoZW4gbWFraW5nIHJlcXVlc3RzIGZvciBkaWZmZXJlbnQgSWRlbnRpdHkgUHJvdmlkZXJzLCBzdWNoIGFzIE9wZW5JRCBjb25uZWN0IHVzZWQgYnkgR29vZ2xlLCBGYWNlYm9vaywgTWljcm9zb2Z0LCBmb3IgZXhhbXBsZS4KKgoqIFdoZW4gYSByZXF1ZXN0IGZvciBhIHVzZXIgaWRlbnRpdHkgaXMgbWFkZSB1c2luZyB0aGUgbWV0aG9kIGxvZ2luV2l0aFJQKGlkZW50aWZpZXIsIHNjb3BlKSwKKiB0aGlzIG1ldGhvZCB3aWxsIGFuYWx5c2UgdGhlIElkZW50aXR5IFByb3ZpZGVyIGNob3NlbiB0byBvYnRhaW4gYW4gaWRlbnRpdHkgYW5kIHdpbGwgdXNlIHRoZSBIZWxsb0pTIG5vZGUgcGFja2FnZQoqIHdpdGggdGhlIHNlbGVjdGVkIElkZW50aXR5IFByb3ZpZGVyIGFuZCBpZGVudGl0eSBzY29wZS4gQWZ0ZXIgdGhlIEhlbGxvSlMgcmVxdWVzdCBmb3IgYW4gQWNjZXNzIFRva2VuCiogdG8gdGhlIElkZW50aXR5IFByb3ZpZGVycywgdGhlIHVzZXIgd2lsbCBiZSBwcm9tcHRlZCB0byBhdXRoZW50aWNhdGUgdG93YXJkcyB0aGUgSWRlbnRpdHkgUHJvdmlkZXIuCiogVXBvbiByZWNlaXZpbmcgdGhlIEFjY2VzcyBUb2tlbiwgdGhpcyB0b2tlbiBpcyB2YWxpZGF0ZWQgd2l0aCBhIFJFU1RmdWwgd2ViIHNlcnZpY2UgcmVxdWVzdCB0byBhbiBlbmRwb2ludAoqIG9uIHRoZSBJZGVudGl0eSBQcm92aWRlciBBdXRob3JpemF0aW9uIFNlcnZlciwgYW5kIGFmdGVyIHRoZSB2YWxpZGF0aW9uIGlzIGRvbmUsCiogYW4gSUQgdG9rZW4gaXMgb2J0YWluZWQgd2l0aCB0aGUgaW5mb3JtYXRpb24gYWNjb3JkaW5nIHRvIHRoZSBzY29wZSByZXF1aXJlZC4KKiBUaGlzIElEIHRva2VuIGlzIHRoZW4gcHJlc2VydmVkIGluIHRoaXMgbW9kdWxlIHRoYXQgY2FuIG9idGFpbmVkIHRocm91Z2ggdGhlIGdldElkZW50aXRpZXMoKQoqIGFuZCBpcyBwYXNzZWQgYXMgcmV0dXJuIHZhbHVlIG9mIHRoZSBsb2dpbldpdGhSUCBmdW5jdGlvbi4gVGhlIG1ldGhvZHMgZ2VuZXJhdGVBc3NlcnRpb24gYW5kIHZhbGlkYXRlQXNzZXJ0aW9uIGhhdmUgbm90IHlldCBiZWVuIGRldmVsb3BlZC4KKgoqLwoKdmFyIElkZW50aXR5TW9kdWxlID0gKGZ1bmN0aW9uICgpIHsKCiAgLyoqCiAgKiBUaGlzIGlzIHRoZSBjb25zdHJ1Y3RvciB0byBpbml0aWFsaXNlIHRoZSBJZGVudGl0eSBNb2R1bGUgaXQgZG9lcyBub3QgcmVxdWlyZSBhbnkgaW5wdXQuCiAgKi8KCiAgZnVuY3Rpb24gSWRlbnRpdHlNb2R1bGUoKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSWRlbnRpdHlNb2R1bGUpOwoKICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAvL3RvIHN0b3JlIGl0ZW1zIHdpdGggdGhpcyBmb3JtYXQ6IHtpZGVudGl0eTogaWRlbnRpdHlVUkwsIHRva2VuOiB0b2tlbklEfQogICAgX3RoaXMuaWRlbnRpdGllcyA9IFtdOwogIH0KCiAgLyoqCiAgKiBSZWdpc3RlciBhIG5ldyBJZGVudGl0eSB3aXRoIGFuIElkZW50aXR5IFByb3ZpZGVyCiAgKi8KCiAgX2NyZWF0ZUNsYXNzKElkZW50aXR5TW9kdWxlLCBbewogICAga2V5OiAncmVnaXN0ZXJJZGVudGl0eScsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVnaXN0ZXJJZGVudGl0eSgpIHt9CiAgICAvLyBCb2R5Li4uCgogICAgLyoqCiAgICAqIEluIHJlbGF0aW9uIHdpdGggYSBjbGFzc2ljYWwgUmVseWluZyBQYXJ0eTogUmVnaXN0cmF0aW9uCiAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdyZWdpc3RlcldpdGhSUCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVnaXN0ZXJXaXRoUlAoKSB7fQogICAgLy8gQm9keS4uLgoKICAgIC8qKgogICAgKiBGdW5jdGlvbiB0byByZXR1cm4gYWxsIHRoZSBpZGVudGl0aWVzIHJlZ2lzdGVyZWQgd2l0aGluIGEgc2Vzc2lvbiBieSBhIHVzZXIuCiAgICAqIFRoZXNlIGlkZW50aXRpZXMgYXJlIHJldHVybmVkIGluIGFuIGFycmF5IGNvbnRhaW5pbmcgYSBKU09OIHBhY2thZ2UgZm9yIGVhY2ggdXNlciBpZGVudGl0eS4KICAgICogQHJldHVybiB7QXJyYXk8SWRlbnRpdGllcz59ICAgICAgICAgQXJyYXkgICAgICAgICBJZGVudGl0aWVzCiAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdnZXRJZGVudGl0aWVzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRJZGVudGl0aWVzKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICByZXR1cm4gX3RoaXMuaWRlbnRpdGllczsKICAgIH0KCiAgICAvKioKICAgICogRnVuY3Rpb24gdG8gcmVxdWVzdCBhbiBJRCBUb2tlbiBmcm9tIGEgdXNlci4gSWYgbm8gdG9rZW4gZXhpc3RzLCB0aGUgSWRlbnRpdHkgTW9kdWxlCiAgICAqIHdpbGwgdHJ5IHRvIG9idGFpbiBvbmUgZnJvbSBhbiBJZGVudGl0eSBQcm92aWRlciwgYW5kIHRoZSB1c2VyIHdpbGwgYmUgYXNrZWQgdG8gYXV0aGVudGljYXRlCiAgICAqICB0b3dhcmRzIHRoZSBJZGVudGl0eSBQcm92aWRlci4KICAgICogVGhlIGZ1bmN0aW9uIHJldHVybnMgYSBwcm9taXNlIHdpdGggYSB0b2tlbiBjb250YWluaW5nIHRoZSB1c2VyIGluZm9ybWF0aW9uLgogICAgKgogICAgKiBAcGFyYW0gIHtJZGVudGlmaWVyfSAgICAgIGlkZW50aWZpZXIgICAgICBpZGVudGlmaWVyCiAgICAqIEBwYXJhbSAge1Njb3BlfSAgICAgICAgICAgc2NvcGUgICAgICAgICAgIHNjb3BlCiAgICAqIEByZXR1cm4ge1Byb21pc2V9ICAgICAgICAgUHJvbWlzZSAgICAgICAgIElEVG9rZW4gY29udGFpbmluZyB0aGUgdXNlciBpbmZvcm1hdGlvbgogICAgKi8KICB9LCB7CiAgICBrZXk6ICdsb2dpbldpdGhSUCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9naW5XaXRoUlAoaWRlbnRpZmllciwgc2NvcGUpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIC8qCiAgICAgICAgV2hlbiBjYWxsaW5nIHRoaXMgZnVuY3Rpb24sIGlmIGV2ZXJ5dGhpbmcgaXMgZmluZSwgYSBzbWFsbCBwb3AtdXAgd2lsbCBvcGVuIHJlcXVlc3RpbmcgYSBsb2dpbiB3aXRoIGEgZ29vZ2xlIGFjY291bnQuIEFmdGVyIHRoZSBsb2dpbiBpcyBtYWRlLCB0aGUgcG9wLXVwIHdpbGwgY2xvc2UgYW5kIHRoZSBmdW5jdGlvbiB3aWxsIHJldHVybiB0aGUgSUQgdG9rZW4uCiAgICAgICAgVGhpcyBmdW5jdGlvbiB3YXMgdGVzdGVkIHdpdGggdGhlIFVSTDogaHR0cDovLzEyNy4wLjAuMTo4MDgwLyBhbmQgd2l0aCB0aGUgc2FtZSByZWRpcmVjdCBVUkkKICAgICAgIAlJbiBjYXNlIHRoZSByZWRpcmVjdCBVUkkgaXMgbm90IGFjY2VwdGVkIG9yIGlzIHJlcXVpcmVkIHRvIGFkZCBvdGhlcnMgcmVkaXJlY3QgVVJJcywgYSBsaXR0bGUgaW5mb3JtYXRpb24gaXMgcHJvdmlkZWQgdG8gZml4IHRoZSBwcm9ibGVtOgogICAgICAgCVNvIHRoYXQgYW4gYXBwbGljYXRpb24gY2FuIHVzZSBHb29nbGUncyBPQXV0aCAyLjAgYXV0aGVudGljYXRpb24gc3lzdGVtIGZvciB1c2VyIGxvZ2luLAogICAgICAJZmlyc3QgaXMgcmVxdWlyZWQgdG8gc2V0IHVwIGEgcHJvamVjdCBpbiB0aGUgR29vZ2xlIERldmVsb3BlcnMgQ29uc29sZSB0byBvYnRhaW4gT0F1dGggMi4wIGNyZWRlbnRpYWxzIGFuZCBzZXQgYSByZWRpcmVjdCBVUkkuCiAgICAgIAlBIHRlc3QgYWNjb3VudCB3YXMgY3JlYXRlZCB0byBzZXQgdGhlIHByb2plY3QgaW4gdGhlIEdvb2dsZSBEZXZlbG9wZXJzIENvbnNvbGUgdG8gb2J0YWluIE9BdXRoIDIuMCBjcmVkZW50aWFscywJd2l0aCB0aGUgZm9sbG93aW5nIGNyZWRlbnRpYWxzOgogICAgICAgICAgIAl1c2VybmFtZTogb3BlbmlkdGVzdDEwQGdtYWlsLmNvbQogICAgICAgICAgICAgcGFzc3dvcmQ6IHRlc3RPcGVuSUQxMAogICAgICAgCVRvIGFkZCBtb3JlIFVSSSdzLCBmb2xsb3cgdGhlIHN0ZXBzOgogICAgICAJMcK6IGNob29zZSB0aGUgcHJvamVjdCAoIGNhbiBiZSB0aGUgTXkgT3BlbklEIFByb2plY3QpCSBmcm9tICBodHRwczovL2NvbnNvbGUuZGV2ZWxvcGVycy5nb29nbGUuY29tL3Byb2plY3RzZWxlY3Rvci9hcGlzL2NyZWRlbnRpYWxzIHVzaW5nIHRoZSBjcmVkZW50aWFscyBwcm92aWRlZCBhYm92ZS4KICAgICAgCTLCuiBPcGVuIFRoZSBDbGllbnQgV2ViIDEgbGlzdGVkIGluIE9BdXRoIDIuMCBDbGllbnQgSUQncwogICAgICAJM8K6IEFkZCB0aGUgVVJJICBpbiB0aGUgYXV0aG9yaXplZCByZWRpcmVjdCBVUkkgc2VjdGlvbi4KICAgICAgICA0wrogY2hhbmdlIHRoZSBSRURJUkVDVCBwYXJhbWV0ZXIgYmVsbG93IHdpdGggdGhlIHByZXRlbmRlZCBVUkkKICAgICAgICAgaWRlbnRpdHlNb2R1bGUuX2hlbGxvLmluaXQoe2dvb2dsZTogIjgwODMyOTU2NjAxMi10cXI4cW9oMTExOTQyZ2Qya2cwMDd0MHM4ZjI3N3JvaS5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbSJ9KTsKICAgICAgICBpZGVudGl0eU1vZHVsZS5faGVsbG8oImdvb2dsZSIpLmxvZ2luKCk7CiAgICAgICAqLwoKICAgICAgdmFyIFZBTElEVVJMID0gJ2h0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS90b2tlbmluZm8/YWNjZXNzX3Rva2VuPSc7CiAgICAgIHZhciBVU0VSSU5GVVJMID0gJ2h0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS91c2VyaW5mbz9hY2Nlc3NfdG9rZW49JzsKICAgICAgdmFyIGFjVG9rZW4gPSB1bmRlZmluZWQ7CiAgICAgIHZhciB0b2tlblR5cGUgPSB1bmRlZmluZWQ7CiAgICAgIHZhciBleHBpcmVzSW4gPSB1bmRlZmluZWQ7CiAgICAgIHZhciB1c2VyID0gdW5kZWZpbmVkOwogICAgICB2YXIgdG9rZW5JRCA9IHVuZGVmaW5lZDsKICAgICAgdmFyIGluZm9Ub2tlbiA9IHVuZGVmaW5lZDsKICAgICAgdmFyIGxvZ2dlZEluID0gZmFsc2U7CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgaWYgKF90aGlzLmluZm9Ub2tlbiAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAvL1RPRE8gdmVyaWZ5IHdoZXRoZXIgdGhlIHRva2VuIGlzIHN0aWxsIHZhbGlkIG9yIG5vdC4KICAgICAgICAgIHJldHVybiByZXNvbHZlKF90aGlzLmluZm9Ub2tlbik7CiAgICAgICAgfQoKICAgICAgICAvL2Z1bmN0aW9uIHRvIHZhbGlkYXRlIHRoZSBhY2Nlc3MgdG9rZW4gcmVjZWl2ZWQgZHVyaW5nIHRoZSBhdXRoZW50aWNhdGlvbgogICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlVG9rZW4odG9rZW4pIHsKICAgICAgICAgIHZhciByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgIHJlcS5vcGVuKCdHRVQnLCBWQUxJRFVSTCArIHRva2VuLCB0cnVlKTsKCiAgICAgICAgICByZXEub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKGUpIHsKICAgICAgICAgICAgaWYgKHJlcS5yZWFkeVN0YXRlID09IDQpIHsKICAgICAgICAgICAgICBpZiAocmVxLnN0YXR1cyA9PSAyMDApIHsKICAgICAgICAgICAgICAgIGdldEluZm9Ub2tlbih0b2tlbik7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChyZXEuc3RhdHVzID09IDQwMCkgewogICAgICAgICAgICAgICAgcmVqZWN0KCdUaGVyZSB3YXMgYW4gZXJyb3IgcHJvY2Vzc2luZyB0aGUgdG9rZW4nKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVqZWN0KCdzb21ldGhpbmcgZWxzZSBvdGhlciB0aGFuIDIwMCB3YXMgcmV0dXJuZWQnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgICByZXEuc2VuZCgpOwogICAgICAgIH0KCiAgICAgICAgLy9mdW5jdGlvbiB0byBleGNoYW5nZSB0aGUgYWNjZXNzIHRva2VuIHdpdGggYW4gSUQgVG9rZW4gY29udGFpbmluZyB0aGUgaW5mb3JtYXRpb24KICAgICAgICBmdW5jdGlvbiBnZXRJbmZvVG9rZW4odG9rZW4pIHsKICAgICAgICAgIHZhciByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgIHJlcS5vcGVuKCdHRVQnLCBVU0VSSU5GVVJMICsgdG9rZW4sIHRydWUpOwoKICAgICAgICAgIHJlcS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAocmVxLnJlYWR5U3RhdGUgPT09IDQpIHsKICAgICAgICAgICAgICBpZiAocmVxLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICBpbmZvVG9rZW4gPSBKU09OLnBhcnNlKHJlcS5yZXNwb25zZVRleHQpOwogICAgICAgICAgICAgICAgX3RoaXMuaW5mb1Rva2VuID0gaW5mb1Rva2VuOwogICAgICAgICAgICAgICAgdmFyIGVtYWlsID0gaW5mb1Rva2VuLmVtYWlsOwoKICAgICAgICAgICAgICAgIC8vY29udHJ1Y3QgdGhlIGlkZW50aXR5VVJMIHRvIGJlIGRlZmluZWQgYXMgaW4gc3BlY2lmaWNhdGlvbgogICAgICAgICAgICAgICAgLy8gbW9kZWw6IHVzZXI6Ly88aWRwZG9tYWluPi88dXNlci1pZGVudGlmaWVyPgogICAgICAgICAgICAgICAgdmFyIGlkZW50aXR5VVJMID0gJ3VzZXI6Ly8nICsgZW1haWwuc3Vic3RyaW5nKGVtYWlsLmluZGV4T2YoJ0AnKSArIDEsIGVtYWlsLmxlbmd0aCkgKyAnLycgKyBlbWFpbC5zdWJzdHJpbmcoMCwgZW1haWwuaW5kZXhPZignQCcpKTsKCiAgICAgICAgICAgICAgICAvL1RPRE8gcmVtb3ZlIGxhdGVyIHRoZSAndG9rZW4nIGZpZWxkIGtleQogICAgICAgICAgICAgICAgdmFyIGlkZW50aXR5QnVuZGxlID0geyBpZGVudGl0eTogaWRlbnRpdHlVUkwsIHRva2VuOiBpbmZvVG9rZW4sIGFjY2Vzc1Rva2VuOiB0b2tlbiwgaWRUb2tlbjoge30sIGluZm9Ub2tlbjogaW5mb1Rva2VuIH07CgogICAgICAgICAgICAgICAgZ2V0SURUb2tlbih0b2tlbiwgaWRlbnRpdHlCdW5kbGUpOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAocmVxLnN0YXR1cyA9PT0gNDAwKSB7CiAgICAgICAgICAgICAgICByZWplY3QoJ1RoZXJlIHdhcyBhbiBlcnJvciBwcm9jZXNzaW5nIHRoZSB0b2tlbicpOwogICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICByZWplY3QoJ3NvbWV0aGluZyBlbHNlIG90aGVyIHRoYW4gMjAwIHdhcyByZXR1cm5lZCcpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfTsKICAgICAgICAgIHJlcS5zZW5kKCk7CiAgICAgICAgfQoKICAgICAgICBmdW5jdGlvbiBnZXRJRFRva2VuKHRva2VuLCBpZGVudGl0eUJ1bmRsZSkgewogICAgICAgICAgdmFyIHJlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgICAgcmVxLm9wZW4oJ0dFVCcsIFZBTElEVVJMICsgdG9rZW4sIHRydWUpOwoKICAgICAgICAgIHJlcS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoZSkgewogICAgICAgICAgICBpZiAocmVxLnJlYWR5U3RhdGUgPT09IDQpIHsKICAgICAgICAgICAgICBpZiAocmVxLnN0YXR1cyA9PT0gMjAwKSB7CiAgICAgICAgICAgICAgICB0b2tlbklEID0gSlNPTi5wYXJzZShyZXEucmVzcG9uc2VUZXh0KTsKCiAgICAgICAgICAgICAgICBpZGVudGl0eUJ1bmRsZS5pZFRva2VuID0gdG9rZW5JRDsKICAgICAgICAgICAgICAgIF90aGlzLmlkZW50aXRpZXMucHVzaChpZGVudGl0eUJ1bmRsZSk7CiAgICAgICAgICAgICAgICByZXNvbHZlKGlkZW50aXR5QnVuZGxlLnRva2VuKTsKICAgICAgICAgICAgICB9IGVsc2UgaWYgKHJlcS5zdGF0dXMgPT09IDQwMCkgewogICAgICAgICAgICAgICAgcmVqZWN0KCdUaGVyZSB3YXMgYW4gZXJyb3IgcHJvY2Vzc2luZyB0aGUgdG9rZW4nKTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmVqZWN0KCdzb21ldGhpbmcgZWxzZSBvdGhlciB0aGFuIDIwMCB3YXMgcmV0dXJuZWQnKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH07CiAgICAgICAgICByZXEuc2VuZCgpOwogICAgICAgIH0KCiAgICAgICAgX2hlbGxvanMyWydkZWZhdWx0J10uaW5pdCh7IGdvb2dsZTogJzgwODMyOTU2NjAxMi10cXI4cW9oMTExOTQyZ2Qya2cwMDd0MHM4ZjI3N3JvaS5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbScgfSk7CiAgICAgICAgKDAsIF9oZWxsb2pzMlsnZGVmYXVsdCddKSgnZ29vZ2xlJykubG9naW4oeyBzY29wZTogJ2VtYWlsJyB9KS50aGVuKGZ1bmN0aW9uICh0b2tlbikgewoKICAgICAgICAgIHZhbGlkYXRlVG9rZW4odG9rZW4uYXV0aFJlc3BvbnNlLmFjY2Vzc190b2tlbik7CiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICBjb25zb2xlLmxvZygnZXJyb3JWYWxpZGF0aW5nICcsIGVycm9yKTsKICAgICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgKiBJbiByZWxhdGlvbiB3aXRoIGEgSHlwZXJ0eSBJbnN0YW5jZTogQXNzb2NpYXRlIGlkZW50aXR5CiAgICAqLwogIH0sIHsKICAgIGtleTogJ3NldEh5cGVydHlJZGVudGl0eScsCiAgICB2YWx1ZTogZnVuY3Rpb24gc2V0SHlwZXJ0eUlkZW50aXR5KCkge30KICAgIC8vIEJvZHkuLi4KCiAgICAvKioKICAgICogR2VuZXJhdGVzIGFuIElkZW50aXR5IEFzc2VydGlvbgogICAgKgogICAgKiBAcGFyYW0gIHtET01TdHJpbmd9IGNvbnRlbnRzICAgICBjb250ZW50cwogICAgKiBAcGFyYW0gIHtET01TdHJpbmd9IG9yaWdpbiAgICAgICBvcmlnaW4KICAgICogQHBhcmFtICB7RE9NU3RyaW5nfSB1c2VybmFtZUhpbnQgdXNlcm5hbWVIaW50CiAgICAqIEByZXR1cm4ge0lkQXNzZXJ0aW9ufSAgICAgICAgICAgICAgSWRBc3NlcnRpb24KICAgICovCgogIH0sIHsKICAgIGtleTogJ2dlbmVyYXRlQXNzZXJ0aW9uJywKICAgIHZhbHVlOiBmdW5jdGlvbiBnZW5lcmF0ZUFzc2VydGlvbihjb250ZW50cywgb3JpZ2luLCB1c2VybmFtZUhpbnQpIHt9CiAgICAvLyBCb2R5Li4uCgogICAgLyoqCiAgICAqIE9USEVSIFVTRVInUyBJREVOVElUWQogICAgKi8KCiAgICAvKioKICAgICogRnVuY3Rpb24gdG8gdmFsaWRhdGUgYW4gaWRlbnRpdHkgYXNzZXJ0aW9uIGdlbmVyYXRlZCBwcmV2aW91c2x5LgogICAgKiBSZXR1cm5zIGEgcHJvbWlzZSB3aXRoIHRoZSByZXN1bHQgZnJvbSB0aGUgdmFsaWRhdGlvbi4KICAgICogQHBhcmFtICB7RE9NU3RyaW5nfSBhc3NlcnRpb24KICAgICogQHJldHVybiB7UHJvbWlzZX0gICAgICAgICBQcm9taXNlICAgICAgICAgcHJvbWlzZSB3aXRoIHRoZSByZXN1bHQgZnJvbSB0aGUgdmFsaWRhdGlvbgogICAgKi8KCiAgfSwgewogICAga2V5OiAndmFsaWRhdGVBc3NlcnRpb24nLAogICAgdmFsdWU6IGZ1bmN0aW9uIHZhbGlkYXRlQXNzZXJ0aW9uKGFzc2VydGlvbikge30KICAgIC8vIEJvZHkuLi4KCiAgICAvKioKICAgICogVHJ1c3QgbGV2ZWwgZXZhbHVhdGlvbiBvZiBhIHJlY2VpdmVkIElkQXNzZXJ0aW9uCiAgICAqIEBwYXJhbSAge0RPTVN0cmluZ30gYXNzZXJ0aW9uIGFzc2VydGlvbgogICAgKi8KCiAgfSwgewogICAga2V5OiAnZ2V0QXNzZXJ0aW9uVHJ1c3RMZXZlbCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0QXNzZXJ0aW9uVHJ1c3RMZXZlbChhc3NlcnRpb24pIHsKICAgICAgLy8gQm9keS4uLgogICAgfQogIH1dKTsKCiAgcmV0dXJuIElkZW50aXR5TW9kdWxlOwp9KSgpOwoKZXhwb3J0c1snZGVmYXVsdCddID0gSWRlbnRpdHlNb2R1bGU7Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7ImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIjo5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6MTMsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjE1LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQiOjE5LCJoZWxsb2pzIjoxMDd9XSwxMTQ6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewondXNlIHN0cmljdCc7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcycpWydkZWZhdWx0J107Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2snKVsnZGVmYXVsdCddOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF91dGlsc1V0aWxzSnMgPSByZXF1aXJlKCcuLi91dGlscy91dGlscy5qcycpOwoKdmFyIFBvbGljeSA9IChmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gUG9saWN5KGlkLCB0YXJnZXQsIHdoZW4sIGF1dGhvcmlzZSwgYWN0aW9ucykgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFBvbGljeSk7CgogICAgdmFyIF90aGlzID0gdGhpczsKICAgIF90aGlzLmlkID0gaWQ7CiAgICBfdGhpcy50YXJnZXQgPSB0YXJnZXQ7CiAgICBfdGhpcy53aGVuID0gd2hlbjsKICAgIF90aGlzLmF1dGhvcmlzZSA9IGF1dGhvcmlzZTsKICAgIF90aGlzLmFjdGlvbnMgPSBhY3Rpb25zOwogIH0KCiAgLyogVE9ETzogc2FuaXRpemF0aW9uIG5lZWRlZCAqLwoKICBfY3JlYXRlQ2xhc3MoUG9saWN5LCBbewogICAga2V5OiAnZXZhbHVhdGUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGV2YWx1YXRlKG1lc3NhZ2UsIHVzZXJJRCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgIHN3aXRjaCAoX3RoaXMudGFyZ2V0KSB7CiAgICAgICAgY2FzZSAnZG9tYWluJzoKICAgICAgICAgIHZhciBkb21haW5VUkwgPSAoMCwgX3V0aWxzVXRpbHNKcy5kaXZpZGVVUkwpKHVzZXJJRCkuZG9tYWluOwogICAgICAgICAgcmVzdWx0WzBdID0gZG9tYWluVVJMID09PSBfdGhpcy53aGVuID8gX3RoaXMuYXV0aG9yaXNlIDogIV90aGlzLmF1dGhvcmlzZTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ2xpc3RzJzoKICAgICAgICAgIHJlc3VsdFswXSA9IGV2YWwoJ190aGlzLicgKyBfdGhpcy53aGVuICsgJyhcJycgKyB1c2VySUQgKyAnXCcpJykgPyBfdGhpcy5hdXRob3Jpc2UgOiAhX3RoaXMuYXV0aG9yaXNlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgY2FzZSAndGltZSc6CiAgICAgICAgICByZXN1bHRbMF0gPSBldmFsKCdfdGhpcy4nICsgX3RoaXMud2hlbikgPyBfdGhpcy5hdXRob3Jpc2UgOiAhX3RoaXMuYXV0aG9yaXNlOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgZGVmYXVsdDoKICAgICAgICAgIHJlc3VsdFsxXSA9IF90aGlzLmFjdGlvbnM7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgICByZXR1cm4gX3Jlc3VsdDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdpc0JsYWNrTGlzdGVkJywKICAgIHZhbHVlOiBmdW5jdGlvbiBpc0JsYWNrTGlzdGVkKHVzZXIpIHsKICAgICAgLy8gbGV0IGJsYWNrTGlzdCA9IHRydXN0RW5naW5lLmdldEJsYWNrTGlzdCgpOwogICAgICB2YXIgYmxhY2tMaXN0ID0gW107CiAgICAgIHJldHVybiBibGFja0xpc3QuaW5kZXhPZih1c2VyKSA+IC0xOwogICAgfQogIH0sIHsKICAgIGtleTogJ2lzV2hpdGVMaXN0ZWQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGlzV2hpdGVMaXN0ZWQodXNlcikgewogICAgICAvLyBsZXQgd2hpdGVMaXN0ID0gdHJ1c3RFbmdpbmUuZ2V0V2hpdGVMaXN0KCk7CiAgICAgIHZhciB3aGl0ZUxpc3QgPSBbXTsKICAgICAgLy93aGl0ZUxpc3QucHVzaCgndXNlcjovL2dtYWlsLmNvbS9vcGVuaWR0ZXN0MTAnKTsKICAgICAgcmV0dXJuIHdoaXRlTGlzdC5pbmRleE9mKGZyb20pID4gLTE7CiAgICB9CiAgfSwgewogICAga2V5OiAnZ2V0TWludXRlcycsCiAgICB2YWx1ZTogZnVuY3Rpb24gZ2V0TWludXRlcyh0aW1lKSB7CiAgICAgIHZhciB0aW1lU3BsaXQgPSB0aW1lLnNwbGl0KCc6Jyk7CiAgICAgIHJldHVybiBwYXJzZUludCh0aW1lU3BsaXRbMF0gKiA2MCArIHRpbWVTcGxpdFsxXSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnaXNUaW1lQmV0d2VlbicsCiAgICB2YWx1ZTogZnVuY3Rpb24gaXNUaW1lQmV0d2VlbihzdGFydCwgZW5kKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHZhciBub3cgPSBuZXcgRGF0ZSgpOwogICAgICB2YXIgbm93TWludXRlcyA9IF90aGlzLmdldE1pbnV0ZXMocGFyc2VJbnQobm93LmdldEhvdXJzKCkpICsgJzonICsgbm93LmdldE1pbnV0ZXMoKSk7CiAgICAgIHZhciBzdGFydE1pbnV0ZXMgPSBfdGhpcy5nZXRNaW51dGVzKHN0YXJ0KTsKICAgICAgdmFyIGVuZE1pbnV0ZXMgPSBfdGhpcy5nZXRNaW51dGVzKGVuZCk7CiAgICAgIHJldHVybiBub3dNaW51dGVzID4gc3RhcnRNaW51dGVzICYmIG5vd01pbnV0ZXMgPCBlbmRNaW51dGVzOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFBvbGljeTsKfSkoKTsKCmV4cG9ydHNbJ2RlZmF1bHQnXSA9IFBvbGljeTsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107Cgp9LHsiLi4vdXRpbHMvdXRpbHMuanMiOjEyNywiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjEzLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxNX1dLDExNTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBfY3JlYXRlQ2xhc3MgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzJylbJ2RlZmF1bHQnXTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjaycpWydkZWZhdWx0J107Cgp2YXIgX1Byb21pc2UgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZScpWydkZWZhdWx0J107Cgp2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCcpWydkZWZhdWx0J107CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX1BvbGljeSA9IHJlcXVpcmUoJy4vUG9saWN5Jyk7Cgp2YXIgX1BvbGljeTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9Qb2xpY3kpOwoKdmFyIF91dGlsc1V0aWxzSnMgPSByZXF1aXJlKCcuLi91dGlscy91dGlscy5qcycpOwoKdmFyIFBvbGljeUVuZ2luZSA9IChmdW5jdGlvbiAoKSB7CiAgZnVuY3Rpb24gUG9saWN5RW5naW5lKGlkZW50aXR5TW9kdWxlLCBydW50aW1lUmVnaXN0cnkpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBQb2xpY3lFbmdpbmUpOwoKICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICBfdGhpcy5pZE1vZHVsZSA9IGlkZW50aXR5TW9kdWxlOwogICAgX3RoaXMucmVnaXN0cnkgPSBydW50aW1lUmVnaXN0cnk7CiAgICBfdGhpcy5wb2xpY2llcyA9IHt9OwogIH0KCiAgLyogVE9ETzogdmFsaWRhdGlvbiBuZWVkZWQgKi8KCiAgX2NyZWF0ZUNsYXNzKFBvbGljeUVuZ2luZSwgW3sKICAgIGtleTogJ2FkZFBvbGljaWVzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRQb2xpY2llcyhrZXksIHBvbGljaWVzKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIGZvciAodmFyIHBvbGljeSBpbiBwb2xpY2llcykgewogICAgICAgIGlmIChfdGhpcy5wb2xpY2llc1trZXldID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIF90aGlzLnBvbGljaWVzW2tleV0gPSBbXTsKICAgICAgICB9CiAgICAgICAgX3RoaXMucG9saWNpZXNba2V5XS5wdXNoKHBvbGljaWVzW3BvbGljeV0pOwogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnc2ltdWxhdGUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHNpbXVsYXRlKGtleSkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgdmFyIGlkID0gJ2FsbG93LW9ubHktZ21haWwnOwogICAgICB2YXIgdGFyZ2V0ID0gJ2RvbWFpbic7CiAgICAgIHZhciB3aGVuID0gJ2dtYWlsLmNvbSc7CiAgICAgIHZhciBhdXRob3Jpc2UgPSB0cnVlOwogICAgICB2YXIgYWN0aW9ucyA9IFtdOwogICAgICB2YXIgcG9saWN5MSA9IG5ldyBfUG9saWN5MlsnZGVmYXVsdCddKGlkLCB0YXJnZXQsIHdoZW4sIGF1dGhvcmlzZSwgYWN0aW9ucyk7CgogICAgICBpZCA9ICdibG9jay1ibGFja2xpc3RlZCc7CiAgICAgIHRhcmdldCA9ICdsaXN0cyc7CiAgICAgIHdoZW4gPSAnaXNCbGFja0xpc3RlZCc7CiAgICAgIGF1dGhvcmlzZSA9IGZhbHNlOwogICAgICBhY3Rpb25zID0gW107CiAgICAgIHZhciBwb2xpY3kyID0gbmV3IF9Qb2xpY3kyWydkZWZhdWx0J10oaWQsIHRhcmdldCwgd2hlbiwgYXV0aG9yaXNlLCBhY3Rpb25zKTsKCiAgICAgIC8qaWQgPSAnYWxsb3ctd2hpdGVsaXN0ZWQnOwogICAgICB0YXJnZXQgPSAnbGlzdHMnOwogICAgICB3aGVuID0gJ2lzV2hpdGVMaXN0ZWQnOwogICAgICBhdXRob3Jpc2UgPSB0cnVlOwogICAgICBhY3Rpb25zID0gW107CiAgICAgIGxldCBwb2xpY3kzID0gbmV3IFBvbGljeShpZCwgdGFyZ2V0LCB3aGVuLCBhdXRob3Jpc2UsIGFjdGlvbnMpOwogICAgICAgaWQgPSAnYWxsb3ctOC0yMyc7CiAgICAgIHRhcmdldCA9ICd0aW1lJzsKICAgICAgd2hlbiA9ICdpc1RpbWVCZXR3ZWVuKFwnODowMFwnLCBcJzIwOjAwXCcpJzsKICAgICAgYXV0aG9yaXNlID0gdHJ1ZTsKICAgICAgYWN0aW9ucyA9IFtdOwogICAgICBsZXQgcG9saWN5NCA9IG5ldyBQb2xpY3koaWQsIHRhcmdldCwgd2hlbiwgYXV0aG9yaXNlLCBhY3Rpb25zKTsqLwoKICAgICAgX3RoaXMuYWRkUG9saWNpZXMoa2V5LCBbcG9saWN5MSwgcG9saWN5Ml0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ3JlbW92ZVBvbGljaWVzJywKICAgIHZhbHVlOiBmdW5jdGlvbiByZW1vdmVQb2xpY2llcyhrZXksIHBvbGljeUlkKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHZhciBhbGxQb2xpY2llcyA9IF90aGlzLnBvbGljaWVzOwoKICAgICAgaWYgKGtleSBpbiBhbGxQb2xpY2llcykgewogICAgICAgIGlmIChwb2xpY3lJZCAhPT0gJ2FsbCcpIHsKICAgICAgICAgIHZhciBwb2xpY2llcyA9IGFsbFBvbGljaWVzW2tleV07CiAgICAgICAgICB2YXIgbnVtUG9saWNpZXMgPSBwb2xpY2llcy5sZW5ndGg7CgogICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBudW1Qb2xpY2llczsgaSsrKSB7CiAgICAgICAgICAgIGlmIChwb2xpY2llc1tpXS5pZCA9PT0gcG9saWN5SWQpIHsKICAgICAgICAgICAgICBwb2xpY2llcy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVsZXRlIF90aGlzLnBvbGljaWVzW2tleV07CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwgewogICAga2V5OiAnYXV0aG9yaXNlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBhdXRob3Jpc2UobWVzc2FnZSkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICAvL190aGlzLnNpbXVsYXRlKG1lc3NhZ2UuZnJvbSk7CiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIF90aGlzLmlkTW9kdWxlLmxvZ2luV2l0aFJQKCdnb29nbGUgaWRlbnRpdHknLCAnc2NvcGUnKS50aGVuKGZ1bmN0aW9uICh2YWx1ZSkgewogICAgICAgICAgdmFyIGFzc2VydGVkSUQgPSBfdGhpcy5pZE1vZHVsZS5nZXRJZGVudGl0aWVzKCk7CgogICAgICAgICAgaWYgKCFtZXNzYWdlLmhhc093blByb3BlcnR5KCdib2R5JykpIHsKICAgICAgICAgICAgbWVzc2FnZS5ib2R5ID0ge307CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgdXNlcklEID0gYXNzZXJ0ZWRJRFswXS5pZGVudGl0eTsKICAgICAgICAgIGlmICghbWVzc2FnZS5ib2R5Lmhhc093blByb3BlcnR5KCdhc3NlcnRlZElkZW50aXR5JykpIHsKICAgICAgICAgICAgbWVzc2FnZS5ib2R5LmFzc2VydGVkSWRlbnRpdHkgPSB1c2VySUQ7CiAgICAgICAgICAgIG1lc3NhZ2UuYm9keS5pZFRva2VuID0gdmFsdWU7CiAgICAgICAgICB9CgogICAgICAgICAgdmFyIHBvbGljaWVzUmVzdWx0ID0gX3RoaXMuY2hlY2tQb2xpY2llcyhtZXNzYWdlLCB1c2VySUQpOwogICAgICAgICAgaWYgKHBvbGljaWVzUmVzdWx0WzBdKSB7CiAgICAgICAgICAgIG1lc3NhZ2UuYm9keS5hdXRob3Jpc2VkID0gdHJ1ZTsKICAgICAgICAgICAgcmVzb2x2ZShtZXNzYWdlKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1lc3NhZ2UuYm9keS5hdXRob3Jpc2VkID0gZmFsc2U7CiAgICAgICAgICAgIHJlamVjdChtZXNzYWdlKTsKICAgICAgICAgIH0KICAgICAgICAgIHJlc29sdmUobWVzc2FnZSk7CiAgICAgICAgfSwgZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdjaGVja1BvbGljaWVzJywKICAgIHZhbHVlOiBmdW5jdGlvbiBjaGVja1BvbGljaWVzKG1lc3NhZ2UsIHVzZXJJRCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgYXBwbGljYWJsZVBvbGljaWVzID0gX3RoaXMuZ2V0QXBwbGljYWJsZVBvbGljaWVzKG1lc3NhZ2UuZnJvbSwgbWVzc2FnZS50bywgdXNlcklEKTsKICAgICAgdmFyIHJlc3VsdHMgPSBbdHJ1ZV07CiAgICAgIHZhciBhY3Rpb25zID0gW107CgogICAgICBmb3IgKHZhciBwb2xpY3kgaW4gYXBwbGljYWJsZVBvbGljaWVzKSB7CiAgICAgICAgdmFyIHJlc3VsdCA9IGFwcGxpY2FibGVQb2xpY2llc1twb2xpY3ldLmV2YWx1YXRlKG1lc3NhZ2UsIHVzZXJJRCk7CiAgICAgICAgcmVzdWx0cy5wdXNoKHJlc3VsdFswXSk7CiAgICAgICAgYWN0aW9ucy5wdXNoKHJlc3VsdFsxXSk7CiAgICAgIH0KCiAgICAgIHZhciBhdXRob3Jpc2F0aW9uRGVjaXNpb24gPSBfdGhpcy5nZXRBdXRob3Jpc2F0aW9uRGVjaXNpb24ocmVzdWx0cyk7CiAgICAgIHJldHVybiBbYXV0aG9yaXNhdGlvbkRlY2lzaW9uLCBhY3Rpb25zXTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdnZXRBcHBsaWNhYmxlUG9saWNpZXMnLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEFwcGxpY2FibGVQb2xpY2llcyhoeXBlcnR5RnJvbSwgaHlwZXJ0eVRvLCB1c2VySUQpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIGFwcGxpY2FibGVQb2xpY2llcyA9IFtdOwoKICAgICAgaWYgKGh5cGVydHlGcm9tIGluIF90aGlzLnBvbGljaWVzKSB7CiAgICAgICAgZm9yICh2YXIgcG9saWN5IGluIF90aGlzLnBvbGljaWVzW2h5cGVydHlGcm9tXSkgewogICAgICAgICAgYXBwbGljYWJsZVBvbGljaWVzLnB1c2goX3RoaXMucG9saWNpZXNbaHlwZXJ0eUZyb21dW3BvbGljeV0pOwogICAgICAgIH0KICAgICAgfQogICAgICBpZiAoaHlwZXJ0eVRvIGluIF90aGlzLnBvbGljaWVzKSB7CiAgICAgICAgZm9yICh2YXIgcG9saWN5IGluIF90aGlzLnBvbGljaWVzW2h5cGVydHlUb10pIHsKICAgICAgICAgIGFwcGxpY2FibGVQb2xpY2llcy5wdXNoKF90aGlzLnBvbGljaWVzW2h5cGVydHlUb11bcG9saWN5XSk7CiAgICAgICAgfQogICAgICB9CiAgICAgIGlmICh1c2VySUQgaW4gX3RoaXMucG9saWNpZXMpIHsKICAgICAgICBmb3IgKHZhciBwb2xpY3kgaW4gX3RoaXMucG9saWNpZXNbdXNlcklEXSkgewogICAgICAgICAgYXBwbGljYWJsZVBvbGljaWVzLnB1c2goX3RoaXMucG9saWNpZXNbdXNlcklEXVtwb2xpY3ldKTsKICAgICAgICB9CiAgICAgIH0KICAgICAgcmV0dXJuIGFwcGxpY2FibGVQb2xpY2llczsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdnZXRBdXRob3Jpc2F0aW9uRGVjaXNpb24nLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEF1dGhvcmlzYXRpb25EZWNpc2lvbihyZXN1bHRzKSB7CiAgICAgIHJldHVybiByZXN1bHRzLmluZGV4T2YoZmFsc2UpID09IC0xOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFBvbGljeUVuZ2luZTsKfSkoKTsKCmV4cG9ydHNbJ2RlZmF1bHQnXSA9IFBvbGljeUVuZ2luZTsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWydkZWZhdWx0J107Cgp9LHsiLi4vdXRpbHMvdXRpbHMuanMiOjEyNywiLi9Qb2xpY3kiOjExNCwiYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UiOjksImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIjoxMywiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyI6MTUsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCI6MTl9XSwxMTY6W2Z1bmN0aW9uKHJlcXVpcmUsbW9kdWxlLGV4cG9ydHMpewovLyBpbXBvcnQgTWVzc2FnZUZhY3RvcnkgZnJvbSAnLi4vLi4vcmVzb3VyY2VzL01lc3NhZ2VGYWN0b3J5JzsKCi8qKgogKiBDbGFzcyB3aWxsIGFzayB0byB0aGUgbWVzc2FnZSBub2RlIGZvciBhZGRyZXNzZXMKICovCid1c2Ugc3RyaWN0JzsKCnZhciBfY3JlYXRlQ2xhc3MgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzJylbJ2RlZmF1bHQnXTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjaycpWydkZWZhdWx0J107Cgp2YXIgX1Byb21pc2UgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZScpWydkZWZhdWx0J107CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgQWRkcmVzc0FsbG9jYXRpb24gPSAoZnVuY3Rpb24gKCkgewogIC8qIHByaXZhdGUKICBfdXJsOiBVUkwKICBfYnVzOiBNaW5pQnVzCiAgKi8KCiAgLyoqCiAgICogQ3JlYXRlIGFuIEFkZHJlc3MgQWxsb2NhdGlvbgogICAqIEBwYXJhbSAge1VSTC5VUkx9ICAgICAgdXJsIC0gdXJsIGZyb20gd2hvIGlzIHNlbmRpbmcgdGhlIG1lc3NhZ2UKICAgKiBAcGFyYW0gIHtNaW5pQnVzfSAgICAgIGJ1cyAtIE1pbmlCdXMgdXNlZCBmb3IgYWRkcmVzcyBhbGxvY2F0aW9uCiAgICovCgogIGZ1bmN0aW9uIEFkZHJlc3NBbGxvY2F0aW9uKHVybCwgYnVzKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgQWRkcmVzc0FsbG9jYXRpb24pOwoKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgLy8gbGV0IG1lc3NhZ2VGYWN0b3J5ID0gbmV3IE1lc3NhZ2VGYWN0b3J5KCk7CiAgICAvLwogICAgLy8gX3RoaXMuX21lc3NhZ2VGYWN0b3J5ID0gbWVzc2FnZUZhY3Rvcnk7CiAgICBfdGhpcy5fdXJsID0gdXJsOwogICAgX3RoaXMuX2J1cyA9IGJ1czsKICB9CgogIC8qKgogICAqIGdldCB0aGUgVVJMIHZhbHVlCiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgdXJsIHZhbHVlOwogICAqLwoKICBfY3JlYXRlQ2xhc3MoQWRkcmVzc0FsbG9jYXRpb24sIFt7CiAgICBrZXk6ICdjcmVhdGUnLAoKICAgIC8qKgogICAgICogQXNrIGZvciBjcmVhdGlvbiBvZiBhIG51bWJlciBvZiBIeXBlcnR5IGFkZHJlc3NlcywgdG8gdGhlIGRvbWFpbiBtZXNzYWdlIG5vZGUuCiAgICAgKiBAcGFyYW0gIHtEb21haW59IGRvbWFpbiAtIERvbWFpbiBvZiB0aGUgbWVzc2FnZSBub2RlLgogICAgICogQHBhcmFtICB7bnVtYmVyfSBudW1iZXIgLSBOdW1iZXIgb2YgYWRkcmVzc2VzIHRvIHJlcXVlc3QKICAgICAqIEByZXR1cm5zIHtQcm9taXNlPEh5cGVydHlVUkw+fSAgQSBsaXN0IG9mIEh5cGVydHlVUkwncwogICAgICovCiAgICB2YWx1ZTogZnVuY3Rpb24gY3JlYXRlKGRvbWFpbiwgbnVtYmVyKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvLyBsZXQgbWVzc2FnZUZhY3RvcnkgPSBfdGhpcy5fbWVzc2FnZUZhY3Rvcnk7CgogICAgICB2YXIgbXNnID0gewogICAgICAgIHR5cGU6ICdjcmVhdGUnLCBmcm9tOiBfdGhpcy5fdXJsLCB0bzogJ2RvbWFpbjovL21zZy1ub2RlLicgKyBkb21haW4gKyAnL2h5cGVydHktYWRkcmVzcy1hbGxvY2F0aW9uJywKICAgICAgICBib2R5OiB7IHZhbHVlOiB7IG51bWJlcjogbnVtYmVyIH0gfQogICAgICB9OwoKICAgICAgLy8gVE9ETzogQXBwbHkgdGhlIG1lc3NhZ2UgZmFjdG9yeQogICAgICAvLyBUaGUgbXNnLW5vZGUtdmVydHggc2hvdWxkIGJlIGNoYW5nZWQgdGhlIGJvZHkgZmllbGQgdG8gcmVjZWl2ZQogICAgICAvLyB0aGUgZm9sbG93aW5nIGZvcm1hdCBib2R5OiB7dmFsdWU6IHtudW1iZXI6IG51bWJlcn19IGJlY2F1c2UKICAgICAgLy8gdGhlIG1lc3NhZ2UgaXMgZ2VuZXJhdGVkIGluIHRoYXQgd2F5IGJ5IHRoZSBtZXNzYWdlIGZhY3Rvcnk7CiAgICAgIC8vIGxldCBtc2cgPSBtZXNzYWdlRmFjdG9yeS5jcmVhdGVNZXNzYWdlUmVxdWVzdChfdGhpcy5fdXJsLCAnZG9tYWluOi8vbXNnLW5vZGUuJyArIGRvbWFpbiArICcvaHlwZXJ0eS1hZGRyZXNzLWFsbG9jYXRpb24nLCAnJywge251bWJlcjogbnVtYmVyfSk7CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgLy8gVE9ETzogY2hhbmdlIHRoaXMgcmVzcG9uc2UgTWVzc2FnZSB1c2luZyB0aGUgTWVzc2FnZUZhY3RvcnkKICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKG1zZywgZnVuY3Rpb24gKHJlcGx5KSB7CiAgICAgICAgICBpZiAocmVwbHkuYm9keS5jb2RlID09PSAyMDApIHsKICAgICAgICAgICAgcmVzb2x2ZShyZXBseS5ib2R5LnZhbHVlLmFsbG9jYXRlZCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZWplY3QocmVwbHkuYm9keS5kZXNjKTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAndXJsJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fdXJsOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIEFkZHJlc3NBbGxvY2F0aW9uOwp9KSgpOwoKZXhwb3J0c1snZGVmYXVsdCddID0gQWRkcmVzc0FsbG9jYXRpb247Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7ImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIjo5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6MTMsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjE1fV0sMTE3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF9jcmVhdGVDbGFzcyA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MnKVsnZGVmYXVsdCddOwoKdmFyIF9jbGFzc0NhbGxDaGVjayA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrJylbJ2RlZmF1bHQnXTsKCnZhciBfUHJvbWlzZSA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlJylbJ2RlZmF1bHQnXTsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfdXRpbHNVdGlsc0pzID0gcmVxdWlyZSgnLi4vdXRpbHMvdXRpbHMuanMnKTsKCi8qKgoqIENvcmUgSHlwZXJ0eURpc2NvdmVyeSBpbnRlcmZhY2UKKiBDbGFzcyB0byBhbGxvdyBhcHBsaWNhdGlvbnMgdG8gc2VhcmNoIGZvciBoeXBlcnRpZXMgdXNpbmcgdGhlIG1lc3NhZ2UgYnVzCiovCgp2YXIgSHlwZXJ0eURpc2NvdmVyeSA9IChmdW5jdGlvbiAoKSB7CgogIC8qKgogICogVG8gaW5pdGlhbGlzZSB0aGUgSHlwZXJ0eURpc2NvdmVyLCB3aGljaCB3aWxsIHByb3ZpZGUgdGhlIHN1cHBvcnQgZm9yIGh5cGVydGllcyB0bwogICogcXVlcnkgdXNlcnMgcmVnaXN0ZXJlZCBpbiBvdXRzaWRlIHRoZSBpbnRlcm5hbCBjb3JlLgogICogQHBhcmFtICB7TWVzc2FnZUJ1c30gICAgICAgICAgbXNnYnVzICAgICAgICAgICAgICAgIG1zZ2J1cwogICogQHBhcmFtICB7UnVudGltZVVSTH0gICAgICAgICAgcnVudGltZVVSTCAgICAgICAgICAgIHJ1bnRpbWVVUkwKICAqLwoKICBmdW5jdGlvbiBIeXBlcnR5RGlzY292ZXJ5KGRvbWFpbiwgbXNnQnVzKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSHlwZXJ0eURpc2NvdmVyeSk7CgogICAgdmFyIF90aGlzID0gdGhpczsKICAgIF90aGlzLm1lc3NhZ2VCdXMgPSBtc2dCdXM7CgogICAgX3RoaXMuZG9tYWluID0gZG9tYWluOwogICAgX3RoaXMuZGlzY292ZXJ5VVJMID0gJ2h5cGVydHk6Ly8nICsgZG9tYWluICsgJy9oeXBlcnR5RGlzb3ZlcnknOwogIH0KCiAgLyoqCiAgKiBmdW5jdGlvbiB0byByZXF1ZXN0IGFib3V0IHVzZXJzIHJlZ2lzdGVyZWQgaW4gZG9tYWluIHJlZ2lzdHJ5LCBhbmQKICAqIHJldHVybiB0aGUgaHlwZXJ0eSBpbnN0YW5jZSBpZiBmb3VuZC4KICAqIEBwYXJhbSAge2VtYWlsfSAgICAgICAgICAgICAgZW1haWwKICAqIEByZXR1cm4ge1Byb21pc2V9ICAgICAgICAgIFByb21pc2UKICAqLwoKICBfY3JlYXRlQ2xhc3MoSHlwZXJ0eURpc2NvdmVyeSwgW3sKICAgIGtleTogJ2Rpc2NvdmVySHlwZXJ0eVBlclVzZXInLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRpc2NvdmVySHlwZXJ0eVBlclVzZXIoZW1haWwpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIGlkZW50aXR5VVJMID0gJ3VzZXI6Ly8nICsgZW1haWwuc3Vic3RyaW5nKGVtYWlsLmluZGV4T2YoJ0AnKSArIDEsIGVtYWlsLmxlbmd0aCkgKyAnLycgKyBlbWFpbC5zdWJzdHJpbmcoMCwgZW1haWwuaW5kZXhPZignQCcpKTsKCiAgICAgIC8vIG1lc3NhZ2UgdG8gcXVlcnkgZG9tYWluIHJlZ2lzdHJ5LCBhc2tpbmcgZm9yIGEgdXNlciBoeXBlcnR5LgogICAgICB2YXIgbWVzc2FnZSA9IHsKICAgICAgICB0eXBlOiAnUkVBRCcsIGZyb206IF90aGlzLmRpc2NvdmVyeVVSTCwgdG86ICdkb21haW46Ly9yZWdpc3RyeS4nICsgX3RoaXMuZG9tYWluICsgJy8nLCBib2R5OiB7IHJlc291cmNlOiBpZGVudGl0eVVSTCB9CiAgICAgIH07CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgX3RoaXMubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtZXNzYWdlLCBmdW5jdGlvbiAocmVwbHkpIHsKICAgICAgICAgIC8vY29uc29sZS5sb2coJ01FU1NBR0UnLCByZXBseSk7CgogICAgICAgICAgdmFyIGh5cGVydHkgPSB1bmRlZmluZWQ7CiAgICAgICAgICB2YXIgbW9zdFJlY2VudCA9IHVuZGVmaW5lZDsKICAgICAgICAgIHZhciBsYXN0SHlwZXJ0eSA9IHVuZGVmaW5lZDsKICAgICAgICAgIHZhciB2YWx1ZSA9IHJlcGx5LmJvZHkudmFsdWU7CgogICAgICAgICAgLy9jb25zb2xlLmxvZygndmFsdWVQYXJzZWQnLCB2YWx1ZVBhcnNlZCk7CiAgICAgICAgICBmb3IgKGh5cGVydHkgaW4gdmFsdWUpIHsKICAgICAgICAgICAgaWYgKHZhbHVlW2h5cGVydHldLmxhc3RNb2RpZmllZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgaWYgKG1vc3RSZWNlbnQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgbW9zdFJlY2VudCA9IG5ldyBEYXRlKHZhbHVlW2h5cGVydHldLmxhc3RNb2RpZmllZCk7CiAgICAgICAgICAgICAgICBsYXN0SHlwZXJ0eSA9IGh5cGVydHk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBoeXBlcnR5RGF0ZSA9IG5ldyBEYXRlKHZhbHVlW2h5cGVydHldLmxhc3RNb2RpZmllZCk7CiAgICAgICAgICAgICAgICBpZiAobW9zdFJlY2VudC5nZXRUaW1lKCkgPCBoeXBlcnR5RGF0ZS5nZXRUaW1lKCkpIHsKICAgICAgICAgICAgICAgICAgbW9zdFJlY2VudCA9IGh5cGVydHlEYXRlOwogICAgICAgICAgICAgICAgICBsYXN0SHlwZXJ0eSA9IGh5cGVydHk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgaHlwZXJ0eVVSTCA9IGxhc3RIeXBlcnR5OwoKICAgICAgICAgIGlmIChoeXBlcnR5VVJMID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHJlamVjdCgnVXNlciBIeXBlcnR5IG5vdCBmb3VuZCcpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpZFBhY2thZ2UgPSB7CiAgICAgICAgICAgIGlkOiBlbWFpbCwKICAgICAgICAgICAgZGVzY3JpcHRvcjogdmFsdWVbaHlwZXJ0eVVSTF0uZGVzY3JpcHRvciwKICAgICAgICAgICAgaHlwZXJ0eVVSTDogaHlwZXJ0eVVSTAogICAgICAgICAgfTsKCiAgICAgICAgICBjb25zb2xlLmxvZygnPT09PiBSZWdpc3Rlckh5cGVydHkgbWVzc2FnZUJ1bmRsZTogJywgaWRQYWNrYWdlKTsKICAgICAgICAgIHJlc29sdmUoaWRQYWNrYWdlKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gSHlwZXJ0eURpc2NvdmVyeTsKfSkoKTsKCmV4cG9ydHNbJ2RlZmF1bHQnXSA9IEh5cGVydHlEaXNjb3Zlcnk7Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7Ii4uL3V0aWxzL3V0aWxzLmpzIjoxMjcsImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIjo5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6MTMsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjE1fV0sMTE4OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF9nZXQgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0JylbJ2RlZmF1bHQnXTsKCnZhciBfaW5oZXJpdHMgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMnKVsnZGVmYXVsdCddOwoKdmFyIF9jcmVhdGVDbGFzcyA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MnKVsnZGVmYXVsdCddOwoKdmFyIF9jbGFzc0NhbGxDaGVjayA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrJylbJ2RlZmF1bHQnXTsKCnZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0JylbJ2RlZmF1bHQnXTsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfUmVnaXN0cnlEYXRhTW9kZWwyID0gcmVxdWlyZSgnLi9SZWdpc3RyeURhdGFNb2RlbCcpOwoKdmFyIF9SZWdpc3RyeURhdGFNb2RlbDMgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9SZWdpc3RyeURhdGFNb2RlbDIpOwoKLyoqCiogICBAYXV0aG9yOiBHaWwgRGlhcyAoZ2lsLmRpYXNAdGVjbmljby51bGlzYm9hLnB0KQoqICAgSHlwZXJ0eUluc3RhbmNlIERhdGEgTW9kZWwgdXNlZCB0byBtb2RlbCBpbnN0YW5jZXMgb2YgSHlwZXJ0aWVzIHJ1bm5pbmcgaW4gZGV2aWNlcyBhbmQgc2VydmVycy4KKi8KCnZhciBIeXBlcnR5SW5zdGFuY2UgPSAoZnVuY3Rpb24gKF9SZWdpc3RyeURhdGFNb2RlbCkgewogIF9pbmhlcml0cyhIeXBlcnR5SW5zdGFuY2UsIF9SZWdpc3RyeURhdGFNb2RlbCk7CgogIGZ1bmN0aW9uIEh5cGVydHlJbnN0YW5jZShpZCwgdXJsLCBkZXNjcmlwdG9yLCBoeXBlcnR5VVJMLCB1c2VyLCBndWlkLCBydW50aW1lLCBjb250ZXh0KSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSHlwZXJ0eUluc3RhbmNlKTsKCiAgICBfZ2V0KE9iamVjdC5nZXRQcm90b3R5cGVPZihIeXBlcnR5SW5zdGFuY2UucHJvdG90eXBlKSwgJ2NvbnN0cnVjdG9yJywgdGhpcykuY2FsbCh0aGlzLCBpZCwgdXJsLCBkZXNjcmlwdG9yKTsKICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICBfdGhpcy5faHlwZXJ0eVVSTCA9IGh5cGVydHlVUkw7CiAgICBfdGhpcy5fdXNlciA9IHVzZXI7CiAgICBfdGhpcy5fZ3VpZCA9IGd1aWQ7CiAgICBfdGhpcy5fcnVudGltZSA9IHJ1bnRpbWU7CiAgICBfdGhpcy5fY29udGV4dCA9IGNvbnRleHQ7CiAgfQoKICBfY3JlYXRlQ2xhc3MoSHlwZXJ0eUluc3RhbmNlLCBbewogICAga2V5OiAndXNlcicsCiAgICBzZXQ6IGZ1bmN0aW9uIHNldChpZGVudGl0eSkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICBfdGhpcy51c2VyID0gaWRlbnRpdHk7CiAgICB9LAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHJldHVybiBfdGhpcy5fdXNlcjsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdoeXBlcnR5VVJMJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICByZXR1cm4gX3RoaXMuX2h5cGVydHlVUkw7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gSHlwZXJ0eUluc3RhbmNlOwp9KShfUmVnaXN0cnlEYXRhTW9kZWwzWydkZWZhdWx0J10pOwoKZXhwb3J0c1snZGVmYXVsdCddID0gSHlwZXJ0eUluc3RhbmNlOwptb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCn0seyIuL1JlZ2lzdHJ5RGF0YU1vZGVsIjoxMjAsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIjoxMywiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyI6MTUsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQiOjE3LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiOjE4LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQiOjE5fV0sMTE5OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF9nZXQgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvZ2V0JylbJ2RlZmF1bHQnXTsKCnZhciBfaW5oZXJpdHMgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMnKVsnZGVmYXVsdCddOwoKdmFyIF9jcmVhdGVDbGFzcyA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MnKVsnZGVmYXVsdCddOwoKdmFyIF9jbGFzc0NhbGxDaGVjayA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrJylbJ2RlZmF1bHQnXTsKCnZhciBfUHJvbWlzZSA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlJylbJ2RlZmF1bHQnXTsKCnZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0JylbJ2RlZmF1bHQnXTsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfdXRpbHNFdmVudEVtaXR0ZXIgPSByZXF1aXJlKCcuLi91dGlscy9FdmVudEVtaXR0ZXInKTsKCnZhciBfdXRpbHNFdmVudEVtaXR0ZXIyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfdXRpbHNFdmVudEVtaXR0ZXIpOwoKdmFyIF9BZGRyZXNzQWxsb2NhdGlvbiA9IHJlcXVpcmUoJy4vQWRkcmVzc0FsbG9jYXRpb24nKTsKCnZhciBfQWRkcmVzc0FsbG9jYXRpb24yID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfQWRkcmVzc0FsbG9jYXRpb24pOwoKdmFyIF9IeXBlcnR5SW5zdGFuY2UgPSByZXF1aXJlKCcuL0h5cGVydHlJbnN0YW5jZScpOwoKdmFyIF9IeXBlcnR5SW5zdGFuY2UyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfSHlwZXJ0eUluc3RhbmNlKTsKCnZhciBfSHlwZXJ0eURpc2NvdmVyeSA9IHJlcXVpcmUoJy4vSHlwZXJ0eURpc2NvdmVyeScpOwoKdmFyIF9IeXBlcnR5RGlzY292ZXJ5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX0h5cGVydHlEaXNjb3ZlcnkpOwoKdmFyIF9zZXJ2aWNlRnJhbWV3b3JrID0gcmVxdWlyZSgnc2VydmljZS1mcmFtZXdvcmsnKTsKCnZhciBfdXRpbHNVdGlsc0pzID0gcmVxdWlyZSgnLi4vdXRpbHMvdXRpbHMuanMnKTsKCi8qKgoqIFJ1bnRpbWUgUmVnaXN0cnkgSW50ZXJmYWNlCiovCgp2YXIgUmVnaXN0cnkgPSAoZnVuY3Rpb24gKF9FdmVudEVtaXR0ZXIpIHsKICBfaW5oZXJpdHMoUmVnaXN0cnksIF9FdmVudEVtaXR0ZXIpOwoKICAvKioKICAqIFRvIGluaXRpYWxpc2UgdGhlIFJ1bnRpbWUgUmVnaXN0cnkgd2l0aCB0aGUgUnVudGltZVVSTCB0aGF0IHdpbGwgYmUgdGhlIGJhc2lzIHRvIGRlcml2ZSB0aGUgaW50ZXJuYWwgcnVudGltZSBhZGRyZXNzZXMgd2hlbiBhbGxvY2F0aW5nIGFkZHJlc3NlcyB0byBpbnRlcm5hbCBydW50aW1lIGNvbXBvbmVudC4gSW4gYWRkaXRpb24sIHRoZSBSZWdpc3RyeSBkb21haW4gYmFjay1lbmQgdG8gYmUgdXNlZCB0byByZW1vdGVseSByZWdpc3RlciBSdW50aW1lIGNvbXBvbmVudHMsIGlzIGFsc28gcGFzc2VkIGFzIGlucHV0IHBhcmFtZXRlci4KICAqIEBwYXJhbSAge01lc3NhZ2VCdXN9ICAgICAgICAgIG1zZ2J1cyAgICAgICAgICAgICAgICBtc2didXMKICAqIEBwYXJhbSAge0h5cGVydHlSdW50aW1lVVJMfSAgIHJ1bnRpbWVVUkwgICAgICAgICAgICBydW50aW1lVVJMCiAgKiBAcGFyYW0gIHtBcHBTYW5kYm94fSAgICAgICAgICBhcHBTYW5kYm94ICAgICAgICAgICAgYXBwU2FuZGJveAogICogQHBhcmFtICB7RG9tYWluVVJMfSAgICAgICAgICAgcmVtb3RlUmVnaXN0cnkgICAgICAgIHJlbW90ZVJlZ2lzdHJ5CiAgKi8KCiAgZnVuY3Rpb24gUmVnaXN0cnkocnVudGltZVVSTCwgYXBwU2FuZGJveCwgaWRlbnRpdHlNb2R1bGUsIHJlbW90ZVJlZ2lzdHJ5KSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUmVnaXN0cnkpOwoKICAgIF9nZXQoT2JqZWN0LmdldFByb3RvdHlwZU9mKFJlZ2lzdHJ5LnByb3RvdHlwZSksICdjb25zdHJ1Y3RvcicsIHRoaXMpLmNhbGwodGhpcyk7CgogICAgLy8gaG93IHNvbWUgZnVuY3Rpb25zIHJlY2VpdmUgdGhlIHBhcmFtZXRlcnMgZm9yIGV4YW1wbGU6CiAgICAvLyBuZXcgUmVnaXN0cnkoJ2h5cGVydHktcnVudGltZTovL3NwMS8xMjMnLCBhcHBTYW5kYm94LCBpZE1vZHVsZSwgcmVtb3RlUmVnaXN0cnkpOwogICAgLy8gcmVnaXN0cnkucmVnaXN0ZXJTdHViKHNhbmRib3gsICdzcDEnKTsKICAgIC8vIHJlZ2lzdHJ5LnJlZ2lzdGVySHlwZXJ0eShzYW5kQm94LCAnaHlwZXJ0eS1ydW50aW1lOi8vc3AxLzEyMycpOwogICAgLy8gcmVnaXN0cnkucmVzb2x2ZSgnaHlwZXJ0eS1ydW50aW1lOi8vc3AxLzEyMycpOwoKICAgIGlmICghcnVudGltZVVSTCkgdGhyb3cgbmV3IEVycm9yKCdydW50aW1lVVJMIGlzIG1pc3NpbmcuJyk7CiAgICAvKmlmICghcmVtb3RlUmVnaXN0cnkpIHRocm93IG5ldyBFcnJvcigncmVtb3RlUmVnaXN0cnkgaXMgbWlzc2luZycpOyovCgogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfdGhpcy5yZWdpc3RyeVVSTCA9IHJ1bnRpbWVVUkwgKyAnL3JlZ2lzdHJ5LzEyMyc7CiAgICBfdGhpcy5hcHBTYW5kYm94ID0gYXBwU2FuZGJveDsKICAgIF90aGlzLnJ1bnRpbWVVUkwgPSBydW50aW1lVVJMOwogICAgX3RoaXMucmVtb3RlUmVnaXN0cnkgPSByZW1vdGVSZWdpc3RyeTsKICAgIF90aGlzLmlkTW9kdWxlID0gaWRlbnRpdHlNb2R1bGU7CiAgICBfdGhpcy5pZGVudGlmaWVyID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDAgKyAxKTsKCiAgICBfdGhpcy5oeXBlcnRpZXNMaXN0VG9SZW1vdmUgPSB7fTsKICAgIF90aGlzLmh5cGVydGllc0xpc3QgPSBbXTsKICAgIF90aGlzLnByb3Rvc3R1YnNMaXN0ID0ge307CiAgICBfdGhpcy5zYW5kYm94ZXNMaXN0ID0geyBzdHViOiB7fSwgaHlwZXJ0eToge30sIGRvbWFpbjoge30gfTsKICAgIF90aGlzLnBlcExpc3QgPSB7fTsKCiAgICBfdGhpcy5fZG9tYWluID0gKDAsIF91dGlsc1V0aWxzSnMuZGl2aWRlVVJMKShfdGhpcy5yZWdpc3RyeVVSTCkuZG9tYWluOwogICAgX3RoaXMuc2FuZGJveGVzTGlzdC5kb21haW5bX3RoaXMuX2RvbWFpbl0gPSBhcHBTYW5kYm94OwogICAgdmFyIG1zZ0ZhY3RvcnkgPSBuZXcgX3NlcnZpY2VGcmFtZXdvcmsuTWVzc2FnZUZhY3RvcnkoJ2ZhbHNlJywgJ3t9Jyk7CiAgICBfdGhpcy5tZXNzYWdlRmFjdG9yeSA9IG1zZ0ZhY3Rvcnk7CiAgfQoKICAvKioKICAqIHJldHVybiB0aGUgbWVzc2FnZUJ1cyBpbiB0aGlzIFJlZ2lzdHJ5CiAgKiBAcGFyYW0ge01lc3NhZ2VCdXN9ICAgICAgICAgICBtZXNzYWdlQnVzCiAgKi8KCiAgX2NyZWF0ZUNsYXNzKFJlZ2lzdHJ5LCBbewogICAga2V5OiAnZ2V0QXBwU2FuZGJveCcsCgogICAgLyoqCiAgICAqIFRoaXMgZnVuY3Rpb24gaXMgdXNlZCB0byByZXR1cm4gdGhlIHNhbmRib3ggaW5zdGFuY2Ugd2hlcmUgdGhlIEFwcGxpY2F0aW9uIGlzIGV4ZWN1dGluZy4gSXQgaXMgYXNzdW1lZCB0aGVyZSBpcyBqdXN0IG9uZSBBcHAgcGVyIFJ1bnRpbWUgaW5zdGFuY2UuCiAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEFwcFNhbmRib3goKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHJldHVybiBfdGhpcy5hcHBTYW5kYm94OwogICAgfQoKICAgIC8qKgogICAgKiBGdW5jdGlvbiB0byBxdWVyeSB0aGUgRG9tYWluIHJlZ2lzdHJ5LCB3aXRoIGFuIHVzZXIgZW1haWwuCiAgICAqLwogIH0sIHsKICAgIGtleTogJ2dldFVzZXJIeXBlcnR5JywKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRVc2VySHlwZXJ0eShlbWFpbCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgaWRlbnRpdHlVUkwgPSAndXNlcjovLycgKyBlbWFpbC5zdWJzdHJpbmcoZW1haWwuaW5kZXhPZignQCcpICsgMSwgZW1haWwubGVuZ3RoKSArICcvJyArIGVtYWlsLnN1YnN0cmluZygwLCBlbWFpbC5pbmRleE9mKCdAJykpOwoKICAgICAgdmFyIG1zZyA9IHsKICAgICAgICB0eXBlOiAnUkVBRCcsIGZyb206IF90aGlzLnJlZ2lzdHJ5VVJMLCB0bzogJ2RvbWFpbjovL3JlZ2lzdHJ5LicgKyBfdGhpcy5fZG9tYWluICsgJy8nLCBib2R5OiB7IHJlc291cmNlOiBpZGVudGl0eVVSTCB9CiAgICAgIH07CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgX3RoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobXNnLCBmdW5jdGlvbiAocmVwbHkpIHsKICAgICAgICAgIC8vY29uc29sZS5sb2coJ01FU1NBR0UnLCByZXBseSk7CgogICAgICAgICAgdmFyIGh5cGVydHkgPSB1bmRlZmluZWQ7CiAgICAgICAgICB2YXIgbW9zdFJlY2VudCA9IHVuZGVmaW5lZDsKICAgICAgICAgIHZhciBsYXN0SHlwZXJ0eSA9IHVuZGVmaW5lZDsKICAgICAgICAgIHZhciB2YWx1ZSA9IHJlcGx5LmJvZHkudmFsdWU7CiAgICAgICAgICBjb25zb2xlLmxvZygncmVwbHknLCB2YWx1ZSk7CiAgICAgICAgICBmb3IgKGh5cGVydHkgaW4gdmFsdWUpIHsKICAgICAgICAgICAgaWYgKHZhbHVlW2h5cGVydHldLmxhc3RNb2RpZmllZCAhPT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgaWYgKG1vc3RSZWNlbnQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgICAgbW9zdFJlY2VudCA9IG5ldyBEYXRlKHZhbHVlW2h5cGVydHldLmxhc3RNb2RpZmllZCk7CiAgICAgICAgICAgICAgICBsYXN0SHlwZXJ0eSA9IGh5cGVydHk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHZhciBoeXBlcnR5RGF0ZSA9IG5ldyBEYXRlKHZhbHVlW2h5cGVydHldLmxhc3RNb2RpZmllZCk7CiAgICAgICAgICAgICAgICBpZiAobW9zdFJlY2VudC5nZXRUaW1lKCkgPCBoeXBlcnR5RGF0ZS5nZXRUaW1lKCkpIHsKICAgICAgICAgICAgICAgICAgbW9zdFJlY2VudCA9IGh5cGVydHlEYXRlOwogICAgICAgICAgICAgICAgICBsYXN0SHlwZXJ0eSA9IGh5cGVydHk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICB2YXIgaHlwZXJ0eVVSTCA9IGxhc3RIeXBlcnR5OwoKICAgICAgICAgIGlmIChoeXBlcnR5VVJMID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgcmV0dXJuIHJlamVjdCgnVXNlciBIeXBlcnR5IG5vdCBmb3VuZCcpOwogICAgICAgICAgfQoKICAgICAgICAgIHZhciBpZFBhY2thZ2UgPSB7CiAgICAgICAgICAgIGlkOiBlbWFpbCwKICAgICAgICAgICAgZGVzY3JpcHRvcjogdmFsdWVbaHlwZXJ0eVVSTF0uZGVzY3JpcHRvciwKICAgICAgICAgICAgaHlwZXJ0eVVSTDogaHlwZXJ0eVVSTAogICAgICAgICAgfTsKCiAgICAgICAgICBjb25zb2xlLmxvZygnPT09PiBSZWdpc3Rlckh5cGVydHkgbWVzc2FnZUJ1bmRsZTogJywgaWRQYWNrYWdlKTsKICAgICAgICAgIHJlc29sdmUoaWRQYWNrYWdlKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAqIFRvIHJlZ2lzdGVyIGEgbmV3IEh5cGVydHkgaW4gdGhlIHJ1bnRpbWUgd2hpY2ggcmV0dXJucyB0aGUgSHlwZXJ0eVVSTCBhbGxvY2F0ZWQgdG8gdGhlIG5ldyBIeXBlcnR5LgogICAgKiBAcGFyYW0gIHtTYW5kYm94fSAgICAgICAgICAgICBzYW5kYm94ICAgICAgICAgICAgICAgc2FuZGJveAogICAgKiBAcGFyYW0gIHtIeXBlcnR5Q2F0YWxvZ3VlVVJMfSBIeXBlcnR5Q2F0YWxvZ3VlVVJMICAgZGVzY3JpcHRvcgogICAgKiBAcmV0dXJuIHtIeXBlcnR5VVJMfSAgICAgICAgICBIeXBlcnR5VVJMCiAgICAqLwogIH0sIHsKICAgIGtleTogJ3JlZ2lzdGVySHlwZXJ0eScsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVnaXN0ZXJIeXBlcnR5KHNhbmRib3gsIGRlc2NyaXB0b3IpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIC8vYXNzdW1pbmcgZGVzY3JpcHRvciBjb21lIGluIHRoaXMgZm9ybWF0LCB0aGUgc2VydmljZS1wcm92aWRlci1kb21haW4gdXJsIGlzIHJldHJpZXZlZCBieSBhIHNwbGl0IGluc3RydWN0aW9uCiAgICAgIC8vaHlwZXJ0eS1jYXRhbG9ndWU6Ly88c2VydmljZS1wcm92aWRlci1kb21haW4+LzxjYXRhbG9ndWUtb2JqZWN0LWlkZW50aWZpZXI+CiAgICAgIHZhciBkb21haW5VcmwgPSAoMCwgX3V0aWxzVXRpbHNKcy5kaXZpZGVVUkwpKGRlc2NyaXB0b3IpLmRvbWFpbjsKCiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICBfdGhpcy5pZE1vZHVsZS5sb2dpbldpdGhSUCgnZ29vZ2xlJywgJ21lJykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICB2YXIgZW1haWwgPSByZXN1bHQuZW1haWw7CiAgICAgICAgICB2YXIgaWRlbnRpdHlVUkwgPSAndXNlcjovLycgKyBlbWFpbC5zdWJzdHJpbmcoZW1haWwuaW5kZXhPZignQCcpICsgMSwgZW1haWwubGVuZ3RoKSArICcvJyArIGVtYWlsLnN1YnN0cmluZygwLCBlbWFpbC5pbmRleE9mKCdAJykpOwoKICAgICAgICAgIGlmIChfdGhpcy5fbWVzc2FnZUJ1cyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgIHJlamVjdCgnTWVzc2FnZUJ1cyBub3QgZm91bmQgb24gcmVnaXN0ZXJTdHViJyk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvL2NhbGwgY2hlY2sgaWYgdGhlIHByb3Rvc3R1YiBleGlzdAogICAgICAgICAgICBfdGhpcy5yZXNvbHZlKCdoeXBlcnR5LXJ1bnRpbWU6Ly8nICsgZG9tYWluVXJsKS50aGVuKGZ1bmN0aW9uICgpIHsKCiAgICAgICAgICAgICAgX3RoaXMucmVnaXN0cnlEb21haW4gPSBkb21haW5Vcmw7CgogICAgICAgICAgICAgIC8vIFRPRE86IHNob3VsZCBiZSBpbXBsZW1lbnRlZCB3aXRoIGFkZHJlc3NlcyBwb2xsCiAgICAgICAgICAgICAgLy8gSW4gdGhpcyBjYXNlIHdlIHdpbGwgcmVxdWVzdCBhbmQgcmV0dXJuIG9ubHkgb25lCiAgICAgICAgICAgICAgLy8gYWRkcmVzcwogICAgICAgICAgICAgIHZhciBudW1iZXJPZkFkZHJlc3NlcyA9IDE7CiAgICAgICAgICAgICAgX3RoaXMuYWRkcmVzc0FsbG9jYXRpb24uY3JlYXRlKGRvbWFpblVybCwgbnVtYmVyT2ZBZGRyZXNzZXMpLnRoZW4oZnVuY3Rpb24gKGFkZGVyZXNzTGlzdCkgewoKICAgICAgICAgICAgICAgIGFkZGVyZXNzTGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChhZGRyZXNzKSB7CgogICAgICAgICAgICAgICAgICBfdGhpcy5fbWVzc2FnZUJ1cy5hZGRMaXN0ZW5lcihhZGRyZXNzICsgJy9zdGF0dXMnLCBmdW5jdGlvbiAobXNnKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ01lc3NhZ2UgYWRkTGlzdGVuZXIgZm9yIDogJywgYWRkcmVzcyArICcvc3RhdHVzIC0+ICcgKyBtc2cpOwogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgICAgIHZhciBoeXBlcnR5ID0gbmV3IF9IeXBlcnR5SW5zdGFuY2UyWydkZWZhdWx0J10oX3RoaXMuaWRlbnRpZmllciwgX3RoaXMucmVnaXN0cnlVUkwsIGRlc2NyaXB0b3IsIGFkZGVyZXNzTGlzdFswXSwgaWRlbnRpdHlVUkwpOwoKICAgICAgICAgICAgICAgIF90aGlzLmh5cGVydGllc0xpc3QucHVzaChoeXBlcnR5KTsKICAgICAgICAgICAgICAgIF90aGlzLnNhbmRib3hlc0xpc3QuaHlwZXJ0eVthZGRlcmVzc0xpc3RbMF1dID0gc2FuZGJveDsKCiAgICAgICAgICAgICAgICAvL21lc3NhZ2UgdG8gcmVnaXN0ZXIgdGhlIG5ldyBoeXBlcnR5LCB3aXRoaW4gdGhlIGRvbWFpbiByZWdpc3RyeQogICAgICAgICAgICAgICAgLy9UT0RPIHVuY29tbWVudCBhbmQgcmVtb3ZlIHRoZSBtc2cgdmFyaWFibGUgd2hlbiB0aGUgbWVzc2FnZUZhY3RvcnkgaXMgdXAuCiAgICAgICAgICAgICAgICAvKmxldCBtZXNzYWdlVmFsdWUgPSB7dXNlcjogaWRlbnRpdHlVUkwsICBoeXBlcnR5RGVzY3JpcHRvclVSTDogZGVzY3JpcHRvciwgaHlwZXJ0eVVSTDogYWRkZXJlc3NMaXN0WzBdfTsKICAgICAgICAgICAgICAgICBsZXQgbWVzc2FnZSA9IF90aGlzLm1lc3NhZ2VGYWN0b3J5LmNyZWF0ZUNyZWF0ZU1lc3NhZ2VSZXF1ZXN0KAogICAgICAgICAgICAgICAgICBfdGhpcy5yZWdpc3RyeVVSTCwKICAgICAgICAgICAgICAgICAgJ2RvbWFpbjovL3JlZ2lzdHJ5LicgKyBfdGhpcy5yZWdpc3RyeURvbWFpbiArICcvJywKICAgICAgICAgICAgICAgICAgbWVzc2FnZVZhbHVlLAogICAgICAgICAgICAgICAgICAncG9saWN5JwogICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdtZXNzYWdlZmFjdG9yeScsIG1lc3NhZ2UpOyovCiAgICAgICAgICAgICAgICB2YXIgbXNnID0gewogICAgICAgICAgICAgICAgICB0eXBlOiAnQ1JFQVRFJywgZnJvbTogX3RoaXMucmVnaXN0cnlVUkwsIHRvOiAnZG9tYWluOi8vcmVnaXN0cnkuJyArIF90aGlzLnJlZ2lzdHJ5RG9tYWluICsgJy8nLCBib2R5OiB7IHZhbHVlOiB7IHVzZXI6IGlkZW50aXR5VVJMLCBoeXBlcnR5RGVzY3JpcHRvclVSTDogZGVzY3JpcHRvciwgaHlwZXJ0eVVSTDogYWRkZXJlc3NMaXN0WzBdIH0gfQogICAgICAgICAgICAgICAgfTsKCiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKCdtZXNzYWdlbm9ybWFsJywgbXNnKTsKICAgICAgICAgICAgICAgIF90aGlzLl9tZXNzYWdlQnVzLnBvc3RNZXNzYWdlKG1zZywgZnVuY3Rpb24gKHJlcGx5KSB7CiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCc9PT0+IFJlZ2lzdGVySHlwZXJ0eSBSZXBseTogJywgcmVwbHkpOwogICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgcmVzb2x2ZShhZGRlcmVzc0xpc3RbMF0pOwogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9KVsnY2F0Y2gnXShmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0FkZHJlc3MgUmVhc29uOiAnLCByZWFzb24pOwogICAgICAgICAgICAgIHJlamVjdChyZWFzb24pOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9LCBmdW5jdGlvbiAoZXJyKSB7CiAgICAgICAgICByZWplY3QoJ0ZhaWxlZCB0byBvYnRhaW4gYW4gaWRlbnRpdHknKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAqIFRvIHVucmVnaXN0ZXIgYSBwcmV2aW91c2x5IHJlZ2lzdGVyZWQgSHlwZXJ0eQogICAgKiBAcGFyYW0gIHtIeXBlcnR5VVJMfSAgICAgICAgICBIeXBlcnR5VVJMIHVybCAgICAgICAgdXJsCiAgICAqLwogIH0sIHsKICAgIGtleTogJ3VucmVnaXN0ZXJIeXBlcnR5JywKICAgIHZhbHVlOiBmdW5jdGlvbiB1bnJlZ2lzdGVySHlwZXJ0eSh1cmwpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICB2YXIgZm91bmQgPSBmYWxzZTsKICAgICAgICB2YXIgaW5kZXggPSAwOwoKICAgICAgICBmb3IgKGluZGV4ID0gMDsgaW5kZXggPCBfdGhpcy5oeXBlcnRpZXNMaXN0Lmxlbmd0aDsgaW5kZXgrKykgewogICAgICAgICAgdmFyIGh5cGVydHkgPSBfdGhpcy5oeXBlcnRpZXNMaXN0W2luZGV4XTsKICAgICAgICAgIGlmIChoeXBlcnR5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgaWYgKGh5cGVydHkuaHlwZXJ0eVVSTCA9PT0gdXJsKSB7CiAgICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZm91bmQgPT09IGZhbHNlKSB7CiAgICAgICAgICByZWplY3QoJ0h5cGVydHkgbm90IGZvdW5kJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGRlbGV0ZSBfdGhpcy5oeXBlcnRpZXNMaXN0W2luZGV4XTsKICAgICAgICAgIHJlc29sdmUoJ0h5cGVydHkgc3VjY2Vzc2Z1bGx5IGRlbGV0ZWQnKTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgKiBUbyBkaXNjb3ZlciBwcm90b2NvbCBzdHVicyBhdmFpbGFibGUgaW4gdGhlIHJ1bnRpbWUgZm9yIGEgY2VydGFpbiBkb21haW4uIElmIGF2YWlsYWJsZSwgaXQgcmV0dXJucyB0aGUgcnVudGltZSB1cmwgZm9yIHRoZSBwcm90b2NvbCBzdHViIHRoYXQgY29ubmVjdHMgdG8gdGhlIHJlcXVlc3RlZCBkb21haW4uIFJlcXVpcmVkIGJ5IHRoZSBydW50aW1lIEJVUyB0byByb3V0ZSBtZXNzYWdlcyB0byByZW1vdGUgc2VydmVycyBvciBwZWVycyAoZG8gd2UgbmVlZCBzb21ldGhpbmcgc2ltaWxhciBmb3IgSHlwZXJ0aWVzPykuCiAgICAqIEBwYXJhbSAge0RvbWFpblVSTH0gICAgICAgICAgIERvbWFpblVSTCAgICAgICAgICAgIHVybAogICAgKiBAcmV0dXJuIHtSdW50aW1lVVJMfSAgICAgICAgICAgUnVudGltZVVSTAogICAgKi8KICB9LCB7CiAgICBrZXk6ICdkaXNjb3ZlclByb3Rvc3R1YicsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGlzY292ZXJQcm90b3N0dWIodXJsKSB7CiAgICAgIGlmICghdXJsKSB0aHJvdyBuZXcgRXJyb3IoJ1BhcmFtZXRlciB1cmwgbmVlZGVkJyk7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgdmFyIHJlcXVlc3QgPSBfdGhpcy5wcm90b3N0dWJzTGlzdFt1cmxdOwoKICAgICAgICBpZiAocmVxdWVzdCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICByZWplY3QoJ3JlcXVlc3RVcGRhdGUgY291bGRuXCcgZ2V0IHRoZSBQcm90b3N0dWJVUkwnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmVzb2x2ZShyZXF1ZXN0KTsKICAgICAgICB9CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogVG8gcmVnaXN0ZXIgYSBuZXcgUHJvdG9jb2wgU3R1YiBpbiB0aGUgcnVudGltZSBpbmNsdWRpbmcgYXMgaW5wdXQgcGFyYW1ldGVycyB0aGUgZnVuY3Rpb24gdG8gcG9zdE1lc3NhZ2UsIHRoZSBEb21haW5VUkwgdGhhdCBpcyBjb25uZWN0ZWQgd2l0aCB0aGUgc3R1Yiwgd2hpY2ggcmV0dXJucyB0aGUgUnVudGltZVVSTCBhbGxvY2F0ZWQgdG8gdGhlIG5ldyBQcm90b2NvbFN0dWIuCiAgICAgKiBAcGFyYW0ge1NhbmRib3h9ICAgICAgICBTYW5kYm94CiAgICAgKiBAcGFyYW0gIHtEb21haW5VUkx9ICAgICBEb21haW5VUkwgc2VydmljZSBwcm92aWRlciBkb21haW4KICAgICAqIEByZXR1cm4ge1J1bnRpbWVQcm90b1N0dWJVUkx9CiAgICAgKi8KICB9LCB7CiAgICBrZXk6ICdyZWdpc3RlclN0dWInLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlZ2lzdGVyU3R1YihzYW5kYm94LCBkb21haW5VUkwpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgdmFyIHJ1bnRpbWVQcm90b1N0dWJVUkwgPSB1bmRlZmluZWQ7CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgLy9jaGVjayBpZiBtZXNzYWdlQnVzIGlzIHJlZ2lzdGVyZWQgaW4gcmVnaXN0cnkgb3Igbm90CiAgICAgICAgaWYgKF90aGlzLl9tZXNzYWdlQnVzID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgIHJlamVjdCgnTWVzc2FnZUJ1cyBub3QgZm91bmQgb24gcmVnaXN0ZXJTdHViJyk7CiAgICAgICAgfQoKICAgICAgICAvL1RPRE8gaW1wbGVtZW50IGEgdW5pcXVlIG51bWJlciBmb3IgdGhlIHByb3Rvc3R1YlVSTAogICAgICAgIGlmICghZG9tYWluVVJMLmluZGV4T2YoJ21zZy1ub2RlLicpKSB7CiAgICAgICAgICBkb21haW5VUkwgPSBkb21haW5VUkwuc3Vic3RyaW5nKGRvbWFpblVSTC5pbmRleE9mKCcuJykgKyAxKTsKICAgICAgICB9CgogICAgICAgIHJ1bnRpbWVQcm90b1N0dWJVUkwgPSAnbXNnLW5vZGUuJyArIGRvbWFpblVSTCArICcvcHJvdG9zdHViLycgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMCArIDEpOwoKICAgICAgICAvLyBUT0RPOiBPcHRpbWl6ZSB0aGlzCiAgICAgICAgX3RoaXMucHJvdG9zdHVic0xpc3RbZG9tYWluVVJMXSA9IHJ1bnRpbWVQcm90b1N0dWJVUkw7CiAgICAgICAgX3RoaXMuc2FuZGJveGVzTGlzdC5zdHViW3J1bnRpbWVQcm90b1N0dWJVUkxdID0gc2FuZGJveDsKCiAgICAgICAgLy8gc2FuZGJveC5hZGRMaXN0ZW5lcignKicsIGZ1bmN0aW9uKG1zZykgewogICAgICAgIC8vICAgX3RoaXMuX21lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobXNnKTsKICAgICAgICAvLyB9KTsKCiAgICAgICAgcmVzb2x2ZShydW50aW1lUHJvdG9TdHViVVJMKTsKCiAgICAgICAgX3RoaXMuX21lc3NhZ2VCdXMuYWRkTGlzdGVuZXIocnVudGltZVByb3RvU3R1YlVSTCArICcvc3RhdHVzJywgZnVuY3Rpb24gKG1zZykgewogICAgICAgICAgaWYgKG1zZy5yZXNvdXJjZSA9PT0gbXNnLnRvICsgJy9zdGF0dXMnKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdSdW50aW1lUHJvdG9zdHViVVJML3N0YXR1cyBtZXNzYWdlOiAnLCBtc2cuYm9keS52YWx1ZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgKiBUbyB1bnJlZ2lzdGVyIGEgcHJldmlvdXNseSByZWdpc3RlcmVkIHByb3RvY29sIHN0dWIKICAgICogQHBhcmFtICB7SHlwZXJ0eVJ1bnRpbWVVUkx9ICAgSHlwZXJ0eVJ1bnRpbWVVUkwgICAgIGh5cGVydHlSdW50aW1lVVJMCiAgICAqLwogIH0sIHsKICAgIGtleTogJ3VucmVnaXN0ZXJTdHViJywKICAgIHZhbHVlOiBmdW5jdGlvbiB1bnJlZ2lzdGVyU3R1YihoeXBlcnR5UnVudGltZVVSTCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgcnVudGltZVByb3RvU3R1YlVSTCA9IHVuZGVmaW5lZDsKCiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICB2YXIgZGF0YSA9IF90aGlzLnByb3Rvc3R1YnNMaXN0W2h5cGVydHlSdW50aW1lVVJMXTsKCiAgICAgICAgaWYgKGRhdGEgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmVqZWN0KCdFcnJvciBvbiB1bnJlZ2lzdGVyU3R1YjogSHlwZXJ0eSBub3QgZm91bmQnKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVsZXRlIF90aGlzLnByb3Rvc3R1YnNMaXN0W2h5cGVydHlSdW50aW1lVVJMXTsKICAgICAgICAgIHJlc29sdmUoJ1Byb3Rvc3R1YlVSTCByZW1vdmVkJyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICogVG8gcmVnaXN0ZXIgYSBuZXcgUG9saWN5IEVuZm9yY2VyIGluIHRoZSBydW50aW1lIGluY2x1ZGluZyBhcyBpbnB1dCBwYXJhbWV0ZXJzIHRoZSBmdW5jdGlvbiB0byBwb3N0TWVzc2FnZSwgdGhlIEh5cGVydHlVUkwgYXNzb2NpYXRlZCB3aXRoIHRoZSBQRVAsIHdoaWNoIHJldHVybnMgdGhlIFJ1bnRpbWVVUkwgYWxsb2NhdGVkIHRvIHRoZSBuZXcgUG9saWN5IEVuZm9yY2VyIGNvbXBvbmVudC4KICAgICogQHBhcmFtICB7TWVzc2FnZS5NZXNzYWdlfSBwb3N0TWVzc2FnZSBwb3N0TWVzc2FnZQogICAgKiBAcGFyYW0gIHtIeXBlcnR5VVJMfSAgICAgICAgICBIeXBlcnR5VVJMICAgICAgICAgICAgaHlwZXJ0eQogICAgKiBAcmV0dXJuIHtIeXBlcnR5UnVudGltZVVSTH0gICBIeXBlcnR5UnVudGltZVVSTAogICAgKi8KICB9LCB7CiAgICBrZXk6ICdyZWdpc3RlclBFUCcsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVnaXN0ZXJQRVAocG9zdE1lc3NhZ2UsIGh5cGVydHkpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIC8vVE9ETyBjaGVjayB3aGF0IHBhcmFtZXRlciBpbiB0aGUgcG9zdE1lc3NhZ2UgdGhlIHBlcCBpcy4KICAgICAgICBfdGhpcy5wZXBMaXN0W2h5cGVydHldID0gcG9zdE1lc3NhZ2U7CiAgICAgICAgcmVzb2x2ZSgnUEVQIHJlZ2lzdGVyZWQgd2l0aCBzdWNjZXNzJyk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgKiBUbyB1bnJlZ2lzdGVyIGEgcHJldmlvdXNseSByZWdpc3RlcmVkIHByb3RvY29sIHN0dWIKICAgICogQHBhcmFtICB7SHlwZXJ0eVJ1bnRpbWVVUkx9ICAgSHlwZXJ0eVJ1bnRpbWVVUkwgICAgIEh5cGVydHlSdW50aW1lVVJMCiAgICAqLwogIH0sIHsKICAgIGtleTogJ3VucmVnaXN0ZXJQRVAnLAogICAgdmFsdWU6IGZ1bmN0aW9uIHVucmVnaXN0ZXJQRVAoSHlwZXJ0eVJ1bnRpbWVVUkwpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICB2YXIgcmVzdWx0ID0gX3RoaXMucGVwTGlzdFtIeXBlcnR5UnVudGltZVVSTF07CgogICAgICAgIGlmIChyZXN1bHQgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmVqZWN0KCdQZXAgTm90IGZvdW5kLicpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByZXNvbHZlKCdQRVAgc3VjY2Vzc2Z1bGx5IHJlbW92ZWQuJyk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICogVG8gcmVjZWl2ZSBzdGF0dXMgZXZlbnRzIGZyb20gY29tcG9uZW50cyByZWdpc3RlcmVkIGluIHRoZSBSZWdpc3RyeS4KICAgICogQHBhcmFtICB7TWVzc2FnZS5NZXNzYWdlfSAgICAgTWVzc2FnZS5NZXNzYWdlICAgICAgIGV2ZW50CiAgICAqLwogIH0sIHsKICAgIGtleTogJ29uRXZlbnQnLAogICAgdmFsdWU6IGZ1bmN0aW9uIG9uRXZlbnQoZXZlbnQpIHt9CiAgICAvLyBUT0RPIGJvZHkuLi4KCiAgICAvKioKICAgICogVG8gZGlzY292ZXIgc2FuZGJveGVzIGF2YWlsYWJsZSBpbiB0aGUgcnVudGltZSBmb3IgYSBjZXJ0YWluIGRvbWFpbi4gUmVxdWlyZWQgYnkgdGhlIHJ1bnRpbWUgVUEgdG8gYXZvaWQgbW9yZSB0aGFuIG9uZSBzYW5kYm94IGZvciB0aGUgc2FtZSBkb21haW4uCiAgICAqIEBwYXJhbSAge0RvbWFpblVSTH0gRG9tYWluVVJMIHVybAogICAgKiBAcmV0dXJuIHtSdW50aW1lU2FuZGJveH0gICAgICAgICAgIFJ1bnRpbWVTYW5kYm94CiAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdnZXRTYW5kYm94JywKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTYW5kYm94KHVybCkgewogICAgICBpZiAoIXVybCkgdGhyb3cgbmV3IEVycm9yKCdQYXJhbWV0ZXIgdXJsIG5lZWRlZCcpOwogICAgICBjb25zb2xlLmxvZygnZ2V0U2FuZGJveDogJyArIHVybCk7CgogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgLy9jaGVjayBpZiBpdCBpcyBhIHByb3Rvc3R1YiB1cmwKICAgICAgICB2YXIgcmVxdWVzdCA9IF90aGlzLnNhbmRib3hlc0xpc3Quc3R1Ylt1cmxdOwoKICAgICAgICBpZiAocmVxdWVzdCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAvL2lmIG5vdCwgY2hlY2sgaWYgaXQgaXMgYSBoeXBlcnR5IGluc3RhbmNlIHVybAogICAgICAgICAgcmVxdWVzdCA9IF90aGlzLnNhbmRib3hlc0xpc3QuaHlwZXJ0eVt1cmxdOwoKICAgICAgICAgIGlmIChyZXF1ZXN0ID09PSB1bmRlZmluZWQpIHsKICAgICAgICAgICAgLy9pZiBub3QsIGNoZWNrIGlmIGl0IGlzIGEgc3BlY2lmaWMgdXJsCiAgICAgICAgICAgIHJlcXVlc3QgPSBfdGhpcy5zYW5kYm94ZXNMaXN0LmRvbWFpblt1cmxdOwoKICAgICAgICAgICAgaWYgKHJlcXVlc3QgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICAgIC8vaWYgbm90LCBjaGVjayBpZiB0aGUgZG9tYWluIGluIHRoZSB1cmwsIGlzIHJlZ2lzdHJlZC4KICAgICAgICAgICAgICB2YXIgZGl2aWRlZFVSTCA9ICgwLCBfdXRpbHNVdGlsc0pzLmRpdmlkZVVSTCkodXJsKTsKICAgICAgICAgICAgICByZXF1ZXN0ID0gX3RoaXMuc2FuZGJveGVzTGlzdC5kb21haW5bZGl2aWRlZFVSTC5kb21haW5dOwoKICAgICAgICAgICAgICBpZiAocmVxdWVzdCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICByZWplY3QoJ1NhbmRib3ggbm90IGZvdW5kJyk7CiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHJlc29sdmUocmVxdWVzdCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJlc29sdmUocmVxdWVzdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlc29sdmUocmVxdWVzdCk7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHJlc29sdmUocmVxdWVzdCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICogVG8gdmVyaWZ5IGlmIHNvdXJjZSBpcyB2YWxpZCBhbmQgdG8gcmVzb2x2ZSB0YXJnZXQgcnVudGltZSB1cmwgYWRkcmVzcyBpZiBuZWVkZWQgKGVnIHByb3Rvc3R1YiBydW50aW1lIHVybCBpbiBjYXNlIHRoZSBtZXNzYWdlIGlzIHRvIGJlIGRpc3BhdGNoZWQgdG8gYSByZW1vdGUgZW5kcG9pbnQpLgogICAgKiBAcGFyYW0gIHtVUkwuVVJMfSAgdXJsICAgICAgIHVybAogICAgKiBAcmV0dXJuIHtQcm9taXNlPFVSTC5VUkw+fSAgICAgICAgICAgICAgICAgUHJvbWlzZSA8VVJMLlVSTD4KICAgICovCiAgfSwgewogICAga2V5OiAncmVzb2x2ZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gcmVzb2x2ZSh1cmwpIHsKICAgICAgY29uc29sZS5sb2coJ3Jlc29sdmUgJyArIHVybCk7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvL3NwbGl0IHRoZSB1cmwgdG8gZmluZCB0aGUgZG9tYWluVVJMLiBkZWFscyB3aXRoIHRoZSB1cmwgZm9yIGV4YW1wbGUgYXM6CiAgICAgIC8vImh5cGVydHktcnVudGltZTovL3NwMS9wcm90b3N0dWIvMTIzIiwKICAgICAgdmFyIGRvbWFpblVybCA9ICgwLCBfdXRpbHNVdGlsc0pzLmRpdmlkZVVSTCkodXJsKS5kb21haW47CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgaWYgKCFkb21haW5VcmwuaW5kZXhPZignbXNnLW5vZGUuJykgfHwgIWRvbWFpblVybC5pbmRleE9mKCdyZWdpc3RyeS4nKSkgewogICAgICAgICAgZG9tYWluVXJsID0gZG9tYWluVXJsLnN1YnN0cmluZyhkb21haW5VcmwuaW5kZXhPZignLicpICsgMSk7CiAgICAgICAgfQoKICAgICAgICB2YXIgcmVxdWVzdCA9IF90aGlzLnByb3Rvc3R1YnNMaXN0W2RvbWFpblVybF07CgogICAgICAgIF90aGlzLmFkZEV2ZW50TGlzdGVuZXIoJ3J1bnRpbWU6c3R1YkxvYWRlZCcsIGZ1bmN0aW9uIChkb21haW5VcmwpIHsKICAgICAgICAgIHJlc29sdmUoZG9tYWluVXJsKTsKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHJlcXVlc3QgIT09IHVuZGVmaW5lZCkgewogICAgICAgICAgcmVzb2x2ZShyZXF1ZXN0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgX3RoaXMudHJpZ2dlcigncnVudGltZTpsb2FkU3R1YicsIGRvbWFpblVybCk7CiAgICAgICAgfQogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdtZXNzYWdlQnVzJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICByZXR1cm4gX3RoaXMuX21lc3NhZ2VCdXM7CiAgICB9LAoKICAgIC8qKgogICAgKiBTZXQgdGhlIG1lc3NhZ2VCdXMgaW4gdGhpcyBSZWdpc3RyeQogICAgKiBAcGFyYW0ge01lc3NhZ2VCdXN9ICAgICAgICAgICBtZXNzYWdlQnVzCiAgICAqLwogICAgc2V0OiBmdW5jdGlvbiBzZXQobWVzc2FnZUJ1cykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICBfdGhpcy5fbWVzc2FnZUJ1cyA9IG1lc3NhZ2VCdXM7CgogICAgICAvLyBJbnN0YWxsIEFkZHJlc3NBbGxvY2F0aW9uCiAgICAgIHZhciBhZGRyZXNzQWxsb2NhdGlvbiA9IG5ldyBfQWRkcmVzc0FsbG9jYXRpb24yWydkZWZhdWx0J10oX3RoaXMucmVnaXN0cnlVUkwsIG1lc3NhZ2VCdXMpOwogICAgICBfdGhpcy5hZGRyZXNzQWxsb2NhdGlvbiA9IGFkZHJlc3NBbGxvY2F0aW9uOwoKICAgICAgdmFyIGh5cGVydHlEaXNjb3ZlcnkgPSBuZXcgX0h5cGVydHlEaXNjb3ZlcnkyWydkZWZhdWx0J10oJ2xvY2FsaG9zdCcsIG1lc3NhZ2VCdXMpOwogICAgICBfdGhpcy5oeXBlcnR5RGlzY292ZXJ5ID0gaHlwZXJ0eURpc2NvdmVyeTsKICAgIH0KICB9XSk7CgogIHJldHVybiBSZWdpc3RyeTsKfSkoX3V0aWxzRXZlbnRFbWl0dGVyMlsnZGVmYXVsdCddKTsKCmV4cG9ydHNbJ2RlZmF1bHQnXSA9IFJlZ2lzdHJ5Owptb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTsKCn0seyIuLi91dGlscy9FdmVudEVtaXR0ZXIiOjEyNiwiLi4vdXRpbHMvdXRpbHMuanMiOjEyNywiLi9BZGRyZXNzQWxsb2NhdGlvbiI6MTE2LCIuL0h5cGVydHlEaXNjb3ZlcnkiOjExNywiLi9IeXBlcnR5SW5zdGFuY2UiOjExOCwiYmFiZWwtcnVudGltZS9jb3JlLWpzL3Byb21pc2UiOjksImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIjoxMywiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyI6MTUsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9nZXQiOjE3LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW5oZXJpdHMiOjE4LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQiOjE5LCJzZXJ2aWNlLWZyYW1ld29yayI6MTA5fV0sMTIwOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLyoqCiogICBAYXV0aG9yOiBHaWwgRGlhcyAoZ2lsLmRpYXNAdGVjbmljby51bGlzYm9hLnB0KQoqICAgUmVnaXN0cnkgRGF0YSBNb2RlbCBpbmNsdWRlcyBhbGwgT2JqZWN0cyB0byBiZSBoYW5kbGVkIGJ5IHRoZSBSZWdpc3RyeSBmdW5jdGlvbmFsaXR5IGluY2x1ZGluZwoqLwoidXNlIHN0cmljdCI7Cgp2YXIgX2NyZWF0ZUNsYXNzID0gcmVxdWlyZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NyZWF0ZS1jbGFzcyIpWyJkZWZhdWx0Il07Cgp2YXIgX2NsYXNzQ2FsbENoZWNrID0gcmVxdWlyZSgiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siKVsiZGVmYXVsdCJdOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICJfX2VzTW9kdWxlIiwgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIFJlZ2lzdHJ5RGF0YU1vZGVsID0gKGZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBSZWdpc3RyeURhdGFNb2RlbChpZCwgdXJsLCBkZXNjcmlwdG9yLCBzdGFydGluZ1RpbWUsIGxhc3RNb2RpZmllZCwgc3RhdHVzLCBzdHVicywgc3R1YnNDb25maWd1cmF0aW9uKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUmVnaXN0cnlEYXRhTW9kZWwpOwoKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgX3RoaXMuX2lkID0gaWQ7CiAgICBfdGhpcy5fdXJsID0gdXJsOwogICAgX3RoaXMuX2Rlc2NyaXB0b3IgPSBkZXNjcmlwdG9yOwogICAgX3RoaXMuX3N0YXJ0aW5nVGltZSA9IHN0YXJ0aW5nVGltZTsKICAgIF90aGlzLl9sYXN0TW9kaWZpZWQgPSBsYXN0TW9kaWZpZWQ7CiAgICBfdGhpcy5fc3RhdHVzID0gc3RhdHVzOwogICAgX3RoaXMuX3N0dWJzID0gc3R1YnM7CiAgICBfdGhpcy5fc3R1YnNDb25maWd1cmF0aW9uID0gc3R1YnNDb25maWd1cmF0aW9uOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFJlZ2lzdHJ5RGF0YU1vZGVsLCBbewogICAga2V5OiAiaWQiLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHJldHVybiBfdGhpcy5faWQ7CiAgICB9CiAgfSwgewogICAga2V5OiAidXJsIiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICByZXR1cm4gX3RoaXMuX3VybDsKICAgIH0KICB9LCB7CiAgICBrZXk6ICJkZXNjcmlwdG9yIiwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICByZXR1cm4gX3RoaXMuX2Rlc2NyaXB0b3I7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gUmVnaXN0cnlEYXRhTW9kZWw7Cn0pKCk7CgpleHBvcnRzWyJkZWZhdWx0Il0gPSBSZWdpc3RyeURhdGFNb2RlbDsKbW9kdWxlLmV4cG9ydHMgPSBleHBvcnRzWyJkZWZhdWx0Il07Cgp9LHsiYmFiZWwtcnVudGltZS9oZWxwZXJzL2NsYXNzLWNhbGwtY2hlY2siOjEzLCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzIjoxNX1dLDEyMTpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBfY3JlYXRlQ2xhc3MgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzJylbJ2RlZmF1bHQnXTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjaycpWydkZWZhdWx0J107Cgp2YXIgX1Byb21pc2UgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZScpWydkZWZhdWx0J107CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX3V0aWxzVXRpbHMgPSByZXF1aXJlKCcuLi91dGlscy91dGlscycpOwoKdmFyIF9zZXJ2aWNlRnJhbWV3b3JrID0gcmVxdWlyZSgnc2VydmljZS1mcmFtZXdvcmsnKTsKCnZhciBSdW50aW1lQ2F0YWxvZ3VlID0gKGZ1bmN0aW9uICgpIHsKICBmdW5jdGlvbiBSdW50aW1lQ2F0YWxvZ3VlKHJ1bnRpbWVGYWN0b3J5KSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgUnVudGltZUNhdGFsb2d1ZSk7CgogICAgLy8gY29uc29sZS5sb2coJ3J1bnRpbWUgY2F0YWxvZ3VlJyk7CiAgICBpZiAoIXJ1bnRpbWVGYWN0b3J5KSB0aHJvdyBFcnJvcignVGhlIGNhdGFsb2d1ZSBuZWVkcyB0aGUgcnVudGltZUZhY3RvcnknKTsKCiAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgX3RoaXMuX2ZhY3RvcnkgPSBuZXcgX3NlcnZpY2VGcmFtZXdvcmsuQ2F0YWxvZ3VlRmFjdG9yeShmYWxzZSwgdW5kZWZpbmVkKTsKCiAgICBfdGhpcy5odHRwUmVxdWVzdCA9IHJ1bnRpbWVGYWN0b3J5LmNyZWF0ZUh0dHBSZXF1ZXN0KCk7CiAgfQoKICBfY3JlYXRlQ2xhc3MoUnVudGltZUNhdGFsb2d1ZSwgW3sKICAgIGtleTogJ2dldEh5cGVydHlSdW50aW1lVVJMJywKCiAgICAvKioKICAgICogR2V0IGh5cGVydHlSdW50aW1lVVJMCiAgICAqLwogICAgdmFsdWU6IGZ1bmN0aW9uIGdldEh5cGVydHlSdW50aW1lVVJMKCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwoKICAgICAgLy8gVE9ETzogY2hlY2sgaWYgdGhpcyBpcyByZWFsIG5lZWRlZDsKICAgICAgcmV0dXJuIF90aGlzLl9oeXBlcnR5UnVudGltZVVSTDsKICAgIH0KCiAgICAvKioKICAgICogR2V0IEh5cGVydHlEZXNjcmlwdG9yCiAgICAqIEBwYXJhbSBoeXBlcnR5VVJMIC0gZS5nLiBteWRvbWFpbi5jb20vLndlbGwta25vd24vaHlwZXJ0eS9NeUh5cGVydHkKICAgICogQHJldHVybnMge1Byb21pc2V9CiAgICAqLwogIH0sIHsKICAgIGtleTogJ2dldEh5cGVydHlEZXNjcmlwdG9yJywKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRIeXBlcnR5RGVzY3JpcHRvcihoeXBlcnR5VVJMKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvLyBjb25zb2xlLmxvZygiZ2V0SHlwZXJ0eURlc2NyaXB0b3IiLCBoeXBlcnR5VVJMKTsKCiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICB2YXIgZGl2aWRlZFVSTCA9ICgwLCBfdXRpbHNVdGlscy5kaXZpZGVVUkwpKGh5cGVydHlVUkwpOwogICAgICAgIHZhciBkb21haW4gPSBkaXZpZGVkVVJMLmRvbWFpbjsKICAgICAgICB2YXIgaHlwZXJ0eSA9IGRpdmlkZWRVUkwuaWRlbnRpdHk7CgogICAgICAgIGlmICghZG9tYWluKSB7CiAgICAgICAgICBkb21haW4gPSBoeXBlcnR5VVJMOwogICAgICAgIH0KCiAgICAgICAgaWYgKGh5cGVydHkpIHsKICAgICAgICAgIGh5cGVydHkgPSBoeXBlcnR5LnN1YnN0cmluZyhoeXBlcnR5Lmxhc3RJbmRleE9mKCcvJykgKyAxKTsKICAgICAgICB9CgogICAgICAgIF90aGlzLmh0dHBSZXF1ZXN0LmdldCgnLi4vcmVzb3VyY2VzL2Rlc2NyaXB0b3JzL0h5cGVydGllcy5qc29uJykudGhlbihmdW5jdGlvbiAoZGVzY3JpcHRvcikgewogICAgICAgICAgX3RoaXMuSHlwZXJ0aWVzID0gSlNPTi5wYXJzZShkZXNjcmlwdG9yKTsKCiAgICAgICAgICB2YXIgcmVzdWx0ID0gX3RoaXMuSHlwZXJ0aWVzW2h5cGVydHldOwoKICAgICAgICAgIGlmIChyZXN1bHQuZXJyb3IpIHsKICAgICAgICAgICAgLy8gVE9ETyBoYW5kbGUgZXJyb3IgcHJvcGVybHkKICAgICAgICAgICAgcmVqZWN0KHJlc3VsdCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiY3JlYXRpbmcgaHlwZXJ0eSBkZXNjcmlwdG9yIGJhc2VkIG9uOiAiLCByZXN1bHQpOwoKICAgICAgICAgICAgLy8gY3JlYXRlIHRoZSBkZXNjcmlwdG9yCiAgICAgICAgICAgIHZhciBfaHlwZXJ0eSA9IF90aGlzLl9mYWN0b3J5LmNyZWF0ZUh5cGVydHlEZXNjcmlwdG9yT2JqZWN0KHJlc3VsdC5jZ3VpZCwgcmVzdWx0Lm9iamVjdE5hbWUsIHJlc3VsdC5kZXNjcmlwdGlvbiwgcmVzdWx0Lmxhbmd1YWdlLCByZXN1bHQuc291cmNlUGFja2FnZVVSTCwgcmVzdWx0LnR5cGUsIHJlc3VsdC5kYXRhT2JqZWN0cyk7CgogICAgICAgICAgICAvLyBjb25zb2xlLmxvZygiY3JlYXRlZCBoeXBlcnR5IGRlc2NyaXB0b3Igb2JqZWN0OiIsIGh5cGVydHkpOwoKICAgICAgICAgICAgLy8gcGFyc2UgYW5kIGF0dGFjaCBzb3VyY2VQYWNrYWdlCiAgICAgICAgICAgIHZhciBzb3VyY2VQYWNrYWdlID0gcmVzdWx0LnNvdXJjZVBhY2thZ2U7CiAgICAgICAgICAgIGlmIChzb3VyY2VQYWNrYWdlKSB7CiAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coImh5cGVydHkgaGFzIHNvdXJjZVBhY2thZ2U6Iiwgc291cmNlUGFja2FnZSk7CiAgICAgICAgICAgICAgX2h5cGVydHkuc291cmNlUGFja2FnZSA9IF90aGlzLl9jcmVhdGVTb3VyY2VQYWNrYWdlKF90aGlzLl9mYWN0b3J5LCBzb3VyY2VQYWNrYWdlKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc29sZS5sb2coJ2h5cGVydHkgaGFzIHNvdXJjZVBhY2thZ2U6JywgX2h5cGVydHkpOwoKICAgICAgICAgICAgcmVzb2x2ZShfaHlwZXJ0eSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgICogR2V0IFJ1bnRpbWVEZXNjcmlwdG9yCiAgICAgKiBAcGFyYW0gcnVudGltZVVSTCAtIGUuZy4gbXlkb21haW4uY29tLy53ZWxsLWtub3duL3J1bnRpbWUvTXlSdW50aW1lCiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZX0KICAgICAqLwogIH0sIHsKICAgIGtleTogJ2dldFJ1bnRpbWVEZXNjcmlwdG9yJywKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRSdW50aW1lRGVzY3JpcHRvcihydW50aW1lVVJMKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgLy8gcmVxdWVzdCB0aGUganNvbgogICAgICAgIF90aGlzLl9tYWtlRXh0ZXJuYWxSZXF1ZXN0KHJ1bnRpbWVVUkwsIF90aGlzLl9ub2RlSHR0cCwgX3RoaXMuX25vZGVIdHRwcykudGhlbihmdW5jdGlvbiAocmVzdWx0KSB7CiAgICAgICAgICByZXN1bHQgPSBKU09OLnBhcnNlKHJlc3VsdCk7CgogICAgICAgICAgaWYgKHJlc3VsdC5FUlJPUikgewogICAgICAgICAgICAvLyBUT0RPIGhhbmRsZSBlcnJvciBwcm9wZXJseQogICAgICAgICAgICByZWplY3QocmVzdWx0KTsKICAgICAgICAgIH0gZWxzZSB7CgogICAgICAgICAgICAvLyBwYXJzZSBjYXBhYmlsaXRpZXMgZmlyc3QKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICByZXN1bHQuaHlwZXJ0eUNhcGFiaWxpdGllcyA9IEpTT04ucGFyc2UocmVzdWx0Lmh5cGVydHlDYXBhYmlsaXRpZXMpOwogICAgICAgICAgICAgIHJlc3VsdC5wcm90b2NvbENhcGFiaWxpdGllcyA9IEpTT04ucGFyc2UocmVzdWx0LnByb3RvY29sQ2FwYWJpbGl0aWVzKTsKICAgICAgICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgICAgICAgIC8vIGFscmVhZHkganNvbiBvYmplY3QKICAgICAgICAgICAgfQogICAgICAgICAgICBjb25zb2xlLmxvZygnY3JlYXRpbmcgcnVudGltZSBkZXNjcmlwdG9yIGJhc2VkIG9uOiAnLCByZXN1bHQpOwoKICAgICAgICAgICAgLy8gY3JlYXRlIHRoZSBkZXNjcmlwdG9yCiAgICAgICAgICAgIHZhciBydW50aW1lID0gX3RoaXMuX2ZhY3RvcnkuY3JlYXRlSHlwZXJ0eVJ1bnRpbWVEZXNjcmlwdG9yT2JqZWN0KHJlc3VsdC5jZ3VpZCwgcmVzdWx0Lm9iamVjdE5hbWUsIHJlc3VsdC5kZXNjcmlwdGlvbiwgcmVzdWx0Lmxhbmd1YWdlLCByZXN1bHQuc291cmNlUGFja2FnZVVSTCwgcmVzdWx0LnR5cGUgfHwgcmVzdWx0LnJ1bnRpbWVUeXBlLCByZXN1bHQuaHlwZXJ0eUNhcGFiaWxpdGllcywgcmVzdWx0LnByb3RvY29sQ2FwYWJpbGl0aWVzKTsKCiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjcmVhdGVkIHJ1bnRpbWUgZGVzY3JpcHRvciBvYmplY3Q6JywgcnVudGltZSk7CgogICAgICAgICAgICAvLyBwYXJzZSBhbmQgYXR0YWNoIHNvdXJjZVBhY2thZ2UKICAgICAgICAgICAgdmFyIHNvdXJjZVBhY2thZ2UgPSByZXN1bHQuc291cmNlUGFja2FnZTsKICAgICAgICAgICAgaWYgKHNvdXJjZVBhY2thZ2UpIHsKICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygncnVudGltZSBoYXMgc291cmNlUGFja2FnZTonLCBzb3VyY2VQYWNrYWdlKTsKICAgICAgICAgICAgICBydW50aW1lLnNvdXJjZVBhY2thZ2UgPSBfdGhpcy5fY3JlYXRlU291cmNlUGFja2FnZShfdGhpcy5fZmFjdG9yeSwgc291cmNlUGFja2FnZSk7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJlc29sdmUocnVudGltZSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQoKICAgIC8qKgogICAgKiBHZXQgc291cmNlIFBhY2thZ2UgZnJvbSBhIFVSTAogICAgKiBAcGFyYW0gc291cmNlUGFja2FnZVVSTCAtIGUuZy4gbXlkb21haW4uY29tLy53ZWxsLWtub3duL2h5cGVydHkvTXlIeXBlcnR5L3NvdXJjZVBhY2thZ2UKICAgICogQHJldHVybnMge1Byb21pc2V9CiAgICAqLwogIH0sIHsKICAgIGtleTogJ2dldFNvdXJjZVBhY2thZ2VGcm9tVVJMJywKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXRTb3VyY2VQYWNrYWdlRnJvbVVSTChzb3VyY2VQYWNrYWdlVVJMKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvLyBjb25zb2xlLmxvZygiZ2V0dGluZyBzb3VyY2VQYWNrYWdlIGZyb206Iiwgc291cmNlUGFja2FnZVVSTCk7CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgaWYgKHNvdXJjZVBhY2thZ2VVUkwgPT09ICcvc291cmNlUGFja2FnZScpIHsKICAgICAgICAgIHJlamVjdCgnc291cmNlUGFja2FnZSBpcyBhbHJlYWR5IGNvbnRhaW5lZCBpbiBkZXNjcmlwdG9yLCBwbGVhc2UgdXNlIGl0IGRpcmVjdGx5Jyk7CiAgICAgICAgfQoKICAgICAgICBfdGhpcy5fbWFrZUV4dGVybmFsUmVxdWVzdChzb3VyY2VQYWNrYWdlVVJMKS50aGVuKGZ1bmN0aW9uIChyZXN1bHQpIHsKICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCJnb3QgcmF3IHNvdXJjZVBhY2thZ2U6IiwgcmVzdWx0KTsKICAgICAgICAgIGlmIChyZXN1bHQuZXJyb3IpIHsKICAgICAgICAgICAgLy8gVE9ETyBoYW5kbGUgZXJyb3IgcHJvcGVybHkKICAgICAgICAgICAgcmVqZWN0KHJlc3VsdCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByZXN1bHQgPSBKU09OLnBhcnNlKHJlc3VsdCk7CgogICAgICAgICAgICB2YXIgc291cmNlUGFja2FnZSA9IHJlc3VsdC5zb3VyY2VQYWNrYWdlOwogICAgICAgICAgICBpZiAoc291cmNlUGFja2FnZSkgewogICAgICAgICAgICAgIHNvdXJjZVBhY2thZ2UgPSBfdGhpcy5fY3JlYXRlU291cmNlUGFja2FnZShfdGhpcy5fZmFjdG9yeSwgc291cmNlUGFja2FnZSk7CiAgICAgICAgICAgICAgcmVzb2x2ZShzb3VyY2VQYWNrYWdlKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByZWplY3QoJ25vIHNvdXJjZSBwYWNrYWdlJyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9KVsnY2F0Y2gnXShmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICByZWplY3QocmVhc29uKTsKICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CgogICAgLyoqCiAgICAqIEdldCBTdHViRGVzY3JpcHRvcgogICAgKiBAcGFyYW0gc3R1YlVSTCAtIGUuZy4gbXlkb21haW4uY29tLy53ZWxsLWtub3duL3Byb3Rvc3R1Yi9NeVByb3Rvc3R1YgogICAgKiBAcmV0dXJucyB7UHJvbWlzZX0KICAgICovCiAgfSwgewogICAga2V5OiAnZ2V0U3R1YkRlc2NyaXB0b3InLAogICAgdmFsdWU6IGZ1bmN0aW9uIGdldFN0dWJEZXNjcmlwdG9yKHN0dWJVUkwpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIC8vIGNvbnNvbGUubG9nKCJnZXR0aW5nIHN0dWIgZGVzY3JpcHRvciBmcm9tOiAiICsgc3R1YlVSTCk7CiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewoKICAgICAgICB2YXIgZGl2aWRlZFVSTCA9ICgwLCBfdXRpbHNVdGlscy5kaXZpZGVVUkwpKHN0dWJVUkwpOwogICAgICAgIHZhciBkb21haW4gPSBkaXZpZGVkVVJMLmRvbWFpbjsKICAgICAgICB2YXIgcHJvdG9TdHViID0gZGl2aWRlZFVSTC5pZGVudGl0eTsKCiAgICAgICAgaWYgKCFkb21haW4pIHsKICAgICAgICAgIGRvbWFpbiA9IHN0dWJVUkw7CiAgICAgICAgfQoKICAgICAgICBpZiAoIXByb3RvU3R1YikgewogICAgICAgICAgcHJvdG9TdHViID0gJ2RlZmF1bHQnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBwcm90b1N0dWIgPSBwcm90b1N0dWIuc3Vic3RyaW5nKHByb3RvU3R1Yi5sYXN0SW5kZXhPZignLycpICsgMSk7CiAgICAgICAgfQoKICAgICAgICBfdGhpcy5odHRwUmVxdWVzdC5nZXQoJy4uL3Jlc291cmNlcy9kZXNjcmlwdG9ycy9Qcm90b1N0dWJzLmpzb24nKS50aGVuKGZ1bmN0aW9uIChkZXNjcmlwdG9yKSB7CiAgICAgICAgICBfdGhpcy5Qcm90b1N0dWJzID0gSlNPTi5wYXJzZShkZXNjcmlwdG9yKTsKCiAgICAgICAgICB2YXIgcmVzdWx0ID0gX3RoaXMuUHJvdG9TdHVic1twcm90b1N0dWJdOwoKICAgICAgICAgIGlmIChyZXN1bHQuZXJyb3IpIHsKICAgICAgICAgICAgLy8gVE9ETyBoYW5kbGUgZXJyb3IgcHJvcGVybHkKICAgICAgICAgICAgcmVqZWN0KHJlc3VsdCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBjb25zb2xlLmxvZygnY3JlYXRpbmcgc3R1YiBkZXNjcmlwdG9yIGJhc2VkIG9uOiAnLCByZXN1bHQpOwoKICAgICAgICAgICAgLy8gY3JlYXRlIHRoZSBkZXNjcmlwdG9yCiAgICAgICAgICAgIHZhciBzdHViID0gX3RoaXMuX2ZhY3RvcnkuY3JlYXRlUHJvdG9TdHViRGVzY3JpcHRvck9iamVjdChyZXN1bHQuY2d1aWQsIHJlc3VsdC5vYmplY3ROYW1lLCByZXN1bHQuZGVzY3JpcHRpb24sIHJlc3VsdC5sYW5ndWFnZSwgcmVzdWx0LnNvdXJjZVBhY2thZ2VVUkwsIHJlc3VsdC5tZXNzYWdlU2NoZW1hcywgSlNPTi5zdHJpbmdpZnkocmVzdWx0LmNvbmZpZ3VyYXRpb24pLCByZXN1bHQuY29uc3RyYWludHMpOwoKICAgICAgICAgICAgLy8gcGFyc2UgYW5kIGF0dGFjaCBzb3VyY2VQYWNrYWdlCiAgICAgICAgICAgIHZhciBzb3VyY2VQYWNrYWdlID0gcmVzdWx0LnNvdXJjZVBhY2thZ2U7CgogICAgICAgICAgICBpZiAoc291cmNlUGFja2FnZSkgewogICAgICAgICAgICAgIHNvdXJjZVBhY2thZ2UgPSBfdGhpcy5fY3JlYXRlU291cmNlUGFja2FnZShfdGhpcy5fZmFjdG9yeSwgc291cmNlUGFja2FnZSk7CiAgICAgICAgICAgICAgc3R1Yi5zb3VyY2VQYWNrYWdlID0gc291cmNlUGFja2FnZTsKICAgICAgICAgICAgfQogICAgICAgICAgICByZXNvbHZlKHN0dWIpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICogR2V0IERhdGFTY2hlbWFEZXNjcmlwdG9yCiAgICAqIEBwYXJhbSBkYXRhU2NoZW1hVVJMIC0gZS5nLiBteWRvbWFpbi5jb20vLndlbGwta25vd24vZGF0YXNjaGVtYS9NeURhdGFTY2hlbWEKICAgICogQHJldHVybnMge1Byb21pc2V9CiAgICAqLwogIH0sIHsKICAgIGtleTogJ2dldERhdGFTY2hlbWFEZXNjcmlwdG9yJywKICAgIHZhbHVlOiBmdW5jdGlvbiBnZXREYXRhU2NoZW1hRGVzY3JpcHRvcihkYXRhU2NoZW1hVVJMKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgLy8gcmVxdWVzdCB0aGUganNvbgogICAgICAgIGlmIChkYXRhU2NoZW1hVVJMKSB7CiAgICAgICAgICBkYXRhU2NoZW1hVVJMID0gZGF0YVNjaGVtYVVSTC5zdWJzdHJpbmcoZGF0YVNjaGVtYVVSTC5sYXN0SW5kZXhPZignLycpICsgMSk7CiAgICAgICAgfQoKICAgICAgICBfdGhpcy5odHRwUmVxdWVzdC5nZXQoJy4uL3Jlc291cmNlcy9kZXNjcmlwdG9ycy9EYXRhU2NoZW1hcy5qc29uJykudGhlbihmdW5jdGlvbiAoZGVzY3JpcHRvcikgewoKICAgICAgICAgIF90aGlzLkRhdGFTY2hlbWFzID0gSlNPTi5wYXJzZShkZXNjcmlwdG9yKTsKCiAgICAgICAgICB2YXIgcmVzdWx0ID0gX3RoaXMuRGF0YVNjaGVtYXNbZGF0YVNjaGVtYVVSTF07CgogICAgICAgICAgaWYgKHJlc3VsdC5FUlJPUikgewogICAgICAgICAgICAvLyBUT0RPIGhhbmRsZSBlcnJvciBwcm9wZXJseQogICAgICAgICAgICByZWplY3QocmVzdWx0KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdjcmVhdGluZyBkYXRhU2NoZW1hIGJhc2VkIG9uOiAnLCByZXN1bHQpOwoKICAgICAgICAgICAgLy8gRklYTUU6IGFjY2Vzc0NvbnRyb2xQb2xpY3kgZmllbGQgbm90IG5lZWRlZD8KICAgICAgICAgICAgLy8gY3JlYXRlIHRoZSBkZXNjcmlwdG9yCiAgICAgICAgICAgIHZhciBkYXRhU2NoZW1hID0gX3RoaXMuX2ZhY3RvcnkuY3JlYXRlRGF0YU9iamVjdFNjaGVtYShyZXN1bHQuY2d1aWQsIHJlc3VsdC5vYmplY3ROYW1lLCByZXN1bHQuZGVzY3JpcHRpb24sIHJlc3VsdC5sYW5ndWFnZSwgcmVzdWx0LnNvdXJjZVBhY2thZ2VVUkwpOwoKICAgICAgICAgICAgY29uc29sZS5sb2coJ2NyZWF0ZWQgZGF0YVNjaGVtYSBkZXNjcmlwdG9yIG9iamVjdDonLCBkYXRhU2NoZW1hKTsKCiAgICAgICAgICAgIC8vIHBhcnNlIGFuZCBhdHRhY2ggc291cmNlUGFja2FnZQogICAgICAgICAgICB2YXIgc291cmNlUGFja2FnZSA9IHJlc3VsdC5zb3VyY2VQYWNrYWdlOwogICAgICAgICAgICBpZiAoc291cmNlUGFja2FnZSkgewogICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCdkYXRhU2NoZW1hIGhhcyBzb3VyY2VQYWNrYWdlOicsIHNvdXJjZVBhY2thZ2UpOwogICAgICAgICAgICAgIGRhdGFTY2hlbWEuc291cmNlUGFja2FnZSA9IF90aGlzLl9jcmVhdGVTb3VyY2VQYWNrYWdlKF90aGlzLl9mYWN0b3J5LCBzb3VyY2VQYWNrYWdlKTsKICAgICAgICAgICAgICBpZiAodHlwZW9mIGRhdGFTY2hlbWEuc291cmNlUGFja2FnZS5zb3VyY2VDb2RlID09PSAnc3RyaW5nJykgewogICAgICAgICAgICAgICAgZGF0YVNjaGVtYS5zb3VyY2VQYWNrYWdlLnNvdXJjZUNvZGUgPSBKU09OLnBhcnNlKGRhdGFTY2hlbWEuc291cmNlUGFja2FnZS5zb3VyY2VDb2RlKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHJlc29sdmUoZGF0YVNjaGVtYSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH0sIHsKICAgIGtleTogJ19jcmVhdGVTb3VyY2VQYWNrYWdlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfY3JlYXRlU291cmNlUGFja2FnZShmYWN0b3J5LCBzcCkgewogICAgICAvLyBjb25zb2xlLmxvZygiY3JlYXRpbmcgc291cmNlUGFja2FnZS4gZmFjdG9yeToiLCBmYWN0b3J5LCAiLCByYXcgcGFja2FnZToiLCBzcCk7CiAgICAgIHRyeSB7CiAgICAgICAgc3AgPSBKU09OLnBhcnNlKHNwKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIGNvbnNvbGUubG9nKCdwYXJzaW5nIHNvdXJjZVBhY2thZ2UgZmFpbGVkLiBhbHJlYWR5IHBhcnNlZD8gLT4gJywgc3ApOwogICAgICB9CgogICAgICAvLyBjaGVjayBlbmNvZGluZwogICAgICBpZiAoc3AuZW5jb2RpbmcgPT09ICdiYXNlNjQnKSB7CiAgICAgICAgc3Auc291cmNlQ29kZSA9IGF0b2Ioc3Auc291cmNlQ29kZSk7CiAgICAgICAgc3AuZW5jb2RpbmcgPSAnVVRGLTgnOwogICAgICB9CgogICAgICB2YXIgc291cmNlUGFja2FnZSA9IGZhY3RvcnkuY3JlYXRlU291cmNlUGFja2FnZShzcC5zb3VyY2VDb2RlQ2xhc3NuYW1lLCBzcC5zb3VyY2VDb2RlKTsKCiAgICAgIGlmIChzcC5oYXNPd25Qcm9wZXJ0eSgnZW5jb2RpbmcnKSkgc291cmNlUGFja2FnZS5lbmNvZGluZyA9IHNwLmVuY29kaW5nOwoKICAgICAgaWYgKHNwLmhhc093blByb3BlcnR5KCdzaWduYXR1cmUnKSkgc291cmNlUGFja2FnZS5zaWduYXR1cmUgPSBzcC5zaWduYXR1cmU7CgogICAgICByZXR1cm4gc291cmNlUGFja2FnZTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICdydW50aW1lVVJMJywKICAgIHNldDogZnVuY3Rpb24gc2V0KHJ1bnRpbWVVUkwpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgX3RoaXMuX3J1bnRpbWVVUkwgPSBydW50aW1lVVJMOwogICAgfSwKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICByZXR1cm4gX3RoaXMuX3J1bnRpbWVVUkw7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gUnVudGltZUNhdGFsb2d1ZTsKfSkoKTsKCmV4cG9ydHNbJ2RlZmF1bHQnXSA9IFJ1bnRpbWVDYXRhbG9ndWU7Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7Ii4uL3V0aWxzL3V0aWxzIjoxMjcsImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIjo5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6MTMsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjE1LCJzZXJ2aWNlLWZyYW1ld29yayI6MTA5fV0sMTIyOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLy9NYWluIGRlcGVuZGVjaWVzCid1c2Ugc3RyaWN0JzsKCnZhciBfY3JlYXRlQ2xhc3MgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzJylbJ2RlZmF1bHQnXTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjaycpWydkZWZhdWx0J107Cgp2YXIgX1Byb21pc2UgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZScpWydkZWZhdWx0J107Cgp2YXIgX09iamVjdCRhc3NpZ24gPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2Fzc2lnbicpWydkZWZhdWx0J107Cgp2YXIgX2ludGVyb3BSZXF1aXJlRGVmYXVsdCA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9pbnRlcm9wLXJlcXVpcmUtZGVmYXVsdCcpWydkZWZhdWx0J107CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgX3JlZ2lzdHJ5UmVnaXN0cnkgPSByZXF1aXJlKCcuLi9yZWdpc3RyeS9SZWdpc3RyeScpOwoKdmFyIF9yZWdpc3RyeVJlZ2lzdHJ5MiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3JlZ2lzdHJ5UmVnaXN0cnkpOwoKdmFyIF9pZGVudGl0eUlkZW50aXR5TW9kdWxlID0gcmVxdWlyZSgnLi4vaWRlbnRpdHkvSWRlbnRpdHlNb2R1bGUnKTsKCnZhciBfaWRlbnRpdHlJZGVudGl0eU1vZHVsZTIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9pZGVudGl0eUlkZW50aXR5TW9kdWxlKTsKCnZhciBfcG9saWN5UG9saWN5RW5naW5lID0gcmVxdWlyZSgnLi4vcG9saWN5L1BvbGljeUVuZ2luZScpOwoKdmFyIF9wb2xpY3lQb2xpY3lFbmdpbmUyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfcG9saWN5UG9saWN5RW5naW5lKTsKCnZhciBfYnVzTWVzc2FnZUJ1cyA9IHJlcXVpcmUoJy4uL2J1cy9NZXNzYWdlQnVzJyk7Cgp2YXIgX2J1c01lc3NhZ2VCdXMyID0gX2ludGVyb3BSZXF1aXJlRGVmYXVsdChfYnVzTWVzc2FnZUJ1cyk7CgovLyBpbXBvcnQgR3JhcGhDb25uZWN0b3IgZnJvbSAnLi4vZ3JhcGhjb25uZWN0b3IvR3JhcGhDb25uZWN0b3InOwoKdmFyIF9SdW50aW1lQ2F0YWxvZ3VlTG9jYWwgPSByZXF1aXJlKCcuL1J1bnRpbWVDYXRhbG9ndWUtTG9jYWwnKTsKCnZhciBfUnVudGltZUNhdGFsb2d1ZUxvY2FsMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX1J1bnRpbWVDYXRhbG9ndWVMb2NhbCk7Cgp2YXIgX3N5bmNoZXJTeW5jaGVyTWFuYWdlciA9IHJlcXVpcmUoJy4uL3N5bmNoZXIvU3luY2hlck1hbmFnZXInKTsKCnZhciBfc3luY2hlclN5bmNoZXJNYW5hZ2VyMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3N5bmNoZXJTeW5jaGVyTWFuYWdlcik7Cgp2YXIgX3V0aWxzVXRpbHMgPSByZXF1aXJlKCcuLi91dGlscy91dGlscycpOwoKLyoqCiAqIFJ1bnRpbWUgVXNlciBBZ2VudCBJbnRlcmZhY2Ugd2lsbCBwcm9jZXNzIGFsbCB0aGUgZGVwZW5kZWNpZXMgb2YgdGhlIGNvcmUgcnVudGltZTsKICogQGF1dGhvciBWaXRvciBTaWx2YSBbdml0b3ItdC1zaWx2YUB0ZWxlY29tLnB0XQogKiBAdmVyc2lvbiAwLjIuMAogKgogKiBAcHJvcGVydHkge3J1bnRpbWVGYWN0b3J5fSBydW50aW1lRmFjdG9yeSAtIFNwZWNpZmljIGltcGxlbWVudGF0aW9uIG9mIHNhbmRib3g7CiAqIEBwcm9wZXJ0eSB7UnVudGltZUNhdGFsb2d1ZX0gcnVudGltZUNhdGFsb2d1ZSAtIENhdGFsb2d1ZSBvZiBjb21wb25lbnRzIGNhbiBiZSBpbnN0YWxsZWQ7CiAqIEBwcm9wZXJ0eSB7cnVudGltZVVSTH0gcnVudGltZVVSTCAtIFRoaXMgaWRlbnRpZnkgdGhlIGNvcmUgcnVudGltZSwgc2hvdWxkIGJlIHVuaXF1ZTsKICogQHByb3BlcnR5IHtJZGVudGl0eU1vZHVsZX0gaWRlbnRpdHlNb2R1bGUgLSBJZGVudGl0eSBNb2R1bGU7CiAqIEBwcm9wZXJ0eSB7UG9saWN5RW5naW5lfSBwb2xpY3lFbmdpbmUgLSBQb2xpY3kgRW5naW5lIE1vZHVsZTsKICogQHByb3BlcnR5IHtSZWdpc3RyeX0gcmVnaXN0cnkgLSBSZWdpc3RyeSBNb2R1bGU7CiAqIEBwcm9wZXJ0eSB7TWVzc2FnZUJ1c30gbWVzc2FnZUJ1cyAtIE1lc3NhZ2UgQnVzIGlzIHVzZWQgbGlrZSBhIHJvdXRlciB0byByZWRpcmVjdCB0aGUgbWVzc2FnZXMgZnJvbSBvbmUgY29tcG9uZW50IHRvIG90aGVyKHMpCiAqIEBwcm9wZXJ0eSB7R3JhcGhDb25uZWN0b3J9IGdyYXBoQ29ubmVjdG9yIC0gR3JhcGggQ29ubmVjdG9yIGhhbmRsaW5nIEdVSUQgYW5kIGNvbnRhY3RzCiAqLwoKdmFyIFJ1bnRpbWVVQSA9IChmdW5jdGlvbiAoKSB7CgogIC8qKgogICAqIENyZWF0ZSBhIG5ldyBpbnN0YW5jZSBvZiBSdW50aW1lIFVzZXIgQWdlbnQKICAgKiBAcGFyYW0ge3J1bnRpbWVGYWN0b3J5fSBydW50aW1lRmFjdG9yeSAtIFNwZWNpZmljIGltcGxlbWVudGF0aW9uIGZvciB0aGUgZW52aXJvbm1lbnQgd2hlcmUgdGhlIGNvcmUgcnVudGltZSB3aWxsIHJ1bjsKICAgKiBAcGFyYW0ge2RvbWFpbn0gZG9tYWluVVJMIC0gc3BlY2lmeSB0aGUgZG9tYWluIGJhc2UgZm9yIHRoZSBydW50aW1lOwogICAqLwoKICBmdW5jdGlvbiBSdW50aW1lVUEocnVudGltZUZhY3RvcnksIGRvbWFpbikgewogICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFJ1bnRpbWVVQSk7CgogICAgaWYgKCFydW50aW1lRmFjdG9yeSkgdGhyb3cgbmV3IEVycm9yKCdUaGUgc2FuZGJveCBmYWN0b3J5IGlzIGEgbmVlZGVkIHBhcmFtZXRlcicpOwogICAgaWYgKCFkb21haW4pIHRocm93IG5ldyBFcnJvcignWW91IG5lZWQgdGhlIGRvbWFpbiBvZiBydW50aW1lJyk7CgogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfdGhpcy5ydW50aW1lRmFjdG9yeSA9IHJ1bnRpbWVGYWN0b3J5OwoKICAgIF90aGlzLnJ1bnRpbWVDYXRhbG9ndWUgPSBuZXcgX1J1bnRpbWVDYXRhbG9ndWVMb2NhbDJbJ2RlZmF1bHQnXShydW50aW1lRmFjdG9yeSk7CgogICAgLy8gVE9ETzogcG9zdCBhbmQgcmV0dXJuIHJlZ2lzdHJ5L2h5cGVydHlSdW50aW1lSW5zdGFuY2UgdG8gYW5kIGZyb20gQmFjay1lbmQgU2VydmljZQogICAgLy8gdGhlIHJlc3BvbnNlIGlzIGxpa2U6IHJ1bnRpbWU6Ly9zcDEvMTIzCgogICAgdmFyIHJ1bnRpbWVVUkwgPSAncnVudGltZTovLycgKyBkb21haW4gKyAnLycgKyBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAxMDAwMCArIDEpOwogICAgX3RoaXMucnVudGltZVVSTCA9IHJ1bnRpbWVVUkw7CiAgICBfdGhpcy5kb21haW4gPSBkb21haW47CgogICAgLy8gVE9ETzogY2hlY2sgaWYgcnVudGltZSBjYXRhbG9ndWUgbmVlZCB0aGUgcnVudGltZVVSTDsKICAgIF90aGlzLnJ1bnRpbWVDYXRhbG9ndWUucnVudGltZVVSTCA9IHJ1bnRpbWVVUkw7CgogICAgLy8gSW5zdGFudGlhdGUgdGhlIGlkZW50aXR5IE1vZHVsZQogICAgX3RoaXMuaWRlbnRpdHlNb2R1bGUgPSBuZXcgX2lkZW50aXR5SWRlbnRpdHlNb2R1bGUyWydkZWZhdWx0J10oKTsKCiAgICAvLyBVc2UgdGhlIHNhbmRib3ggZmFjdG9yeSB0byBjcmVhdGUgYW4gQXBwU2FuZGJveDsKICAgIC8vIEluIHRoZSBmdXR1cmUgY2FuIGJlIGRlY2lkZWQgYnkgcG9saWN5RW5naW5lIGlmIHdlIG5lZWQKICAgIC8vIGNyZWF0ZSBhIEFwcFNhbmRib3ggb3Igbm90OwogICAgdmFyIGFwcFNhbmRib3ggPSBydW50aW1lRmFjdG9yeS5jcmVhdGVBcHBTYW5kYm94KCk7CgogICAgLy8gSW5zdGFudGlhdGUgdGhlIFJlZ2lzdHJ5IE1vZHVsZQogICAgX3RoaXMucmVnaXN0cnkgPSBuZXcgX3JlZ2lzdHJ5UmVnaXN0cnkyWydkZWZhdWx0J10ocnVudGltZVVSTCwgYXBwU2FuZGJveCwgX3RoaXMuaWRlbnRpdHlNb2R1bGUpOwoKICAgIC8vIEluc3RhbnRpYXRlIHRoZSBQb2xpY3kgRW5naW5lCiAgICBfdGhpcy5wb2xpY3lFbmdpbmUgPSBuZXcgX3BvbGljeVBvbGljeUVuZ2luZTJbJ2RlZmF1bHQnXShfdGhpcy5pZGVudGl0eU1vZHVsZSwgX3RoaXMucmVnaXN0cnkpOwoKICAgIC8vIEluc3RhbnRpYXRlIHRoZSBNZXNzYWdlIEJ1cwogICAgX3RoaXMubWVzc2FnZUJ1cyA9IG5ldyBfYnVzTWVzc2FnZUJ1czJbJ2RlZmF1bHQnXShfdGhpcy5yZWdpc3RyeSk7CiAgICBfdGhpcy5tZXNzYWdlQnVzLnBpcGVsaW5lLmhhbmRsZXJzID0gWwoKICAgIC8vIFBvbGljeSBtZXNzYWdlIGF1dGhvcmlzZQogICAgZnVuY3Rpb24gKGN0eCkgewogICAgICBfdGhpcy5wb2xpY3lFbmdpbmUuYXV0aG9yaXNlKGN0eC5tc2cpLnRoZW4oZnVuY3Rpb24gKGNoYW5nZWRNZ3MpIHsKICAgICAgICBjdHgubXNnID0gY2hhbmdlZE1nczsKICAgICAgICBjdHgubmV4dCgpOwogICAgICB9KVsnY2F0Y2gnXShmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgY29uc29sZS5lcnJvcihyZWFzb24pOwogICAgICAgIGN0eC5mYWlsKHJlYXNvbik7CiAgICAgIH0pOwogICAgfV07CgogICAgLy8gQWRkIHRvIEFwcCBTYW5kYm94IHRoZSBsaXN0ZW5lcjsKICAgIGFwcFNhbmRib3guYWRkTGlzdGVuZXIoJyonLCBmdW5jdGlvbiAobXNnKSB7CiAgICAgIF90aGlzLm1lc3NhZ2VCdXMucG9zdE1lc3NhZ2UobXNnKTsKICAgIH0pOwoKICAgIC8vIFJlZ2lzdGVyIG1lc3NhZ2VCdXMgb24gUmVnaXN0cnkKICAgIF90aGlzLnJlZ2lzdHJ5Lm1lc3NhZ2VCdXMgPSBfdGhpcy5tZXNzYWdlQnVzOwoKICAgIF90aGlzLnJlZ2lzdHJ5LmFkZEV2ZW50TGlzdGVuZXIoJ3J1bnRpbWU6bG9hZFN0dWInLCBmdW5jdGlvbiAoZG9tYWluVVJMKSB7CgogICAgICBfdGhpcy5sb2FkU3R1Yihkb21haW5VUkwpLnRoZW4oZnVuY3Rpb24gKCkgewogICAgICAgIF90aGlzLnJlZ2lzdHJ5LnRyaWdnZXIoJ3J1bnRpbWU6c3R1YkxvYWRlZCcsIGRvbWFpblVSTCk7CiAgICAgIH0pWydjYXRjaCddKGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICBjb25zb2xlLmVycm9yKHJlYXNvbik7CiAgICAgIH0pOwogICAgfSk7CgogICAgLy8gVXNlIHNhbmRib3ggZmFjdG9yeSB0byB1c2Ugc3BlY2lmaWMgbWV0aG9kcwogICAgLy8gYW5kIHNldCB0aGUgbWVzc2FnZSBidXMgdG8gdGhlIGZhY3RvcnkKICAgIHJ1bnRpbWVGYWN0b3J5Lm1lc3NhZ2VCdXMgPSBfdGhpcy5tZXNzYWdlQnVzOwoKICAgIC8vIEluc3RhbmNpYXRlIHRoZSBTeW5jaGVyTWFuYWdlcjsKICAgIF90aGlzLnN5bmNoZXJNYW5hZ2VyID0gbmV3IF9zeW5jaGVyU3luY2hlck1hbmFnZXIyWydkZWZhdWx0J10oX3RoaXMucnVudGltZVVSTCwgX3RoaXMubWVzc2FnZUJ1cywge30sIF90aGlzLnJ1bnRpbWVDYXRhbG9ndWUpOwoKICAgIC8vIEluc3RhbnRpYXRlIHRoZSBHcmFwaCBDb25uZWN0b3IKICAgIC8vIF90aGlzLmdyYXBoQ29ubmVjdG9yID0gbmV3IEdyYXBoQ29ubmVjdG9yKF90aGlzLnJ1bnRpbWVVUkwsIF90aGlzLm1lc3NhZ2VCdXMpOwogIH0KCiAgLyoqCiAgKiBBY2NvbW9kYXRlIGludGVyb3BlcmFiaWxpdHkgaW4gSDJIIGFuZCBwcm90byBvbiB0aGUgZmx5IGZvciBuZXdseSBkaXNjb3ZlcmVkIGRldmljZXMgaW4gTTJNCiAgKiBAcGFyYW0gIHtDYXRhbG9ndWVEYXRhT2JqZWN0Lkh5cGVydHlEZXNjcmlwdG9yfSAgIGRlc2NyaXB0b3IgICAgZGVzY3JpcHRvcgogICovCgogIF9jcmVhdGVDbGFzcyhSdW50aW1lVUEsIFt7CiAgICBrZXk6ICdkaXNjb3ZlckhpcGVydHknLAogICAgdmFsdWU6IGZ1bmN0aW9uIGRpc2NvdmVySGlwZXJ0eShkZXNjcmlwdG9yKSB7fQogICAgLy8gQm9keS4uLgoKICAgIC8qKgogICAgKiBSZWdpc3RlciBIeXBlcnR5IGRlcGxveWVkIGJ5IHRoZSBBcHAgdGhhdCBpcyBwYXNzZWQgYXMgaW5wdXQgcGFyYW1ldGVyLiBUbyBiZSB1c2VkIHdoZW4gQXBwIGFuZCBIeXBlcnRpZXMgYXJlIGZyb20gdGhlIHNhbWUgZG9tYWluIG90aGVyd2lzZSB0aGUgUnVudGltZVVBIHdpbGwgcmFpc2UgYW4gZXhjZXB0aW9uIGFuZCB0aGUgQXBwIGhhcyB0byB1c2UgdGhlIGxvYWRIeXBlcnR5KC4uKSBmdW5jdGlvbi4KICAgICogQHBhcmFtICB7T2JqZWN0fSBPYmplY3QgICAgICAgICAgICAgICAgICAgaHlwZXJ0eUluc3RhbmNlCiAgICAqIEBwYXJhbSAge1VSTC5IeXBlcnR5Q2F0YWxvZ3VlVVJMfSAgICAgICAgIGRlc2NyaXB0b3IgICAgICBkZXNjcmlwdG9yCiAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdyZWdpc3Rlckh5cGVydHknLAogICAgdmFsdWU6IGZ1bmN0aW9uIHJlZ2lzdGVySHlwZXJ0eShoeXBlcnR5SW5zdGFuY2UsIGRlc2NyaXB0b3IpIHt9CiAgICAvLyBCb2R5Li4uCgogICAgLyoqCiAgICAqIERlcGxveSBIeXBlcnR5IGZyb20gQ2F0YWxvZ3VlIFVSTAogICAgKiBAcGFyYW0gIHtVUkwuSHlwZXJ0eUNhdGFsb2d1ZVVSTH0gICAgaHlwZXJ0eSBoeXBlcnR5RGVzY3JpcHRvciB1cmw7CiAgICAqLwoKICB9LCB7CiAgICBrZXk6ICdsb2FkSHlwZXJ0eScsCiAgICB2YWx1ZTogZnVuY3Rpb24gbG9hZEh5cGVydHkoaHlwZXJ0eURlc2NyaXB0b3JVUkwpIHsKCiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICBpZiAoIWh5cGVydHlEZXNjcmlwdG9yVVJMKSB0aHJvdyBuZXcgRXJyb3IoJ0h5cGVydHkgZGVzY3JpcHRvciB1cmwgcGFyYW1ldGVyIGlzIG5lZWRlZCcpOwoKICAgICAgcmV0dXJuIG5ldyBfUHJvbWlzZShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7CgogICAgICAgIHZhciBfaHlwZXJ0eVVSTCA9IHVuZGVmaW5lZDsKICAgICAgICB2YXIgX2h5cGVydHlTYW5kYm94ID0gdW5kZWZpbmVkOwogICAgICAgIHZhciBfaHlwZXJ0eURlc2NyaXB0b3IgPSB1bmRlZmluZWQ7CiAgICAgICAgdmFyIF9oeXBlcnR5U291cmNlUGFja2FnZSA9IHVuZGVmaW5lZDsKCiAgICAgICAgdmFyIGVycm9yUmVhc29uID0gZnVuY3Rpb24gZXJyb3JSZWFzb24ocmVhc29uKSB7CiAgICAgICAgICByZWplY3QocmVhc29uKTsKICAgICAgICB9OwoKICAgICAgICAvLyBHZXQgSHlwZXJ0eSBkZXNjcmlwdG9yCiAgICAgICAgLy8gVE9ETzogdGhlIHJlcXVlc3QgTW9kdWxlIHNob3VsZCBiZSBjaGFuZ2VkLAogICAgICAgIC8vIGJlY2F1c2UgYXQgdGhpcyBtb21lbnQgaXQgaXMgaW5jb21wYXRpYmxlIHdpdGggbm9kZWpzOwogICAgICAgIC8vIFByb2JhYmx5IHdlIG5lZWQgdG8gcGFzcyBhIGZhY3RvcnkgbGlrZSB3ZSBkbyBmb3Igc2FuZGJveGVzOwogICAgICAgIGNvbnNvbGUuaW5mbygnLS0tLS0tLS0tLS0tLS0tLS0tIEh5cGVydHkgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJyk7CiAgICAgICAgY29uc29sZS5pbmZvKCdHZXQgaHlwZXJ0eSBkZXNjcmlwdG9yIGZvciA6JywgaHlwZXJ0eURlc2NyaXB0b3JVUkwpOwogICAgICAgIF90aGlzLnJ1bnRpbWVDYXRhbG9ndWUuZ2V0SHlwZXJ0eURlc2NyaXB0b3IoaHlwZXJ0eURlc2NyaXB0b3JVUkwpLnRoZW4oZnVuY3Rpb24gKGh5cGVydHlEZXNjcmlwdG9yKSB7CiAgICAgICAgICAvLyBhdCB0aGlzIHBvaW50LCB3ZSBoYXZlIGNvbXBsZXRlZCAic3RlcCAyIGFuZCAzIiBhcyBzaG93biBpbiBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1oeXBlcnR5Lm1kCiAgICAgICAgICBjb25zb2xlLmluZm8oJzE6IHJldHVybiBoeXBlcnR5IGRlc2NyaXB0b3InLCBoeXBlcnR5RGVzY3JpcHRvcik7CgogICAgICAgICAgLy8gaHlwZXJ0eSBjb250YWlucyB0aGUgZnVsbCBwYXRoIG9mIHRoZSBjYXRhbG9ndWUgVVJMLCBlLmcuCiAgICAgICAgICAvLyBjYXRhbG9ndWUucmV0aGluay5ldS8ud2VsbC1rbm93bi8uLi4uLi4uLi4uCiAgICAgICAgICBfaHlwZXJ0eURlc2NyaXB0b3IgPSBoeXBlcnR5RGVzY3JpcHRvcjsKCiAgICAgICAgICB2YXIgc291cmNlUGFja2FnZVVSTCA9IGh5cGVydHlEZXNjcmlwdG9yLnNvdXJjZVBhY2thZ2VVUkw7CgogICAgICAgICAgaWYgKHNvdXJjZVBhY2thZ2VVUkwgPT09ICcvc291cmNlUGFja2FnZScpIHsKICAgICAgICAgICAgcmV0dXJuIGh5cGVydHlEZXNjcmlwdG9yLnNvdXJjZVBhY2thZ2U7CiAgICAgICAgICB9CgogICAgICAgICAgLy8gR2V0IHRoZSBoeXBlcnR5IHNvdXJjZSBjb2RlCiAgICAgICAgICByZXR1cm4gX3RoaXMucnVudGltZUNhdGFsb2d1ZS5nZXRTb3VyY2VQYWNrYWdlRnJvbVVSTChzb3VyY2VQYWNrYWdlVVJMKTsKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChzb3VyY2VQYWNrYWdlKSB7CiAgICAgICAgICBjb25zb2xlLmluZm8oJzI6IHJldHVybiBoeXBlcnR5IHNvdXJjZSBjb2RlJyk7CgogICAgICAgICAgLy8gYXQgdGhpcyBwb2ludCwgd2UgaGF2ZSBjb21wbGV0ZWQgInN0ZXAgNCBhbmQgNSIgYXMgc2hvd24gaW4gaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktaHlwZXJ0eS5tZAoKICAgICAgICAgIF9oeXBlcnR5U291cmNlUGFja2FnZSA9IHNvdXJjZVBhY2thZ2U7CgogICAgICAgICAgLy8KICAgICAgICAgIC8vIHN0ZXBzIDYgLS0gOSBhcmUgc2tpcHBlZC4KICAgICAgICAgIC8vIFRPRE86IG9uIHJlbGVhc2Ugb2YgY29yZSAwLjI7CiAgICAgICAgICAvLyBUT0RPOiBQcm9taXNlIHRvIGNoZWNrIHRoZSBwb2xpY3kgZW5naW5lCgogICAgICAgICAgLy8gbW9jay11cCBjb2RlOwogICAgICAgICAgLy8gdGVtcG9yYXJ5IGNvZGUsIG9ubHkKICAgICAgICAgIHZhciBwb2xpY3kgPSB0cnVlOwoKICAgICAgICAgIHJldHVybiBwb2xpY3k7CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAocG9saWN5UmVzdWx0KSB7CiAgICAgICAgICBjb25zb2xlLmluZm8oJzM6IHJldHVybiBwb2xpY3kgZW5naW5lIHJlc3VsdDogJywgcG9saWN5UmVzdWx0KTsKCiAgICAgICAgICAvLyB3ZSBoYXZlIGNvbXBsZXRlZCBzdGVwIDYgdG8gOSBvZiBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1oeXBlcnR5Lm1kIHJpZ2h0IG5vdy4KICAgICAgICAgIC8vCiAgICAgICAgICAvLyBTdGVwcyA2IC0tIDkKICAgICAgICAgIC8vIEFzIGEgcmVzdWx0IG9mIHRoZSBzaXBwZWQgc3RlcHMsIHdlIGtub3cgYXQgdGhpcyBwb2ludCBpZiB3ZSBleGVjdXRlCiAgICAgICAgICAvLyBpblNhbWVTYW5kYm94IG9yIG5vdC4KICAgICAgICAgIC8vCgogICAgICAgICAgLy8gRm9yIHRlc3RpbmcsIGp1c3QgYXNzdW1lIHdlIGV4ZWN1dGUgaW4gc2FtZSBTYW5kYm94LgogICAgICAgICAgdmFyIGluU2FtZVNhbmRib3ggPSB0cnVlOwogICAgICAgICAgdmFyIHNhbmRib3ggPSB1bmRlZmluZWQ7CgogICAgICAgICAgaWYgKGluU2FtZVNhbmRib3gpIHsKCiAgICAgICAgICAgIC8vIHRoaXMgZG9uJ3QgbmVlZCBiZSBhIFByb21pc2U7CiAgICAgICAgICAgIHNhbmRib3ggPSBfdGhpcy5yZWdpc3RyeS5nZXRBcHBTYW5kYm94KCk7CgogICAgICAgICAgICAvLyB3ZSBoYXZlIGNvbXBsZXRlZCBzdGVwIDExIGhlcmUuCiAgICAgICAgICB9IGVsc2UgewoKICAgICAgICAgICAgICB2YXIgZG9tYWluID0gKDAsIF91dGlsc1V0aWxzLmRpdmlkZVVSTCkoaHlwZXJ0eURlc2NyaXB0b3JVUkwpLmRvbWFpbjsKCiAgICAgICAgICAgICAgLy8gZ2V0U2FuZGJveCwgdGhpcyB3aWxsIHJldHVybiBhIHByb21pc2U7CiAgICAgICAgICAgICAgc2FuZGJveCA9IF90aGlzLnJlZ2lzdHJ5LmdldFNhbmRib3goZG9tYWluKTsKICAgICAgICAgICAgfQoKICAgICAgICAgIC8vIHRoaXMgd2lsbCByZXR1cm4gdGhlIHNhbmRib3ggb3Igb25lIHByb21pc2UgdG8gZ2V0U2FuZGJveDsKICAgICAgICAgIHJldHVybiBzYW5kYm94OwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHNhbmRib3gpIHsKICAgICAgICAgIGNvbnNvbGUuaW5mbygnNDogcmV0dXJuIHRoZSBzYW5kYm94Jywgc2FuZGJveCk7CgogICAgICAgICAgLy8gUmV0dXJuIHRoZSBzYW5kYm94IGluZGVwZW50ZWx5IGlmIGl0IHJ1bm5pbmcgaW4gdGhlIHNhbWUgc2FuZGJveCBvciBub3QKICAgICAgICAgIC8vIHdlIGhhdmUgY29tcGxldGVkIHN0ZXAgMTQgaGVyZS4KICAgICAgICAgIHJldHVybiBzYW5kYm94OwogICAgICAgIH0sIGZ1bmN0aW9uIChyZWFzb24pIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJzQuMTogdHJ5IHRvIHJlZ2lzdGVyIGEgbmV3IHNhbmRib3gnLCByZWFzb24pOwoKICAgICAgICAgIC8vIGNoZWNrIGlmIHRoZSBzYW5kYm94IGlzIHJlZ2lzdGVkIGZvciB0aGlzIGh5cGVydHkgZGVzY3JpcHRvciB1cmw7CiAgICAgICAgICAvLyBNYWtlIFN0ZXBzIHh4eCAtLS0geHh4CiAgICAgICAgICAvLyBJbnN0YW50aWF0ZSB0aGUgU2FuZGJveAogICAgICAgICAgdmFyIHNhbmRib3ggPSBfdGhpcy5ydW50aW1lRmFjdG9yeS5jcmVhdGVTYW5kYm94KCk7CgogICAgICAgICAgc2FuZGJveC5hZGRMaXN0ZW5lcignKicsIGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICAgICAgX3RoaXMubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2cpOwogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuIHNhbmRib3g7CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoc2FuZGJveCkgewogICAgICAgICAgY29uc29sZS5pbmZvKCc1OiByZXR1cm4gc2FuZGJveCBhbmQgcmVnaXN0ZXInKTsKCiAgICAgICAgICBfaHlwZXJ0eVNhbmRib3ggPSBzYW5kYm94OwoKICAgICAgICAgIC8vIFJlZ2lzdGVyIGh5cGVydHkKICAgICAgICAgIHJldHVybiBfdGhpcy5yZWdpc3RyeS5yZWdpc3Rlckh5cGVydHkoc2FuZGJveCwgaHlwZXJ0eURlc2NyaXB0b3JVUkwpOwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGh5cGVydHlVUkwpIHsKICAgICAgICAgIGNvbnNvbGUuaW5mbygnNjogSHlwZXJ0eSB1cmwsIGFmdGVyIHJlZ2lzdGVyIGh5cGVydHknLCBoeXBlcnR5VVJMKTsKCiAgICAgICAgICAvLyB3ZSBoYXZlIGNvbXBsZXRlZCBzdGVwIDE2IG9mIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LWh5cGVydHkubWQgcmlnaHQgbm93LgoKICAgICAgICAgIF9oeXBlcnR5VVJMID0gaHlwZXJ0eVVSTDsKCiAgICAgICAgICBjb25zb2xlLmxvZyhfaHlwZXJ0eURlc2NyaXB0b3IpOwoKICAgICAgICAgIC8vIEV4dGVuZCBvcmlnaW5hbCBoeXBlcnR5IGNvbmZpZ3VyYXRpb247CiAgICAgICAgICB2YXIgY29uZmlndXJhdGlvbiA9IHt9OwogICAgICAgICAgaWYgKCEoMCwgX3V0aWxzVXRpbHMuZW1wdHlPYmplY3QpKF9oeXBlcnR5RGVzY3JpcHRvci5jb25maWd1cmF0aW9uKSkgewogICAgICAgICAgICBjb25maWd1cmF0aW9uID0gX09iamVjdCRhc3NpZ24oe30sIEpTT04ucGFyc2UoX2h5cGVydHlEZXNjcmlwdG9yLmNvbmZpZ3VyYXRpb24pKTsKICAgICAgICAgIH0KICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucnVudGltZVVSTCA9IF90aGlzLnJ1bnRpbWVVUkw7CgogICAgICAgICAgLy8gV2Ugd2lsbCBkZXBsb3kgdGhlIGNvbXBvbmVudCAtIHN0ZXAgMTcgb2YgaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktaHlwZXJ0eS5tZCByaWdodCBub3cuCiAgICAgICAgICByZXR1cm4gX2h5cGVydHlTYW5kYm94LmRlcGxveUNvbXBvbmVudChfaHlwZXJ0eVNvdXJjZVBhY2thZ2Uuc291cmNlQ29kZSwgX2h5cGVydHlVUkwsIGNvbmZpZ3VyYXRpb24pOwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGRlcGxveUNvbXBvbmVudFN0YXR1cykgewogICAgICAgICAgY29uc29sZS5pbmZvKCc3OiBEZXBsb3kgY29tcG9uZW50IHN0YXR1cyBmb3IgaHlwZXJ0eTogJywgZGVwbG95Q29tcG9uZW50U3RhdHVzKTsKCiAgICAgICAgICAvLyB3ZSBoYXZlIGNvbXBsZXRlZCBzdGVwIDE5IGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LWh5cGVydHkubWQgcmlnaHQgbm93LgoKICAgICAgICAgIC8vIEFkZCB0aGUgbWVzc2FnZSBidXMgbGlzdGVuZXIgdG8gdGhlIGFwcFNhbmRib3ggb3IgaHlwZXJ0U2FuZGJveDsKICAgICAgICAgIF90aGlzLm1lc3NhZ2VCdXMuYWRkTGlzdGVuZXIoX2h5cGVydHlVUkwsIGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICAgICAgX2h5cGVydHlTYW5kYm94LnBvc3RNZXNzYWdlKG1zZyk7CiAgICAgICAgICB9KTsKCiAgICAgICAgICAvLyB3ZSBoYXZlIGNvbXBsZXRlZCBzdGVwIDIwIG9mIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LWh5cGVydHkubWQgcmlnaHQgbm93LgogICAgICAgICAgdmFyIGh5cGVydHkgPSB7CiAgICAgICAgICAgIHJ1bnRpbWVIeXBlcnR5VVJMOiBfaHlwZXJ0eVVSTCwKICAgICAgICAgICAgc3RhdHVzOiBkZXBsb3lDb21wb25lbnRTdGF0dXMKICAgICAgICAgIH07CgogICAgICAgICAgcmVzb2x2ZShoeXBlcnR5KTsKCiAgICAgICAgICAvLyB3ZSBoYXZlIGNvbXBsZXRlZCBzdGVwIDIxIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LWh5cGVydHkubWQgcmlnaHQgbm93LgogICAgICAgICAgY29uc29sZS5sb2coJy0tLS0tLS0tLS0tLS0tLS0tLSBFTkQgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJyk7CiAgICAgICAgfSlbJ2NhdGNoJ10oZXJyb3JSZWFzb24pOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICogRGVwbG95IFN0dWIgZnJvbSBDYXRhbG9ndWUgVVJMIG9yIGRvbWFpbiB1cmwKICAgICogQHBhcmFtICB7VVJMLlVSTH0gICAgIGRvbWFpbiAgICAgICAgICBkb21haW4KICAgICovCiAgfSwgewogICAga2V5OiAnbG9hZFN0dWInLAogICAgdmFsdWU6IGZ1bmN0aW9uIGxvYWRTdHViKHByb3Rvc3R1YlVSTCkgewoKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmICghcHJvdG9zdHViVVJMKSB0aHJvdyBuZXcgRXJyb3IoJ2RvbWFpbiBwYXJhbWV0ZXIgaXMgbmVlZGVkJyk7CgogICAgICByZXR1cm4gbmV3IF9Qcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKCiAgICAgICAgdmFyIGRvbWFpbiA9ICgwLCBfdXRpbHNVdGlscy5kaXZpZGVVUkwpKHByb3Rvc3R1YlVSTCkuZG9tYWluOwoKICAgICAgICBpZiAoIWRvbWFpbikgewogICAgICAgICAgZG9tYWluID0gcHJvdG9zdHViVVJMOwogICAgICAgIH0KCiAgICAgICAgdmFyIF9zdHViU2FuZGJveCA9IHVuZGVmaW5lZDsKICAgICAgICB2YXIgX3N0dWJEZXNjcmlwdG9yID0gdW5kZWZpbmVkOwogICAgICAgIHZhciBfcnVudGltZVByb3RvU3R1YlVSTCA9IHVuZGVmaW5lZDsKICAgICAgICB2YXIgX3N0dWJTb3VyY2VQYWNrYWdlID0gdW5kZWZpbmVkOwoKICAgICAgICB2YXIgZXJyb3JSZWFzb24gPSBmdW5jdGlvbiBlcnJvclJlYXNvbihyZWFzb24pIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IocmVhc29uKTsKICAgICAgICAgIHJlamVjdChyZWFzb24pOwogICAgICAgIH07CgogICAgICAgIC8vIERpc2NvdmVyIFByb3RvY29sIFN0dWIKICAgICAgICBjb25zb2xlLmluZm8oJy0tLS0tLS0tLS0tLS0tLS0tLS0gUHJvdG9TdHViIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuJyk7CiAgICAgICAgY29uc29sZS5pbmZvKCdEaXNjb3ZlciBvciBDcmVhdGUgYSBuZXcgUHJvdG9TdHViIGZvciBkb21haW46ICcsIGRvbWFpbik7CiAgICAgICAgX3RoaXMucmVnaXN0cnkuZGlzY292ZXJQcm90b3N0dWIoZG9tYWluKS50aGVuKGZ1bmN0aW9uIChkZXNjcmlwdG9yKSB7CiAgICAgICAgICAvLyBJcyByZWdpc3RlZD8KICAgICAgICAgIGNvbnNvbGUuaW5mbygnMS4gUHJvdG8gU3R1YiBEaXNjb3ZlcmVkOiAnLCBkZXNjcmlwdG9yKTsKICAgICAgICAgIF9zdHViRGVzY3JpcHRvciA9IGRlc2NyaXB0b3I7CgogICAgICAgICAgLy8gd2UgaGF2ZSBjb21wbGV0ZWQgc3RlcCAyIGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LXByb3Rvc3R1Yi5tZAoKICAgICAgICAgIHJldHVybiBfc3R1YkRlc2NyaXB0b3I7CiAgICAgICAgfSwgZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgICAgLy8gaXMgbm90IHJlZ2lzdGVkPwogICAgICAgICAgY29uc29sZS5pbmZvKCcxLiBQcm90byBTdHViIG5vdCBmb3VuZDonLCByZWFzb24pOwoKICAgICAgICAgIC8vIHdlIGhhdmUgY29tcGxldGVkIHN0ZXAgMyBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1wcm90b3N0dWIubWQKCiAgICAgICAgICAvLyB3ZSBuZWVkIHRvIGdldCBQcm90b1N0dWIgZGVzY3JpcHRvciBzdGVwIDQgaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kCiAgICAgICAgICByZXR1cm4gX3RoaXMucnVudGltZUNhdGFsb2d1ZS5nZXRTdHViRGVzY3JpcHRvcihwcm90b3N0dWJVUkwpOwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHN0dWJEZXNjcmlwdG9yKSB7CgogICAgICAgICAgY29uc29sZS5pbmZvKCcyLiByZXR1cm4gdGhlIFByb3RvU3R1YiBkZXNjcmlwdG9yOicsIHN0dWJEZXNjcmlwdG9yKTsKCiAgICAgICAgICAvLyB3ZSBoYXZlIGNvbXBsZXRlZCBzdGVwIDUgaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kCgogICAgICAgICAgX3N0dWJEZXNjcmlwdG9yID0gc3R1YkRlc2NyaXB0b3I7CgogICAgICAgICAgdmFyIHNvdXJjZVBhY2thZ2VVUkwgPSBzdHViRGVzY3JpcHRvci5zb3VyY2VQYWNrYWdlVVJMOwoKICAgICAgICAgIGlmIChzb3VyY2VQYWNrYWdlVVJMID09PSAnL3NvdXJjZVBhY2thZ2UnKSB7CiAgICAgICAgICAgIHJldHVybiBzdHViRGVzY3JpcHRvci5zb3VyY2VQYWNrYWdlOwogICAgICAgICAgfQoKICAgICAgICAgIC8vIHdlIG5lZWQgdG8gZ2V0IFByb3RvU3R1YiBTb3VyY2UgY29kZSBmcm9tIGRlc2NyaXB0b3IgLSBzdGVwIDYgaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kCiAgICAgICAgICByZXR1cm4gX3RoaXMucnVudGltZUNhdGFsb2d1ZS5nZXRTb3VyY2VQYWNrYWdlRnJvbVVSTChzb3VyY2VQYWNrYWdlVVJMKTsKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChzdHViU291cmNlUGFja2FnZSkgewogICAgICAgICAgY29uc29sZS5pbmZvKCczLiByZXR1cm4gdGhlIFByb3RvU3R1YiBTb3VyY2UgQ29kZTogJywgc3R1YlNvdXJjZVBhY2thZ2UpOwoKICAgICAgICAgIC8vIHdlIGhhdmUgY29tcGxldGVkIHN0ZXAgNyBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1wcm90b3N0dWIubWQKCiAgICAgICAgICBfc3R1YlNvdXJjZVBhY2thZ2UgPSBzdHViU291cmNlUGFja2FnZTsKCiAgICAgICAgICAvLyBUT0RPOiBDaGVjayBvbiBQRVAgKHBvbGljeSBFbmdpbmUpIGlmIHdlIG5lZWQgdGhlIHNhbmRib3ggYW5kIGNoZWNrIGlmIHRoZSBTYW5kYm94IEZhY3RvcnkgaGF2ZSB0aGUgY29udGV4dCBzYW5kYm94OwogICAgICAgICAgdmFyIHBvbGljeSA9IHRydWU7CiAgICAgICAgICByZXR1cm4gcG9saWN5OwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHBvbGljeSkgewogICAgICAgICAgLy8gdGhpcyB3aWxsIHJldHVybiB0aGUgc2FuZGJveCBvciBvbmUgcHJvbWlzZSB0byBnZXRTYW5kYm94OwogICAgICAgICAgcmV0dXJuIF90aGlzLnJlZ2lzdHJ5LmdldFNhbmRib3goZG9tYWluKTsKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChzdHViU2FuZGJveCkgewoKICAgICAgICAgIGNvbnNvbGUuaW5mbygnNC4gaWYgdGhlIHNhbmRib3ggaXMgcmVnaXN0ZXJlZCB0aGVuIHJldHVybiB0aGUgc2FuZGJveCcsIHN0dWJTYW5kYm94KTsKCiAgICAgICAgICAvLyB3ZSBoYXZlIGNvbXBsZXRlZCBzdGVwIHh4eCBodHRwczovL2dpdGh1Yi5jb20vcmVUSElOSy1wcm9qZWN0L2NvcmUtZnJhbWV3b3JrL2Jsb2IvbWFzdGVyL2RvY3Mvc3BlY3MvcnVudGltZS9keW5hbWljLXZpZXcvYmFzaWNzL2RlcGxveS1wcm90b3N0dWIubWQKCiAgICAgICAgICBfc3R1YlNhbmRib3ggPSBzdHViU2FuZGJveDsKICAgICAgICAgIHJldHVybiBzdHViU2FuZGJveDsKICAgICAgICB9LCBmdW5jdGlvbiAocmVhc29uKSB7CiAgICAgICAgICBjb25zb2xlLmluZm8oJzUuIFNhbmRib3ggd2FzIG5vdCBmb3VuZCwgY3JlYXRpbmcgYSBuZXcgb25lJywgcmVhc29uKTsKCiAgICAgICAgICAvLyBjaGVjayBpZiB0aGUgc2FuZGJveCBpcyByZWdpc3RlZCBmb3IgdGhpcyBzdHViIGRlc2NyaXB0b3IgdXJsOwogICAgICAgICAgLy8gTWFrZSBTdGVwcyB4eHggLS0tIHh4eAogICAgICAgICAgLy8gSW5zdGFudGlhdGUgdGhlIFNhbmRib3gKICAgICAgICAgIHZhciBzYW5kYm94ID0gX3RoaXMucnVudGltZUZhY3RvcnkuY3JlYXRlU2FuZGJveCgpOwogICAgICAgICAgc2FuZGJveC5hZGRMaXN0ZW5lcignKicsIGZ1bmN0aW9uIChtc2cpIHsKICAgICAgICAgICAgX3RoaXMubWVzc2FnZUJ1cy5wb3N0TWVzc2FnZShtc2cpOwogICAgICAgICAgfSk7CgogICAgICAgICAgcmV0dXJuIHNhbmRib3g7CiAgICAgICAgfSkudGhlbihmdW5jdGlvbiAoc2FuZGJveCkgewogICAgICAgICAgY29uc29sZS5pbmZvKCc2LiByZXR1cm4gdGhlIHNhbmRib3ggaW5zdGFuY2UgYW5kIHJlZ2lzdGVyJywgc2FuZGJveCwgJ3RvIGRvbWFpbiAnLCBkb21haW4pOwoKICAgICAgICAgIF9zdHViU2FuZGJveCA9IHNhbmRib3g7CgogICAgICAgICAgLy8gd2UgbmVlZCByZWdpc3RlciBzdHViIG9uIHJlZ2lzdHJ5IC0gc3RlcCB4eHggaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kCiAgICAgICAgICByZXR1cm4gX3RoaXMucmVnaXN0cnkucmVnaXN0ZXJTdHViKF9zdHViU2FuZGJveCwgZG9tYWluKTsKICAgICAgICB9KS50aGVuKGZ1bmN0aW9uIChydW50aW1lUHJvdG9TdHViVVJMKSB7CgogICAgICAgICAgY29uc29sZS5pbmZvKCc3LiByZXR1cm4gdGhlIHJ1bnRpbWUgcHJvdG9zdHViIHVybDogJywgcnVudGltZVByb3RvU3R1YlVSTCk7CgogICAgICAgICAgLy8gd2UgaGF2ZSBjb21wbGV0ZWQgc3RlcCB4eHggaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kCgogICAgICAgICAgX3J1bnRpbWVQcm90b1N0dWJVUkwgPSBydW50aW1lUHJvdG9TdHViVVJMOwoKICAgICAgICAgIGNvbnNvbGUubG9nKF9zdHViRGVzY3JpcHRvcik7CgogICAgICAgICAgLy8gRXh0ZW5kIG9yaWdpbmFsIGh5cGVydHkgY29uZmlndXJhdGlvbjsKICAgICAgICAgIHZhciBjb25maWd1cmF0aW9uID0gX09iamVjdCRhc3NpZ24oe30sIEpTT04ucGFyc2UoX3N0dWJEZXNjcmlwdG9yLmNvbmZpZ3VyYXRpb24pKTsKICAgICAgICAgIGNvbmZpZ3VyYXRpb24ucnVudGltZVVSTCA9IF90aGlzLnJ1bnRpbWVVUkw7CgogICAgICAgICAgLy8gRGVwbG95IENvbXBvbmVudCBzdGVwIHh4eAogICAgICAgICAgcmV0dXJuIF9zdHViU2FuZGJveC5kZXBsb3lDb21wb25lbnQoX3N0dWJTb3VyY2VQYWNrYWdlLnNvdXJjZUNvZGUsIHJ1bnRpbWVQcm90b1N0dWJVUkwsIGNvbmZpZ3VyYXRpb24pOwogICAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKGRlcGxveUNvbXBvbmVudFN0YXR1cykgewogICAgICAgICAgY29uc29sZS5pbmZvKCc4OiByZXR1cm4gZGVwbG95IGNvbXBvbmVudCBmb3Igc2FuZGJveCBzdGF0dXM6ICcsIGRlcGxveUNvbXBvbmVudFN0YXR1cyk7CgogICAgICAgICAgLy8gd2UgaGF2ZSBjb21wbGV0ZWQgc3RlcCB4eHggaHR0cHM6Ly9naXRodWIuY29tL3JlVEhJTkstcHJvamVjdC9jb3JlLWZyYW1ld29yay9ibG9iL21hc3Rlci9kb2NzL3NwZWNzL3J1bnRpbWUvZHluYW1pYy12aWV3L2Jhc2ljcy9kZXBsb3ktcHJvdG9zdHViLm1kCgogICAgICAgICAgLy8gQWRkIHRoZSBtZXNzYWdlIGJ1cyBsaXN0ZW5lcgogICAgICAgICAgX3RoaXMubWVzc2FnZUJ1cy5hZGRMaXN0ZW5lcihfcnVudGltZVByb3RvU3R1YlVSTCwgZnVuY3Rpb24gKG1zZykgewogICAgICAgICAgICBfc3R1YlNhbmRib3gucG9zdE1lc3NhZ2UobXNnKTsKICAgICAgICAgIH0pOwoKICAgICAgICAgIC8vIHdlIGhhdmUgY29tcGxldGVkIHN0ZXAgeHh4IGh0dHBzOi8vZ2l0aHViLmNvbS9yZVRISU5LLXByb2plY3QvY29yZS1mcmFtZXdvcmsvYmxvYi9tYXN0ZXIvZG9jcy9zcGVjcy9ydW50aW1lL2R5bmFtaWMtdmlldy9iYXNpY3MvZGVwbG95LXByb3Rvc3R1Yi5tZAoKICAgICAgICAgIC8vIExvYWQgU3R1YiBmdW5jdGlvbiByZXNvbHZlZCB3aXRoIHN1Y2Nlc3M7CiAgICAgICAgICB2YXIgc3R1YiA9IHsKICAgICAgICAgICAgcnVudGltZVByb3RvU3R1YlVSTDogX3J1bnRpbWVQcm90b1N0dWJVUkwsCiAgICAgICAgICAgIHN0YXR1czogZGVwbG95Q29tcG9uZW50U3RhdHVzCiAgICAgICAgICB9OwoKICAgICAgICAgIHJlc29sdmUoc3R1Yik7CiAgICAgICAgICBjb25zb2xlLmluZm8oJy0tLS0tLS0tLS0tLS0tLS0tLS0gRU5EIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuJyk7CiAgICAgICAgfSlbJ2NhdGNoJ10oZXJyb3JSZWFzb24pOwogICAgICB9KTsKICAgIH0KCiAgICAvKioKICAgICogVXNlZCB0byBjaGVjayBmb3IgdXBkYXRlcyBhYm91dCBjb21wb25lbnRzIGhhbmRsZWQgaW4gdGhlIENhdGFsb2d1ZSBpbmNsdWRpbmcgcHJvdG9jb2wgc3R1YnMgYW5kIEh5cGVydGllcy4gY2hlY2sgcmVsYXRpb25zaGlwIHdpdGggbGlmZWN5Y2xlIG1hbmFnZW1lbnQgcHJvdmlkZWQgYnkgU2VydmljZSBXb3JrZXJzCiAgICAqIEBwYXJhbSAge0NhdGFsb2d1ZVVSTH0gICAgICAgdXJsIHVybAogICAgKi8KICB9LCB7CiAgICBrZXk6ICdjaGVja0ZvclVwZGF0ZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gY2hlY2tGb3JVcGRhdGUodXJsKSB7CiAgICAgIC8vIEJvZHkuLi4KICAgIH0KICB9XSk7CgogIHJldHVybiBSdW50aW1lVUE7Cn0pKCk7CgpleHBvcnRzWydkZWZhdWx0J10gPSBSdW50aW1lVUE7Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7Ii4uL2J1cy9NZXNzYWdlQnVzIjoxMTEsIi4uL2lkZW50aXR5L0lkZW50aXR5TW9kdWxlIjoxMTMsIi4uL3BvbGljeS9Qb2xpY3lFbmdpbmUiOjExNSwiLi4vcmVnaXN0cnkvUmVnaXN0cnkiOjExOSwiLi4vc3luY2hlci9TeW5jaGVyTWFuYWdlciI6MTI1LCIuLi91dGlscy91dGlscyI6MTI3LCIuL1J1bnRpbWVDYXRhbG9ndWUtTG9jYWwiOjEyMSwiYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9hc3NpZ24iOjIsImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIjo5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6MTMsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjE1LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQiOjE5fV0sMTIzOltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF9pbnRlcm9wUmVxdWlyZURlZmF1bHQgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQnKVsnZGVmYXVsdCddOwoKT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgewogIHZhbHVlOiB0cnVlCn0pOwoKdmFyIF9ydW50aW1lUnVudGltZVVBID0gcmVxdWlyZSgnLi9ydW50aW1lL1J1bnRpbWVVQScpOwoKdmFyIF9ydW50aW1lUnVudGltZVVBMiA9IF9pbnRlcm9wUmVxdWlyZURlZmF1bHQoX3J1bnRpbWVSdW50aW1lVUEpOwoKZXhwb3J0c1snZGVmYXVsdCddID0gX3J1bnRpbWVSdW50aW1lVUEyWydkZWZhdWx0J107Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7Ii4vcnVudGltZS9SdW50aW1lVUEiOjEyMiwiYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0IjoxOX1dLDEyNDpbZnVuY3Rpb24ocmVxdWlyZSxtb2R1bGUsZXhwb3J0cyl7Cid1c2Ugc3RyaWN0JzsKCnZhciBfY3JlYXRlQ2xhc3MgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY3JlYXRlLWNsYXNzJylbJ2RlZmF1bHQnXTsKCnZhciBfY2xhc3NDYWxsQ2hlY2sgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjaycpWydkZWZhdWx0J107Cgp2YXIgX1Byb21pc2UgPSByZXF1aXJlKCdiYWJlbC1ydW50aW1lL2NvcmUtanMvcHJvbWlzZScpWydkZWZhdWx0J107CgpPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7CiAgdmFsdWU6IHRydWUKfSk7Cgp2YXIgT2JqZWN0QWxsb2NhdGlvbiA9IChmdW5jdGlvbiAoKSB7CiAgLyogcHJpdmF0ZQogIF91cmw6IFVSTAogIF9idXM6IE1pbmlCdXMKICAqLwoKICAvKioKICAgKiBDcmVhdGUgYW4gT2JqZWN0IEFsbG9jYXRpb24KICAgKiBAcGFyYW0gIHtVUkwuVVJMfSAgICAgIHVybCAtIHVybCBmcm9tIHdobyBpcyBzZW5kaW5nIHRoZSBtZXNzYWdlCiAgICogQHBhcmFtICB7TWluaUJ1c30gICAgICBidXMgLSBNaW5pQnVzIHVzZWQgZm9yIGFkZHJlc3MgYWxsb2NhdGlvbgogICAqLwoKICBmdW5jdGlvbiBPYmplY3RBbGxvY2F0aW9uKHVybCwgYnVzKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgT2JqZWN0QWxsb2NhdGlvbik7CgogICAgdmFyIF90aGlzID0gdGhpczsKCiAgICBfdGhpcy5fdXJsID0gdXJsOwogICAgX3RoaXMuX2J1cyA9IGJ1czsKICB9CgogIC8qKgogICAqIGdldCB0aGUgVVJMIHZhbHVlCiAgICogQHJldHVybiB7c3RyaW5nfSBUaGUgdXJsIHZhbHVlOwogICAqLwoKICBfY3JlYXRlQ2xhc3MoT2JqZWN0QWxsb2NhdGlvbiwgW3sKICAgIGtleTogJ2NyZWF0ZScsCgogICAgLyoqCiAgICAgKiBBc2sgZm9yIGNyZWF0aW9uIG9mIGEgbnVtYmVyIG9mIE9iamVjdCBhZGRyZXNzZXMsIHRvIHRoZSBkb21haW4gbWVzc2FnZSBub2RlLgogICAgICogQHBhcmFtICB7RG9tYWlufSBkb21haW4gLSBEb21haW4gb2YgdGhlIG1lc3NhZ2Ugbm9kZS4KICAgICAqIEBwYXJhbSAge251bWJlcn0gbnVtYmVyIC0gTnVtYmVyIG9mIGFkZHJlc3NlcyB0byByZXF1ZXN0CiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZTxPYmplY3RVUkw+fSAgQSBsaXN0IG9mIE9iamVjdFVSTCdzCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiBjcmVhdGUoZG9tYWluLCBzY2hlbWUsIGNoaWxkcmVuLCBudW1iZXIpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciBtc2cgPSB7CiAgICAgICAgdHlwZTogJ2NyZWF0ZScsIGZyb206IF90aGlzLl91cmwsIHRvOiAnZG9tYWluOi8vbXNnLW5vZGUuJyArIGRvbWFpbiArICcvb2JqZWN0LWFkZHJlc3MtYWxsb2NhdGlvbicsCiAgICAgICAgYm9keTogeyBzY2hlbWU6IHNjaGVtZSwgY2hpbGRyZW5SZXNvdXJjZXM6IGNoaWxkcmVuLCB2YWx1ZTogeyBudW1iZXI6IG51bWJlciB9IH0KICAgICAgfTsKCiAgICAgIHJldHVybiBuZXcgX1Byb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UobXNnLCBmdW5jdGlvbiAocmVwbHkpIHsKICAgICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkgewogICAgICAgICAgICByZXNvbHZlKHJlcGx5LmJvZHkudmFsdWUuYWxsb2NhdGVkKTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJlamVjdChyZXBseS5ib2R5LmRlc2MpOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9KTsKICAgIH0KICB9LCB7CiAgICBrZXk6ICd1cmwnLAogICAgZ2V0OiBmdW5jdGlvbiBnZXQoKSB7CiAgICAgIHJldHVybiB0aGlzLl91cmw7CiAgICB9CiAgfV0pOwoKICByZXR1cm4gT2JqZWN0QWxsb2NhdGlvbjsKfSkoKTsKCmV4cG9ydHNbJ2RlZmF1bHQnXSA9IE9iamVjdEFsbG9jYXRpb247Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7ImJhYmVsLXJ1bnRpbWUvY29yZS1qcy9wcm9taXNlIjo5LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6MTMsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjE1fV0sMTI1OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKJ3VzZSBzdHJpY3QnOwoKdmFyIF9jcmVhdGVDbGFzcyA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MnKVsnZGVmYXVsdCddOwoKdmFyIF9jbGFzc0NhbGxDaGVjayA9IHJlcXVpcmUoJ2JhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrJylbJ2RlZmF1bHQnXTsKCnZhciBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0ID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9oZWxwZXJzL2ludGVyb3AtcmVxdWlyZS1kZWZhdWx0JylbJ2RlZmF1bHQnXTsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBfdXRpbHNVdGlscyA9IHJlcXVpcmUoJy4uL3V0aWxzL3V0aWxzJyk7Cgp2YXIgX09iamVjdEFsbG9jYXRpb24gPSByZXF1aXJlKCcuL09iamVjdEFsbG9jYXRpb24nKTsKCnZhciBfT2JqZWN0QWxsb2NhdGlvbjIgPSBfaW50ZXJvcFJlcXVpcmVEZWZhdWx0KF9PYmplY3RBbGxvY2F0aW9uKTsKCi8qKgogKiBAYXV0aG9yIG1pY2FlbHBlZHJvc2FAZ21haWwuY29tCiAqIENvcmUgU3luY3Jvbml6YXRpb24gc3lzdGVtLgogKi8KCnZhciBTeW5jaGVyTWFuYWdlciA9IChmdW5jdGlvbiAoKSB7CiAgLyogcHJpdmF0ZQogIF91cmw6IFVSTAogIF9idXM6IE1pbmlCdXMKICBfcmVnaXN0cnk6IFJlZ2lzdHJ5CiAgX2FsbG9jYXRvcjogT2JqZWN0QWxsb2NhdGlvbgogICBfc3Vic2NyaXB0aW9uczogeyBPYmplY3RVUkw6IHsgb3duZXI6IEh5cGVydHlVUkwsIHNjaGVtYTogU2NoZW1hLCBzbDogTXNnTGlzdGVuZXIsIGNsOiBbTXNnTGlzdGVuZXJdLCBzdWJzOiBbSHlwZXJ0eVVSTF0gfSB9CiAgKi8KCiAgZnVuY3Rpb24gU3luY2hlck1hbmFnZXIocnVudGltZVVSTCwgYnVzLCByZWdpc3RyeSwgY2F0YWxvZywgYWxsb2NhdG9yKSB7CiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgU3luY2hlck1hbmFnZXIpOwoKICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgX3RoaXMuX2J1cyA9IGJ1czsKICAgIF90aGlzLl9yZWdpc3RyeSA9IHJlZ2lzdHJ5OwogICAgX3RoaXMuX2NhdGFsb2cgPSBjYXRhbG9nOwoKICAgIC8vVE9ETzogdGhlc2Ugc2hvdWxkIGJlIHNhdmVkIGluIHBlcnNpc3RlbmNlIGVuZ2luZT8KICAgIF90aGlzLl91cmwgPSBydW50aW1lVVJMICsgJy9zbSc7CiAgICBfdGhpcy5fb2JqZWN0VVJMID0gcnVudGltZVVSTCArICcvb2JqZWN0LWFsbG9jYXRpb24nOwogICAgX3RoaXMuX3N1YnNjcmlwdGlvbnMgPSB7fTsKCiAgICAvL1RPRE86IHRoaXMgc2hvdWxkIG5vdCBiZSBoYXJkY29kZWQhCiAgICBfdGhpcy5fZG9tYWluID0gKDAsIF91dGlsc1V0aWxzLmRpdmlkZVVSTCkocnVudGltZVVSTCkuZG9tYWluOwoKICAgIGlmIChhbGxvY2F0b3IpIHsKICAgICAgX3RoaXMuX2FsbG9jYXRvciA9IGFsbG9jYXRvcjsKICAgIH0gZWxzZSB7CiAgICAgIF90aGlzLl9hbGxvY2F0b3IgPSBuZXcgX09iamVjdEFsbG9jYXRpb24yWydkZWZhdWx0J10oX3RoaXMuX29iamVjdFVSTCwgYnVzKTsKICAgIH0KCiAgICBidXMuYWRkTGlzdGVuZXIoX3RoaXMuX3VybCwgZnVuY3Rpb24gKG1zZykgewogICAgICBjb25zb2xlLmxvZygnU3luY2hlck1hbmFnZXItUkNWOiAnLCBtc2cpOwogICAgICBzd2l0Y2ggKG1zZy50eXBlKSB7CiAgICAgICAgY2FzZSAnY3JlYXRlJzoKICAgICAgICAgIF90aGlzLl9vbkNyZWF0ZShtc2cpO2JyZWFrOwogICAgICAgIGNhc2UgJ2RlbGV0ZSc6CiAgICAgICAgICBfdGhpcy5fb25EZWxldGUobXNnKTticmVhazsKICAgICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgICAgX3RoaXMuX29uTG9jYWxTdWJzY3JpYmUobXNnKTticmVhazsKICAgICAgICBjYXNlICd1bnN1YnNjcmliZSc6CiAgICAgICAgICBfdGhpcy5fb25Mb2NhbFVuU3Vic2NyaWJlKG1zZyk7YnJlYWs7CiAgICAgIH0KICAgIH0pOwogIH0KCiAgX2NyZWF0ZUNsYXNzKFN5bmNoZXJNYW5hZ2VyLCBbewogICAga2V5OiAnX29uQ3JlYXRlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25DcmVhdGUobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CiAgICAgIHZhciBvd25lciA9IG1zZy5mcm9tOwogICAgICB2YXIgZG9tYWluID0gKDAsIF91dGlsc1V0aWxzLmRpdmlkZVVSTCkobXNnLmZyb20pLmRvbWFpbjsKCiAgICAgIC8vVE9ETzogNS03IGF1dGhvcml6ZU9iamVjdENyZWF0aW9uKG93bmVyLCBvYmogPz8/PyApCiAgICAgIC8vVE9ETzogb3RoZXIgb3B0aW9uYWwgc3RlcHMKCiAgICAgIC8vZ2V0IHNjaGVtYSBmcm9tIGNhdGFsb2d1ZSBhbmQgcGFyc2UgLT4gKHNjaGVtZSwgY2hpbGRyZW4pCiAgICAgIF90aGlzLl9jYXRhbG9nLmdldERhdGFTY2hlbWFEZXNjcmlwdG9yKG1zZy5ib2R5LnNjaGVtYSkudGhlbihmdW5jdGlvbiAoZGVzY3JpcHRvcikgewogICAgICAgIHZhciBwcm9wZXJ0aWVzID0gZGVzY3JpcHRvci5zb3VyY2VQYWNrYWdlLnNvdXJjZUNvZGUucHJvcGVydGllczsKICAgICAgICB2YXIgc2NoZW1lID0gcHJvcGVydGllcy5zY2hlbWUgPyBwcm9wZXJ0aWVzLnNjaGVtZS5jb25zdGFudCA6ICdyZXNvdXJjZSc7CiAgICAgICAgdmFyIGNoaWxkcmVuID0gcHJvcGVydGllcy5jaGlsZHJlbiA/IHByb3BlcnRpZXMuY2hpbGRyZW4uY29uc3RhbnQgOiBbXTsKCiAgICAgICAgX3RoaXMuX2FsbG9jYXRvci5jcmVhdGUoZG9tYWluLCBzY2hlbWUsIGNoaWxkcmVuLCAxKS50aGVuKGZ1bmN0aW9uIChhbGxvY2F0ZWQpIHsKICAgICAgICAgIC8vVE9ETzogZ2V0IGFkZHJlc3MgZnJvbSBhZGRyZXNzIGFsbG9jYXRvciA/CiAgICAgICAgICB2YXIgb2JqVVJMID0gYWxsb2NhdGVkWzBdOwogICAgICAgICAgdmFyIG9ialN1YnNjcmlwdG9yVVJMID0gb2JqVVJMICsgJy9zdWJzY3JpcHRpb24nOwoKICAgICAgICAgIC8vMTUuIGFkZCBzdWJzY3JpcHRpb24gbGlzdGVuZXIKICAgICAgICAgIHZhciBzdWJzY3JpcHRvckxpc3RlbmVyID0gX3RoaXMuX2J1cy5hZGRMaXN0ZW5lcihvYmpTdWJzY3JpcHRvclVSTCwgZnVuY3Rpb24gKG1zZykgewogICAgICAgICAgICBjb25zb2xlLmxvZyhvYmpTdWJzY3JpcHRvclVSTCArICctUkNWOiAnLCBtc2cpOwogICAgICAgICAgICBzd2l0Y2ggKG1zZy50eXBlKSB7CiAgICAgICAgICAgICAgY2FzZSAnc3Vic2NyaWJlJzoKICAgICAgICAgICAgICAgIF90aGlzLl9vblJlbW90ZVN1YnNjcmliZShvYmpVUkwsIG1zZyk7YnJlYWs7CiAgICAgICAgICAgICAgY2FzZSAndW5zdWJzY3JpYmUnOgogICAgICAgICAgICAgICAgX3RoaXMuX29uUmVtb3RlVW5TdWJzY3JpYmUob2JqVVJMLCBtc2cpO2JyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKCiAgICAgICAgICB2YXIgb2JqU3Vic2NyaXB0aW9uID0geyBvd25lcjogb3duZXIsIGNoaWxkcmVuOiBjaGlsZHJlbiwgc2w6IHN1YnNjcmlwdG9yTGlzdGVuZXIsIGNsOiBbXSwgc3ViczogW10gfTsKICAgICAgICAgIF90aGlzLl9zdWJzY3JpcHRpb25zW29ialVSTF0gPSBvYmpTdWJzY3JpcHRpb247CgogICAgICAgICAgLy9hZGQgY2hpbGRyZW4gbGlzdGVuZXJzLi4uCiAgICAgICAgICB2YXIgY2hpbGRCYXNlVVJMID0gb2JqVVJMICsgJy9jaGlsZHJlbi8nOwogICAgICAgICAgY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICAgICAgdmFyIGNoaWxkVVJMID0gY2hpbGRCYXNlVVJMICsgY2hpbGQ7CiAgICAgICAgICAgIHZhciBjaGlsZExpc3RlbmVyID0gX3RoaXMuX2J1cy5hZGRMaXN0ZW5lcihjaGlsZFVSTCwgZnVuY3Rpb24gKG1zZykgewoKICAgICAgICAgICAgICAvL1RPRE86IHdoYXQgdG9kbyBoZXJlPyBQcm9jZXNzIGNoaWxkIGNyZWF0aW9ucz8KICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU3luY2hlck1hbmFnZXItJyArIGNoaWxkVVJMICsgJy1SQ1Y6ICcsIG1zZyk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgb2JqU3Vic2NyaXB0aW9uLmNsLnB1c2goY2hpbGRMaXN0ZW5lcik7CiAgICAgICAgICB9KTsKCiAgICAgICAgICAvL2FsbCBvaywgc2VuZCByZXNwb25zZQogICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG93bmVyLAogICAgICAgICAgICBib2R5OiB7IGNvZGU6IDIwMCwgcmVzb3VyY2U6IG9ialVSTCwgY2hpbGRyZW46IGNoaWxkcmVuIH0KICAgICAgICAgIH0pOwoKICAgICAgICAgIC8vMTkuIHNlbmQgY3JlYXRlIHRvIGFsbCBvYnNlcnZlcnMsIHJlc3BvbnNlcyB3aWxsIGJlIGRlbGl2ZXIgdG8gdGhlIEh5cGVydHkgb3duZXI/CiAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgLy9zY2hlZHVsZSBmb3IgbmV4dCBjeWNsZSBuZWVkZWQsIGJlY2F1c2UgdGhlIFJlcG9ydGVyIHNob3VsZCBiZSBhdmFpbGFibGUuCiAgICAgICAgICAgIG1zZy5ib2R5LmF1dGhvcmlzZS5mb3JFYWNoKGZ1bmN0aW9uIChoeXBlcnR5VVJMKSB7CiAgICAgICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgICB0eXBlOiAnY3JlYXRlJywgZnJvbTogb3duZXIsIHRvOiBoeXBlcnR5VVJMLAogICAgICAgICAgICAgICAgYm9keTogeyBzY2hlbWE6IG1zZy5ib2R5LnNjaGVtYSwgcmVzb3VyY2U6IG9ialVSTCwgdmFsdWU6IG1zZy5ib2R5LnZhbHVlIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfSlbJ2NhdGNoJ10oZnVuY3Rpb24gKHJlYXNvbikgewogICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UoewogICAgICAgICAgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgZnJvbTogbXNnLnRvLCB0bzogb3duZXIsCiAgICAgICAgICBib2R5OiB7IGNvZGU6IDUwMCwgZGVzYzogcmVhc29uIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uRGVsZXRlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25EZWxldGUobXNnKSB7CiAgICAgIHZhciBfdGhpcyA9IHRoaXM7CgogICAgICAvL1RPRE86IHdoZXJlIHRvIGdldCBvYmplY3RVUkwgPwogICAgICB2YXIgb2JqVVJMID0gJzxvYmpVUkw+JzsKCiAgICAgIC8vZGVzdHJveSBhbGwgb2JqVVJMIGxpc3RlbmVycwogICAgICBkZWxldGUgX3RoaXMuX3N1YnNjcmlwdGlvbnNbb2JqVVJMXTsKICAgICAgX3RoaXMuX2J1cy5yZW1vdmVBbGxMaXN0ZW5lcnNPZihvYmpVUkwpOwogICAgICBfdGhpcy5fYnVzLnJlbW92ZUFsbExpc3RlbmVyc09mKG9ialVSTCArICcvc3Vic2NyaXB0aW9uJyk7CgogICAgICAvL1RPRE86IGRlc3Ryb3kgb2JqZWN0IGluIHRoZSByZWdpc3RyeT8KICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25SZW1vdGVTdWJzY3JpYmUnLAogICAgdmFsdWU6IGZ1bmN0aW9uIF9vblJlbW90ZVN1YnNjcmliZShvYmpVUkwsIG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgaHlwZXJ0eVVybCA9IG1zZy5ib2R5LnN1YnNjcmliZXI7CgogICAgICB2YXIgc3Vic2NyaXB0aW9uID0gX3RoaXMuX3N1YnNjcmlwdGlvbnNbb2JqVVJMXTsKICAgICAgdmFyIGNoaWxkQmFzZVVSTCA9IG9ialVSTCArICcvY2hpbGRyZW4vJzsKCiAgICAgIC8vMjcuIHZhbGlkYXRlIGlmIHN1YnNjcmlwdGlvbiBhbHJlYWR5IGV4aXN0cz8KICAgICAgaWYgKHN1YnNjcmlwdGlvbi5zdWJzLmluZGV4T2YoaHlwZXJ0eVVybCkgIT09IC0xKSB7CiAgICAgICAgdmFyIGVycm9yTXNnID0gewogICAgICAgICAgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgZnJvbTogbXNnLnRvLCB0bzogaHlwZXJ0eVVybCwKICAgICAgICAgIGJvZHk6IHsgY29kZTogNTAwLCBkZXNjOiAnU3Vic2NyaXB0aW9uIGZvciAoJyArIG9ialVSTCArICcgOiAnICsgaHlwZXJ0eVVybCArICcpIGFscmVhZHkgZXhpc3RzIScgfQogICAgICAgIH07CgogICAgICAgIF90aGlzLl9idXMucG9zdE1lc3NhZ2UoZXJyb3JNc2cpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8zMS4gYXNrIHRvIHN1YnNjcmliZSB0byBTeW5jaGVyPyAoZGVwZW5kcyBvbiB0aGUgb3BlcmF0aW9uIG1vZGUpCiAgICAgIC8vVE9ETzogZ2V0IG1vZGUgZnJvbSBvYmplY3QhCiAgICAgIHZhciBtb2RlID0gJ3N1Yi9wdWInOwoKICAgICAgaWYgKG1vZGUgPT09ICdzdWIvcHViJykgewogICAgICAgIC8vZm9yd2FyZCB0byBIeXBlcnR5IG93bmVyCiAgICAgICAgdmFyIGZvcndhcmRNc2cgPSB7CiAgICAgICAgICB0eXBlOiAnZm9yd2FyZCcsIGZyb206IF90aGlzLl91cmwsIHRvOiBzdWJzY3JpcHRpb24ub3duZXIsCiAgICAgICAgICBib2R5OiB7IHR5cGU6IG1zZy50eXBlLCBmcm9tOiBoeXBlcnR5VXJsLCB0bzogb2JqVVJMIH0KICAgICAgICB9OwoKICAgICAgICBfdGhpcy5fYnVzLnBvc3RNZXNzYWdlKGZvcndhcmRNc2csIGZ1bmN0aW9uIChyZXBseSkgewogICAgICAgICAgY29uc29sZS5sb2coJ2ZvcndhcmQtcmVwbHk6ICcsIHJlcGx5KTsKICAgICAgICAgIGlmIChyZXBseS5ib2R5LmNvZGUgPT09IDIwMCkgewogICAgICAgICAgICAvL3N1YnNjcmlwdGlvbiBhY2NlcHRlZCAoYWRkIGZvcndhcmQgYW5kIHN1YnNjcmlwdGlvbikKICAgICAgICAgICAgX3RoaXMuX2J1cy5hZGRGb3J3YXJkKG9ialVSTCwgaHlwZXJ0eVVybCk7CgogICAgICAgICAgICAvL2FkZCBmb3J3YXJkIGZvciBjaGlsZHJlbgogICAgICAgICAgICBzdWJzY3JpcHRpb24uY2hpbGRyZW4uZm9yRWFjaChmdW5jdGlvbiAoY2hpbGQpIHsKICAgICAgICAgICAgICBfdGhpcy5fYnVzLmFkZEZvcndhcmQoY2hpbGRCYXNlVVJMICsgY2hpbGQsIGh5cGVydHlVcmwpOwogICAgICAgICAgICB9KTsKCiAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5zdWJzLnB1c2goaHlwZXJ0eVVybCk7CiAgICAgICAgICB9CgogICAgICAgICAgLy9zZW5kIHN1YnNjcmliZS1yZXNwb25zZQogICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgIGlkOiBtc2cuaWQsIHR5cGU6ICdyZXNwb25zZScsIGZyb206IG1zZy50bywgdG86IG1zZy5mcm9tLAogICAgICAgICAgICBib2R5OiByZXBseS5ib2R5CiAgICAgICAgICB9KTsKICAgICAgICB9KTsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogJ19vblJlbW90ZVVuU3Vic2NyaWJlJywKICAgIHZhbHVlOiBmdW5jdGlvbiBfb25SZW1vdGVVblN1YnNjcmliZShvYmpVUkwsIG1zZykgewogICAgICB2YXIgX3RoaXMgPSB0aGlzOwogICAgICB2YXIgaHlwZXJ0eVVybCA9IG1zZy5mcm9tOwoKICAgICAgdmFyIHN1YnMgPSBfdGhpcy5fc3Vic2NyaXB0aW9uc1tvYmpVUkxdLnN1YnM7CiAgICAgIHZhciBpbmRleCA9IHN1YnMuaW5kZXhPZihoeXBlcnR5VXJsKTsKICAgICAgc3Vicy5zcGxpY2UoaW5kZXgsIDEpOwoKICAgICAgLy9UT0RPOiBzZW5kIHVuLXN1YnNjcmliZSBtZXNzYWdlIHRvIFN5bmNoZXI/IChkZXBlbmRzIG9uIHRoZSBvcGVyYXRpb24gbW9kZSkKICAgIH0KICB9LCB7CiAgICBrZXk6ICdfb25Mb2NhbFN1YnNjcmliZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uTG9jYWxTdWJzY3JpYmUobXNnKSB7CiAgICAgIHZhciBfdGhpczIgPSB0aGlzOwoKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIHZhciBkb21haW4gPSAoMCwgX3V0aWxzVXRpbHMuZGl2aWRlVVJMKShtc2cuZnJvbSkuZG9tYWluOwogICAgICB2YXIgb2JqVVJMID0gbXNnLmJvZHkucmVzb3VyY2U7CiAgICAgIHZhciBvYmpVUkxTdWJzY3JpcHRpb24gPSBvYmpVUkwgKyAnL3N1YnNjcmlwdGlvbic7CgogICAgICAvL2dldCBzY2hlbWEgZnJvbSBjYXRhbG9ndWUgYW5kIHBhcnNlIC0+IChjaGlsZHJlbikKICAgICAgX3RoaXMuX2NhdGFsb2cuZ2V0RGF0YVNjaGVtYURlc2NyaXB0b3IobXNnLmJvZHkuc2NoZW1hKS50aGVuKGZ1bmN0aW9uIChkZXNjcmlwdG9yKSB7CiAgICAgICAgdmFyIHByb3BlcnRpZXMgPSBkZXNjcmlwdG9yLnNvdXJjZVBhY2thZ2Uuc291cmNlQ29kZS5wcm9wZXJ0aWVzOwogICAgICAgIHZhciBjaGlsZHJlbiA9IHByb3BlcnRpZXMuY2hpbGRyZW4gPyBwcm9wZXJ0aWVzLmNoaWxkcmVuLmNvbnN0YW50IDogW107CiAgICAgICAgdmFyIGNoaWxkQmFzZVVSTCA9IG9ialVSTCArICcvY2hpbGRyZW4vJzsKCiAgICAgICAgLy8xLiBzdWJzY3JpYmUgbXNnIGZvciB0aGUgZG9tYWluIG5vZGUKICAgICAgICB2YXIgbm9kZVN1YnNjcmliZU1zZyA9IHsKICAgICAgICAgIHR5cGU6ICdzdWJzY3JpYmUnLCBmcm9tOiBfdGhpcy5fdXJsLCB0bzogJ2RvbWFpbjovL21zZy1ub2RlLicgKyBkb21haW4gKyAnL3NtJywKICAgICAgICAgIGJvZHk6IHsgcmVzb3VyY2U6IG1zZy5ib2R5LnJlc291cmNlLCBjaGlsZHJlblJlc291cmNlczogY2hpbGRyZW4gfQogICAgICAgIH07CgogICAgICAgIC8vMi4gc3Vic2NyaWJlIGluIG1zZy1ub2RlCiAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShub2RlU3Vic2NyaWJlTXNnLCBmdW5jdGlvbiAocmVwbHkpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKCdub2RlLXN1YnNjcmliZS1yZXNwb25zZTogJywgcmVwbHkpOwogICAgICAgICAgaWYgKHJlcGx5LmJvZHkuY29kZSA9PT0gMjAwKSB7CiAgICAgICAgICAgIC8vbGlzdGVuZXIgYWNjZXB0ZWQgKGFkZCBmb3J3YXJkIGFuZCBzdWJzY3JpYmUgdG8gcmVwb3J0ZXIpCiAgICAgICAgICAgIF90aGlzLl9idXMuYWRkRm9yd2FyZChvYmpVUkwsIG1zZy5mcm9tKTsKCiAgICAgICAgICAgIC8vYWRkIGZvcndhcmQgZm9yIGNoaWxkcmVuCiAgICAgICAgICAgIGNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7CiAgICAgICAgICAgICAgX3RoaXMuX2J1cy5hZGRGb3J3YXJkKGNoaWxkQmFzZVVSTCArIGNoaWxkLCBtc2cuZnJvbSk7CiAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy9zZW5kIHByb3Zpc2lvbmFsIHJlc3BvbnNlCiAgICAgICAgICAgIF90aGlzMi5fYnVzLnBvc3RNZXNzYWdlKHsKICAgICAgICAgICAgICBpZDogbXNnLmlkLCB0eXBlOiAncmVzcG9uc2UnLCBmcm9tOiBtc2cudG8sIHRvOiBtc2cuZnJvbSwKICAgICAgICAgICAgICBib2R5OiB7IGNvZGU6IDEwMCwgY2hpbGRyZW5SZXNvdXJjZXM6IGNoaWxkcmVuIH0KICAgICAgICAgICAgfSk7CgogICAgICAgICAgICB2YXIgb2JqU3Vic2NyaWJlTXNnID0gewogICAgICAgICAgICAgIHR5cGU6ICdzdWJzY3JpYmUnLCBmcm9tOiBfdGhpcy5fdXJsLCB0bzogb2JqVVJMU3Vic2NyaXB0aW9uLAogICAgICAgICAgICAgIGJvZHk6IHsgc3Vic2NyaWJlcjogbXNnLmZyb20gfQogICAgICAgICAgICB9OwoKICAgICAgICAgICAgLy9zdWJzY3JpYmUgdG8gcmVwb3J0ZXIgU00KICAgICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZShvYmpTdWJzY3JpYmVNc2csIGZ1bmN0aW9uIChyZXBseSkgewogICAgICAgICAgICAgIC8vZm9yd2FyZCB0byBoeXBlcnR5OgogICAgICAgICAgICAgIHJlcGx5LmlkID0gbXNnLmlkOwogICAgICAgICAgICAgIHJlcGx5LmZyb20gPSBfdGhpcy5fdXJsOwogICAgICAgICAgICAgIHJlcGx5LnRvID0gbXNnLmZyb207CiAgICAgICAgICAgICAgX3RoaXMyLl9idXMucG9zdE1lc3NhZ2UocmVwbHkpOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vbGlzdGVuZXIgcmVqZWN0ZWQKICAgICAgICAgICAgX3RoaXMuX2J1cy5wb3N0TWVzc2FnZSh7CiAgICAgICAgICAgICAgaWQ6IG1zZy5pZCwgdHlwZTogJ3Jlc3BvbnNlJywgZnJvbTogbXNnLnRvLCB0bzogbXNnLmZyb20sCiAgICAgICAgICAgICAgYm9keTogcmVwbHkuYm9keQogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfSk7CiAgICB9CiAgfSwgewogICAga2V5OiAnX29uTG9jYWxVblN1YnNjcmliZScsCiAgICB2YWx1ZTogZnVuY3Rpb24gX29uTG9jYWxVblN1YnNjcmliZShtc2cpIHt9CiAgfSwgewogICAga2V5OiAndXJsJywKICAgIGdldDogZnVuY3Rpb24gZ2V0KCkgewogICAgICByZXR1cm4gdGhpcy5fdXJsOwogICAgfQogIH1dKTsKCiAgcmV0dXJuIFN5bmNoZXJNYW5hZ2VyOwp9KSgpOwoKZXhwb3J0c1snZGVmYXVsdCddID0gU3luY2hlck1hbmFnZXI7Cm1vZHVsZS5leHBvcnRzID0gZXhwb3J0c1snZGVmYXVsdCddOwoKfSx7Ii4uL3V0aWxzL3V0aWxzIjoxMjcsIi4vT2JqZWN0QWxsb2NhdGlvbiI6MTI0LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6MTMsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjE1LCJiYWJlbC1ydW50aW1lL2hlbHBlcnMvaW50ZXJvcC1yZXF1aXJlLWRlZmF1bHQiOjE5fV0sMTI2OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLyoqCiAqIEV2ZW50RW1pdHRlcgogKiBBbGwgY2xhc3NlcyB3aGljaCBleHRlbmRzIHRoaXMsIGNhbiBoYXZlIGFkZEV2ZW50TGlzdGVuZXIgYW5kIHRyaWdnZXIgZXZlbnRzOwogKi8KInVzZSBzdHJpY3QiOwoKdmFyIF9jcmVhdGVDbGFzcyA9IHJlcXVpcmUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiKVsiZGVmYXVsdCJdOwoKdmFyIF9jbGFzc0NhbGxDaGVjayA9IHJlcXVpcmUoImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jbGFzcy1jYWxsLWNoZWNrIilbImRlZmF1bHQiXTsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAiX19lc01vZHVsZSIsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKCnZhciBFdmVudEVtaXR0ZXIgPSAoZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIEV2ZW50RW1pdHRlcigpIHsKICAgIF9jbGFzc0NhbGxDaGVjayh0aGlzLCBFdmVudEVtaXR0ZXIpOwogIH0KCiAgX2NyZWF0ZUNsYXNzKEV2ZW50RW1pdHRlciwgW3sKICAgIGtleTogImFkZEV2ZW50TGlzdGVuZXIiLAoKICAgIC8qKgogICAgICogYWRkRXZlbnRMaXN0ZW5lciBsaXN0ZW4gZm9yIGFuIGV2ZW50VHlwZQogICAgICogQHBhcmFtICB7c3RyaW5nfSAgICAgICAgIGV2ZW50VHlwZSAtIGxpc3RlbmluZyBmb3IgdGhpcyB0eXBlIG9mIGV2ZW50CiAgICAgKiBAcGFyYW0gIHtGdW5jdGlvbn0gICAgICAgY2IgICAgICAgIC0gY2FsbGJhY2sgZnVuY3Rpb24gd2lsbCBiZSBleGVjdXRlZCB3aGVuIHRoZSBldmVudCBpdCBpcyBpbnZva2VkCiAgICAgKi8KICAgIHZhbHVlOiBmdW5jdGlvbiBhZGRFdmVudExpc3RlbmVyKGV2ZW50VHlwZSwgY2IpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKICAgICAgX3RoaXNbZXZlbnRUeXBlXSA9IGNiOwogICAgfQoKICAgIC8qKgogICAgICogSW52b2tlIHRoZSBldmVudFR5cGUKICAgICAqIEBwYXJhbSAge3N0cmluZ30gZXZlbnRUeXBlIC0gZXZlbnQgd2lsbCBiZSBpbnZva2VkCiAgICAgKiBAcGFyYW0gIHtvYmplY3R9IHBhcmFtcyAtIHBhcmFtZXRlcnMgd2lsbCBiZSBwYXNzZWQgdG8gdGhlIGFkZEV2ZW50TGlzdGVuZXIKICAgICAqLwogIH0sIHsKICAgIGtleTogInRyaWdnZXIiLAogICAgdmFsdWU6IGZ1bmN0aW9uIHRyaWdnZXIoZXZlbnRUeXBlLCBwYXJhbXMpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIGlmIChfdGhpc1tldmVudFR5cGVdKSB7CiAgICAgICAgX3RoaXNbZXZlbnRUeXBlXShwYXJhbXMpOwogICAgICB9CiAgICB9CiAgfV0pOwoKICByZXR1cm4gRXZlbnRFbWl0dGVyOwp9KSgpOwoKZXhwb3J0c1siZGVmYXVsdCJdID0gRXZlbnRFbWl0dGVyOwptb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbImRlZmF1bHQiXTsKCn0seyJiYWJlbC1ydW50aW1lL2hlbHBlcnMvY2xhc3MtY2FsbC1jaGVjayI6MTMsImJhYmVsLXJ1bnRpbWUvaGVscGVycy9jcmVhdGUtY2xhc3MiOjE1fV0sMTI3OltmdW5jdGlvbihyZXF1aXJlLG1vZHVsZSxleHBvcnRzKXsKLyoqCiAqIFN1cHBvcnQgbW9kdWxlIHdpdGggc29tZSBmdW5jdGlvbnMgd2lsbCBiZSB1c2VmdWwKICogQG1vZHVsZSB1dGlscwogKi8KCi8qKgogKiBAdHlwZWRlZiBkaXZpZGVVUkwKICogQHR5cGUgT2JqZWN0CiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSB0eXBlIFRoZSB0eXBlIG9mIFVSTAogKiBAcHJvcGVydHkge3N0cmluZ30gZG9tYWluIFRoZSBkb21haW4gb2YgVVJMCiAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBpZGVudGl0eSBUaGUgaWRlbnRpdHkgb2YgVVJMCiAqLwoKLyoqCiAqIERpdmlkZSBhbiB1cmwgaW4gdHlwZSwgZG9tYWluIGFuZCBpZGVudGl0eQogKiBAcGFyYW0gIHtVUkwuVVJMfSB1cmwgLSB1cmwgYWRkcmVzcwogKiBAcmV0dXJuIHtkaXZpZGVVUkx9IHRoZSByZXN1bHQgb2YgZGl2aWRlVVJMCiAqLwondXNlIHN0cmljdCc7Cgp2YXIgX09iamVjdCRrZXlzID0gcmVxdWlyZSgnYmFiZWwtcnVudGltZS9jb3JlLWpzL29iamVjdC9rZXlzJylbJ2RlZmF1bHQnXTsKCk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCAnX19lc01vZHVsZScsIHsKICB2YWx1ZTogdHJ1ZQp9KTsKZXhwb3J0cy5kaXZpZGVVUkwgPSBkaXZpZGVVUkw7CmV4cG9ydHMuZW1wdHlPYmplY3QgPSBlbXB0eU9iamVjdDsKZXhwb3J0cy5kZWVwQ2xvbmUgPSBkZWVwQ2xvbmU7CgpmdW5jdGlvbiBkaXZpZGVVUkwodXJsKSB7CgogIC8vIGxldCByZSA9IC8oW2EtekEtWi1dKik/OlwvXC8oPzpcLik/KFstYS16QS1aMC05QDolLl9cK34jPV17MiwyNTZ9XC5bYS16XXsyLDZ9XGIpKihcL1tcL1xkXHdcLi1dKikqKD86W1w/XSkqKC4rKSovZ2k7CiAgdmFyIHJlID0gLyhbYS16QS1aLV0qKTpcL1wvKD86XC4pPyhbLWEtekEtWjAtOUA6JS5fXCt+Iz1dezIsMjU2fSkoWy1hLXpBLVowLTlAOiUuX1wrfiM9XC9dKikvZ2k7CiAgdmFyIHN1YnN0ID0gJyQxLCQyLCQzJzsKICB2YXIgcGFydHMgPSB1cmwucmVwbGFjZShyZSwgc3Vic3QpLnNwbGl0KCcsJyk7CiAgdmFyIHJlc3VsdCA9IHsKICAgIHR5cGU6IHBhcnRzWzBdLAogICAgZG9tYWluOiBwYXJ0c1sxXSwKICAgIGlkZW50aXR5OiBwYXJ0c1syXQogIH07CgogIHJldHVybiByZXN1bHQ7Cn0KCi8qKgogKiBDaGVjayBpZiBhbiBPYmplY3QgaXMgZW1wdHkKICogQHBhcmFtICB7T2JqZWN0fSBvYmplY3QgT2JqZWN0IHRvIGJlIGNoZWNrZWQKICogQHJldHVybiB7Qm9vbGVhbn0gICAgICAgc3RhdHVzIG9mIE9iamVjdCwgZW1wdHkgb3Igbm90ICh0cnVlfGZhbHNlKTsKICovCgpmdW5jdGlvbiBlbXB0eU9iamVjdChvYmplY3QpIHsKICByZXR1cm4gX09iamVjdCRrZXlzKG9iamVjdCkubGVuZ3RoID4gMCA/IGZhbHNlIDogdHJ1ZTsKfQoKLyoqCiAqIE1ha2UgYSBDT1BZIG9mIHRoZSBvcmlnaW5hbCBkYXRhCiAqIEBwYXJhbSAge09iamVjdH0gIG9iaiAtIG9iamVjdCB0byBiZSBjbG9uZWQKICogQHJldHVybiB7T2JqZWN0fQogKi8KCmZ1bmN0aW9uIGRlZXBDbG9uZShvYmopIHsKICAvL1RPRE86IHNpbXBsZSBidXQgaW5lZmZpY2llbnQgSlNPTiBkZWVwIGNsb25lLi4uCiAgaWYgKG9iaikgcmV0dXJuIEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob2JqKSk7Cn0KCn0seyJiYWJlbC1ydW50aW1lL2NvcmUtanMvb2JqZWN0L2tleXMiOjd9XX0se30sWzEyM10pKDEyMykKfSk7",
      "sourceCodeClassname": "MyRuntime",
      "encoding": "base64",
      "signature": ""
    },
    "type": "Runtimes",
    "configuration": {},
    "signature": "",
    "messageSchemas": "",
    "dataObjects": [],
    "accessControlPolicy": "somePolicy"
  }
}
