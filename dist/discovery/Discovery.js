"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var o=0;o<r.length;o++){var s=r[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(r,o,s){return o&&e(r.prototype,o),s&&e(r,s),r}}(),_utils=require("../utils/utils"),Discovery=function(){function e(r,o){_classCallCheck(this,e);var s=this;s.messageBus=o,s.domain=(0,_utils.divideURL)(r).domain,s.discoveryURL=r}return _createClass(e,[{key:"discoverDataObjectPerName",value:function(e,r){var o=this,s=void 0;s=r?r:o.domain;var t={type:"read",from:o.discoveryURL,to:"domain://registry."+s+"/",body:{resource:e}};return new Promise(function(e,r){o.messageBus.postMessage(t,function(o){var s=o.body.value;s?e(s):r("DataObject not found")})})}},{key:"discoverDataObjectPerURL",value:function(e,r){var o=this,s=void 0;s=r?r:o.domain;var t={type:"read",from:o.discoveryURL,to:"domain://registry."+s+"/",body:{resource:e}};return new Promise(function(e,r){o.messageBus.postMessage(t,function(o){var s=o.body.value;s?e(s):r("DataObject not found")})})}},{key:"deleteDataObject",value:function(e,r){var o=this,s=void 0;s=r?r:o.domain;var t={type:"delete",from:o.discoveryURL,to:"domain://registry."+s+"/",body:{value:{name:e}}};return new Promise(function(e,r){o.messageBus.postMessage(t,function(o){var s=o.body.code;200===s?e(s):r("Error on deleting dataObject")})})}},{key:"discoverDataObjectPerReporter",value:function(e,r){var o=this,s=void 0;s=r?r:o.domain;var t={type:"read",from:o.discoveryURL,to:"domain://registry."+s+"/",body:{resource:e}};return new Promise(function(e,r){o.messageBus.postMessage(t,function(o){var s=o.body.value;s?e(s):r("No dataObject was found")})})}},{key:"discoverDataObject",value:function(e,r,o,s){var t=this,i=void 0;i=s?s:t.domain;var a={type:"read",from:t.discoveryURL,to:"domain://registry."+i+"/",body:{resource:e,criteria:{resources:o,dataSchemes:r}}};return new Promise(function(e,r){t.messageBus.postMessage(a,function(o){var s=o.body.value;s?e(s):r("No DataObject was found")})})}},{key:"discoverHyperty",value:function(e,r,o,s){var t=this,i=void 0,a=(0,_utils.convertToUserURL)(e);i=s?s:t.domain;var n={type:"read",from:t.discoveryURL,to:"domain://registry."+i+"/",body:{resource:a,criteria:{resources:o,dataSchemes:r}}};return new Promise(function(e,r){t.messageBus.postMessage(n,function(o){var s=o.body.value;s?e(s):r("No Hyperty was found")})})}},{key:"discoverHypertyPerUser",value:function(e,r){var o=this,s=void 0;s=r?r:o.domain;var t="user://"+e.substring(e.indexOf("@")+1,e.length)+"/"+e.substring(0,e.indexOf("@")),i={type:"read",from:o.discoveryURL,to:"domain://registry."+s+"/",body:{resource:t}};return console.log("Message: ",i,s,t),new Promise(function(r,s){o.messageBus.postMessage(i,function(o){console.log("message reply",o);var t=void 0,i=void 0,a=void 0,n=o.body.value;for(t in n)if(void 0!==n[t].lastModified)if(void 0===i)i=new Date(n[t].lastModified),a=t;else{var d=new Date(n[t].lastModified);i.getTime()<d.getTime()&&(i=d,a=t)}console.log("Last Hyperty: ",a,i);var u=a;if(void 0===u)return s("User Hyperty not found");var c={id:e,descriptor:n[u].descriptor,hypertyURL:u};console.log("===> hypertyDiscovery messageBundle: ",c),r(c)})})}},{key:"discoverHypertiesPerUser",value:function(e,r){var o=this,s=void 0;s=r?r:o.domain;var t="user://"+e.substring(e.indexOf("@")+1,e.length)+"/"+e.substring(0,e.indexOf("@")),i={type:"read",from:o.discoveryURL,to:"domain://registry."+s+"/",body:{resource:t}};return console.log("Message discoverHypertiesPerUser: ",i,s,t),new Promise(function(e,r){o.messageBus.postMessage(i,function(o){console.log("discoverHypertiesPerUser reply",o);var s=o.body.value;return s?void e(s):r("User Hyperty not found")})})}},{key:"deleteHyperty",value:function(e,r,o){var s=this,t=void 0;t=o?o:s.domain;var i={type:"delete",from:s.discoveryURL,to:"domain://registry."+t+"/",body:{value:{user:e,url:r}}};return new Promise(function(e,r){s.messageBus.postMessage(i,function(o){var s=o.body.code;s?e("Hyperty successfully deleted"):r("Error on deleting hyperty")})})}}]),e}();exports["default"]=Discovery,module.exports=exports["default"];
//# sourceMappingURL=Discovery.js.map
