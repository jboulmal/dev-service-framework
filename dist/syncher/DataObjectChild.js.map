{"version":3,"sources":["syncher/DataObjectChild.js"],"names":["_interopRequireDefault","obj","__esModule","default","_classCallCheck","instance","Constructor","TypeError","Object","defineProperty","exports","value","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","protoProps","staticProps","prototype","_SyncObject","require","_SyncObject2","DataObjectChild","parent","childId","initialData","owner","msgId","this","_this","_parent","_childId","_owner","_msgId","_syncObj","_bus","_allocateListeners","_listener","addListener","msg","type","id","console","log","_onResponse","remove","_children","_releaseListeners","callback","observe","event","_onResponseHandler","url","body","source","code","get","data","module"],"mappings":"AAAA,YAqBgG,SAASA,wBAAuBC,GAAK,MAAOA,IAAKA,EAAIC,WAAWD,GAAKE,UAAQF,GAAM,QAASG,iBAAgBC,EAASC,GAAa,KAAKD,YAAoBC,IAAc,KAAM,IAAIC,WAAU,qCArBhRC,OAAOC,eAAeC,QAAQ,cAAcC,OAAM,GAAO,IAAIC,cAAa,WAAW,QAASC,GAAiBC,EAAOC,GAAO,IAAI,GAAIC,GAAE,EAAEA,EAAED,EAAME,OAAOD,IAAI,CAAC,GAAIE,GAAWH,EAAMC,EAAGE,GAAWC,WAAWD,EAAWC,aAAY,EAAMD,EAAWE,cAAa,EAAQ,SAAUF,KAAWA,EAAWG,UAAS,GAAKb,OAAOC,eAAeK,EAAOI,EAAWI,IAAIJ,IAAc,MAAO,UAASZ,EAAYiB,EAAWC,GAAuI,MAAvHD,IAAWV,EAAiBP,EAAYmB,UAAUF,GAAeC,GAAYX,EAAiBP,EAAYkB,GAAoBlB,MAuBljBoB,YAAAC,QAAA,gBAF+CC,aAAa5B,uBAAuB0B,aAQ7EG,gBAL4C,WAgBhD,QAAAA,GAAYC,EAAQC,EAASC,EAAaC,EAAOC,GAAO9B,gBAAA+B,KAAAN,EACtD,IAAIO,GAAQD,IAEZC,GAAMC,QAAUP,EAChBM,EAAME,SAAWP,EACjBK,EAAMG,OAASN,EACfG,EAAMI,OAASN,EAEfE,EAAMK,SAAW,GAAAb,cAAAA,WAAeI,GAEhCI,EAAMM,KAAOZ,EAAOY,KACpBN,EAAMO,qBAH2D,MAjBgP/B,cAAaiB,IAAkBP,IAAI,qBAAqBX,MAAM,WAwB/W,GAAIyB,GAAQD,IAGRC,GAAMG,SACRH,EAAMQ,UAAYR,EAAMM,KAAKG,YAAYT,EAAMG,OAAQ,SAACO,GACrC,aAAbA,EAAIC,MAAuBD,EAAIE,KAAOZ,EAAMI,SAC9CS,QAAQC,IAAI,8BAA+BJ,GAC3CV,EAAMe,YAAYL,UA9BuLxB,IAAI,oBAAoBX,MAAM,WAqC7O,GAAIyB,GAAQD,IAERC,GAAMQ,WACRR,EAAMQ,UAAUQ,YAtCd9B,IAAI,SAASX,MAAM,WA8CvB,GAAIyB,GAAQD,WAELC,GAAMC,QAAQgB,UAAUjB,EAAME,UAErCF,EAAMkB,uBA9CFhC,IAAI,WAGPX,MAAM,SAgEA4C,GACPpB,KAAKM,SAASe,QAAQ,SAACC,GACrBF,EAASE,QA/DPnC,IAAI,aAAaX,MAAM,SAuElB4C,GACTpB,KAAKuB,mBAAqBH,KAvE3BjC,IAAI,cAAcX,MAAM,SA2EbmC,GACV,GAAIV,GAAQD,KAERsB,GACFV,KAAMD,EAAIC,KACVY,IAAKb,EAAIc,KAAKC,OACdC,KAAMhB,EAAIc,KAAKE,KAGb1B,GAAMsB,oBACRtB,EAAMsB,mBAAmBD,MArFwKnC,IAAI,UAAUyC,IAAI,WAgDvM,MAAO5B,MAAKG,YA7CtBhB,IAAI,OAAOyC,IAAI,WAmDR,MAAO5B,MAAKM,SAASuB,SAnDwCnC,IAAoBnB,SAAAA,WAwFjFmB,gBAxFiHoC,OAAOvD,QAAQA,QAAQ","file":"syncher/DataObjectChild.js","sourcesContent":["/**\n* Copyright 2016 PT Inovação e Sistemas SA\n* Copyright 2016 INESC-ID\n* Copyright 2016 QUOBIS NETWORKS SL\n* Copyright 2016 FRAUNHOFER-GESELLSCHAFT ZUR FOERDERUNG DER ANGEWANDTEN FORSCHUNG E.V\n* Copyright 2016 ORANGE SA\n* Copyright 2016 Deutsche Telekom AG\n* Copyright 2016 Apizee\n* Copyright 2016 TECHNISCHE UNIVERSITAT BERLIN\n*\n* Licensed under the Apache License, Version 2.0 (the \"License\");\n* you may not use this file except in compliance with the License.\n* You may obtain a copy of the License at\n*\n*   http://www.apache.org/licenses/LICENSE-2.0\n*\n* Unless required by applicable law or agreed to in writing, software\n* distributed under the License is distributed on an \"AS IS\" BASIS,\n* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n* See the License for the specific language governing permissions and\n* limitations under the License.\n**/\n\nimport SyncObject from './SyncObject';\n\n/**\n * The class returned from the DataObject addChildren call or from onAddChildren if remotely created.\n * Children object synchronization is a a fast forward mechanism, no need for direct subscriptions, it uses the already authorized subscription from the parent DataObject.\n */\nclass DataObjectChild /* implements SyncStatus */ {\n  /* private\n\n  ----event handlers----\n  _onResponseHandler: (event) => void\n  */\n\n  /**\n   * @ignore\n   * Should not be used directly by Hyperties. It's called by the DataObject.addChildren\n   */\n  constructor(parent, childId, initialData, owner, msgId) {\n    let _this = this;\n\n    _this._parent = parent;\n    _this._childId = childId;\n    _this._owner = owner;\n    _this._msgId = msgId;\n\n    _this._syncObj = new SyncObject(initialData);\n\n    _this._bus = parent._bus;\n    _this._allocateListeners();\n  }\n\n  _allocateListeners() {\n    let _this = this;\n\n    //this is only needed for children reporters\n    if (_this._owner) {\n      _this._listener = _this._bus.addListener(_this._owner, (msg) => {\n        if (msg.type === 'response' && msg.id === _this._msgId) {\n          console.log('DataObjectChild.onResponse:', msg);\n          _this._onResponse(msg);\n        }\n      });\n    }\n  }\n\n  _releaseListeners() {\n    let _this = this;\n\n    if (_this._listener) {\n      _this._listener.remove();\n    }\n  }\n\n  /**\n   * Release and delete object data\n   */\n  delete() {\n    let _this = this;\n\n    delete _this._parent._children[_this._childId];\n\n    _this._releaseListeners();\n\n    //TODO: send delete message ?\n  }\n\n  /**\n   * Children ID generated on addChildren. Unique identifier\n   * @type {URL} - URL of the format <HypertyURL>#<numeric-sequence>\n   */\n  get childId() { return this._childId; }\n\n  /**\n   * Data Structure to be synchronized.\n   * @type {JSON} - JSON structure that should follow the defined schema, if any.\n   */\n  get data() { return this._syncObj.data; }\n\n  /**\n   * Register the change listeners sent by the reporter child\n   * @param {function(event: MsgEvent)} callback\n   */\n  onChange(callback) {\n    this._syncObj.observe((event) => {\n      callback(event);\n    });\n  }\n\n  /**\n   * Setup the callback to process response notifications of the creates\n   * @param {function(event: MsgEvent)} callback\n   */\n  onResponse(callback) {\n    this._onResponseHandler = callback;\n  }\n\n  //FLOW-IN: message received from a remote DataObject -> _onChildCreate\n  _onResponse(msg) {\n    let _this = this;\n\n    let event = {\n      type: msg.type,\n      url: msg.body.source,\n      code: msg.body.code\n    };\n\n    if (_this._onResponseHandler) {\n      _this._onResponseHandler(event);\n    }\n  }\n\n}\n\nexport default DataObjectChild;\n"],"sourceRoot":"/source/"}