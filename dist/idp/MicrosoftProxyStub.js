"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function activate(e,t,o){return{name:"MicrosoftProxyStub",instance:new MicrosoftProxyStub(e,t,o)}}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var n=t[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,o,n){return o&&e(t.prototype,o),n&&e(t,n),t}}();exports["default"]=activate;var identities={},nIdentity=0,microsoftInfo={clientID:"7e2f3589-4b38-4b1c-a321-c9251de00ef2",redirectURI:location.origin,tokenEndpoint:"https://login.windows.net/common/oauth2/authorize?",type:"id_token",scope:"openid",mode:"fragment"},idp={validateAssertion:function(e,t){return new Promise(function(t,o){var n=JSON.parse(atob(e));t({identity:n.email,contents:n})})},generateAssertion:function(e,t,o){return new Promise(function(t,n){if(o){var r=o.split("."),i=JSON.parse(atob(r[1])),s={domain:"google.com",protocol:"OIDC"},a={assertion:r[1],idp:s,infoToken:i};t(a)}else{var c=microsoftInfo,u=c.tokenEndpoint+"response_type="+c.type+"&client_id="+c.clientID+"&scope="+c.scope+"&nonce="+e+"&response_mode="+c.mode+"&redirect_uri="+c.redirectURI;n({name:"IdPLoginError",loginUrl:u})}})}},MicrosoftProxyStub=function(){function e(t,o,n){_classCallCheck(this,e);var r=this;r.runtimeProtoStubURL=t,r.messageBus=o,r.config=n,r.messageBus.addListener("*",function(e){"domain-idp://microsoft.com"===e.to&&r.requestToIdp(e)})}return _createClass(e,[{key:"requestToIdp",value:function(e){var t=this,o=e.body.params;switch(e.body.method){case"generateAssertion":idp.generateAssertion(o.contents,o.origin,o.usernameHint).then(function(o){t.replyMessage(e,o)},function(o){t.replyMessage(e,o)});break;case"validateAssertion":idp.validateAssertion(o.assertion,o.origin).then(function(o){t.replyMessage(e,o)},function(o){t.replyMessage(e,o)})}}},{key:"replyMessage",value:function(e,t){var o=this,n={id:e.id,type:"response",to:e.from,from:e.to,body:{code:200,value:t}};o.messageBus.postMessage(n)}}]),e}();module.exports=exports["default"];
//# sourceMappingURL=MicrosoftProxyStub.js.map
